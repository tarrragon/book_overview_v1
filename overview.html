<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Readmoo書籍目錄</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 14px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px 8px;
            text-align: left;
            vertical-align: top;
        }
        th {
            background-color: #4285f4;
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        tr:hover {
            background-color: #e3f2fd;
        }
        .book-cover {
            width: 60px;
            height: 90px;
            object-fit: cover;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .book-id {
            font-family: monospace;
            font-size: 12px;
            color: #666;
        }
        .book-title {
            font-weight: 500;
            color: #1976d2;
            max-width: 300px;
            word-wrap: break-word;
        }
        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #e8f0fe;
            border-radius: 8px;
        }
        .stat-item {
            text-align: center;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #1976d2;
        }
        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        .export-buttons {
            margin-bottom: 20px;
            text-align: center;
        }
        .export-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .export-btn:hover {
            background: #3367d6;
        }
        #searchBox {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        #searchBox:focus {
            outline: none;
            border-color: #4285f4;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📚 Readmoo書籍目錄</h1>
        
        <div class="stats">
            <div class="stat-item">
                <div class="stat-number" id="totalBooks">0</div>
                <div class="stat-label">總書籍數</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="displayedBooks">0</div>
                <div class="stat-label">顯示中</div>
            </div>
        </div>

        <input type="text" id="searchBox" placeholder="🔍 搜尋書籍標題..." oninput="filterBooks()">
        
        <div class="export-buttons">
            <button class="export-btn" onclick="exportToCSV()">📊 匯出 CSV</button>
            <button class="export-btn" onclick="copyTableText()">📋 複製表格文字</button>
            <button class="export-btn" onclick="selectAllTable()">✅ 選取全部</button>
            <button class="export-btn" onclick="resetAndReload()">🔄 重新載入檔案</button>
        </div>

        <div id="fileUploader" style="display: none;">
            <div style="text-align: center; padding: 20px; border: 2px dashed #4285f4; border-radius: 8px; margin: 20px 0; background-color: #f8f9fa;">
                <h3>📁 載入書籍 JSON 檔案</h3>
                <p>請選擇包含書籍資料的 JSON 檔案</p>
                <input type="file" id="jsonFileInput" accept=".json" style="margin: 10px;">
                <br>
                <button class="export-btn" onclick="loadFromFile()">📂 載入檔案</button>
                <button class="export-btn" onclick="loadSampleData()">📚 載入範例資料</button>
            </div>
        </div>

        <table id="booksTable">
            <thead>
                <tr>
                    <th>封面</th>
                    <th>書籍ID</th>
                    <th>書名</th>
                </tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
        </table>
    </div>

    <script>
        let booksData = []; // 改為空陣列，等待載入資料

        const sampleData = [
    {
        "id": "210327003000101",
        "title": "大腦不滿足",
        "cover": "https://cdn.readmoo.com/cover/jb/qpfmrmi_210x315.jpg?v=1714370332"
    },
    {
        "id": "210165843000101",
        "title": "我們為何吃太多？",
        "cover": "https://cdn.readmoo.com/cover/a9/37l3i8f_210x315.jpg?v=1734599599"
    },
    {
        "id": "210120158000101",
        "title": "雜食者的兩難（新版）",
        "cover": "https://cdn.readmoo.com/cover/qh/kogrvjr_210x315.jpg?v=1574841701"
    },
    {
        "id": "210278978000101",
        "title": "國家的視角",
        "cover": "https://cdn.readmoo.com/cover/92/ca97l77_210x315.jpg?v=1688694153"
    },
    {
        "id": "210305735000101",
        "title": "想像的共同體──民族主義的起源與散布",
        "cover": "https://cdn.readmoo.com/cover/fk/bb9imfe_210x315.jpg?v=1748087489"
    },
    {
        "id": "210192970000101",
        "title": "鍋匠 裁縫 士兵 間諜",
        "cover": "https://cdn.readmoo.com/cover/ka/fgcmpbf_210x315.jpg?v=1631612880"
    },
    {
        "id": "210331412000101",
        "title": "迷宮中的盲眼蚯蚓",
        "cover": "https://cdn.readmoo.com/cover/bd/dc85k97_210x315.jpg?v=1736131715"
    },
    {
        "id": "210324894000101",
        "title": "現代政治思想史：從霍布斯到馬克思",
        "cover": "https://cdn.readmoo.com/cover/qj/miqtvgm_210x315.jpg?v=1712719808"
    },
    {
        "id": "210278228000101",
        "title": "長安的荔枝",
        "cover": "https://cdn.readmoo.com/cover/bc/ac5dkh4_210x315.jpg?v=1687161691"
    },
    {
        "id": "210200211000101",
        "title": "誰會愛上你受的傷（Netflix動畫影集《馬男波傑克》主創者首部短篇小說集）",
        "cover": "https://cdn.readmoo.com/cover/a5/a43aigc_210x315.jpg?v=1669015633"
    },
    {
        "id": "210224292000101",
        "title": "一枝筆就能開始的素描課【視角篇】",
        "cover": "https://cdn.readmoo.com/cover/bc/ab5ike9_210x315.jpg?v=1752739965"
    },
    {
        "id": "210224293000101",
        "title": "一枝筆就能開始的素描課【人物篇】",
        "cover": "https://cdn.readmoo.com/cover/ci/al7cjga_210x315.jpg?v=1752739977"
    },
    {
        "id": "210224294000101",
        "title": "一枝筆就能開始的素描課【光影篇】",
        "cover": "https://cdn.readmoo.com/cover/ea/b98jnlb_210x315.jpg?v=1752740014"
    },
    {
        "id": "210209760000101",
        "title": "這樣經營，餐廳才會賺",
        "cover": "https://cdn.readmoo.com/cover/63/8a51g76_210x315.jpg?v=1639129979"
    },
    {
        "id": "210136866000101",
        "title": "懸案密碼：籠裡的女人",
        "cover": "https://cdn.readmoo.com/cover/92/2haal7a_210x315.jpg?v=1586505525"
    },
    {
        "id": "210315219000101",
        "title": "亞洲海洋大歷史：從葉門到橫濱的跨海域世界",
        "cover": "https://cdn.readmoo.com/cover/a5/a587i7l_210x315.jpg?v=1708414507"
    },
    {
        "id": "210140148000101",
        "title": "柳橙不是唯一的水果",
        "cover": "https://cdn.readmoo.com/cover/bb/gia7kd4_210x315.jpg?v=1639573375"
    },
    {
        "id": "210292992000101",
        "title": "國家的品格",
        "cover": "https://cdn.readmoo.com/cover/64/bbb1g9b_210x315.jpg?v=1696263879"
    },
    {
        "id": "210383389000101",
        "title": "把時間買回來",
        "cover": "https://cdn.readmoo.com/cover/mr/mlmpthq_210x315.jpg?v=1745210143"
    },
    {
        "id": "210157899000101",
        "title": "艱困時代的經濟學思考",
        "cover": "https://cdn.readmoo.com/cover/jg/nfqjril_210x315.jpg?v=1660531982"
    },
    {
        "id": "210033824000101",
        "title": "貨幣崛起",
        "cover": "https://cdn.readmoo.com/cover/64/236cg18_210x315.jpg?v=1525072449"
    },
    {
        "id": "210217152000101",
        "title": "極限返航",
        "cover": "https://cdn.readmoo.com/cover/5f/f710gcf_210x315.jpg?v=1645524040"
    },
    {
        "id": "210385251000101",
        "title": "雜碎",
        "cover": "https://cdn.readmoo.com/cover/a5/a44fi4c_210x315.jpg?v=1745891225"
    },
    {
        "id": "210391998000101",
        "title": "咦，一手包辦公司系統的我被開除了嗎？ (2)(漫畫)",
        "cover": "https://cdn.readmoo.com/cover/qn/gzzkvjj_210x315.jpg?v=1748943271"
    },
    {
        "id": "210331963000101",
        "title": "咦，一手包辦公司系統的我被開除了嗎？ (1)(漫畫)",
        "cover": "https://cdn.readmoo.com/cover/jh/fmlprqi_210x315.jpg?v=1717552390"
    },
    {
        "id": "210340054000101",
        "title": "沉默的告別",
        "cover": "https://cdn.readmoo.com/cover/e9/87j9nff_210x315.jpg?v=1721377172"
    },
    {
        "id": "210306292000101",
        "title": "《那年，我們的夏天》寫真散文",
        "cover": "https://cdn.readmoo.com/cover/bc/ab6bkg9_210x315.jpg?v=1703561764"
    },
    {
        "id": "210211153000101",
        "title": "火鳳燎原 (12)",
        "cover": "https://cdn.readmoo.com/cover/76/fe12h7g_210x315.jpg?v=1640537486"
    },
    {
        "id": "210217655000101",
        "title": "順勢溝通",
        "cover": "https://cdn.readmoo.com/cover/fi/hlgkmen_210x315.jpg?v=1646108694"
    },
    {
        "id": "210324932000101",
        "title": "超級專案管理：牛津大學教授揭示計畫成敗的法則，教你順利完成任何專案",
        "cover": "https://cdn.readmoo.com/cover/bg/d77hkc7_210x315.jpg?v=1736136837"
    },
    {
        "id": "210327635000101",
        "title": "控制邊緣",
        "cover": "https://cdn.readmoo.com/cover/a7/g74cihe_210x315.jpg?v=1715069273"
    },
    {
        "id": "210307667000101",
        "title": "過載",
        "cover": "https://cdn.readmoo.com/cover/a7/g79aild_210x315.jpg?v=1704293778"
    },
    {
        "id": "210198524000101",
        "title": "創造文明的人",
        "cover": "https://cdn.readmoo.com/cover/nj/pcgkzoc_210x315.jpg?v=1722216354"
    },
    {
        "id": "210299879000101",
        "title": "幽默",
        "cover": "https://cdn.readmoo.com/cover/fk/kkdjmj8_210x315.jpg?v=1699342638"
    },
    {
        "id": "210200901000101",
        "title": "搞定！",
        "cover": "https://cdn.readmoo.com/cover/d7/ddicjad_210x315.jpg?v=1634054869"
    },
    {
        "id": "210367788000101",
        "title": "中華料理的世界史",
        "cover": "https://cdn.readmoo.com/cover/nm/decpzok_210x315.jpg?v=1747194859"
    },
    {
        "id": "210383930000101",
        "title": "世界還能變好嗎？",
        "cover": "https://cdn.readmoo.com/cover/ka/fgdbpjh_210x315.jpg?v=1745483996"
    },
    {
        "id": "210337485000101",
        "title": "進烤箱的好日子（獨家附贈紀念版書封）",
        "cover": "https://cdn.readmoo.com/cover/mz/gpoitzm_210x315.jpg?v=1751245900"
    },
    {
        "id": "210324680000101",
        "title": "老窮奇幻紀事",
        "cover": "https://cdn.readmoo.com/cover/ha/l8lmong_210x315.jpg?v=1712548577"
    },
    {
        "id": "210317285000101",
        "title": "在世界盡頭遇到松茸",
        "cover": "https://cdn.readmoo.com/cover/ci/ald6jib_210x315.jpg?v=1709601175"
    },
    {
        "id": "210368642000101",
        "title": "餐桌上的中國史",
        "cover": "https://cdn.readmoo.com/cover/8g/ffe9lee_210x315.jpg?v=1737531937"
    },
    {
        "id": "210343661000102",
        "title": "二戰（三冊不分售）",
        "cover": "https://cdn.readmoo.com/cover/od/irgjtff_210x315.jpg?v=1726033368"
    },
    {
        "id": "210218052000101",
        "title": "雖然會胖，但還是想一個人吃完半半炸雞再睡",
        "cover": "https://cdn.readmoo.com/cover/bb/7a46k7b_210x315.jpg?v=1646363432"
    },
    {
        "id": "210224190000101",
        "title": "呼吸",
        "cover": "https://cdn.readmoo.com/cover/qh/kmeivei_210x315.jpg?v=1649816002"
    },
    {
        "id": "210313005000101",
        "title": "也好吃",
        "cover": "https://cdn.readmoo.com/cover/mq/pohptgr_210x315.jpg?v=1707104495"
    },
    {
        "id": "210364615000101",
        "title": "前端測試指南：策略與實踐",
        "cover": "https://cdn.readmoo.com/cover/fi/hlg9mcg_210x315.jpg?v=1738554588"
    },
    {
        "id": "210221848000101",
        "title": "毛姆文學課",
        "cover": "https://cdn.readmoo.com/cover/hb/jb8hocg_210x315.jpg?v=1647929240"
    },
    {
        "id": "210353836000101",
        "title": "SRE工作現場直擊：維運起點x實戰經驗x職涯規劃面面觀（iThome鐵人賽系列書）",
        "cover": "https://cdn.readmoo.com/cover/nm/nngizij_210x315.jpg?v=1729647771"
    },
    {
        "id": "210356725000101",
        "title": "可觀測性入門指南：Logs、Metrics、Traces三大實戰應用，用24個Lab鞏固你的SRE技能樹(iThome鐵人賽系列書)",
        "cover": "https://cdn.readmoo.com/cover/d6/adbijf5_210x315.jpg?v=1731637373"
    },
    {
        "id": "210278375000101",
        "title": "超乎常理的款待",
        "cover": "https://cdn.readmoo.com/cover/fh/j8kjm9c_210x315.jpg?v=1704171897"
    },
    {
        "id": "210350943000101",
        "title": "厭世機器人Ⅳ",
        "cover": "https://cdn.readmoo.com/cover/pt/hiffugh_210x315.jpg?v=1728649111"
    },
    {
        "id": "210251205000101",
        "title": "厭世機器人Ⅲ",
        "cover": "https://cdn.readmoo.com/cover/ci/albfj87_210x315.jpg?v=1671524941"
    },
    {
        "id": "210346223000101",
        "title": "只有屍體不會說謊",
        "cover": "https://cdn.readmoo.com/cover/po/vnvouvj_210x315.jpg?v=1728892379"
    },
    {
        "id": "210093593000101",
        "title": "直搗蜂窩的女孩【寂寞創社10週年紀念版】",
        "cover": "https://cdn.readmoo.com/cover/lg/omfiqjk_210x315.jpg?v=1744009672"
    },
    {
        "id": "210093591000101",
        "title": "龍紋身的女孩【寂寞創社10週年紀念版】",
        "cover": "https://cdn.readmoo.com/cover/fi/89chmhl_210x315.jpg?v=1625125872"
    },
    {
        "id": "210093592000101",
        "title": "玩火的女孩【寂寞創社10週年紀念版】",
        "cover": "https://cdn.readmoo.com/cover/ha/8geaoii_210x315.jpg?v=1745379334"
    },
    {
        "id": "210325379000101",
        "title": "八月砲火",
        "cover": "https://cdn.readmoo.com/cover/a6/3dhdigl_210x315.jpg?v=1713313857"
    },
    {
        "id": "210164959000101",
        "title": "身分政治",
        "cover": "https://cdn.readmoo.com/cover/pt/hivoukk_210x315.jpg?v=1609145854"
    },
    {
        "id": "210367814000101",
        "title": "騷動火藥庫",
        "cover": "https://cdn.readmoo.com/cover/ed/kcl9n67_210x315.jpg?v=1737453711"
    },
    {
        "id": "210335100000101",
        "title": "停損的勝算",
        "cover": "https://cdn.readmoo.com/cover/ni/iqgizhe_210x315.jpg?v=1719393389"
    },
    {
        "id": "210240941000101",
        "title": "東南亞史",
        "cover": "https://cdn.readmoo.com/cover/of/gkrztjh_210x315.jpg?v=1659948475"
    },
    {
        "id": "210214151000101",
        "title": "順著大腦來生活",
        "cover": "https://cdn.readmoo.com/cover/fg/l77cm7e_210x315.jpg?v=1642690277"
    },
    {
        "id": "210369415000101",
        "title": "電玩的本質",
        "cover": "https://cdn.readmoo.com/cover/fl/ehefmj8_210x315.jpg?v=1738620576"
    },
    {
        "id": "210253652000101",
        "title": "鷹架教養",
        "cover": "https://cdn.readmoo.com/cover/be/gdb9khb_210x315.jpg?v=1667777432"
    },
    {
        "id": "210252757000101",
        "title": "告訴我，你為什麼殺人",
        "cover": "https://cdn.readmoo.com/cover/d6/adfhjgk_210x315.jpg?v=1667818835"
    },
    {
        "id": "210117464000101",
        "title": "向下扎根！德國教育的公民思辨課7－「過濾氣泡、假新聞與說謊媒體──我們如何避免被操弄？」",
        "cover": "https://cdn.readmoo.com/cover/h9/f8alo8k_210x315.jpg?v=1570507452"
    },
    {
        "id": "210104657000101",
        "title": "徹底坦率",
        "cover": "https://cdn.readmoo.com/cover/79/f9aah8a_210x315.jpg?v=1552644417"
    },
    {
        "id": "210106378000101",
        "title": "凝視死亡",
        "cover": "https://cdn.readmoo.com/cover/in/ndompmj_210x315.jpg?v=1623134235"
    },
    {
        "id": "210214539000101",
        "title": "男孩，鼴鼠，狐狸與馬",
        "cover": "https://cdn.readmoo.com/cover/je/qncnrig_210x315.jpg?v=1669689377"
    },
    {
        "id": "210107066000101",
        "title": "一個女人，在北極",
        "cover": "https://cdn.readmoo.com/cover/ik/qioapcc_210x315.jpg?v=1555901640"
    },
    {
        "id": "210235608000101",
        "title": "每個孩子都能好好吃飯【跨世代長銷經典版】",
        "cover": "https://cdn.readmoo.com/cover/ha/l9nionn_210x315.jpg?v=1657251792"
    },
    {
        "id": "210235606000101",
        "title": "每個孩子都能學好規矩【跨世代長銷經典版】",
        "cover": "https://cdn.readmoo.com/cover/ec/hbihnlk_210x315.jpg?v=1657180801"
    },
    {
        "id": "210125836000101",
        "title": "平凡的邪惡",
        "cover": "https://cdn.readmoo.com/cover/nm/nngpzlf_210x315.jpg?v=1578384390"
    },
    {
        "id": "210218454000101",
        "title": "災難清理教我的事",
        "cover": "https://cdn.readmoo.com/cover/eb/eaclnbd_210x315.jpg?v=1646367899"
    },
    {
        "id": "210373722000101",
        "title": "想做料理的她與愛吃美食的她 (4)",
        "cover": "https://cdn.readmoo.com/cover/iq/cffcpnn_210x315.jpg?v=1740625838"
    },
    {
        "id": "210326487000101",
        "title": "豁然開朗的商業模式思考",
        "cover": "https://cdn.readmoo.com/cover/fl/ehllm9f_210x315.jpg?v=1714018564"
    },
    {
        "id": "210303892000101",
        "title": "烏合之眾",
        "cover": "https://cdn.readmoo.com/cover/bf/iee7k4h_210x315.jpg?v=1708919004"
    },
    {
        "id": "210292472000101",
        "title": "誤判的總和",
        "cover": "https://cdn.readmoo.com/cover/h9/emkho9h_210x315.jpg?v=1695696759"
    },
    {
        "id": "210288710000101",
        "title": "報導的技藝（二版）",
        "cover": "https://cdn.readmoo.com/cover/ed/aif9nif_210x315.jpg?v=1708919128"
    },
    {
        "id": "210252934000101",
        "title": "智慧型手機知識碎片化時代的「閱讀力」最新技術大全",
        "cover": "https://cdn.readmoo.com/cover/ee/djabnei_210x315.jpg?v=1675937920"
    },
    {
        "id": "210109705000101",
        "title": "拚教養",
        "cover": "https://cdn.readmoo.com/cover/ll/boonqej_210x315.jpg?v=1660529526"
    },
    {
        "id": "210171248000101",
        "title": "風之帝國：全球貿易的關鍵地帶，海洋亞洲的盛世繁華",
        "cover": "https://cdn.readmoo.com/cover/60/907ag16_210x315.jpg?v=1612765375"
    },
    {
        "id": "210276874000101",
        "title": "毛姆閱讀課",
        "cover": "https://cdn.readmoo.com/cover/iq/joecpnf_210x315.jpg?v=1686669322"
    },
    {
        "id": "210236459000101",
        "title": "阿宅的戀愛太難 (11)",
        "cover": "https://cdn.readmoo.com/cover/je/gdimrqn_210x315.jpg?v=1657189475"
    },
    {
        "id": "210228694000101",
        "title": "阿宅的戀愛太難 (10)",
        "cover": "https://cdn.readmoo.com/cover/ec/hbffncb_210x315.jpg?v=1652423358"
    }
];

        function loadFromFile() {
            const fileInput = document.getElementById('jsonFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('請先選擇一個 JSON 檔案！');
                return;
            }
            
            if (!file.name.toLowerCase().endsWith('.json')) {
                alert('請選擇 JSON 格式的檔案！');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const jsonData = JSON.parse(e.target.result);
                    
                    // 驗證 JSON 格式
                    if (!Array.isArray(jsonData)) {
                        throw new Error('JSON 檔案應該包含一個陣列');
                    }
                    
                    // 驗證每個書籍物件的格式
                    for (let i = 0; i < jsonData.length; i++) {
                        const book = jsonData[i];
                        if (!book.id || !book.title || !book.cover) {
                            throw new Error(`第 ${i + 1} 個書籍缺少必要欄位 (id, title, cover)`);
                        }
                    }
                    
                    // 載入資料
                    booksData.length = 0; // 清空現有資料
                    booksData.push(...jsonData);
                    
                    // 隱藏檔案上傳介面
                    document.getElementById('fileUploader').style.display = 'none';
                    
                    // 重新渲染表格
                    renderTable();
                    
                    alert(`成功載入 ${jsonData.length} 本書籍資料！`);
                    
                } catch (error) {
                    alert(`載入檔案失敗：${error.message}`);
                }
            };
            
            reader.onerror = function() {
                alert('讀取檔案時發生錯誤！');
            };
            
            reader.readAsText(file, 'UTF-8');
        }

        function loadSampleData() {
            booksData.length = 0; // 清空現有資料
            booksData.push(...sampleData);
            
            // 隱藏檔案上傳介面
            document.getElementById('fileUploader').style.display = 'none';
            
            // 重新渲染表格
            renderTable();
            
            alert(`載入了 ${sampleData.length} 本範例書籍資料！`);
        }

        function showFileUploader() {
            document.getElementById('fileUploader').style.display = 'block';
        }

        function renderTable() {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            
            booksData.forEach((book, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <img src="${book.cover}" alt="${book.title}" class="book-cover" 
                             onerror="this.style.display='none'">
                    </td>
                    <td class="book-id">${book.id}</td>
                    <td class="book-title">${book.title}</td>
                `;
                tableBody.appendChild(row);
            });
            
            updateStats();
        }

        function updateStats() {
            const totalBooks = booksData.length;
            const displayedBooks = document.querySelectorAll('#tableBody tr').length;
            
            document.getElementById('totalBooks').textContent = totalBooks;
            document.getElementById('displayedBooks').textContent = displayedBooks;
        }

        function filterBooks() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const rows = document.querySelectorAll('#tableBody tr');
            
            rows.forEach(row => {
                const title = row.querySelector('.book-title').textContent.toLowerCase();
                const id = row.querySelector('.book-id').textContent.toLowerCase();
                
                if (title.includes(searchTerm) || id.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
            
            const visibleRows = document.querySelectorAll('#tableBody tr:not([style*="display: none"])').length;
            document.getElementById('displayedBooks').textContent = visibleRows;
        }

        function exportToCSV() {
            let csv = '書籍ID,書名,封面連結\n';
            
            booksData.forEach(book => {
                csv += `"${book.id}","${book.title.replace(/"/g, '""')}","${book.cover}"\n`;
            });
            
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'readmoo_books.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function copyTableText() {
            let text = '書籍ID\t書名\t封面連結\n';
            
            booksData.forEach(book => {
                text += `${book.id}\t${book.title}\t${book.cover}\n`;
            });
            
            navigator.clipboard.writeText(text).then(() => {
                alert('表格內容已複製到剪貼簿！可以直接貼到Google文件中。');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('表格內容已複製到剪貼簿！可以直接貼到Google文件中。');
            });
        }

        function selectAllTable() {
            const table = document.getElementById('booksTable');
            const range = document.createRange();
            range.selectNode(table);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            alert('表格已選取，請按 Ctrl+C (或 Cmd+C) 複製後貼到Google文件中。');
        }

        function resetAndReload() {
            // 清空資料陣列
            booksData.length = 0;
            
            // 清空表格
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            
            // 重新顯示檔案上傳介面
            showFileUploader();
            
            // 重置統計
            document.getElementById('totalBooks').textContent = '0';
            document.getElementById('displayedBooks').textContent = '0';
            
            // 清空搜尋框
            document.getElementById('searchBox').value = '';
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            if (booksData.length === 0) {
                showFileUploader();
            } else {
                renderTable();
            }
        });
    </script>
</body>
</html>