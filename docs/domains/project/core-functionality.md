# 📚 Readmoo 書庫提取器 - 核心功能規格

**版本**: v1.0  
**文件版本**: 2025-08-22  
**系統類型**: Chrome Extension (Manifest V3)

## 🎯 系統概述

Readmoo 書庫提取器是一個簡潔的 Chrome Extension，專注於從 Readmoo 電子書平台提取書籍資料，並提供簡單的匯出入和去重功能。系統採用**檔案為基礎的手動操作模式**，讓使用者完全控制資料的處理流程。

### 核心設計理念

基於使用者原始需求：

> "針對各書城用JS檢查頁面上的節點，撈出我要的資料（書名或者圖片網址），做成JSON格式然後匯入我們的書目資料庫...匯出JSON跟匯入JSON然後排除重複書目統整成一個資料庫"

**設計原則**：

- **簡潔至上**: 避免複雜的自動化邏輯，採用直觀的手動操作
- **檔案為中心**: 以JSON檔案為核心的資料交換格式
- **使用者控制**: 使用者決定何時提取、匯出、匯入和整理資料
- **平台無關**: 架構支援未來擴展其他書城平台

## 🔧 核心功能模組

### 1. 📖 資料提取模組 (Data Extraction)

**目的**: 從Readmoo網頁提取書籍資料

**主要組件**:

- `BookDataExtractor` - 平台無關的提取協調器
- `ReadmooAdapter` - Readmoo特定的DOM解析器

**提取資料**:

```javascript
{
  id: "cover-xxxxx",           // 穩定ID（用於去重）
  title: "書籍標題",           // 書名
  cover: "https://...",        // 封面圖片URL
  progress: 85,                // 閱讀進度 (0-100)
  source: "readmoo",           // 資料來源
  extractedAt: "2025-08-22T...", // 提取時間戳
  readerId: "xxxxx",           // 閱讀器ID
  type: "電子書"               // 書籍類型
}
```

**操作流程**:

1. 使用者訪問 Readmoo 書庫頁面
2. 點擊 Extension 圖示開啟 Popup
3. 點擊「提取書籍資料」按鈕
4. 系統自動掃描頁面並提取所有書籍資料
5. 在 Popup 中顯示提取結果

### 2. 📤 資料匯出模組 (Data Export)

**目的**: 將提取的資料匯出為檔案供備份或分享

**支援格式**:

- **JSON** - 完整資料格式，支援匯入
- **CSV** - 表格格式，便於Excel處理

**主要組件**:

- `JSONExportHandler` - JSON格式匯出處理器
- `exportToCSV()` - CSV格式匯出功能

**操作流程**:

1. 在 Popup 中查看已提取的書籍資料
2. 點擊「匯出JSON」或「匯出CSV」按鈕
3. 瀏覽器自動下載檔案到預設下載目錄
4. 檔案名稱格式：`readmoo-books-YYYY-MM-DD.json/csv`

### 3. 📥 資料匯入模組 (Data Import)

**目的**: 從JSON檔案載入書籍資料

**主要組件**:

- `loadFromFile()` - JSON檔案匯入功能
- 檔案格式驗證機制
- 資料結構驗證機制

**支援操作**:

- **載入**: 從JSON檔案載入書籍資料
- **追加**: 將新資料追加到現有資料
- **覆蓋**: 清空現有資料並載入新資料

**操作流程**:

1. 在 Overview 頁面點擊「載入檔案」按鈕
2. 選擇 JSON 檔案（必須符合系統格式）
3. 系統驗證檔案格式和資料結構
4. 資料載入並顯示在表格中

### 4. 🔄 去重統整模組 (Deduplication)

**目的**: 處理重複書目，確保資料庫一致性

**去重策略**:

```javascript
// 三層穩定ID生成策略
1. 封面ID: 從封面URL提取 (最穩定)
2. 標題ID: 正規化書名生成 (中等穩定)
3. 閱讀器ID: 從閱讀器URL提取 (最不穩定但可用)
```

**主要組件**:

- `generateStableBookId()` - 穩定ID生成演算法
- 重複檢測邏輯
- ID衝突處理機制

**處理原則**:

- **相同ID**: 以最新的資料為準（較新的extractedAt）
- **不同ID但內容相似**: 保留兩筆記錄（讓使用者手動決定）
- **進度更新**: 相同書籍以進度較新的為準

### 5. 💾 資料存儲模組 (Data Storage)

**目的**: 在瀏覽器中持久化存儲書籍資料

**存儲方式**:

- **Chrome Extension Storage API** - 主要存儲方式
- **Local Storage** - 備用存儲方式
- **記憶體存儲** - 臨時資料處理

**資料結構**:

```javascript
{
  books: [           // 書籍資料陣列
    { /* 書籍物件 */ }
  ],
  lastSync: "2025-08-22T...", // 最後同步時間
  totalBooks: 150,   // 總書籍數量
  platform: "readmoo" // 資料來源平台
}
```

### 6. 🎨 使用者介面模組 (User Interface)

**目的**: 提供直觀的使用者操作介面

**主要組件**:

- **Popup** (`popup.html`) - Extension 主要控制介面
- **Overview** (`overview.html`) - 詳細資料檢視和管理介面
- **事件驅動更新** - 即時反映資料變化

**Popup 功能**:

- 顯示目前提取的書籍數量
- 一鍵提取當前頁面資料
- 快速匯出功能
- 開啟詳細管理頁面

**Overview 功能**:

- 以表格形式顯示所有書籍
- 搜尋和篩選功能
- 匯入檔案功能
- 匯出多種格式
- 手動編輯和刪除功能

## 🔄 核心工作流程

### 標準使用流程

```
1. 資料提取
   使用者訪問Readmoo → 開啟Extension → 點擊提取 → 資料提取完成

2. 資料檢視
   開啟Overview頁面 → 查看提取的書籍清單 → 搜尋/篩選特定書籍

3. 資料匯出
   選擇匯出格式 → 點擊匯出按鈕 → 下載檔案到本地

4. 資料備份/分享
   將匯出的JSON檔案備份到雲端 → 分享給其他裝置或使用者

5. 資料匯入
   在新裝置/瀏覽器 → 載入JSON檔案 → 系統自動去重和整合
```

### 跨平台擴展流程（未來）

```
1. 新平台適配器開發
   建立新的 {Platform}Adapter → 實現相同的資料提取介面

2. 資料格式統一
   確保新平台輸出相同的JSON格式 → 去重邏輯自動處理

3. 整合測試
   測試多平台資料的匯出入 → 驗證去重邏輯正確性
```

## 🎯 系統邊界與限制

### 功能範圍內

- ✅ Readmoo 平台的書籍資料提取
- ✅ JSON/CSV 格式的資料匯出
- ✅ JSON 格式的資料匯入
- ✅ 基本的去重和資料整理
- ✅ 本地瀏覽器資料存儲
- ✅ 簡單的搜尋和篩選功能

### 功能範圍外

- ❌ 即時跨平台同步
- ❌ 複雜的衝突解決機制
- ❌ 自動化的資料同步
- ❌ 雲端存儲整合
- ❌ 多使用者協作功能
- ❌ 進階的資料分析功能
- ❌ 自動化的書籍推薦

### 技術限制

- **瀏覽器依賴**: 必須在支援Chrome Extension的瀏覽器中運行
- **DOM依賴**: 資料提取依賴於Readmoo網站的DOM結構
- **儲存限制**: 受Chrome Extension Storage API的容量限制
- **網路限制**: 僅能在有網路連接時從Readmoo提取資料

## 🔒 資料安全與隱私

### 資料處理原則

- **本地處理**: 所有資料處理都在使用者的瀏覽器本地進行
- **無第三方傳輸**: 不會將使用者資料傳送到任何外部服務
- **使用者控制**: 使用者完全控制資料的匯出、匯入和刪除
- **透明性**: 所有資料處理邏輯開源且可驗證

### 權限要求

- **主動標籤**: 只能在使用者主動開啟的Readmoo標籤中運行
- **無背景權限**: 不會在背景中自動執行任何操作
- **儲存權限**: 僅用於存儲使用者明確提取的書籍資料
- **最小權限原則**: 只請求完成核心功能所需的最少權限

## 📊 成功指標

### 功能完整性指標

- ✅ Readmoo資料提取成功率 > 95%
- ✅ JSON匯出入功能100%可用
- ✅ 去重邏輯準確率 > 99%
- ✅ 使用者介面響應時間 < 2秒

### 使用者體驗指標

- ✅ 一鍵操作：提取、匯出、匯入都是單次點擊完成
- ✅ 直觀介面：無需說明文件即可理解操作方式
- ✅ 可靠性：相同操作總是產生相同結果
- ✅ 效能：處理1000本書籍資料 < 5秒

### 系統品質指標

- ✅ 程式碼覆蓋率 > 90%
- ✅ 建置成功率 100%
- ✅ 無已知的功能性缺陷
- ✅ Chrome Extension Store 合規性 100%

---

**重要備註**: 本文件描述的是簡化後的v1.0核心功能。系統設計遵循**簡潔性優於複雜性**的原則，專注於提供穩定、可靠、易用的基本功能，而非追求功能的完整性或先進性。
