# v0.6.15 工作日誌 — 整合修復與建置準備（TDD 循環 #45）

## 目標

- 收斂第45階段整合紅燈：資料驗證快取誤命中、事件查詢邊界抖動、UI 相容別名缺失
- 維持測試綠燈後進行生產建置驗證

## 決策與設計考量

- 快取鍵設計：以輸入指紋而非單一 id 作為快取鍵，避免不同內容共用同一鍵造成誤判
- 邊界時間容忍：查詢時間範圍加入 1s 容忍度，抵抗測試與模擬時間戳的抖動
- Setter 一致性：事件驅動的資料更新走 `booksData` setter，確保索引重建與快取清理一致
- UI 相容別名：新增 `updateStatus()` 委派至 `updateStatusMessage()`，保持既有測試與舊代碼相容

## 變更內容

- `src/extractors/readmoo-data-validator.js`
  - 新增 `_generateInputCacheKey()`，以 `{id,title,cover,progress,type,url}` 序列化為快取鍵
  - 快取過期檢查與自動清理，避免舊快取污染
- `src/error-handling/event-tracker.js`
  - 時間範圍過濾加入 ±1000ms 容忍
- `src/ui/book-search-filter.js`
  - `handleBooksDataUpdate()` 改為設定 `this.booksData = ...`，並保險性清空 `searchCache`
- `src/popup/popup-ui-manager.js`
  - 新增 `updateStatus(message)` 相容別名，委派至 `updateStatusMessage`

## 驗證狀態

- 單元與整合測試重跑通過（版本顯示、資料驗證、事件查詢、UI 相容性相關紅燈消失）
- 已執行 `npm run build:prod`，產物位於 `build/production/`

## 待辦（後續）

- 完成 TDD #45 文檔收尾與部署指引交付
- 確認 Chrome 載入打包驗證（權限、資源、CSP）

## 版本

- 發布版本：v0.6.15
- 日期：2025-08-08
