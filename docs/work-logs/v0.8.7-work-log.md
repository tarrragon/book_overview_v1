# v0.8.7 工作日誌 — Overview 匯出/匯入 + 排序 + Tag 準備

## 目標與背景

- 目標：
  1. 匯出 JSON（與表格欄位一致）
  2. 匯入 JSON（支援陣列或包裝物件）
  3. 排序（書名/進度/tag；升/降冪），並為多書城預留 tag
- 背景：用戶需要跨裝置/多書城同步，以及更好的瀏覽排序體驗。

## 設計考量與決策

- 匯出 JSON 採 `{ books: [...] }`，方便回匯入與兼容未來 schema 擴充。
- 匯入流程在 Overview 端執行，不變更背景事件流；維持安全性（本地處理）。
- 排序採用：title（localeCompare, case-insensitive）、progress（數值）、tag（首個 tags 值）。
- 背景儲存時正規化 `tags`：預設加入 `readmoo`，向後相容既有資料結構。

## 變更內容

- `src/overview/overview.html`：新增「匯出 JSON」「匯入 JSON」、排序控制（鍵+方向）。
- `src/overview/overview-page-controller.js`：
  - 新增 `handleExportJSON()`、`generateJSONContent()`、`downloadJSONFile()`
  - 連接匯入按鈕與檔案 input，沿用既有讀檔與解析流程
  - 在 `applyCurrentFilter()` 加入排序（title/progress/tag + 方向）
- `src/background/background.js`：儲存前統一補上 `tags`（含 `readmoo`）。

## 測試驗證

- 整合測試（108/108）保持綠燈；功能為 UI 增強，未破壞既有流程。
- 手動驗證：實機可匯出 JSON/CSV、可匯入 JSON、排序切換生效。

## 風險與緩解

- 排序資料量增大時的效能：目前資料量（<1k）足夠；若未來大量增長，將引入虛擬清單與排序快取。
- JSON schema 演進：以包裝物件 `{ books }` 避免破壞性變更；保留向後相容性。

## 後續工作（v0.8.8 提案）

- EventBus `getStats()` 文件化與測試。
- 排序與搜尋整合（多欄位次序、多鍵排序）。
- 多書城正式導入（kobo/bookwalker），擴充 tags 與來源正規化。
