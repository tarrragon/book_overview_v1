# v0.6.14 工作日誌 — 版本顯示動態化與測試（TDD 循環 #45 部分）

## 目標

- 將 Popup 版本顯示從硬編碼調整為動態讀取 `manifest.json`
- 以測試驗證版本顯示邏輯（一般版 / 開發版 / 例外情況）

## 決策與設計考量

- 避免硬編碼版本字串，維持版本資訊單一事實來源（`manifest.json`）
- `popup.js` 使用 `chrome.runtime.getManifest()` 取得 `version`
  - 一般版顯示：`v{version}`
  - 開發版（含 dev 或 0. 開頭）顯示：`v{version} 開發版本`
  - 例外顯示：`v?.?.? 未知版本`
- 測試層面：
  - 整合測試改為讀取 `manifest.json`，mock `chrome.runtime.getManifest`
  - 新增單元測試覆蓋上述三種情境

## 變更內容

- 編輯 `src/popup/popup.html`：將版本顯示改為占位字串（載入中...）
- 編輯 `tests/integration/chrome-extension/popup-interface.test.js`：
  - 動態讀取 `manifest.json` 並 mock `chrome.runtime.getManifest`
  - 呼叫 `updateVersionDisplay()` 驗證顯示
- 新增 `tests/unit/popup/version-display.test.js`：
  - 一般版 `v{version}`
  - 開發版（含 dev 或 0. 開頭）`v{version} 開發版本`
  - 例外顯示 `v?.?.? 未知版本`

## 驗證狀態

- 單元與整合測試已執行，版本顯示相關測試通過。
- 其餘紅燈測試（PopupUIManager、BookSearchFilter、ReadmooDataValidator、PopupErrorHandler 重構紅燈）與本變更無直接關聯，將於 TDD #45 後續步驟修復。

## 待辦（TDD #45 後續）

- 修復 `BookSearchFilter` 2 個事件相關測試紅燈
- 修復 `ReadmooDataValidator` 進度/類型/封面 URL 驗證測試紅燈（快取影響與嚴格度調整）
- 校正 `PopupUIManager` 測試期望與現實 DOM 快取鍵名規格
- 維持測試綠燈後進行 build 與部署驗證

## 影響範圍

- Popup 版本顯示：使用者可見的版本文字來源改為 `manifest.json`
- 測試：增加一組單元測試；整合測試驗證邏輯更新

## 風險與緩解

- 風險：`chrome.runtime.getManifest` 在測試環境不可用
  - 緩解：在測試中以 mock 方式提供回傳值

## 版本

- 發布版本：v0.6.14
- 日期：2025-08-08
