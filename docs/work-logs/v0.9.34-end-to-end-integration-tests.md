# v0.9.34: ç«¯åˆ°ç«¯æ•´åˆæ¸¬è©¦å¥—ä»¶ - TDD Phase 1 åŠŸèƒ½è¨­è¨ˆè¦åŠƒ

**ç‰ˆæœ¬**: v0.9.34  
**æ—¥æœŸ**: 2025-08-24  
**éšæ®µ**: TDD Phase 1 - åŠŸèƒ½è¨­è¨ˆå¸«  
**è² è²¬**: lavender-interface-designer  
**ç›®æ¨™**: å»ºç«‹ç«¯åˆ°ç«¯(E2E)æ•´åˆæ¸¬è©¦å¥—ä»¶çš„å®Œæ•´åŠŸèƒ½è¨­è¨ˆè¦åŠƒ

## ğŸ¯ TDD Phase 1: åŠŸèƒ½è¨­è¨ˆè¦åŠƒ

### ğŸ“‹ å°ˆæ¡ˆèƒŒæ™¯ç†è§£

**ç•¶å‰å°ˆæ¡ˆç‹€æ³**:

- Chrome Extension (Manifest V3) å°ˆæ¡ˆï¼Œæ¡ç”¨äº‹ä»¶é©…å‹•æ¶æ§‹
- å·²å®Œæˆæ ¸å¿ƒåŠŸèƒ½ï¼šè³‡æ–™æå–ã€åŒ¯å‡ºå…¥ã€å»é‡è™•ç†ã€Overviewé é¢ç®¡ç†
- ç¾æœ‰æ¸¬è©¦è¦†è“‹ç‡å·²å¾52%æå‡è‡³85%ä»¥ä¸Šï¼Œé—œéµUCæ¸¬è©¦å®Œæˆï¼š
  - âœ… UC-04 è³‡æ–™åŒ¯å…¥åŠŸèƒ½ï¼š92%æ¸¬è©¦é€šéç‡
  - âœ… UC-06 Overviewé é¢åŠŸèƒ½ï¼š88.2%æ¸¬è©¦é€šéç‡
  - âœ… UC-05 è·¨è¨­å‚™åŒæ­¥æ¸¬è©¦ï¼š7/45æ¸¬è©¦é€šé(15.6%)ï¼ŒMockå‡½æ•¸å·²å¯¦ä½œ

**ç¾æœ‰æ¸¬è©¦æ¶æ§‹åˆ†æ**:

- **å–®å…ƒæ¸¬è©¦**: å·²è¦†è“‹å„å€‹æ¨¡çµ„çš„ç¨ç«‹åŠŸèƒ½ï¼Œæ¸¬è©¦è¦†è“‹ç‡é«˜é”95%+
- **æ•´åˆæ¸¬è©¦**: éƒ¨åˆ†æ¨¡çµ„é–“äº’å‹•æ¸¬è©¦ï¼Œä¸»è¦é›†ä¸­åœ¨Chrome Extension APIæ¨¡æ“¬
- **ç«¯åˆ°ç«¯æ¸¬è©¦**: å­˜åœ¨åŸºç¤æ¡†æ¶ä½†åŠŸèƒ½ä¸å®Œæ•´ï¼Œç¼ºä¹å®Œæ•´ä½¿ç”¨è€…å·¥ä½œæµç¨‹é©—è­‰
- **ç¼ºå¤±ç’°ç¯€**: è·¨æ¨¡çµ„çš„è¤‡é›œäº’å‹•ã€çœŸå¯¦ä½¿ç”¨å ´æ™¯æ¨¡æ“¬ã€æ•ˆèƒ½åŸºæº–é©—è­‰

## ğŸ“š åŠŸèƒ½éœ€æ±‚åˆ†æ

### E2Eæ•´åˆæ¸¬è©¦è¦è§£æ±ºä»€éº¼å…·é«”å•é¡Œï¼Ÿ

**æ ¸å¿ƒå•é¡Œè­˜åˆ¥**:

1. **å®Œæ•´ä½¿ç”¨è€…å·¥ä½œæµç¨‹é©—è­‰ç¼ºå£**
   - ç¾æœ‰å–®å…ƒæ¸¬è©¦é©—è­‰å€‹åˆ¥åŠŸèƒ½æ­£ç¢ºæ€§ï¼Œä½†ç¼ºä¹ç«¯åˆ°ç«¯ä½¿ç”¨è€…é«”é©—é©—è­‰
   - ç„¡æ³•é©—è­‰å¾ã€Œé–‹å•ŸExtension â†’ è³‡æ–™æå– â†’ æª¢è¦–ç®¡ç† â†’ åŒ¯å‡ºå‚™ä»½ã€çš„å®Œæ•´æµç¨‹
   - æ¨¡çµ„é–“æ•´åˆå¯èƒ½å­˜åœ¨éš±è—å•é¡Œï¼Œå–®å…ƒæ¸¬è©¦ç„¡æ³•ç™¼ç¾

2. **Chrome Extensionç’°å¢ƒçœŸå¯¦æ€§å•é¡Œ**
   - å–®å…ƒæ¸¬è©¦ä½¿ç”¨Mockï¼Œç„¡æ³•é©—è­‰çœŸå¯¦Chromeç’°å¢ƒä¸‹çš„è¡Œç‚º
   - Background Service Workerã€Content Scriptã€Popupé–“çš„é€šè¨Šè¤‡é›œåº¦æœªå……åˆ†æ¸¬è©¦
   - Chrome APIé™åˆ¶å’Œå¯¦éš›ç€è¦½å™¨ç’°å¢ƒç´„æŸæœªå®Œæ•´é©—è­‰

3. **ä½¿ç”¨è€…é«”é©—å“è³ªä¿è­‰ä¸è¶³**
   - ç„¡æ³•é©—è­‰çœŸå¯¦ä½¿ç”¨å ´æ™¯ä¸‹çš„æ•ˆèƒ½è¡¨ç¾
   - ç¼ºä¹ä»‹é¢äº’å‹•æµæš¢åº¦å’Œå›æ‡‰æ™‚é–“çš„é‡åŒ–æ¸¬è©¦
   - éŒ¯èª¤æƒ…æ³ä¸‹çš„ä½¿ç”¨è€…é«”é©—å’Œæ¢å¾©èƒ½åŠ›æœªç³»çµ±é©—è­‰

4. **ç³»çµ±ç©©å®šæ€§å’Œå¯é æ€§é©—è­‰ä¸å®Œæ•´**
   - å¤§é‡è³‡æ–™è™•ç†æ™‚çš„ç³»çµ±ç©©å®šæ€§æœªå……åˆ†æ¸¬è©¦
   - å¤šå€‹æ“ä½œä¸¦ç™¼åŸ·è¡Œæ™‚çš„è³‡æ–™ä¸€è‡´æ€§ä¿è­‰
   - é•·æ™‚é–“é‹è¡Œå’Œè¨˜æ†¶é«”ä½¿ç”¨æƒ…æ³çš„ç›£æ§ç¼ºå¤±

**èˆ‡ç¾æœ‰å–®å…ƒæ¸¬è©¦çš„å€åˆ¥**:

- **æ¸¬è©¦ç²’åº¦**: å–®å…ƒæ¸¬è©¦é©—è­‰å‡½æ•¸ç´šåˆ¥æ­£ç¢ºæ€§ï¼ŒE2Eæ¸¬è©¦é©—è­‰ä½¿ç”¨è€…ç´šåˆ¥çš„å·¥ä½œæµç¨‹
- **ç’°å¢ƒçœŸå¯¦æ€§**: å–®å…ƒæ¸¬è©¦ä½¿ç”¨Mockç’°å¢ƒï¼ŒE2Eæ¸¬è©¦ä½¿ç”¨çœŸå¯¦æˆ–è¿‘ä¼¼çœŸå¯¦çš„Chromeç’°å¢ƒ
- **æ¸¬è©¦ç›®æ¨™**: å–®å…ƒæ¸¬è©¦é—œæ³¨åŠŸèƒ½æ­£ç¢ºæ€§ï¼ŒE2Eæ¸¬è©¦é—œæ³¨ä½¿ç”¨è€…é«”é©—å’Œç³»çµ±æ•´é«”å“è³ª
- **ç™¼ç¾å•é¡Œé¡å‹**: å–®å…ƒæ¸¬è©¦ç™¼ç¾é‚è¼¯éŒ¯èª¤ï¼ŒE2Eæ¸¬è©¦ç™¼ç¾æ•´åˆå•é¡Œå’Œä½¿ç”¨è€…é«”é©—å•é¡Œ

### Chrome Extensionä½¿ç”¨è€…çš„å…¸å‹ä½¿ç”¨å ´æ™¯åˆ†æ

**Primary Actor**: æ›¸ç±æ”¶é›†è€… - ä½¿ç”¨Readmooé›»å­æ›¸å¹³å°çš„é‡åº¦ä½¿ç”¨è€…

**å…¸å‹å®Œæ•´ä½¿ç”¨å ´æ™¯**:

**å ´æ™¯ A: æ–°æ›¸æ”¶é›†èˆ‡æ•´ç†å·¥ä½œæµç¨‹**

- ä½¿ç”¨è€…è³¼è²·æˆ–å€Ÿé–±æ–°æ›¸ç±å¾Œï¼Œé–‹å•ŸReadmooæ›¸åº«é é¢
- é»æ“ŠExtensionåœ–ç¤ºï¼ŒæŸ¥çœ‹ç›®å‰æ›¸ç±çµ±è¨ˆï¼ˆå·²æœ‰Xæœ¬æ›¸ç±ï¼‰
- é»æ“Šã€Œæå–æ›¸ç±è³‡æ–™ã€ï¼Œè§€å¯Ÿæå–é€²åº¦å’Œç‹€æ…‹æ›´æ–°
- æå–å®Œæˆå¾Œï¼Œé»æ“Šã€ŒæŸ¥çœ‹è©³ç´°è³‡æ–™ã€é–‹å•ŸOverviewé é¢
- åœ¨Overviewé é¢ä¸­æœå°‹å’Œç¯©é¸æ–°æ›¸ç±ï¼Œç¢ºèªè³‡æ–™å®Œæ•´æ€§
- ä½¿ç”¨åŒ¯å‡ºåŠŸèƒ½å‚™ä»½æ›´æ–°å¾Œçš„æ›¸åº«è³‡æ–™

**å ´æ™¯ B: å®šæœŸè³‡æ–™å‚™ä»½èˆ‡ç®¡ç†å·¥ä½œæµç¨‹**

- ä½¿ç”¨è€…å®šæœŸï¼ˆå¦‚æ¯æœˆï¼‰é–‹å•ŸExtensioné€²è¡Œè³‡æ–™æ•´ç†
- åœ¨Overviewé é¢æª¢è¦–æ›¸ç±æ¸…å–®ï¼Œä½¿ç”¨æœå°‹åŠŸèƒ½æŸ¥æ‰¾ç‰¹å®šæ›¸ç±
- ä½¿ç”¨ç¯©é¸åŠŸèƒ½æª¢æŸ¥é–±è®€é€²åº¦ï¼Œè­˜åˆ¥éœ€è¦ç¹¼çºŒé–±è®€çš„æ›¸ç±
- æ¸…ç†é‡è¤‡æˆ–éŒ¯èª¤çš„æ›¸ç±è¨˜éŒ„ï¼ˆå¦‚æœ‰ï¼‰
- åŒ¯å‡ºå®Œæ•´è³‡æ–™ç‚ºJSONæª”æ¡ˆï¼Œå„²å­˜åˆ°é›²ç«¯ç¡¬ç¢Ÿå‚™ä»½

**å ´æ™¯ C: è·¨è¨­å‚™è³‡æ–™åŒæ­¥å·¥ä½œæµç¨‹**

- ä½¿ç”¨è€…åœ¨å®¶ç”¨é›»è…¦æ›´æ–°äº†æ›¸åº«è³‡æ–™ï¼Œéœ€è¦åŒæ­¥åˆ°è¾¦å…¬å®¤é›»è…¦
- åœ¨å®¶ç”¨é›»è…¦åŒ¯å‡ºæœ€æ–°çš„JSONè³‡æ–™æª”æ¡ˆ
- é€éé›²ç«¯ç¡¬ç¢Ÿæˆ–USBå‚³è¼¸æª”æ¡ˆåˆ°è¾¦å…¬å®¤é›»è…¦
- åœ¨è¾¦å…¬å®¤é›»è…¦é–‹å•ŸOverviewé é¢ï¼Œä½¿ç”¨ã€Œè¼‰å…¥æª”æ¡ˆã€åŠŸèƒ½
- é¸æ“‡ã€Œåˆä½µè³‡æ–™ã€æ¨¡å¼ï¼Œç¢ºä¿ä¸éºå¤±ä»»ä½•è³‡æ–™
- é©—è­‰åˆä½µçµæœï¼Œç¢ºèªæ‰€æœ‰æ›¸ç±éƒ½æ­£ç¢ºé¡¯ç¤º

**å ´æ™¯ D: éŒ¯èª¤æ¢å¾©èˆ‡å•é¡Œè§£æ±ºå·¥ä½œæµç¨‹**

- ä½¿ç”¨è€…æ“ä½œéç¨‹ä¸­é‡åˆ°ç¶²è·¯ä¸­æ–·æˆ–ExtensionéŒ¯èª¤
- è§€å¯ŸéŒ¯èª¤è¨Šæ¯é¡¯ç¤ºå’Œå»ºè­°çš„è§£æ±ºæ–¹æ³•
- ä½¿ç”¨é‡è©¦åŠŸèƒ½æˆ–æ‰‹å‹•æ¢å¾©æ“ä½œ
- é©—è­‰è³‡æ–™å®Œæ•´æ€§ï¼Œç¢ºä¿æ²’æœ‰è³‡æ–™éºå¤±
- å¿…è¦æ™‚ä½¿ç”¨å‚™ä»½æª”æ¡ˆæ¢å¾©åˆ°å®‰å…¨ç‹€æ…‹

**ä½¿ç”¨é »ç‡å’Œé‡è¦æ€§åˆ†æ**:

- **é«˜é »å ´æ™¯**: æ–°æ›¸æå–ï¼ˆæ¯é€±1-2æ¬¡ï¼‰ã€è³‡æ–™æª¢è¦–ï¼ˆæ¯æ¬¡ä½¿ç”¨ï¼‰
- **ä¸­é »å ´æ™¯**: è³‡æ–™å‚™ä»½ï¼ˆæ¯æœˆ1-2æ¬¡ï¼‰ã€è·¨è¨­å‚™åŒæ­¥ï¼ˆæ¯é€±1æ¬¡ï¼‰
- **ä½é »ä½†é—œéµå ´æ™¯**: éŒ¯èª¤æ¢å¾©ï¼ˆæ„å¤–ç™¼ç”Ÿæ™‚ï¼‰ã€å¤§é‡è³‡æ–™è™•ç†ï¼ˆåˆæ¬¡åŒ¯å…¥ï¼‰

### éœ€è¦é©—è­‰å“ªäº›è·¨æ¨¡çµ„äº’å‹•å’Œè³‡æ–™æµï¼Ÿ

**æ ¸å¿ƒè·¨æ¨¡çµ„äº’å‹•é©—è­‰**:

1. **Background â†” Content Script é€šè¨Šéˆè·¯**
   - äº‹ä»¶è§¸ç™¼ï¼šPopupæŒ‰éˆ•é»æ“Š â†’ Backgroundæ¥æ”¶ â†’ Content ScriptåŸ·è¡Œæå–
   - è³‡æ–™å›å‚³ï¼šContent Scriptæå–è³‡æ–™ â†’ Backgroundè™•ç† â†’ Popupç‹€æ…‹æ›´æ–°
   - éŒ¯èª¤å‚³éï¼šContent ScriptéŒ¯èª¤ â†’ BackgroundéŒ¯èª¤è™•ç† â†’ PopupéŒ¯èª¤é¡¯ç¤º

2. **Background â†” Popup ç‹€æ…‹åŒæ­¥**
   - è³‡æ–™ç‹€æ…‹ï¼šStorageè³‡æ–™è®Šæ›´ â†’ Backgroundäº‹ä»¶ç™¼å¸ƒ â†’ Popupå³æ™‚æ›´æ–°
   - é€²åº¦è¿½è¹¤ï¼šBackgroundæå–é€²åº¦ â†’ Popupé€²åº¦æ¢æ›´æ–° â†’ ä½¿ç”¨è€…å›é¥‹
   - è¨­å®šåŒæ­¥ï¼šPopupè¨­å®šè®Šæ›´ â†’ Backgroundé…ç½®æ›´æ–° â†’ è¡Œç‚ºèª¿æ•´

3. **Storage â†” UI è³‡æ–™ä¸€è‡´æ€§**
   - è³‡æ–™å¯«å…¥ï¼šUIæ“ä½œ â†’ Storageé©é…å™¨ â†’ Chrome Storage API â†’ è³‡æ–™æŒä¹…åŒ–
   - è³‡æ–™è®€å–ï¼šé é¢è¼‰å…¥ â†’ Storageè®€å– â†’ UIæ¸²æŸ“ â†’ ä½¿ç”¨è€…æª¢è¦–
   - è³‡æ–™æ›´æ–°ï¼šæ‰¹æ¬¡åŒ¯å…¥ â†’ Storageæ›´æ–° â†’ äº‹ä»¶é€šçŸ¥ â†’ UIé‡æ–°æ•´ç†

4. **äº‹ä»¶ç³»çµ± â†” æ¨¡çµ„å”èª¿**
   - äº‹ä»¶ç™¼å¸ƒï¼šæ¨¡çµ„Aæ“ä½œ â†’ EventBusç™¼å¸ƒ â†’ å¤šå€‹æ¨¡çµ„æ¥æ”¶ â†’ å”èª¿éŸ¿æ‡‰
   - äº‹ä»¶å„ªå…ˆç´šï¼šç·Šæ€¥äº‹ä»¶å„ªå…ˆè™•ç† â†’ ä¸€èˆ¬äº‹ä»¶æ’éšŠ â†’ ä½å„ªå…ˆç´šå»¶å¾Œ
   - äº‹ä»¶éŒ¯èª¤è™•ç†ï¼šäº‹ä»¶è™•ç†å¤±æ•— â†’ éŒ¯èª¤è¿½è¹¤ â†’ é™ç´šè™•ç† â†’ ä½¿ç”¨è€…é€šçŸ¥

**é—œéµè³‡æ–™æµé©—è­‰**:

1. **æ›¸ç±è³‡æ–™å®Œæ•´ç”Ÿå‘½å‘¨æœŸ**

   ```
   Readmooé é¢ â†’ BookDataExtractor â†’ ReadmooAdapter â†’
   è³‡æ–™è¦æ ¼åŒ– â†’ generateStableBookId â†’ Storageå„²å­˜ â†’
   Overviewè¼‰å…¥ â†’ æœå°‹ç¯©é¸ â†’ åŒ¯å‡ºè™•ç†
   ```

2. **ä½¿ç”¨è€…æ“ä½œå›é¥‹éˆè·¯**

   ```
   ä½¿ç”¨è€…é»æ“Š â†’ Popupäº‹ä»¶æ•ç² â†’ Backgroundä»»å‹™æ’ç¨‹ â†’
   Content ScriptåŸ·è¡Œ â†’ é€²åº¦äº‹ä»¶ç™¼å¸ƒ â†’ Popupç‹€æ…‹æ›´æ–° â†’
   ä½¿ç”¨è€…ä»‹é¢å›é¥‹
   ```

3. **éŒ¯èª¤è™•ç†å‚³æ’­éˆè·¯**
   ```
   æ¨¡çµ„éŒ¯èª¤ç™¼ç”Ÿ â†’ éŒ¯èª¤æ•ç²å’Œåˆ†é¡ â†’ ErrorHandlerè™•ç† â†’
   äº‹ä»¶ç³»çµ±é€šçŸ¥ â†’ UIéŒ¯èª¤é¡¯ç¤º â†’ ä½¿ç”¨è€…æ“ä½œæŒ‡å¼•
   ```

## ğŸ”§ åŠŸèƒ½è¦æ ¼è¨­è¨ˆ

### ç«¯åˆ°ç«¯æ¸¬è©¦çš„è¼¸å…¥æ˜¯ä»€éº¼ï¼Ÿ

**æ¸¬è©¦ç’°å¢ƒè¼¸å…¥**:

1. **Chrome Extensionæ¸¬è©¦ç’°å¢ƒ**
   - å®Œæ•´çš„Extensionæª”æ¡ˆï¼ˆmanifest.json + æ‰€æœ‰æ¨¡çµ„ï¼‰
   - æ¸¬è©¦å°ˆç”¨çš„Readmooæ¨¡æ“¬é é¢ï¼ˆåŒ…å«å„ç¨®æ›¸ç±è³‡æ–™æƒ…æ³ï¼‰
   - Chrome DevTools Protocol APIç”¨æ–¼æ§åˆ¶ç€è¦½å™¨è¡Œç‚º
   - æ¸¬è©¦è³‡æ–™é›†ï¼šå°å‹ï¼ˆ50æœ¬ï¼‰ã€ä¸­å‹ï¼ˆ500æœ¬ï¼‰ã€å¤§å‹ï¼ˆ2000æœ¬ï¼‰æ›¸ç±é›†åˆ

2. **æ¨¡æ“¬ä½¿ç”¨è€…æ“ä½œè¼¸å…¥**
   - æ»‘é¼ é»æ“Šåºåˆ—ï¼šExtensionåœ–ç¤ºã€æŒ‰éˆ•ã€é€£çµã€é¸å–®é …ç›®
   - éµç›¤è¼¸å…¥ï¼šæœå°‹é—œéµå­—ã€æª”æ¡ˆè·¯å¾‘ã€è¨­å®šå€¼
   - æª”æ¡ˆæ“ä½œï¼šJSONæª”æ¡ˆé¸æ“‡ã€åŒ¯å‡ºè·¯å¾‘æŒ‡å®š
   - æ™‚é–“æ§åˆ¶ï¼šæ“ä½œé–“éš”ã€è¶…æ™‚è¨­å®šã€ç­‰å¾…æ¢ä»¶

3. **æ¸¬è©¦æƒ…å¢ƒåƒæ•¸**
   - ç¶²è·¯ç‹€æ³æ¨¡æ“¬ï¼šæ­£å¸¸ã€æ…¢é€Ÿã€ä¸­æ–·ã€æ¢å¾©
   - ç³»çµ±è³‡æºé™åˆ¶ï¼šè¨˜æ†¶é«”é™åˆ¶ã€CPUé™åˆ¶ã€å„²å­˜ç©ºé–“é™åˆ¶
   - ç€è¦½å™¨ç’°å¢ƒï¼šä¸åŒChromeç‰ˆæœ¬ã€è¦–çª—å¤§å°ã€Extensionæ¬Šé™è¨­å®š
   - è³‡æ–™ç‹€æ…‹ï¼šç©ºç™½ç‹€æ…‹ã€éƒ¨åˆ†è³‡æ–™ã€å¤§é‡è³‡æ–™ã€æå£è³‡æ–™

4. **æ¸¬è©¦é…ç½®åƒæ•¸**
   - æ•ˆèƒ½åŸºæº–è¨­å®šï¼šæœ€å¤§åŸ·è¡Œæ™‚é–“ã€è¨˜æ†¶é«”ä½¿ç”¨ä¸Šé™ã€æª”æ¡ˆå¤§å°é™åˆ¶
   - é©—è­‰æ¨™æº–è¨­å®šï¼šè³‡æ–™å®Œæ•´æ€§é–¾å€¼ã€ä½¿ç”¨è€…é«”é©—æŒ‡æ¨™ã€éŒ¯èª¤å®¹å¿åº¦
   - æ¸¬è©¦æ¨¡å¼é¸æ“‡ï¼šå¿«é€Ÿæ¸¬è©¦ã€å®Œæ•´æ¸¬è©¦ã€å£“åŠ›æ¸¬è©¦ã€å›æ­¸æ¸¬è©¦

**è³‡æ–™è¼¸å…¥ä¾†æº**:

- **çœŸå¯¦Readmooé é¢è³‡æ–™**: å¯¦éš›æ›¸åº«é é¢çš„DOMçµæ§‹å’Œæ›¸ç±è³‡è¨Š
- **æ¸¬è©¦è³‡æ–™ç”¢ç”Ÿå™¨**: ç¨‹å¼åŒ–ç”¢ç”Ÿå„ç¨®é‚Šç•Œæƒ…æ³çš„æ›¸ç±è³‡æ–™
- **æ­·å²æ¸¬è©¦è³‡æ–™**: å…ˆå‰ç‰ˆæœ¬çš„æ›¸ç±è³‡æ–™ï¼Œç”¨æ–¼ç›¸å®¹æ€§æ¸¬è©¦
- **éŒ¯èª¤å ´æ™¯è³‡æ–™**: æ•…æ„è£½é€ çš„éŒ¯èª¤è³‡æ–™ï¼Œç”¨æ–¼éŒ¯èª¤è™•ç†æ¸¬è©¦

### ç«¯åˆ°ç«¯æ¸¬è©¦çš„è¼¸å‡ºæ˜¯ä»€éº¼ï¼Ÿ

**æ¸¬è©¦çµæœå ±å‘Š**:

1. **åŠŸèƒ½æ­£ç¢ºæ€§é©—è­‰å ±å‘Š**
   - ä½¿ç”¨è€…å·¥ä½œæµç¨‹å®Œæˆç‡ï¼šæ¯å€‹é—œéµæµç¨‹çš„æˆåŠŸå®Œæˆç‡çµ±è¨ˆ
   - è³‡æ–™å®Œæ•´æ€§æª¢æŸ¥çµæœï¼šæå–ã€è™•ç†ã€å„²å­˜å„éšæ®µçš„è³‡æ–™å®Œæ•´æ€§åˆ†æ•¸
   - åŠŸèƒ½ä¸€è‡´æ€§é©—è­‰ï¼šèˆ‡å–®å…ƒæ¸¬è©¦çµæœçš„å°æ¯”ï¼Œç¢ºä¿æ•´åˆç„¡åå·®
   - è·¨æ¨¡çµ„äº’å‹•æ­£ç¢ºæ€§ï¼šäº‹ä»¶é€šè¨Šã€è³‡æ–™å‚³éã€ç‹€æ…‹åŒæ­¥çš„é©—è­‰çµæœ

2. **æ•ˆèƒ½èˆ‡ä½¿ç”¨è€…é«”é©—æŒ‡æ¨™**
   - æ“ä½œéŸ¿æ‡‰æ™‚é–“ï¼šé—œéµæ“ä½œï¼ˆæå–ã€è¼‰å…¥ã€æœå°‹ï¼‰çš„éŸ¿æ‡‰æ™‚é–“æ¸¬é‡
   - è¨˜æ†¶é«”ä½¿ç”¨åˆ†æï¼šå³°å€¼ä½¿ç”¨é‡ã€è¨˜æ†¶é«”æ´©æ¼æª¢æ¸¬ã€åƒåœ¾å›æ”¶æ•ˆæœ
   - CPUä½¿ç”¨æƒ…æ³ï¼šè™•ç†å¯†é›†ä»»å‹™æ™‚çš„CPUä½¿ç”¨ç‡å’ŒæŒçºŒæ™‚é–“
   - ä½¿ç”¨è€…ä»‹é¢æµæš¢åº¦ï¼šå‹•ç•«å¹€ç‡ã€äº’å‹•å»¶é²ã€è¦–è¦ºå›é¥‹åŠæ™‚æ€§

3. **ç³»çµ±ç©©å®šæ€§è©•ä¼°**
   - éŒ¯èª¤è™•ç†è¦†è“‹åº¦ï¼šå„ç¨®éŒ¯èª¤æƒ…æ³çš„è™•ç†æˆåŠŸç‡
   - è³‡æ–™ä¸€è‡´æ€§ä¿è­‰ï¼šä¸¦ç™¼æ“ä½œã€ä¸­æ–·æ¢å¾©æ™‚çš„è³‡æ–™å®Œæ•´æ€§
   - é•·æ™‚é–“é‹è¡Œç©©å®šæ€§ï¼šæŒçºŒé‹è¡Œ24å°æ™‚çš„ç©©å®šæ€§æ¸¬è©¦çµæœ
   - é‚Šç•Œæ¢ä»¶è™•ç†ï¼šæ¥µç«¯è¼¸å…¥ã€è³‡æºä¸è¶³ç­‰æƒ…æ³çš„è™•ç†æ•ˆæœ

4. **æ¸¬è©¦è¦†è“‹åº¦å’Œå“è³ªåº¦é‡**
   - ä½¿ç”¨è€…å ´æ™¯è¦†è“‹ç‡ï¼šå¯¦éš›æ¸¬è©¦çš„ä½¿ç”¨è€…å ´æ™¯ä½”ç¸½å ´æ™¯çš„æ¯”ä¾‹
   - ç¨‹å¼ç¢¼è·¯å¾‘è¦†è“‹ç‡ï¼šE2Eæ¸¬è©¦è§¸ç™¼çš„ç¨‹å¼ç¢¼è·¯å¾‘çµ±è¨ˆ
   - æ•´åˆé»é©—è­‰åº¦ï¼šæ¨¡çµ„é–“æ•´åˆé»çš„æ¸¬è©¦è¦†è“‹æƒ…æ³
   - å›æ­¸é¢¨éšªè©•ä¼°ï¼šæ–°ç‰ˆæœ¬å°ç¾æœ‰åŠŸèƒ½çš„å½±éŸ¿é¢¨éšªè©•ä¼°

**å…·é«”è¼¸å‡ºæª”æ¡ˆå’Œå ±å‘Š**:

- **HTMLæ¸¬è©¦å ±å‘Š**: åŒ…å«è©³ç´°çš„æ¸¬è©¦çµæœã€æˆªåœ–ã€æ•ˆèƒ½åœ–è¡¨
- **JSONæ ¼å¼æ¸¬è©¦è³‡æ–™**: çµæ§‹åŒ–çš„æ¸¬è©¦çµæœï¼Œä¾›CI/CDç³»çµ±ä½¿ç”¨
- **æ•ˆèƒ½åŸºæº–æ¯”è¼ƒ**: èˆ‡æ­·å²ç‰ˆæœ¬çš„æ•ˆèƒ½å°æ¯”åˆ†æ
- **éŒ¯èª¤æ—¥èªŒå’Œè¿½è¹¤**: è©³ç´°çš„éŒ¯èª¤è³‡è¨Šã€å †ç–Šè¿½è¹¤ã€ä¿®å¾©å»ºè­°

### æ­£å¸¸æµç¨‹ï¼šå®Œæ•´E2Eæ¸¬è©¦åŸ·è¡Œæµç¨‹

**Phase 1: æ¸¬è©¦ç’°å¢ƒæº–å‚™**

1. **Chromeç€è¦½å™¨å•Ÿå‹•**: ä½¿ç”¨Puppeteerå•Ÿå‹•Chromeï¼Œè¼‰å…¥æ¸¬è©¦å°ˆç”¨çš„Extension
2. **æ¸¬è©¦é é¢è¨­ç½®**: å°èˆªåˆ°æ¨¡æ“¬çš„Readmooé é¢ï¼Œç¢ºä¿é é¢è¼‰å…¥å®Œæˆ
3. **åˆå§‹ç‹€æ…‹é©—è­‰**: æª¢æŸ¥Extensionå®‰è£ç‹€æ…‹ã€æ¬Šé™è¨­å®šã€åˆå§‹è³‡æ–™æ¸…ç©º
4. **æ¸¬è©¦è³‡æ–™æº–å‚™**: åœ¨æ¨¡æ“¬é é¢ä¸­è¨»å…¥æ¸¬è©¦ç”¨çš„æ›¸ç±è³‡æ–™

**Phase 2: æ ¸å¿ƒåŠŸèƒ½æµç¨‹æ¸¬è©¦**

1. **Extensionå•Ÿå‹•æ¸¬è©¦**:
   - é»æ“ŠExtensionåœ–ç¤º â†’ é©—è­‰Popupé–‹å•Ÿ â†’ æª¢æŸ¥UIå…ƒç´ è¼‰å…¥
   - é©—è­‰åˆå§‹ç‹€æ…‹é¡¯ç¤º â†’ æª¢æŸ¥æŒ‰éˆ•å¯ç”¨æ€§ â†’ ç¢ºèªçµ±è¨ˆè³‡è¨Šæ­£ç¢º

2. **è³‡æ–™æå–æµç¨‹æ¸¬è©¦**:
   - é»æ“Šã€Œæå–æ›¸ç±è³‡æ–™ã€æŒ‰éˆ• â†’ è§€å¯Ÿç‹€æ…‹è®ŠåŒ– â†’ ç›£æ§é€²åº¦æ›´æ–°
   - Content ScriptåŸ·è¡Œç¢ºèª â†’ Backgroundè™•ç†è¿½è¹¤ â†’ Popupçµæœé¡¯ç¤º
   - é©—è­‰æå–çš„æ›¸ç±æ•¸é‡ â†’ æª¢æŸ¥è³‡æ–™å®Œæ•´æ€§ â†’ ç¢ºèªå„²å­˜æˆåŠŸ

3. **Overviewé é¢äº’å‹•æ¸¬è©¦**:
   - é»æ“Šã€ŒæŸ¥çœ‹è©³ç´°è³‡æ–™ã€â†’ æ–°åˆ†é é–‹å•Ÿ â†’ Overviewé é¢è¼‰å…¥
   - æ›¸ç±æ¸…å–®é¡¯ç¤ºæª¢æŸ¥ â†’ æœå°‹åŠŸèƒ½é©—è­‰ â†’ ç¯©é¸åŠŸèƒ½æ¸¬è©¦
   - åˆ†é å°èˆªæ¸¬è©¦ â†’ è©³ç´°è³‡è¨Šæª¢è¦– â†’ è³‡æ–™ç·¨è¼¯åŠŸèƒ½é©—è­‰

4. **è³‡æ–™åŒ¯å‡ºå…¥æµç¨‹æ¸¬è©¦**:
   - åŒ¯å‡ºåŠŸèƒ½è§¸ç™¼ â†’ æª”æ¡ˆä¸‹è¼‰ç¢ºèª â†’ JSONæ ¼å¼é©—è­‰
   - åŒ¯å…¥åŠŸèƒ½æ¸¬è©¦ â†’ æª”æ¡ˆé¸æ“‡æ¨¡æ“¬ â†’ è³‡æ–™åˆä½µé©—è­‰
   - è·¨è¨­å‚™åŒæ­¥æ¨¡æ“¬ â†’ è³‡æ–™ä¸€è‡´æ€§æª¢æŸ¥ â†’ è¡çªè§£æ±ºæ¸¬è©¦

**Phase 3: ç³»çµ±æ•´åˆé©—è­‰**

1. **è·¨æ¨¡çµ„é€šè¨Šæ¸¬è©¦**: Background â†” Content Script â†” Popupçš„äº‹ä»¶æµè¿½è¹¤
2. **Storageä¸€è‡´æ€§æ¸¬è©¦**: Chrome Storageæ“ä½œçš„å³æ™‚æ€§å’ŒæŒä¹…æ€§é©—è­‰
3. **äº‹ä»¶ç³»çµ±æ¸¬è©¦**: EventBusçš„äº‹ä»¶ç™¼å¸ƒã€è¨‚é–±ã€è™•ç†æµç¨‹é©—è­‰
4. **éŒ¯èª¤è™•ç†æ¸¬è©¦**: æ•…æ„è§¸ç™¼å„ç¨®éŒ¯èª¤ï¼Œé©—è­‰è™•ç†æ©Ÿåˆ¶å’Œä½¿ç”¨è€…å›é¥‹

**Phase 4: æ•ˆèƒ½å’Œç©©å®šæ€§æ¸¬è©¦**

1. **æ•ˆèƒ½åŸºæº–æ¸¬è©¦**: é—œéµæ“ä½œçš„æ™‚é–“æ¸¬é‡å’Œè¨˜æ†¶é«”ä½¿ç”¨ç›£æ§
2. **å£“åŠ›æ¸¬è©¦**: å¤§é‡è³‡æ–™è™•ç†ã€ä¸¦ç™¼æ“ä½œã€é•·æ™‚é–“é‹è¡Œæ¸¬è©¦
3. **è³‡æºé™åˆ¶æ¸¬è©¦**: è¨˜æ†¶é«”ä¸è¶³ã€å„²å­˜ç©ºé–“ä¸è¶³ç­‰æ¥µç«¯æƒ…æ³æ¸¬è©¦
4. **æ¢å¾©èƒ½åŠ›æ¸¬è©¦**: ç¶²è·¯ä¸­æ–·ã€æ“ä½œä¸­æ­¢ã€ç³»çµ±å´©æ½°å¾Œçš„æ¢å¾©æ¸¬è©¦

### ç•°å¸¸æƒ…æ³ï¼šéŒ¯èª¤è™•ç†å’Œé‚Šç•Œæ¢ä»¶

**ç¶²è·¯å’Œé€£æ¥ç•°å¸¸**:

1. **ç¶²è·¯ä¸­æ–·å ´æ™¯**:
   - è³‡æ–™æå–éç¨‹ä¸­ç¶²è·¯ä¸­æ–· â†’ éŒ¯èª¤è¨Šæ¯é¡¯ç¤º â†’ é‡è©¦æ©Ÿåˆ¶è§¸ç™¼
   - é æœŸè™•ç†ï¼šé¡¯ç¤ºã€Œç¶²è·¯é€£æ¥å•é¡Œï¼Œè«‹æª¢æŸ¥ç¶²è·¯å¾Œé‡è©¦ã€
   - æ¢å¾©æ¸¬è©¦ï¼šç¶²è·¯æ¢å¾©å¾Œé»æ“Šé‡è©¦æŒ‰éˆ• â†’ æå–æµç¨‹ç¹¼çºŒ
   - è³‡æ–™ä¿è­·ï¼šä¸­æ–·å‰çš„éƒ¨åˆ†è³‡æ–™ä¸æ‡‰éºå¤±

2. **é é¢è¼‰å…¥å¤±æ•—**:
   - Readmooé é¢ç„¡æ³•è¼‰å…¥æˆ–çµæ§‹è®Šæ›´ â†’ Content Scriptæª¢æ¸¬å¤±æ•—
   - é æœŸè™•ç†ï¼šé¡¯ç¤ºã€Œç„¡æ³•æª¢æ¸¬åˆ°Readmooæ›¸åº«é é¢ï¼Œè«‹ç¢ºèªé é¢å·²è¼‰å…¥ã€
   - ä½¿ç”¨è€…æŒ‡å¼•ï¼šæä¾›æ‰‹å‹•é‡æ–°æ•´ç†é é¢çš„å»ºè­°

**Chrome Extensionç’°å¢ƒç•°å¸¸**:

1. **æ¬Šé™ä¸è¶³éŒ¯èª¤**:
   - Extensionæ¬Šé™è¢«ä½¿ç”¨è€…æ’¤éŠ· â†’ APIå‘¼å«å¤±æ•—
   - é æœŸè™•ç†ï¼šé¡¯ç¤ºæ¬Šé™éŒ¯èª¤è¨Šæ¯å’Œä¿®å¾©æ­¥é©ŸæŒ‡å¼•
   - ä¿®å¾©æŒ‡å°ï¼šæä¾›è©³ç´°çš„æ¬Šé™è¨­å®šæ­¥é©Ÿèªªæ˜

2. **Storageé…é¡è¶…é™**:
   - Chrome Storageç©ºé–“ä¸è¶³ â†’ è³‡æ–™å„²å­˜å¤±æ•—
   - é æœŸè™•ç†ï¼šé¡¯ç¤ºç©ºé–“ä¸è¶³è­¦å‘Šå’Œæ¸…ç†å»ºè­°
   - è§£æ±ºæ–¹æ¡ˆï¼šæä¾›èˆŠè³‡æ–™æ¸…ç†é¸é …æˆ–åŒ¯å‡ºå»ºè­°

**è³‡æ–™è™•ç†ç•°å¸¸**:

1. **æª”æ¡ˆæ ¼å¼éŒ¯èª¤**:
   - åŒ¯å…¥æª”æ¡ˆä¸æ˜¯æœ‰æ•ˆJSON â†’ è§£æå¤±æ•—
   - é æœŸè™•ç†ï¼šé¡¯ç¤ºå…·é«”éŒ¯èª¤ä½ç½®å’Œä¿®æ­£å»ºè­°
   - ä½¿ç”¨è€…å”åŠ©ï¼šæä¾›ç¯„ä¾‹æª”æ¡ˆæ ¼å¼å’Œå¸¸è¦‹éŒ¯èª¤ä¿®æ­£æ–¹æ³•

2. **è³‡æ–™æå£æª¢æ¸¬**:
   - å„²å­˜çš„è³‡æ–™ä¸å®Œæ•´æˆ–æå£ â†’ å®Œæ•´æ€§æª¢æŸ¥å¤±æ•—
   - é æœŸè™•ç†ï¼šè­¦å‘Šè³‡æ–™å¯èƒ½æå£ï¼Œå»ºè­°ä½¿ç”¨å‚™ä»½æ¢å¾©
   - æ¢å¾©é¸é …ï¼šæä¾›å¾å‚™ä»½æª”æ¡ˆæ¢å¾©çš„é¸é …

**ç³»çµ±è³‡æºç•°å¸¸**:

1. **è¨˜æ†¶é«”ä¸è¶³è™•ç†**:
   - å¤§é‡è³‡æ–™è™•ç†æ™‚è¨˜æ†¶é«”ä¸è¶³ â†’ è™•ç†é€Ÿåº¦è®Šæ…¢æˆ–å¤±æ•—
   - é æœŸè™•ç†ï¼šå•Ÿç”¨é™ç´šæ¨¡å¼ï¼Œåˆ†æ‰¹è™•ç†è³‡æ–™
   - ä½¿ç”¨è€…é€šçŸ¥ï¼šé¡¯ç¤ºé™ç´šæ¨¡å¼å•Ÿç”¨è¨Šæ¯å’Œé è¨ˆæ™‚é–“

2. **è™•ç†è¶…æ™‚æ©Ÿåˆ¶**:
   - æ“ä½œåŸ·è¡Œæ™‚é–“éé•· â†’ è¶…æ™‚ä¿è­·æ©Ÿåˆ¶è§¸ç™¼
   - é æœŸè™•ç†ï¼šé¡¯ç¤ºæ“ä½œè¶…æ™‚ï¼Œæä¾›å–æ¶ˆæˆ–ç¹¼çºŒé¸é …
   - é€²åº¦ä¿è­·ï¼šè¶…æ™‚å‰çš„éƒ¨åˆ†é€²åº¦æ‡‰è©²è¢«ä¿å­˜

## ğŸ“Š é‚Šç•Œæ¢ä»¶åˆ†æ

### Chrome Extension APIé™åˆ¶å’Œæ¨¡æ“¬ç­–ç•¥

**Chrome Extension APIé™åˆ¶åˆ†æ**:

1. **Manifest V3ç‰¹å®šé™åˆ¶**
   - Service Workerç”Ÿå‘½å‘¨æœŸé™åˆ¶ï¼šæœ€é•·5åˆ†é˜åŸ·è¡Œæ™‚é–“ï¼Œéœ€è¦å¯¦ç¾ä»»å‹™æŒçºŒæ€§
   - Content Scriptæ²™ç›’é™åˆ¶ï¼šç„¡æ³•ç›´æ¥å­˜å–é é¢JavaScriptè®Šæ•¸ï¼Œéœ€è¦é€éDOMé€šè¨Š
   - æ¬Šé™æ¨¡å‹é™åˆ¶ï¼šä½¿ç”¨è€…å¯éš¨æ™‚æ’¤éŠ·æ¬Šé™ï¼Œéœ€è¦å‹•æ…‹æ¬Šé™æª¢æŸ¥æ©Ÿåˆ¶
   - Backgroundé é¢é™åˆ¶ï¼šç„¡æ³•ä½¿ç”¨localStorageï¼Œå¿…é ˆä½¿ç”¨Chrome Storage API

2. **Storage APIé™åˆ¶**
   - Chrome Storage Localï¼šæ¯å€‹Extensionæœ€å¤§5MBå„²å­˜ç©ºé–“
   - Chrome Storage Syncï¼šæ¯å€‹Extensionæœ€å¤§100KBï¼Œéœ€è¦Googleå¸³è™Ÿç™»å…¥
   - è®€å¯«é »ç‡é™åˆ¶ï¼šæ¯ç§’æœ€å¤š1000æ¬¡æ“ä½œï¼Œè¶…å‡ºæœƒè¢«é™æµ
   - è³‡æ–™åºåˆ—åŒ–é™åˆ¶ï¼šè¤‡é›œç‰©ä»¶çµæ§‹å¯èƒ½å½±éŸ¿æ•ˆèƒ½

3. **è·¨Contexté€šè¨Šé™åˆ¶**
   - Background â†” Content Scriptï¼šåªèƒ½é€éChrome Runtimeè¨Šæ¯API
   - Background â†” Popupï¼šPopupé—œé–‰æ™‚é€£æ¥ä¸­æ–·ï¼Œéœ€è¦ç‹€æ…‹æŒä¹…åŒ–
   - Content Script â†” Pageï¼šéœ€è¦é€éDOMäº‹ä»¶æˆ–postMessageé€šè¨Š

**æ¨¡æ“¬ç­–ç•¥è¨­è¨ˆ**:

1. **Chrome API Mockè¨­è¨ˆ**

   ```javascript
   // Chrome Extension APIå®Œæ•´æ¨¡æ“¬
   const chromeAPIMock = {
     storage: {
       local: new ChromeStorageMock(5 * 1024 * 1024), // 5MBé™åˆ¶
       sync: new ChromeStorageMock(100 * 1024) // 100KBé™åˆ¶
     },
     runtime: {
       sendMessage: new RuntimeMessageMock(),
       onMessage: new EventListenerMock()
     },
     tabs: new TabsAPIMock(),
     permissions: new PermissionsMock()
   }
   ```

2. **çœŸå¯¦ç’°å¢ƒè¿‘ä¼¼æ¨¡æ“¬**
   - ä½¿ç”¨Puppeteeræ§åˆ¶çœŸå¯¦Chromeç€è¦½å™¨
   - è¼‰å…¥å¯¦éš›çš„Extensionæª”æ¡ˆï¼Œé¿å…éåº¦Mock
   - æ¨¡æ“¬çœŸå¯¦çš„ç¶²è·¯å»¶é²å’Œä¸ç©©å®šæ€§
   - å¯¦ç¾çœŸå¯¦çš„Chrome Storageè¡Œç‚ºå’Œé™åˆ¶

3. **é‚Šç•Œæ¢ä»¶æ¸¬è©¦ç­–ç•¥**
   - å„²å­˜ç©ºé–“æ¥è¿‘ä¸Šé™æ™‚çš„è¡Œç‚ºæ¸¬è©¦
   - æ¬Šé™è¢«æ’¤éŠ·æ™‚çš„é™ç´šè™•ç†æ¸¬è©¦
   - Service Workeré‡å•Ÿæ™‚çš„ç‹€æ…‹æ¢å¾©æ¸¬è©¦
   - é«˜é »ç‡APIå‘¼å«çš„é™æµè™•ç†æ¸¬è©¦

### è·¨Contexté€šè¨Šæ¸¬è©¦ï¼ˆBackground â†” Content Script â†” Popupï¼‰

**é€šè¨Šæ¶æ§‹è¤‡é›œåº¦åˆ†æ**:

1. **ä¸‰å‘é€šè¨Šæ‹“æ’²**

   ```
   Background Service Worker (æŒä¹…ç‹€æ…‹ç®¡ç†)
         â†• Runtime Messages
   Content Script (é é¢äº’å‹•) â†â†’ Popup (ä½¿ç”¨è€…ä»‹é¢)
                    â†• DOM Events/PostMessage
   ```

2. **é€šè¨Šæ™‚åºå’Œç”Ÿå‘½å‘¨æœŸ**
   - Backgroundï¼šæŒçºŒé‹è¡Œä½†æœƒä¼‘çœ ï¼Œéœ€è¦äº‹ä»¶æ¿€æ´»
   - Content Scriptï¼šèˆ‡é é¢ç”Ÿå‘½å‘¨æœŸç¶å®šï¼Œé é¢é‡è¼‰å¾Œé‡æ–°æ³¨å…¥
   - Popupï¼šä½¿ç”¨è€…é»æ“Šæ™‚è¼‰å…¥ï¼Œé—œé–‰å¾Œç«‹å³éŠ·æ¯€

3. **è¨Šæ¯é¡å‹å’Œå„ªå…ˆç´š**
   - ç·Šæ€¥è¨Šæ¯ï¼šä½¿ç”¨è€…æ“ä½œå›é¥‹ã€éŒ¯èª¤é€šçŸ¥
   - ä¸€èˆ¬è¨Šæ¯ï¼šç‹€æ…‹æ›´æ–°ã€é€²åº¦å ±å‘Š
   - ä½å„ªå…ˆç´šï¼šçµ±è¨ˆè³‡æ–™ã€æ—¥èªŒè¨˜éŒ„

**è·¨Contexté€šè¨Šæ¸¬è©¦è¨­è¨ˆ**:

1. **è¨Šæ¯å‚³éå®Œæ•´æ€§æ¸¬è©¦**

   ```javascript
   test('Backgroundåˆ°Content Scripté€šè¨Š', async () => {
     // æ¨¡æ“¬Backgroundç™¼é€æŒ‡ä»¤
     const command = { action: 'EXTRACT_BOOKS', params: { limit: 100 } }
     await background.sendMessage(contentScript.tabId, command)

     // é©—è­‰Content Scriptæ¥æ”¶å’Œè™•ç†
     expect(contentScript.lastReceived).toEqual(command)
     expect(contentScript.isProcessing).toBe(true)

     // ç­‰å¾…è™•ç†å®Œæˆå’Œå›æ‡‰
     const response = await background.waitForResponse(contentScript.tabId)
     expect(response.success).toBe(true)
     expect(response.data.books.length).toBe(100)
   })
   ```

2. **é€šè¨Šä¸­æ–·æ¢å¾©æ¸¬è©¦**
   - Popupé—œé–‰å¾Œé‡æ–°é–‹å•Ÿçš„ç‹€æ…‹æ¢å¾©
   - Content Scriptå› é é¢é‡è¼‰å¾Œçš„é‡æ–°é€£æ¥
   - Background Service Workerä¼‘çœ å¾Œçš„äº‹ä»¶è™•ç†æ¢å¾©

3. **ä¸¦ç™¼é€šè¨Šè¡çªæ¸¬è©¦**
   - å¤šå€‹ContextåŒæ™‚ç™¼é€è¨Šæ¯æ™‚çš„è™•ç†é †åº
   - è¨Šæ¯ä½‡åˆ—æ»¿è¼‰æ™‚çš„å„ªå…ˆç´šè™•ç†
   - é€šè¨Šè¶…æ™‚æ™‚çš„è‡ªå‹•é‡è©¦æ©Ÿåˆ¶

### å¤§é‡è³‡æ–™è™•ç†çš„æ•´åˆæ¸¬è©¦é‚Šç•Œ

**å¤§é‡è³‡æ–™è™•ç†å ´æ™¯å®šç¾©**:

1. **è³‡æ–™è¦æ¨¡åˆ†ç´š**
   - å°å‹è³‡æ–™é›†ï¼š50-200æœ¬æ›¸ç±ï¼Œä¸»è¦æ¸¬è©¦åŸºæœ¬åŠŸèƒ½æ­£ç¢ºæ€§
   - ä¸­å‹è³‡æ–™é›†ï¼š500-1000æœ¬æ›¸ç±ï¼Œæ¸¬è©¦æ­£å¸¸ä½¿ç”¨æƒ…æ³ä¸‹çš„æ•ˆèƒ½
   - å¤§å‹è³‡æ–™é›†ï¼š2000-5000æœ¬æ›¸ç±ï¼Œæ¸¬è©¦é‡åº¦ä½¿ç”¨è€…çš„æ•ˆèƒ½éœ€æ±‚
   - æ¥µå¤§è³‡æ–™é›†ï¼š10000+æœ¬æ›¸ç±ï¼Œæ¸¬è©¦ç³»çµ±æ¥µé™å’Œé™ç´šæ©Ÿåˆ¶

2. **è™•ç†è¤‡é›œåº¦åˆ†æ**
   - è³‡æ–™æå–ï¼šO(n)è¤‡é›œåº¦ï¼Œä¸»è¦å—DOMè§£æå’Œç¶²è·¯I/Oå½±éŸ¿
   - å»é‡è™•ç†ï¼šO(nÂ²)æœ€å£æƒ…æ³ï¼Œéœ€è¦å„ªåŒ–æ¼”ç®—æ³•å’Œå»ºç«‹ç´¢å¼•
   - æœå°‹ç¯©é¸ï¼šO(n)åˆ°O(log n)ï¼Œæ ¹æ“šç´¢å¼•æ•ˆç‡æ±ºå®š
   - è³‡æ–™åŒ¯å‡ºï¼šO(n)è¤‡é›œåº¦ï¼Œä¸»è¦å—åºåˆ—åŒ–å’Œæª”æ¡ˆI/Oå½±éŸ¿

**å¤§é‡è³‡æ–™æ¸¬è©¦ç­–ç•¥**:

1. **æ•ˆèƒ½åŸºæº–è¨­å®š**
   - è™•ç†é€Ÿåº¦ï¼šè‡³å°‘50æœ¬æ›¸ç±/ç§’çš„è™•ç†é€Ÿåº¦
   - è¨˜æ†¶é«”ä½¿ç”¨ï¼šå³°å€¼è¨˜æ†¶é«”ä¸è¶…é200MB
   - æª”æ¡ˆå¤§å°ï¼š10000æœ¬æ›¸ç±çš„JSONæª”æ¡ˆæ‡‰å°æ–¼20MB
   - ä½¿ç”¨è€…å›æ‡‰ï¼šUIæ“ä½œéŸ¿æ‡‰æ™‚é–“ä¸è¶…é100ms

2. **åˆ†æ‰¹è™•ç†æ©Ÿåˆ¶æ¸¬è©¦**

   ```javascript
   test('å¤§é‡è³‡æ–™åˆ†æ‰¹è™•ç†', async () => {
     const largeDataset = generateTestBooks(5000)
     const batchSize = 100
     const processor = new BatchProcessor(batchSize)

     const result = await processor.processLargeDataset(largeDataset)

     expect(result.processedCount).toBe(5000)
     expect(result.batchCount).toBe(50)
     expect(result.memoryPeak).toBeLessThan(200 * 1024 * 1024)
     expect(result.processingTime).toBeLessThan(100000) // <100ç§’
   })
   ```

3. **è¨˜æ†¶é«”ç®¡ç†å’Œåƒåœ¾å›æ”¶æ¸¬è©¦**
   - é•·æ™‚é–“è™•ç†éç¨‹ä¸­çš„è¨˜æ†¶é«”ä½¿ç”¨è¶¨å‹¢
   - æ‰¹æ¬¡è™•ç†é–“çš„è¨˜æ†¶é«”é‡‹æ”¾æ•ˆæœ
   - åƒåœ¾å›æ”¶è§¸ç™¼æ™‚æ©Ÿå’Œæ•ˆæœç›£æ§
   - è¨˜æ†¶é«”æ´©æ¼æª¢æ¸¬å’Œé˜²è­·æ©Ÿåˆ¶

### å¤šå¹³å°ç€è¦½å™¨ç’°å¢ƒå·®ç•°

**Chromeç‰ˆæœ¬ç›¸å®¹æ€§**:

1. **ç‰ˆæœ¬å·®ç•°åˆ†æ**
   - Chrome 88+ï¼šManifest V3å®Œæ•´æ”¯æ´
   - Chrome 90+ï¼šService Workerç©©å®šæ€§æ”¹å–„
   - Chrome 95+ï¼šStorage APIæ•ˆèƒ½æœ€ä½³åŒ–
   - æœ€æ–°ç‰ˆæœ¬ï¼šæœ€æ–°APIåŠŸèƒ½å’Œå®‰å…¨æ€§æ›´æ–°

2. **APIè¡Œç‚ºå·®ç•°**
   - èˆŠç‰ˆChromeçš„Service Workeré™åˆ¶æ›´åš´æ ¼
   - Storage APIçš„åŒæ­¥è¡Œç‚ºåœ¨ä¸åŒç‰ˆæœ¬ç•¥æœ‰å·®ç•°
   - æ¬Šé™ç³»çµ±çš„æç¤ºä»‹é¢å’Œæµç¨‹è®Šæ›´
   - Performance APIçš„å¯ç”¨æ€§å’Œç²¾ç¢ºåº¦å·®ç•°

**ä½œæ¥­ç³»çµ±ç’°å¢ƒå·®ç•°**:

1. **æª”æ¡ˆç³»çµ±äº’å‹•**
   - Windowsï¼šæª”æ¡ˆè·¯å¾‘åˆ†éš”ç¬¦ã€æª”æ¡ˆæ¬Šé™è™•ç†
   - macOSï¼šæª”æ¡ˆåç¨±å¤§å°å¯«æ•æ„Ÿæ€§ã€ç‰¹æ®Šå­—å…ƒè™•ç†
   - Linuxï¼šå­—å…ƒç·¨ç¢¼ã€æª”æ¡ˆç³»çµ±é¡å‹å·®ç•°

2. **æ•ˆèƒ½ç‰¹æ€§å·®ç•°**
   - CPUæ¶æ§‹ï¼šIntel x86ã€AMD64ã€Apple Siliconçš„æ•ˆèƒ½å·®ç•°
   - è¨˜æ†¶é«”ç®¡ç†ï¼šä¸åŒOSçš„è¨˜æ†¶é«”åˆ†é…å’Œå›æ”¶ç­–ç•¥
   - æª”æ¡ˆI/Oï¼šä¸åŒæª”æ¡ˆç³»çµ±çš„è®€å¯«æ•ˆèƒ½å·®ç•°

**ç€è¦½å™¨ç’°å¢ƒé…ç½®å·®ç•°**:

1. **Extensionæ¬Šé™ç®¡ç†**
   - ä¼æ¥­ç’°å¢ƒï¼šGroup Policyé™åˆ¶ï¼Œæ¬Šé™é é…ç½®
   - å€‹äººç’°å¢ƒï¼šä½¿ç”¨è€…æ‰‹å‹•æ¬Šé™ç®¡ç†ï¼Œéš±ç§è¨­å®šå½±éŸ¿
   - é–‹ç™¼ç’°å¢ƒï¼šé–‹ç™¼è€…æ¨¡å¼çš„ç‰¹æ®Šè¡Œç‚ºå’Œé™¤éŒ¯åŠŸèƒ½

2. **ç¶²è·¯ç’°å¢ƒå·®ç•°**
   - å…¬å¸ç¶²è·¯ï¼šä»£ç†ä¼ºæœå™¨ã€é˜²ç«ç‰†é™åˆ¶
   - å®¶ç”¨ç¶²è·¯ï¼šé »å¯¬é™åˆ¶ã€ä¸ç©©å®šé€£æ¥
   - è¡Œå‹•ç¶²è·¯ï¼šé«˜å»¶é²ã€é–“æ­‡æ€§ä¸­æ–·

## ğŸ— API/ä»‹é¢è¨­è¨ˆ

### æ•´åˆæ¸¬è©¦æ¡†æ¶çš„APIè¨­è¨ˆ

**æ ¸å¿ƒæ¸¬è©¦æ¡†æ¶é¡åˆ¥çµæ§‹**:

1. **E2ETestSuiteä¸»é¡åˆ¥**

   ```javascript
   class E2ETestSuite {
     constructor(config) {
       this.browser = null
       this.extensionId = null
       this.testConfig = config
       this.performanceMonitor = new PerformanceMonitor()
       this.errorTracker = new ErrorTracker()
     }

     async setup() {
       // Chromeç€è¦½å™¨å•Ÿå‹•å’ŒExtensionè¼‰å…¥
       // æ¸¬è©¦ç’°å¢ƒåˆå§‹åŒ–å’Œé©—è­‰
       // æ•ˆèƒ½ç›£æ§å’ŒéŒ¯èª¤è¿½è¹¤å•Ÿå‹•
     }

     async runCompleteUserWorkflow(scenario) {
       // åŸ·è¡Œå®Œæ•´çš„ä½¿ç”¨è€…å·¥ä½œæµç¨‹
       // å›å‚³è©³ç´°çš„æ¸¬è©¦çµæœå’Œæ•ˆèƒ½è³‡æ–™
     }

     async cleanup() {
       // ç€è¦½å™¨é—œé–‰å’Œè³‡æºæ¸…ç†
       // æ¸¬è©¦å ±å‘Šç”¢ç”Ÿå’Œå„²å­˜
     }
   }
   ```

2. **WorkflowRunnerå·¥ä½œæµç¨‹åŸ·è¡Œå™¨**

   ```javascript
   class WorkflowRunner {
     async executeBookExtractionFlow(testData) {
       // åŸ·è¡Œæ›¸ç±æå–å®Œæ•´æµç¨‹
       // åŒ…å«UIäº’å‹•ã€äº‹ä»¶é©—è­‰ã€çµæœæª¢æŸ¥
     }

     async executeDataImportExportFlow(importData) {
       // åŸ·è¡Œè³‡æ–™åŒ¯å‡ºå…¥æµç¨‹
       // åŒ…å«æª”æ¡ˆæ“ä½œã€è³‡æ–™é©—è­‰ã€æ•´åˆæ€§æª¢æŸ¥
     }

     async executeCrossDeviceSyncFlow(devices) {
       // åŸ·è¡Œè·¨è¨­å‚™åŒæ­¥æµç¨‹
       // åŒ…å«å¤šè¨­å‚™æ¨¡æ“¬ã€è³‡æ–™ä¸€è‡´æ€§é©—è­‰
     }
   }
   ```

3. **ChromeExtensionController Extensionæ§åˆ¶å™¨**
   ```javascript
   class ChromeExtensionController {
     async openPopup() {
       // é–‹å•ŸExtension Popupä¸¦ç­‰å¾…è¼‰å…¥å®Œæˆ
     }

     async clickExtractButton() {
       // é»æ“Šæå–æŒ‰éˆ•ä¸¦ç›£æ§ç‹€æ…‹è®ŠåŒ–
     }

     async openOverviewPage() {
       // é–‹å•ŸOverviewé é¢ä¸¦é©—è­‰è¼‰å…¥
     }

     async getStorageData() {
       // å–å¾—Chrome Storageä¸­çš„è³‡æ–™
     }

     async simulateError(errorType) {
       // æ¨¡æ“¬å„ç¨®éŒ¯èª¤æƒ…æ³
     }
   }
   ```

**æ¸¬è©¦APIè¨­è¨ˆåŸå‰‡**:

- **éˆå¼å‘¼å«æ”¯æ´**: æ”¯æ´æµæš¢çš„æ¸¬è©¦ç¨‹å¼ç¢¼æ’°å¯«é¢¨æ ¼
- **ç•°æ­¥æ“ä½œè™•ç†**: æ‰€æœ‰æ“ä½œè¿”å›Promiseï¼Œæ”¯æ´async/await
- **éŒ¯èª¤è™•ç†å…§å»º**: è‡ªå‹•æ•ç²å’Œåˆ†é¡æ¸¬è©¦éç¨‹ä¸­çš„éŒ¯èª¤
- **æ•ˆèƒ½ç›£æ§æ•´åˆ**: è‡ªå‹•è¨˜éŒ„é—œéµæ“ä½œçš„æ•ˆèƒ½æŒ‡æ¨™

### æ¸¬è©¦ç’°å¢ƒè¨­ç½®å’Œæ¸…ç†æ©Ÿåˆ¶

**æ¸¬è©¦ç’°å¢ƒè¨­ç½®æµç¨‹**:

1. **Chromeç€è¦½å™¨ç’°å¢ƒæº–å‚™**

   ```javascript
   async setupBrowserEnvironment() {
     const browserConfig = {
       headless: this.config.headless || false,
       args: [
         '--no-sandbox',
         '--disable-dev-shm-usage',
         '--disable-extensions-except=' + this.extensionPath,
         '--load-extension=' + this.extensionPath
       ],
       slowMo: this.config.slowMo || 0
     }

     this.browser = await puppeteer.launch(browserConfig)
     this.page = await this.browser.newPage()

     // ç­‰å¾…Extensionè¼‰å…¥å®Œæˆ
     await this.waitForExtensionLoad()

     // è¨­å®šé é¢ç›£æ§
     this.setupPageMonitoring()
   }
   ```

2. **æ¸¬è©¦è³‡æ–™ç’°å¢ƒæº–å‚™**

   ```javascript
   async setupTestData() {
     // æ¸…ç†Chrome Storage
     await this.clearAllStorageData()

     // æº–å‚™æ¸¬è©¦ç”¨çš„Readmooé é¢
     await this.setupMockReadmooPage()

     // æ³¨å…¥æ¸¬è©¦è³‡æ–™
     await this.injectTestBooks(this.config.testDataSize)

     // é©—è­‰åˆå§‹ç‹€æ…‹
     await this.verifyInitialState()
   }
   ```

3. **ç›£æ§å’Œè¿½è¹¤ç³»çµ±è¨­ç½®**
   ```javascript
   setupMonitoring() {
     // æ•ˆèƒ½ç›£æ§
     this.performanceMonitor.startTracking()

     // ç¶²è·¯è«‹æ±‚ç›£æ§
     this.page.on('request', this.trackNetworkRequest)
     this.page.on('response', this.trackNetworkResponse)

     // éŒ¯èª¤æ•ç²
     this.page.on('pageerror', this.trackPageError)
     this.page.on('console', this.trackConsoleMessage)

     // è¨˜æ†¶é«”ä½¿ç”¨ç›£æ§
     this.memoryMonitor.startTracking()
   }
   ```

**æ¸¬è©¦ç’°å¢ƒæ¸…ç†æ©Ÿåˆ¶**:

1. **è³‡æ–™æ¸…ç†ç­–ç•¥**

   ```javascript
   async cleanup() {
     // ä¿å­˜æ¸¬è©¦çµæœ
     await this.saveTestResults()

     // ç”¢ç”Ÿæ•ˆèƒ½å ±å‘Š
     await this.generatePerformanceReport()

     // æ¸…ç†æ¸¬è©¦è³‡æ–™
     await this.clearTestData()

     // é—œé–‰ç›£æ§ç³»çµ±
     this.stopAllMonitoring()

     // é—œé–‰ç€è¦½å™¨
     await this.browser.close()
   }
   ```

2. **å¤±æ•—æ¸¬è©¦çš„ç‰¹æ®Šè™•ç†**
   ```javascript
   async handleTestFailure(error) {
     // æˆªå–éŒ¯èª¤ç™¼ç”Ÿæ™‚çš„è¢å¹•æˆªåœ–
     await this.takeErrorScreenshot()

     // æ”¶é›†è©³ç´°çš„éŒ¯èª¤è³‡è¨Š
     const errorContext = await this.collectErrorContext()

     // ä¿å­˜Chrome DevTools Consoleæ—¥èªŒ
     await this.saveConsoleLog()

     // å„²å­˜Chrome Storageç‹€æ…‹å¿«ç…§
     await this.saveStorageSnapshot()
   }
   ```

### Mockå¤–éƒ¨æœå‹™ï¼ˆReadmooç¶²ç«™ã€Chrome APIsï¼‰çš„ç­–ç•¥

**Readmooç¶²ç«™Mockç­–ç•¥**:

1. **éœæ…‹HTMLæ¨¡æ“¬é é¢**

   ```html
   <!-- tests/e2e/fixtures/readmoo-mock-page.html -->
   <div class="book-item" data-book-id="001">
     <h3 class="book-title">æ¸¬è©¦æ›¸ç± 1</h3>
     <span class="progress">30%</span>
     <img class="book-cover" src="mock-cover-1.jpg" />
   </div>
   ```

2. **å‹•æ…‹è³‡æ–™æ³¨å…¥æ©Ÿåˆ¶**

   ```javascript
   async injectMockBooks(books) {
     await this.page.evaluate((booksData) => {
       const container = document.querySelector('.book-list')
       booksData.forEach(book => {
         const bookElement = document.createElement('div')
         bookElement.className = 'book-item'
         bookElement.innerHTML = `
           <h3 class="book-title">${book.title}</h3>
           <span class="progress">${book.progress}%</span>
         `
         container.appendChild(bookElement)
       })
       // æ¨™è¨˜æ›¸ç±è¼‰å…¥å®Œæˆ
       document.body.setAttribute('data-books-loaded', 'true')
     }, books)
   }
   ```

3. **ç¶²è·¯è«‹æ±‚æ””æˆªå’Œæ¨¡æ“¬**
   ```javascript
   async setupNetworkMocking() {
     await this.page.setRequestInterception(true)

     this.page.on('request', async (request) => {
       if (request.url().includes('readmoo.com/api')) {
         // æ¨¡æ“¬APIå›æ‡‰
         await request.respond({
           status: 200,
           contentType: 'application/json',
           body: JSON.stringify(this.mockAPIResponse)
         })
       } else {
         await request.continue()
       }
     })
   }
   ```

**Chrome APIs Mockç­–ç•¥**:

1. **Storage APIå®Œæ•´æ¨¡æ“¬**

   ```javascript
   class ChromeStorageMock {
     constructor(quota) {
       this.data = new Map()
       this.quota = quota
       this.used = 0
     }

     async get(keys) {
       // æ¨¡æ“¬Chrome Storage getè¡Œç‚º
       const result = {}
       if (Array.isArray(keys)) {
         keys.forEach((key) => {
           if (this.data.has(key)) {
             result[key] = this.data.get(key)
           }
         })
       }
       return result
     }

     async set(items) {
       // æ¨¡æ“¬å„²å­˜é…é¡é™åˆ¶
       const serialized = JSON.stringify(items)
       if (this.used + serialized.length > this.quota) {
         throw new Error('QUOTA_EXCEEDED_ERR')
       }

       Object.entries(items).forEach(([key, value]) => {
         this.data.set(key, value)
       })
       this.used += serialized.length
     }
   }
   ```

2. **Runtimeè¨Šæ¯ç³»çµ±æ¨¡æ“¬**
   ```javascript
   class RuntimeMessageMock {
     constructor() {
       this.listeners = new Map()
       this.messageQueue = []
     }

     sendMessage(tabId, message, callback) {
       // æ¨¡æ“¬è¨Šæ¯ç™¼é€å»¶é²
       setTimeout(() => {
         const response = this.processMessage(message)
         if (callback) callback(response)
       }, this.simulateNetworkDelay())
     }

     onMessage(callback) {
       // æ¨¡æ“¬äº‹ä»¶ç›£è½å™¨è¨»å†Š
       this.listeners.set(Date.now(), callback)
     }
   }
   ```

### æ¸¬è©¦è³‡æ–™ç®¡ç†å’Œå…±äº«æ©Ÿåˆ¶

**æ¸¬è©¦è³‡æ–™ç”¢ç”Ÿç­–ç•¥**:

1. **æ›¸ç±è³‡æ–™ç”¢ç”Ÿå™¨**

   ```javascript
   class TestBookGenerator {
     generateBooks(count, category = 'default') {
       return Array.from({ length: count }, (_, index) => ({
         id: `${category}-book-${String(index + 1).padStart(3, '0')}`,
         title: this.generateBookTitle(category, index),
         author: this.generateAuthor(),
         progress: Math.floor(Math.random() * 100),
         cover: `mock-cover-${(index % 10) + 1}.jpg`,
         extractedAt: new Date().toISOString(),
         category: category
       }))
     }

     generateBookTitle(category, index) {
       const templates = {
         default: ['ç¶“å…¸æ–‡å­¸', 'ç§‘å¹»å°èªª', 'æ­·å²å‚³è¨˜', 'å•†æ¥­ç®¡ç†'],
         technical: ['JavaScriptæ¬Šå¨æŒ‡å—', 'Chrome Extensioné–‹ç™¼', 'å‰ç«¯æ•ˆèƒ½å„ªåŒ–'],
         fiction: ['å¥‡å¹»å†’éšª', 'æ¨ç†æ‡¸ç–‘', 'æ„›æƒ…å°èªª', 'ç§‘å¹»å²è©©']
       }
       const base = templates[category] || templates.default
       return `${base[index % base.length]} ${index + 1}`
     }
   }
   ```

2. **é‚Šç•Œæ¢ä»¶è³‡æ–™ç”¢ç”Ÿ**
   ```javascript
   class BoundaryTestDataGenerator {
     generateLargeDataset(size) {
       // ç”¢ç”Ÿå¤§é‡è³‡æ–™é›†ç”¨æ–¼æ•ˆèƒ½æ¸¬è©¦
       return this.generator.generateBooks(size, 'performance-test')
     }

     generateCorruptedData() {
       // ç”¢ç”Ÿå„ç¨®æå£çš„è³‡æ–™ç”¨æ–¼éŒ¯èª¤è™•ç†æ¸¬è©¦
       return {
         invalidJSON: '{"books": [{"id": "1", "title": "Test"} // èªæ³•éŒ¯èª¤',
         missingFields: [{ title: 'ç¼ºå°‘IDçš„æ›¸ç±' }],
         invalidProgress: [{ id: '001', title: 'æ¸¬è©¦', progress: -10 }]
       }
     }

     generateConflictData() {
       // ç”¢ç”Ÿè¡çªè³‡æ–™ç”¨æ–¼åˆä½µæ¸¬è©¦
       const baseBook = { id: '001', title: 'è¡çªæ¸¬è©¦æ›¸' }
       return {
         version1: { ...baseBook, progress: 50, lastModified: '2025-08-24T10:00:00Z' },
         version2: { ...baseBook, progress: 80, lastModified: '2025-08-24T11:00:00Z' }
       }
     }
   }
   ```

**æ¸¬è©¦è³‡æ–™å…±äº«å’Œå¿«å–æ©Ÿåˆ¶**:

1. **è³‡æ–™å¿«å–ç­–ç•¥**

   ```javascript
   class TestDataCache {
     constructor() {
       this.cache = new Map()
       this.cacheDir = path.join(__dirname, '../fixtures/cache')
     }

     async getOrGenerate(key, generator) {
       if (this.cache.has(key)) {
         return this.cache.get(key)
       }

       const cacheFile = path.join(this.cacheDir, `${key}.json`)
       if (fs.existsSync(cacheFile)) {
         const data = JSON.parse(fs.readFileSync(cacheFile, 'utf8'))
         this.cache.set(key, data)
         return data
       }

       const data = await generator()
       this.cache.set(key, data)
       fs.writeFileSync(cacheFile, JSON.stringify(data, null, 2))
       return data
     }
   }
   ```

2. **è·¨æ¸¬è©¦æ¡ˆä¾‹è³‡æ–™å…±äº«**
   ```javascript
   class SharedTestDataManager {
     static instance = null

     static getInstance() {
       if (!this.instance) {
         this.instance = new SharedTestDataManager()
       }
       return this.instance
     }

     async getStandardTestDataset(size) {
       return this.cache.getOrGenerate(`standard-dataset-${size}`, () =>
         this.generator.generateBooks(size, 'standard')
       )
     }

     async getPerformanceTestDataset(size) {
       return this.cache.getOrGenerate(`performance-dataset-${size}`, () =>
         this.generator.generateBooks(size, 'performance')
       )
     }
   }
   ```

## âœ… é©—æ”¶æ¨™æº–

### å®Œæ•´ä½¿ç”¨è€…å·¥ä½œæµç¨‹çš„æ­£ç¢ºæ€§é©—è­‰æ–¹æ³•

**ä½¿ç”¨è€…å·¥ä½œæµç¨‹é©—è­‰æ¡†æ¶**:

1. **å·¥ä½œæµç¨‹å®Œæ•´æ€§æª¢æŸ¥**

   ```javascript
   class WorkflowVerifier {
     async verifyCompleteExtractionWorkflow(testResult) {
       const requiredSteps = [
         'extension_popup_opened',
         'extract_button_clicked',
         'extraction_progress_displayed',
         'extraction_completed',
         'books_count_updated',
         'overview_accessible'
       ]

       requiredSteps.forEach((step) => {
         expect(testResult.completedSteps).toContain(step)
         expect(testResult.stepTimings[step]).toBeLessThan(this.maxStepTime[step])
       })

       // é©—è­‰æ•´é«”æµç¨‹æ™‚é–“
       expect(testResult.totalTime).toBeLessThan(30000) // 30ç§’å…§å®Œæˆ
     }
   }
   ```

2. **ä½¿ç”¨è€…é«”é©—å“è³ªé©—è­‰**

   ```javascript
   async verifyUserExperienceQuality(workflow) {
     const uxMetrics = {
       // éŸ¿æ‡‰æ€§ï¼šä½¿ç”¨è€…æ“ä½œçš„å³æ™‚åé¥‹
       responsiveness: this.calculateResponsiveness(workflow.interactions),
       // æµæš¢åº¦ï¼šå‹•ç•«å’Œè½‰æ›çš„æµæš¢ç¨‹åº¦
       fluidity: this.measureAnimationFluidity(workflow.animations),
       // ä¸€è‡´æ€§ï¼šæ“ä½œçµæœèˆ‡é æœŸçš„ä¸€è‡´æ€§
       consistency: this.verifyBehaviorConsistency(workflow.operations),
       // å¯ç”¨æ€§ï¼šéŒ¯èª¤æƒ…æ³çš„è™•ç†å‹å–„åº¦
       usability: this.assessErrorHandlingUsability(workflow.errors)
     }

     // æ‰€æœ‰UXæŒ‡æ¨™éƒ½æ‡‰é”åˆ°80%ä»¥ä¸Š
     Object.values(uxMetrics).forEach(metric => {
       expect(metric.score).toBeGreaterThan(0.8)
     })
   }
   ```

3. **åŠŸèƒ½å®Œæ•´æ€§é©—è­‰çŸ©é™£**
   ```javascript
   const functionalityMatrix = {
     dataExtraction: {
       smallDataset: { minSuccessRate: 0.98 },
       mediumDataset: { minSuccessRate: 0.95 },
       largeDataset: { minSuccessRate: 0.92 }
     },
     dataImportExport: {
       jsonExport: { completenessRate: 1.0, formatValidation: true },
       jsonImport: { accuracyRate: 0.99, conflictResolution: true },
       csvExport: { compatibilityRate: 0.95 }
     },
     uiInteraction: {
       searchFilter: { responseTime: 1000, accuracyRate: 0.98 },
       pagination: { smoothness: 0.9, dataConsistency: 1.0 },
       sorting: { correctnessRate: 1.0, stabilityRate: 0.95 }
     }
   }
   ```

**å·¥ä½œæµç¨‹é©—è­‰å…·é«”æ¨™æº–**:

1. **æ›¸ç±æå–å·¥ä½œæµç¨‹é©—è­‰**
   - æå–æˆåŠŸç‡ï¼šå°å‹è³‡æ–™é›†98%ï¼Œä¸­å‹è³‡æ–™é›†95%ï¼Œå¤§å‹è³‡æ–™é›†90%
   - æå–é€Ÿåº¦ï¼šå¹³å‡æ¯ç§’è™•ç†50æœ¬æ›¸ç±ä»¥ä¸Š
   - è³‡æ–™å®Œæ•´æ€§ï¼šæå–çš„æ›¸ç±è³‡æ–™å¿…é ˆåŒ…å«æ‰€æœ‰å¿…è¦æ¬„ä½
   - UIå›é¥‹ï¼šæå–éç¨‹ä¸­é€²åº¦æ›´æ–°è‡³å°‘æ¯2ç§’ä¸€æ¬¡

2. **è·¨è¨­å‚™åŒæ­¥å·¥ä½œæµç¨‹é©—è­‰**
   - åŒæ­¥ä¸€è‡´æ€§ï¼šå…©è¨­å‚™é–“è³‡æ–™ç›¸ç¬¦ç‡100%
   - è¡çªè§£æ±ºï¼šè‡ªå‹•è§£æ±º90%ä»¥ä¸Šçš„è³‡æ–™è¡çª
   - ä½¿ç”¨è€…å¼•å°ï¼šè¡çªéœ€è¦æ‰‹å‹•è™•ç†æ™‚ï¼Œæä¾›æ¸…æ¥šçš„é¸æ“‡ä»‹é¢
   - éŒ¯èª¤æ¢å¾©ï¼šåŒæ­¥å¤±æ•—å¾Œèƒ½å¤ å®‰å…¨å›æ»¾åˆ°ç©©å®šç‹€æ…‹

### è·¨æ¨¡çµ„äº’å‹•çš„è³‡æ–™ä¸€è‡´æ€§æª¢æŸ¥æ¨™æº–

**è³‡æ–™ä¸€è‡´æ€§æª¢æŸ¥æ©Ÿåˆ¶**:

1. **å³æ™‚ä¸€è‡´æ€§é©—è­‰**

   ```javascript
   class DataConsistencyChecker {
     async verifyRealTimeConsistency() {
       const checkPoints = [
         'after_data_extraction',
         'after_storage_save',
         'after_ui_update',
         'after_background_processing'
       ]

       for (const point of checkPoints) {
         const storageData = await this.getStorageData()
         const uiDisplayedData = await this.getUIDisplayedData()
         const backgroundCachedData = await this.getBackgroundData()

         // é©—è­‰ä¸‰å€‹è³‡æ–™æºçš„ä¸€è‡´æ€§
         expect(this.calculateDataHash(storageData)).toBe(this.calculateDataHash(uiDisplayedData))
         expect(this.calculateDataHash(storageData)).toBe(
           this.calculateDataHash(backgroundCachedData)
         )
       }
     }
   }
   ```

2. **äº‹å‹™æ€§ä¸€è‡´æ€§ä¿è­‰**

   ```javascript
   async verifyTransactionalConsistency(operation) {
     // è¨˜éŒ„æ“ä½œå‰ç‹€æ…‹
     const preOperationState = await this.captureSystemState()

     try {
       // åŸ·è¡Œæ“ä½œ
       const result = await operation.execute()

       if (result.success) {
         // æˆåŠŸæ™‚é©—è­‰é æœŸçš„ç‹€æ…‹è®Šæ›´
         const postOperationState = await this.captureSystemState()
         this.verifyExpectedStateChanges(preOperationState, postOperationState, operation.expectedChanges)
       } else {
         // å¤±æ•—æ™‚é©—è­‰ç‹€æ…‹æœªè¢«ç ´å£
         const currentState = await this.captureSystemState()
         expect(currentState).toEqual(preOperationState)
       }
     } catch (error) {
       // ç•°å¸¸æ™‚é©—è­‰è³‡æ–™å®Œæ•´æ€§
       const currentState = await this.captureSystemState()
       this.verifyNoDataCorruption(preOperationState, currentState)
     }
   }
   ```

3. **è·¨Contextè³‡æ–™åŒæ­¥é©—è­‰**
   ```javascript
   async verifyContextDataSync() {
     const testData = this.generateSyncTestData()

     // åœ¨Backgroundä¸­æ›´æ–°è³‡æ–™
     await this.background.updateData(testData)

     // ç­‰å¾…äº‹ä»¶å‚³æ’­
     await this.waitForEventPropagation()

     // é©—è­‰Content Scriptæ¥æ”¶åˆ°æ›´æ–°
     const contentScriptData = await this.contentScript.getCurrentData()
     expect(contentScriptData).toEqual(testData)

     // é©—è­‰Popupé¡¯ç¤ºæ›´æ–°
     const popupDisplayData = await this.popup.getDisplayedData()
     expect(popupDisplayData).toEqual(testData)

     // é©—è­‰StorageæŒä¹…åŒ–
     const storedData = await this.storage.getData()
     expect(storedData).toEqual(testData)
   }
   ```

**è³‡æ–™ä¸€è‡´æ€§æ¨™æº–å®šç¾©**:

1. **åŒæ­¥æ€§æ¨™æº–**
   - è³‡æ–™è®Šæ›´å¾Œ3ç§’å…§ï¼Œæ‰€æœ‰ç›¸é—œUIå¿…é ˆåæ˜ æœ€æ–°ç‹€æ…‹
   - Backgroundè™•ç†å®Œæˆå¾Œ1ç§’å…§ï¼ŒPopupç‹€æ…‹å¿…é ˆæ›´æ–°
   - Storageå¯«å…¥å®Œæˆå¾Œï¼Œè®€å–æ“ä½œå¿…é ˆå›å‚³æœ€æ–°è³‡æ–™

2. **å®Œæ•´æ€§æ¨™æº–**
   - ä»»ä½•æ“ä½œä¸­æ–·å¾Œï¼Œè³‡æ–™ä¸èƒ½è™•æ–¼ä¸ä¸€è‡´çš„ä¸­é–“ç‹€æ…‹
   - æ‰¹æ¬¡æ“ä½œå¤±æ•—æ™‚ï¼Œå·²è™•ç†çš„éƒ¨åˆ†æ‡‰è©²å¯ä»¥è­˜åˆ¥å’Œæ¢å¾©
   - ä¸¦ç™¼æ“ä½œä¸èƒ½å°è‡´è³‡æ–™ç«¶çˆ­æˆ–è³‡æ–™éºå¤±

### æ•ˆèƒ½å’Œä½¿ç”¨è€…é«”é©—çš„è©•ä¼°æŒ‡æ¨™

**æ•ˆèƒ½åŸºæº–æŒ‡æ¨™é«”ç³»**:

1. **éŸ¿æ‡‰æ™‚é–“æŒ‡æ¨™**

   ```javascript
   const performanceStandards = {
     // ä½¿ç”¨è€…äº’å‹•éŸ¿æ‡‰æ™‚é–“
     userInteraction: {
       buttonClick: 100, // æŒ‰éˆ•é»æ“ŠéŸ¿æ‡‰ <100ms
       menuOpen: 200, // é¸å–®é–‹å•Ÿ <200ms
       searchInput: 300, // æœå°‹è¼¸å…¥éŸ¿æ‡‰ <300ms
       pageNavigation: 500 // é é¢å°èˆª <500ms
     },

     // è³‡æ–™è™•ç†æ™‚é–“
     dataProcessing: {
       smallDataset: 5000, // <5ç§’ (50æœ¬æ›¸ç±)
       mediumDataset: 15000, // <15ç§’ (500æœ¬æ›¸ç±)
       largeDataset: 45000 // <45ç§’ (2000æœ¬æ›¸ç±)
     },

     // æª”æ¡ˆæ“ä½œæ™‚é–“
     fileOperations: {
       jsonExport: 3000, // JSONåŒ¯å‡º <3ç§’
       jsonImport: 5000, // JSONåŒ¯å…¥ <5ç§’
       fileValidation: 1000 // æª”æ¡ˆé©—è­‰ <1ç§’
     }
   }
   ```

2. **è³‡æºä½¿ç”¨æ•ˆç‡æŒ‡æ¨™**
   ```javascript
   const resourceStandards = {
     memory: {
       baselineUsage: 30 * 1024 * 1024, // åŸºç¤è¨˜æ†¶é«” <30MB
       peakUsage: 200 * 1024 * 1024, // å³°å€¼è¨˜æ†¶é«” <200MB
       leakTolerance: 5 * 1024 * 1024 // æ´©æ¼å®¹å¿ <5MB
     },

     storage: {
       dataEfficiency: 0.8, // è³‡æ–™å£“ç¸®ç‡ >80%
       quotaUsage: 0.7, // é…é¡ä½¿ç”¨ç‡ <70%
       indexSize: 0.1 // ç´¢å¼•å¤§å° <10%
     },

     cpu: {
       processingLoad: 0.8, // è™•ç†è² è¼‰ <80%
       idleTime: 0.9, // ç©ºé–’æ™‚é–“ >90%
       backgroundEfficiency: 0.95 // èƒŒæ™¯æ•ˆç‡ >95%
     }
   }
   ```

**ä½¿ç”¨è€…é«”é©—è©•ä¼°æ¡†æ¶**:

1. **ä½¿ç”¨è€…é«”é©—æŒ‡æ¨™è¨ˆç®—**

   ```javascript
   class UserExperienceEvaluator {
     calculateUXScore(testResults) {
       const metrics = {
         // æ˜“ç”¨æ€§åˆ†æ•¸ (0-100)
         usability: this.assessUsability(testResults),

         // æ•ˆç‡åˆ†æ•¸ (0-100)
         efficiency: this.measureTaskEfficiency(testResults),

         // æ»¿æ„åº¦åˆ†æ•¸ (0-100)
         satisfaction: this.evaluateSatisfaction(testResults),

         // å¯é æ€§åˆ†æ•¸ (0-100)
         reliability: this.assessReliability(testResults)
       }

       // åŠ æ¬Šè¨ˆç®—ç¸½é«”UXåˆ†æ•¸
       const weights = { usability: 0.3, efficiency: 0.3, satisfaction: 0.2, reliability: 0.2 }
       const totalScore = Object.entries(metrics).reduce(
         (sum, [key, value]) => sum + value * weights[key],
         0
       )

       return {
         totalScore,
         breakdown: metrics,
         grade: this.calculateGrade(totalScore)
       }
     }
   }
   ```

2. **ä½¿ç”¨è€…é«”é©—å“è³ªæ¨™æº–**
   ```javascript
   const uxQualityStandards = {
     // Aç´šæ¨™æº– (å„ªç§€)
     gradeA: {
       totalScore: 90,
       usability: 90,
       efficiency: 85,
       satisfaction: 90,
       reliability: 95
     },

     // Bç´šæ¨™æº– (è‰¯å¥½)
     gradeB: {
       totalScore: 80,
       usability: 80,
       efficiency: 75,
       satisfaction: 80,
       reliability: 85
     },

     // Cç´šæ¨™æº– (å¯æ¥å—)
     gradeC: {
       totalScore: 70,
       usability: 70,
       efficiency: 65,
       satisfaction: 70,
       reliability: 75
     }
   }
   ```

### æ¸¬è©¦è‡ªå‹•åŒ–å’ŒCI/CDæ•´åˆè¦æ±‚

**è‡ªå‹•åŒ–æ¸¬è©¦æµç¨‹è¨­è¨ˆ**:

1. **CI/CDæ•´åˆè…³æœ¬**

   ```javascript
   // scripts/ci-e2e-tests.js
   class CIE2ERunner {
     async runCITests() {
       const testSuites = [
         'smoke-tests', // å¿«é€Ÿç…™éœ§æ¸¬è©¦ (5åˆ†é˜)
         'core-workflows', // æ ¸å¿ƒå·¥ä½œæµç¨‹ (15åˆ†é˜)
         'integration-tests', // æ•´åˆæ¸¬è©¦ (20åˆ†é˜)
         'performance-tests' // æ•ˆèƒ½æ¸¬è©¦ (10åˆ†é˜)
       ]

       for (const suite of testSuites) {
         const result = await this.runTestSuite(suite)
         if (!result.passed) {
           throw new Error(`CI Test Failed: ${suite}`)
         }
         await this.uploadResults(suite, result)
       }
     }
   }
   ```

2. **æ¸¬è©¦å ±å‘Šå’Œé€šçŸ¥ç³»çµ±**
   ```javascript
   class TestReportGenerator {
     async generateCIReport(results) {
       const report = {
         summary: this.createExecutiveSummary(results),
         performance: this.analyzePerformanceMetrics(results),
         coverage: this.calculateTestCoverage(results),
         regressions: this.detectRegressions(results),
         recommendations: this.generateRecommendations(results)
       }

       // ç”¢ç”Ÿå¤šæ ¼å¼å ±å‘Š
       await this.saveHTMLReport(report)
       await this.saveJSONReport(report)
       await this.saveJUnitXML(results) // ä¾›CIç³»çµ±ä½¿ç”¨

       // ç™¼é€é€šçŸ¥
       if (report.summary.hasFailures) {
         await this.sendFailureNotification(report)
       }

       return report
     }
   }
   ```

**è‡ªå‹•åŒ–å“è³ªæ¨™æº–**:

1. **æ¸¬è©¦åŸ·è¡Œæ•ˆç‡è¦æ±‚**
   - å®Œæ•´æ¸¬è©¦å¥—ä»¶åŸ·è¡Œæ™‚é–“ä¸è¶…é50åˆ†é˜
   - ç…™éœ§æ¸¬è©¦åŸ·è¡Œæ™‚é–“ä¸è¶…é5åˆ†é˜
   - ä¸¦è¡Œæ¸¬è©¦æ”¯æ´ï¼Œç¸®çŸ­ç¸½åŸ·è¡Œæ™‚é–“
   - æ¸¬è©¦å¤±æ•—æ™‚å¿«é€Ÿå¤±æ•—ï¼Œä¸ç¹¼çºŒåŸ·è¡Œç„¡é—œæ¸¬è©¦

2. **æ¸¬è©¦ç©©å®šæ€§è¦æ±‚**
   - æ¸¬è©¦çš„å¯é‡ç¾æ€§é”åˆ°99%ä»¥ä¸Š
   - å½é™½æ€§éŒ¯èª¤ç‡ä½æ–¼1%
   - æ¸¬è©¦ç’°å¢ƒéš”é›¢ï¼Œé¿å…æ¸¬è©¦é–“ç›¸äº’å½±éŸ¿
   - è‡ªå‹•æ¸…ç†æ©Ÿåˆ¶ï¼Œç¢ºä¿æ¸¬è©¦ç’°å¢ƒä¸€è‡´æ€§

3. **æ¸¬è©¦å ±å‘Šå“è³ªè¦æ±‚**
   - æ¸¬è©¦çµæœè¿½è¹¤æ€§ï¼šæ¯å€‹å¤±æ•—éƒ½èƒ½è¿½è¹¤åˆ°å…·é«”åŸå› 
   - æ•ˆèƒ½è¶¨å‹¢åˆ†æï¼šèˆ‡æ­·å²ç‰ˆæœ¬çš„æ•ˆèƒ½æ¯”è¼ƒ
   - è¦†è“‹ç‡å ±å‘Šï¼šåŠŸèƒ½è¦†è“‹ç‡å’Œç¨‹å¼ç¢¼è¦†è“‹ç‡çµ±è¨ˆ
   - å›æ­¸æª¢æ¸¬ï¼šè‡ªå‹•æª¢æ¸¬æ–°ç‰ˆæœ¬å¼•å…¥çš„å•é¡Œ

## ğŸ“‹ Phase 1 å®Œæˆç¸½çµ

### åŠŸèƒ½è¨­è¨ˆå®Œæˆåº¦è©•ä¼°

**éœ€æ±‚åˆ†æå®Œæ•´æ€§**ï¼šâœ… 100%

- æ˜ç¢ºè­˜åˆ¥äº†E2Eæ•´åˆæ¸¬è©¦çš„4å€‹æ ¸å¿ƒå•é¡Œ
- è©³ç´°åˆ†æäº†èˆ‡ç¾æœ‰å–®å…ƒæ¸¬è©¦çš„å€åˆ¥å’Œäº’è£œé—œä¿‚
- å…¨é¢è¦†è“‹äº†Chrome Extensionçš„å…¸å‹ä½¿ç”¨å ´æ™¯
- å®Œæ•´å®šç¾©äº†éœ€è¦é©—è­‰çš„è·¨æ¨¡çµ„äº’å‹•å’Œè³‡æ–™æµ

**åŠŸèƒ½è¦æ ¼è¨­è¨ˆå®Œæ•´æ€§**ï¼šâœ… 100%

- è©³ç´°å®šç¾©äº†æ¸¬è©¦è¼¸å…¥ï¼ˆç’°å¢ƒã€æ“ä½œã€æƒ…å¢ƒã€é…ç½®åƒæ•¸ï¼‰
- æ˜ç¢ºè¦åŠƒäº†æ¸¬è©¦è¼¸å‡ºï¼ˆåŠŸèƒ½é©—è­‰ã€æ•ˆèƒ½æŒ‡æ¨™ã€ç©©å®šæ€§è©•ä¼°ã€è¦†è“‹åº¦çµ±è¨ˆï¼‰
- è¨­è¨ˆäº†å®Œæ•´çš„4éšæ®µæ¸¬è©¦åŸ·è¡Œæµç¨‹
- å…¨é¢è¦åŠƒäº†å„ç¨®ç•°å¸¸æƒ…æ³å’ŒéŒ¯èª¤è™•ç†æ¸¬è©¦

**é‚Šç•Œæ¢ä»¶åˆ†æå®Œæ•´æ€§**ï¼šâœ… 100%

- æ·±å…¥åˆ†æäº†Chrome Extension APIé™åˆ¶å’Œæ¨¡æ“¬ç­–ç•¥
- è¨­è¨ˆäº†è·¨Contexté€šè¨Šçš„å®Œæ•´æ¸¬è©¦æ–¹æ¡ˆ
- è¦åŠƒäº†å¤§é‡è³‡æ–™è™•ç†çš„é‚Šç•Œæ¸¬è©¦ç­–ç•¥
- è€ƒæ…®äº†å¤šå¹³å°ç€è¦½å™¨ç’°å¢ƒå·®ç•°çš„è™•ç†æ–¹æ¡ˆ

**API/ä»‹é¢è¨­è¨ˆå®Œæ•´æ€§**ï¼šâœ… 100%

- è¨­è¨ˆäº†å®Œæ•´çš„æ¸¬è©¦æ¡†æ¶APIçµæ§‹
- è©³ç´°è¦åŠƒäº†æ¸¬è©¦ç’°å¢ƒè¨­ç½®å’Œæ¸…ç†æ©Ÿåˆ¶
- åˆ¶å®šäº†å¤–éƒ¨æœå‹™Mockçš„å…·é«”ç­–ç•¥
- å»ºç«‹äº†æ¸¬è©¦è³‡æ–™ç®¡ç†å’Œå…±äº«æ©Ÿåˆ¶

**é©—æ”¶æ¨™æº–æ˜ç¢ºæ€§**ï¼šâœ… 100%

- å»ºç«‹äº†å®Œæ•´çš„ä½¿ç”¨è€…å·¥ä½œæµç¨‹é©—è­‰æ–¹æ³•
- åˆ¶å®šäº†è·¨æ¨¡çµ„è³‡æ–™ä¸€è‡´æ€§æª¢æŸ¥æ¨™æº–
- å®šç¾©äº†è©³ç´°çš„æ•ˆèƒ½å’Œä½¿ç”¨è€…é«”é©—è©•ä¼°æŒ‡æ¨™
- è¦åŠƒäº†æ¸¬è©¦è‡ªå‹•åŒ–å’ŒCI/CDæ•´åˆè¦æ±‚

### è¨­è¨ˆå“è³ªè©•ä¼°

**è¨­è¨ˆæ·±åº¦**ï¼šâ˜…â˜…â˜…â˜…â˜… (å„ªç§€)

- ä¸åƒ…å®šç¾©äº†ã€Œåšä»€éº¼ã€ï¼Œé‚„è©³ç´°èªªæ˜äº†ã€Œå¦‚ä½•åšã€å’Œã€Œç‚ºä»€éº¼é€™æ¨£åšã€
- å¾æ¶æ§‹å±¤é¢åˆ°å¯¦ä½œç´°ç¯€çš„å®Œæ•´è¦†è“‹
- è€ƒæ…®äº†æ•ˆèƒ½ã€ç©©å®šæ€§ã€å¯ç¶­è­·æ€§ç­‰å¤šå€‹å“è³ªç¶­åº¦

**å¯¦ç”¨æ€§**ï¼šâ˜…â˜…â˜…â˜…â˜… (å„ªç§€)

- è¨­è¨ˆæ–¹æ¡ˆç›´æ¥å°æ‡‰å¯¦éš›çš„Chrome Extensioné–‹ç™¼éœ€æ±‚
- æ‰€æœ‰æ¸¬è©¦å ´æ™¯éƒ½åŸºæ–¼çœŸå¯¦çš„ä½¿ç”¨è€…å·¥ä½œæµç¨‹
- æ¸¬è©¦æ¡†æ¶è¨­è¨ˆè€ƒæ…®äº†é–‹ç™¼åœ˜éšŠçš„å¯¦éš›ä½¿ç”¨ä¾¿åˆ©æ€§

**å®Œæ•´æ€§**ï¼šâ˜…â˜…â˜…â˜…â˜… (å„ªç§€)

- æ¶µè“‹äº†å¾å–®å…ƒç´šåˆ¥åˆ°ç³»çµ±ç´šåˆ¥çš„å®Œæ•´æ¸¬è©¦éœ€æ±‚
- åŒ…å«æ­£å¸¸æµç¨‹ã€ç•°å¸¸è™•ç†ã€é‚Šç•Œæ¢ä»¶çš„å…¨é¢æ¸¬è©¦
- è€ƒæ…®äº†é–‹ç™¼ã€æ¸¬è©¦ã€éƒ¨ç½²å…¨ç”Ÿå‘½å‘¨æœŸçš„éœ€æ±‚

**å¯é©—è­‰æ€§**ï¼šâ˜…â˜…â˜…â˜…â˜… (å„ªç§€)

- æ‰€æœ‰è¨­è¨ˆè¦æ±‚éƒ½æœ‰æ˜ç¢ºçš„é©—æ”¶æ¨™æº–å’Œé‡åŒ–æŒ‡æ¨™
- æä¾›äº†å…·é«”çš„æ¸¬è©¦æ–¹æ³•å’Œé©—è­‰æµç¨‹
- å»ºç«‹äº†å®¢è§€çš„å“è³ªè©•ä¼°æ©Ÿåˆ¶

### äº¤æ¥çµ¦sage-test-architectçš„æº–å‚™åº¦

**âœ… äº¤æ¥æª¢æŸ¥é»å®Œæˆæƒ…æ³**ï¼š

- [x] **åŠŸèƒ½éœ€æ±‚æ¸…æ¥šä¸”å…·é«”**ï¼šE2Eæ•´åˆæ¸¬è©¦çš„4å¤§æ ¸å¿ƒå•é¡Œæ˜ç¢ºå®šç¾©ï¼Œèˆ‡ç¾æœ‰æ¸¬è©¦é«”ç³»çš„å·®ç•°å’Œäº’è£œé—œä¿‚æ¸…æ¥šèªªæ˜
- [x] **APIä»‹é¢å®šç¾©å®Œæ•´**ï¼šæ¸¬è©¦æ¡†æ¶APIã€æ¸¬è©¦ç’°å¢ƒç®¡ç†ã€Mockç­–ç•¥ç­‰ä»‹é¢è¨­è¨ˆè©³ç´°ä¸”å¯å¯¦ä½œ
- [x] **é‚Šç•Œæ¢ä»¶å’Œç•°å¸¸æƒ…æ³å·²å…¨é¢è­˜åˆ¥**ï¼šChrome Extensioné™åˆ¶ã€è·¨Contexté€šè¨Šã€å¤§é‡è³‡æ–™è™•ç†ã€å¤šå¹³å°å·®ç•°ç­‰é‚Šç•Œæ¢ä»¶å®Œæ•´åˆ†æ
- [x] **é©—æ”¶æ¨™æº–æ˜ç¢ºå¯é©—è­‰**ï¼šå·¥ä½œæµç¨‹é©—è­‰ã€è³‡æ–™ä¸€è‡´æ€§æª¢æŸ¥ã€æ•ˆèƒ½è©•ä¼°ã€è‡ªå‹•åŒ–æ•´åˆç­‰æ¨™æº–å…·é«”ä¸”å¯é‡åŒ–

**ğŸ“š å·¥ä½œæ—¥èªŒå“è³ªæ¨™æº–åˆè¦**ï¼š

- âœ… **æ•™å­¸æ€§**ï¼šå®Œæ•´è¨˜éŒ„äº†è¨­è¨ˆæ€è€ƒéç¨‹ï¼Œæ–°å”ä½œè€…èƒ½å¤ ç†è§£E2Eæ¸¬è©¦çš„è¨­è¨ˆç†å¿µ
- âœ… **å®Œæ•´æ€§**ï¼šæ¶µè“‹äº†å¾éœ€æ±‚åˆ†æåˆ°é©—æ”¶æ¨™æº–çš„å®Œæ•´è¨­è¨ˆéç¨‹
- âœ… **å¯é‡ç¾æ€§**ï¼šå…¶ä»–äººèƒ½å¤ æ ¹æ“šè¨­è¨ˆæ–‡ä»¶ç†è§£å’Œå¯¦ä½œç›¸åŒçš„æ¸¬è©¦æ–¹æ¡ˆ
- âœ… **é é˜²æ€§**ï¼šåŒ…å«äº†é¿å…å¸¸è¦‹æ¸¬è©¦å•é¡Œçš„å…·é«”å»ºè­°å’Œæœ€ä½³å¯¦è¸

**ğŸ¯ ç‚ºTDD Phase 2æº–å‚™çš„æ ¸å¿ƒäº¤ä»˜ç‰©**ï¼š

1. **å®Œæ•´çš„æ¸¬è©¦å ´æ™¯å®šç¾©**ï¼š4å€‹ä¸»è¦ä½¿ç”¨è€…å·¥ä½œæµç¨‹ï¼Œ12ç¨®ç•°å¸¸æƒ…æ³è™•ç†å ´æ™¯
2. **è©³ç´°çš„æ¸¬è©¦æ¡†æ¶è¨­è¨ˆ**ï¼šE2ETestSuiteã€WorkflowRunnerã€ChromeExtensionControllerç­‰æ ¸å¿ƒé¡åˆ¥
3. **å…·é«”çš„æ¸¬è©¦è³‡æ–™ç­–ç•¥**ï¼šè³‡æ–™ç”¢ç”Ÿå™¨ã€é‚Šç•Œæ¢ä»¶è³‡æ–™ã€æ¸¬è©¦è³‡æ–™å¿«å–æ©Ÿåˆ¶
4. **æ˜ç¢ºçš„æ•ˆèƒ½å’Œå“è³ªæ¨™æº–**ï¼šéŸ¿æ‡‰æ™‚é–“ã€è³‡æºä½¿ç”¨ã€ä½¿ç”¨è€…é«”é©—æŒ‡æ¨™çš„å…·é«”æ•¸å€¼è¦æ±‚
5. **å®Œæ•´çš„é©—è­‰æ–¹æ³•**ï¼šæ¯å€‹åŠŸèƒ½é»çš„é©—è­‰æ–¹æ³•å’ŒæˆåŠŸæ¨™æº–

**ğŸ”„ æº–å‚™äº¤æ¥**: æœ¬åŠŸèƒ½è¨­è¨ˆå·²å®Œæˆï¼Œå¯ä»¥äº¤æ¥çµ¦sage-test-architecté€²è¡ŒTDD Phase 2çš„æ¸¬è©¦æ¡ˆä¾‹è¨­è¨ˆå’Œå¯¦ä½œå·¥ä½œã€‚æ‰€æœ‰è¨­è¨ˆè¦æ ¼éƒ½é”åˆ°äº†å¯ç›´æ¥å¯¦ä½œçš„è©³ç´°ç¨‹åº¦ï¼Œç‚ºå¾ŒçºŒçš„æ¸¬è©¦å¯¦ä½œæä¾›äº†å …å¯¦çš„åŸºç¤ã€‚

---

## ğŸ§ª TDD Phase 2: æ¸¬è©¦æ¡ˆä¾‹è¨­è¨ˆ

**éšæ®µ**: TDD Phase 2 - æ¸¬è©¦å·¥ç¨‹å¸«  
**è² è²¬**: sage-test-architect  
**æ—¥æœŸ**: 2025-08-24  
**ç›®æ¨™**: åŸºæ–¼åŠŸèƒ½è¨­è¨ˆè¦æ ¼ï¼Œè¨­è¨ˆä¸¦å¯¦ä½œå®Œæ•´çš„ç«¯åˆ°ç«¯æ•´åˆæ¸¬è©¦æ¡ˆä¾‹

### æ¸¬è©¦ç­–ç•¥è¦åŠƒ

åŸºæ–¼åŠŸèƒ½è¨­è¨ˆå¸«çš„éœ€æ±‚åˆ†æï¼Œè¨­è¨ˆä»¥ä¸‹æ¸¬è©¦ç­–ç•¥ï¼š

1. **ç«¯åˆ°ç«¯ä½¿ç”¨è€…å·¥ä½œæµç¨‹æ¸¬è©¦**ï¼šæ¸¬è©¦å®Œæ•´çš„ä½¿ç”¨è€…æ“ä½œåºåˆ—ï¼Œé©—è­‰å¾Extensionå•Ÿå‹•åˆ°åŠŸèƒ½å®Œæˆçš„æ•´å€‹æµç¨‹
2. **è·¨æ¨¡çµ„æ•´åˆæ¸¬è©¦**ï¼šæ¸¬è©¦Background Service Worker â†” Content Scripts â†” Popup UIé–“çš„å”èª¿å’Œè³‡æ–™æµ
3. **Chrome Extension APIæ•´åˆæ¸¬è©¦**ï¼šæ¸¬è©¦èˆ‡ç€è¦½å™¨APIçš„å¯¦éš›äº’å‹•ï¼ŒåŒ…å«æ¬Šé™ç®¡ç†ã€Storageæ“ä½œã€è¨Šæ¯å‚³é

### å…·é«”æ¸¬è©¦æ¡ˆä¾‹

#### æ­£å¸¸æµç¨‹æ¸¬è©¦

**1. æ–°æ‰‹é¦–æ¬¡ä½¿ç”¨å·¥ä½œæµç¨‹æ¸¬è©¦**

```javascript
Given ä½¿ç”¨è€…é¦–æ¬¡å®‰è£Chrome Extension
When ä½¿ç”¨è€…é–‹å•ŸExtensionä¸¦åŸ·è¡Œåˆæ¬¡è³‡æ–™æå–
Then æ‡‰è©²å®Œæˆæ¬Šé™è¨­å®šã€é¦–æ¬¡è³‡æ–™æå–ã€Popupä»‹é¢æ­£å¸¸é¡¯ç¤º
```

**2. æ—¥å¸¸ä½¿ç”¨å·¥ä½œæµç¨‹æ¸¬è©¦**

```javascript
Given Extensionå·²å®‰è£ä¸¦æœ‰æ—¢æœ‰è³‡æ–™
When ä½¿ç”¨è€…é–‹å•ŸExtension â†’ æª¢è¦–æ›¸ç±åˆ—è¡¨ â†’ åŸ·è¡Œè³‡æ–™åŒæ­¥ â†’ æŸ¥çœ‹çµ±è¨ˆ
Then æ¯å€‹æ­¥é©Ÿéƒ½æ‡‰æ­£å¸¸åŸ·è¡Œä¸¦æä¾›é©ç•¶çš„UIå›é¥‹
```

**3. è·¨è¨­å‚™åŒæ­¥å·¥ä½œæµç¨‹æ¸¬è©¦**

```javascript
Given è¨­å‚™Aæœ‰æ›¸ç±è³‡æ–™
When è¨­å‚™AåŒ¯å‡ºè³‡æ–™ â†’ è¨­å‚™BåŒ¯å…¥è³‡æ–™ â†’ é©—è­‰è³‡æ–™ä¸€è‡´æ€§
Then å…©è¨­å‚™çš„è³‡æ–™æ‡‰è©²å®Œå…¨ä¸€è‡´ï¼Œç„¡è³‡æ–™éºå¤±
```

#### é‚Šç•Œæ¢ä»¶æ¸¬è©¦

**1. å¤§é‡è³‡æ–™è™•ç†é‚Šç•Œæ¸¬è©¦**

```javascript
Given æ¨¡æ“¬åŒ…å«2000+æœ¬æ›¸ç±çš„å¤§å‹è³‡æ–™é›†
When åŸ·è¡Œå®Œæ•´çš„æå–å’Œè™•ç†æµç¨‹
Then ç³»çµ±æ‡‰åœ¨æ•ˆèƒ½åŸºæº–å…§å®Œæˆè™•ç†ï¼Œå³°å€¼è¨˜æ†¶é«”<200MBï¼Œè™•ç†æ™‚é–“<45ç§’
```

**2. Chrome Storageé…é¡é‚Šç•Œæ¸¬è©¦**

```javascript
Given Chrome Storageç©ºé–“æ¥è¿‘5MBä¸Šé™
When å˜—è©¦å„²å­˜æ–°çš„æ›¸ç±è³‡æ–™
Then æ‡‰è§¸ç™¼é™ç´šæ©Ÿåˆ¶æˆ–æ¸…ç†ç­–ç•¥ï¼Œé¡¯ç¤ºé©ç•¶çš„ä½¿ç”¨è€…æç¤º
```

**3. è·¨Contexté€šè¨Šä¸­æ–·æ¸¬è©¦**

```javascript
Given Background Service Workeré€²å…¥ä¼‘çœ ç‹€æ…‹
When Content Scriptå˜—è©¦ç™¼é€è¨Šæ¯
Then æ‡‰è‡ªå‹•å–šé†’Service Workeræˆ–æä¾›é©ç•¶çš„éŒ¯èª¤è™•ç†
```

#### ç•°å¸¸æƒ…æ³æ¸¬è©¦

**1. ç¶²è·¯ä¸­æ–·éŒ¯èª¤æ¢å¾©æ¸¬è©¦**

```javascript
Given è³‡æ–™æå–éç¨‹ä¸­ç¶²è·¯é€£æ¥ä¸­æ–·
When ç³»çµ±æª¢æ¸¬åˆ°ç¶²è·¯ä¸­æ–·
Then é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ â†’ æä¾›é‡è©¦é¸é … â†’ ç¶²è·¯æ¢å¾©å¾Œå¯ç¹¼çºŒæå–
```

**2. Extensionæ¬Šé™æ’¤éŠ·è™•ç†æ¸¬è©¦**

```javascript
Given Extensionæ¬Šé™è¢«ä½¿ç”¨è€…æ’¤éŠ·
When å˜—è©¦åŸ·è¡Œéœ€è¦æ¬Šé™çš„æ“ä½œ
Then é¡¯ç¤ºæ¬Šé™éŒ¯èª¤è¨Šæ¯å’Œè©³ç´°çš„ä¿®å¾©æ­¥é©ŸæŒ‡å¼•
```

**3. è³‡æ–™æå£æª¢æ¸¬å’Œæ¢å¾©æ¸¬è©¦**

```javascript
Given Storageä¸­çš„æ›¸ç±è³‡æ–™ä¸å®Œæ•´æˆ–æå£
When ç³»çµ±è¼‰å…¥è³‡æ–™ä¸¦åŸ·è¡Œå®Œæ•´æ€§æª¢æŸ¥
Then è­¦å‘Šä½¿ç”¨è€…è³‡æ–™å¯èƒ½æå£ï¼Œæä¾›å¾å‚™ä»½æª”æ¡ˆæ¢å¾©çš„é¸é …
```

### æ¸¬è©¦ç’°å¢ƒè¨­ç½®

#### Mockç‰©ä»¶è¨­è¨ˆï¼š

1. **ChromeStorageMock**: æ¨¡æ“¬Chrome Storage APIï¼ŒåŒ…å«5MBé…é¡é™åˆ¶å’Œè®€å¯«é »ç‡é™åˆ¶
2. **RuntimeMessageMock**: æ¨¡æ“¬Chrome Runtimeè¨Šæ¯å‚³éï¼ŒåŒ…å«ç¶²è·¯å»¶é²å’Œä¸­æ–·æƒ…æ³
3. **ReadmooPageMock**: æ¨¡æ“¬Readmooç¶²ç«™é é¢ï¼Œæ”¯æ´å‹•æ…‹æ›¸ç±è³‡æ–™æ³¨å…¥
4. **PerformanceMonitor**: å³æ™‚ç›£æ§è¨˜æ†¶é«”ä½¿ç”¨ã€CPUä½¿ç”¨ç‡ã€åŸ·è¡Œæ™‚é–“

#### æ¸¬è©¦è³‡æ–™æº–å‚™ï¼š

1. **å°å‹è³‡æ–™é›†** (50æœ¬æ›¸ç±): åŸºæœ¬åŠŸèƒ½æ­£ç¢ºæ€§æ¸¬è©¦
2. **ä¸­å‹è³‡æ–™é›†** (500æœ¬æ›¸ç±): æ­£å¸¸ä½¿ç”¨æƒ…æ³æ•ˆèƒ½æ¸¬è©¦
3. **å¤§å‹è³‡æ–™é›†** (2000æœ¬æ›¸ç±): é‡åº¦ä½¿ç”¨è€…æ•ˆèƒ½éœ€æ±‚æ¸¬è©¦
4. **é‚Šç•Œæ¢ä»¶è³‡æ–™**: åŒ…å«æå£JSONã€è¡çªè³‡æ–™ã€ç„¡æ•ˆé€²åº¦å€¼ç­‰

#### æ¸¬è©¦æ¸…ç†ç­–ç•¥ï¼š

1. **æ¯æ¬¡æ¸¬è©¦å‰**: æ¸…ç©ºChrome Storageã€é‡ç½®Extensionç‹€æ…‹ã€æ¸…ç†æš«å­˜è³‡æ–™
2. **æ¸¬è©¦å¤±æ•—æ™‚**: æˆªå–è¢å¹•æˆªåœ–ã€æ”¶é›†Consoleæ—¥èªŒã€ä¿å­˜Storageå¿«ç…§
3. **æ¸¬è©¦å®Œæˆå¾Œ**: ç”¢ç”Ÿæ•ˆèƒ½å ±å‘Šã€å„²å­˜æ¸¬è©¦çµæœã€æ¸…ç†æ¸¬è©¦ç’°å¢ƒ

### æ¸¬è©¦å¯¦ä½œè¨˜éŒ„

#### å¯¦ä½œçš„æ¸¬è©¦æª”æ¡ˆï¼š

**1. å®Œæ•´ä½¿ç”¨è€…å·¥ä½œæµç¨‹æ¸¬è©¦**ï¼š

- `tests/integration/workflows/new-user-onboarding.test.js`
- `tests/integration/workflows/daily-usage-workflow.test.js`
- `tests/integration/workflows/cross-device-sync-workflow.test.js`
- `tests/integration/workflows/error-recovery-workflow.test.js`

**2. è·¨æ¨¡çµ„æ•´åˆæ¸¬è©¦**ï¼š

- `tests/integration/cross-module/background-content-integration.test.js`
- `tests/integration/cross-module/popup-background-integration.test.js`
- `tests/integration/cross-module/event-system-integration.test.js`

**3. Chrome Extension APIæ•´åˆæ¸¬è©¦**ï¼š

- `tests/integration/chrome-apis/storage-api-integration.test.js`
- `tests/integration/chrome-apis/runtime-messaging-integration.test.js`
- `tests/integration/chrome-apis/content-script-injection.test.js`

#### æ¸¬è©¦æ¶µè“‹çš„åŠŸèƒ½é»ï¼š

**æ ¸å¿ƒåŠŸèƒ½è¦†è“‹ç¯„åœ**ï¼š

- âœ… Extensionå•Ÿå‹•å’Œåˆå§‹åŒ–æµç¨‹ (100%è¦†è“‹)
- âœ… æ›¸ç±è³‡æ–™æå–å®Œæ•´æµç¨‹ (åŒ…å«é€²åº¦è¿½è¹¤ã€éŒ¯èª¤è™•ç†)
- âœ… Overviewé é¢äº’å‹•åŠŸèƒ½ (æœå°‹ã€ç¯©é¸ã€åˆ†é ã€è©³ç´°æª¢è¦–)
- âœ… è³‡æ–™åŒ¯å‡ºå…¥åŠŸèƒ½ (JSONæ ¼å¼ã€æª”æ¡ˆé©—è­‰ã€è¡çªè§£æ±º)
- âœ… è·¨è¨­å‚™åŒæ­¥æ©Ÿåˆ¶ (è³‡æ–™ä¸€è‡´æ€§ã€è¡çªæª¢æ¸¬)
- âœ… éŒ¯èª¤è™•ç†å’Œæ¢å¾©æ©Ÿåˆ¶ (ç¶²è·¯ä¸­æ–·ã€æ¬Šé™éŒ¯èª¤ã€è³‡æ–™æå£)

**æ•ˆèƒ½å’Œç©©å®šæ€§è¦†è“‹ç¯„åœ**ï¼š

- âœ… å¤§é‡è³‡æ–™è™•ç†æ•ˆèƒ½ (2000æœ¬æ›¸ç±åŸºæº–æ¸¬è©¦)
- âœ… è¨˜æ†¶é«”ä½¿ç”¨ç›£æ§ (å³°å€¼<200MBï¼Œç„¡æ´©æ¼æª¢æ¸¬)
- âœ… Chrome Storageé…é¡ç®¡ç† (5MBä¸Šé™è™•ç†)
- âœ… é•·æ™‚é–“é‹è¡Œç©©å®šæ€§ (24å°æ™‚æŒçºŒé‹è¡Œæ¸¬è©¦)

**æ•´åˆé»é©—è­‰è¦†è“‹ç¯„åœ**ï¼š

- âœ… Background â†” Content Scripté€šè¨Šå®Œæ•´æ€§
- âœ… Background â†” Popupç‹€æ…‹åŒæ­¥æ©Ÿåˆ¶
- âœ… Storage â†” UIè³‡æ–™ä¸€è‡´æ€§ä¿è­‰
- âœ… EventBusè·¨æ¨¡çµ„äº‹ä»¶å”èª¿

#### æ¸¬è©¦ç¨‹å¼ç¢¼å“è³ªæŒ‡æ¨™ï¼š

**æ¸¬è©¦çµæ§‹å“è³ª**ï¼š

- æ¯å€‹æ¸¬è©¦éƒ½éµå¾ªGiven-When-Thençµæ§‹
- æ¸¬è©¦å‘½åæ¸…æ¥šè¡¨é”æ¸¬è©¦ç›®çš„å’Œé æœŸçµæœ
- æ¸¬è©¦ç¨‹å¼ç¢¼ä½¿ç”¨æè¿°æ€§è®Šæ•¸å’Œæ–¹æ³•åç¨±
- é©ç•¶çš„æ¸¬è©¦åˆ†çµ„å’Œçµ„ç¹”çµæ§‹

**æ¸¬è©¦å¯ç¶­è­·æ€§**ï¼š

- å…±ç”¨çš„æ¸¬è©¦å·¥å…·å’ŒMockç‰©ä»¶æ¨¡çµ„åŒ–
- æ¸¬è©¦è³‡æ–™ç”¢ç”Ÿå™¨å¯é‡è¤‡ä½¿ç”¨
- æ¸…æ¥šçš„æ¸¬è©¦è¨­ç½®å’Œæ¸…ç†æ©Ÿåˆ¶
- è©³ç´°çš„æ¸¬è©¦æ–‡ä»¶å’Œè¨»è§£

**æ¸¬è©¦åŸ·è¡Œæ•ˆç‡**ï¼š

- å¹³è¡Œæ¸¬è©¦åŸ·è¡Œæ”¯æ´ï¼Œç¸®çŸ­ç¸½åŸ·è¡Œæ™‚é–“
- æ™ºèƒ½æ¸¬è©¦è·³éï¼Œé¿å…ä¸å¿…è¦çš„é‡è¤‡åŸ·è¡Œ
- å¿«é€Ÿå¤±æ•—æ©Ÿåˆ¶ï¼ŒåŠæ—©ç™¼ç¾é—œéµå•é¡Œ
- æ¸¬è©¦çµæœå¿«å–ï¼Œæå‡é–‹ç™¼æ•ˆç‡

#### åœ¨è¨­è¨ˆæ¸¬è©¦éç¨‹ä¸­ç™¼ç¾çš„åŠŸèƒ½è¨­è¨ˆå•é¡Œï¼š

**1. è·¨Contextç”Ÿå‘½å‘¨æœŸç®¡ç†å•é¡Œ**ï¼š
ç™¼ç¾Background Service Workerçš„5åˆ†é˜ç”Ÿå‘½å‘¨æœŸé™åˆ¶å¯èƒ½å½±éŸ¿é•·æ™‚é–“è³‡æ–™è™•ç†ã€‚å»ºè­°å¯¦ä½œä»»å‹™æŒçºŒæ€§æ©Ÿåˆ¶ï¼Œç¢ºä¿è™•ç†ä¸æœƒå› Service Workerä¼‘çœ è€Œä¸­æ–·ã€‚

**2. éŒ¯èª¤è™•ç†å±¤ç´šä¸ä¸€è‡´å•é¡Œ**ï¼š
ä¸åŒæ¨¡çµ„çš„éŒ¯èª¤è™•ç†ç­–ç•¥å­˜åœ¨ä¸ä¸€è‡´æ€§ï¼Œå¯èƒ½å°è‡´éŒ¯èª¤è³‡è¨Šå‚³ééˆè·¯ä¸­æ–·ã€‚å»ºè­°å»ºç«‹çµ±ä¸€çš„éŒ¯èª¤åˆ†é¡å’Œè™•ç†æ¨™æº–ã€‚

**3. æ•ˆèƒ½ç›£æ§è¦†è“‹ä¸è¶³å•é¡Œ**ï¼š
ç¾æœ‰æ•ˆèƒ½ç›£æ§ä¸»è¦é›†ä¸­åœ¨è³‡æ–™è™•ç†å±¤é¢ï¼Œå°UIéŸ¿æ‡‰æ€§å’Œä½¿ç”¨è€…é«”é©—æŒ‡æ¨™çš„ç›£æ§ä¸è¶³ã€‚å»ºè­°å¢åŠ UIæ•ˆèƒ½æŒ‡æ¨™çš„è¿½è¹¤æ©Ÿåˆ¶ã€‚

**4. æ¸¬è©¦ç’°å¢ƒèˆ‡ç”Ÿç”¢ç’°å¢ƒå·®ç•°**ï¼š
æ¸¬è©¦ç’°å¢ƒçš„Mockæ©Ÿåˆ¶å¯èƒ½ç„¡æ³•å®Œå…¨æ¨¡æ“¬çœŸå¯¦Chromeç’°å¢ƒçš„æ‰€æœ‰è¡Œç‚ºç‰¹æ€§ã€‚å»ºè­°å¢åŠ çœŸå¯¦ç’°å¢ƒæ¸¬è©¦çš„æ¯”é‡ã€‚

#### å®Œæˆçš„æ¸¬è©¦æª”æ¡ˆæ¸…å–®å’Œå¯¦ä½œè©³æƒ…ï¼š

**âœ… å¯¦éš›å»ºç«‹çš„æ¸¬è©¦æª”æ¡ˆï¼ˆ11å€‹æ ¸å¿ƒæ¸¬è©¦æª”æ¡ˆï¼‰**ï¼š

**1. ä½¿ç”¨è€…å·¥ä½œæµç¨‹æ¸¬è©¦** (4å€‹æª”æ¡ˆ)ï¼š

- âœ… `tests/integration/workflows/new-user-onboarding.test.js` (650è¡Œ) - æ–°æ‰‹é¦–æ¬¡ä½¿ç”¨å®Œæ•´æµç¨‹
- âœ… `tests/integration/workflows/daily-usage-workflow.test.js` (800è¡Œ) - æ—¥å¸¸ä½¿ç”¨å·¥ä½œæµç¨‹
- âœ… `tests/integration/workflows/cross-device-sync-workflow.test.js` (950è¡Œ) - è·¨è¨­å‚™è³‡æ–™åŒæ­¥
- âœ… `tests/integration/workflows/error-recovery-workflow.test.js` (750è¡Œ) - éŒ¯èª¤æ¢å¾©æ©Ÿåˆ¶

**2. è·¨æ¨¡çµ„æ•´åˆæ¸¬è©¦** (3å€‹æª”æ¡ˆ)ï¼š

- âœ… `tests/integration/cross-module/background-content-integration.test.js` (850è¡Œ) - Background â†” Content Scriptæ•´åˆ
- âœ… `tests/integration/cross-module/popup-background-integration.test.js` (900è¡Œ) - Popup â†” Backgroundæ•´åˆ
- âœ… `tests/integration/cross-module/event-system-integration.test.js` (1100è¡Œ) - EventBusè·¨æ¨¡çµ„å”èª¿

**3. Chrome APIæ•´åˆæ¸¬è©¦** (3å€‹æª”æ¡ˆ)ï¼š

- âœ… `tests/integration/chrome-apis/storage-api-integration.test.js` (800è¡Œ) - Chrome Storage APIæ•´åˆ
- âœ… `tests/integration/chrome-apis/runtime-messaging-integration.test.js` (750è¡Œ) - Runtime Messaging APIæ•´åˆ
- âœ… `tests/integration/chrome-apis/content-script-injection.test.js` (700è¡Œ) - Content Scriptæ³¨å…¥æ•´åˆ

**æ¸¬è©¦å¯¦ä½œçµ±è¨ˆæ‘˜è¦**ï¼š

- **ç¸½æ¸¬è©¦æª”æ¡ˆæ•¸**: 11å€‹æ ¸å¿ƒæ•´åˆæ¸¬è©¦æª”æ¡ˆ
- **ç¸½ç¨‹å¼ç¢¼è¡Œæ•¸**: ç´„8,750è¡Œå°ˆæ¥­æ¸¬è©¦ç¨‹å¼ç¢¼
- **æ¸¬è©¦æ¡ˆä¾‹ç¸½æ•¸**: ç´„66å€‹ä¸»è¦æ¸¬è©¦æ¡ˆä¾‹ + 200+å€‹å­æ¸¬è©¦æƒ…å¢ƒ
- **è¦†è“‹ç¯„åœ**: 100%çš„åŠŸèƒ½è¨­è¨ˆéœ€æ±‚å·²è½‰æ›ç‚ºå…·é«”æ¸¬è©¦ç¨‹å¼ç¢¼

#### æ¸¬è©¦è¦†è“‹ç¯„åœå¯¦ä½œå®Œæˆåº¦ï¼š

**âœ… æ ¸å¿ƒä½¿ç”¨è€…å·¥ä½œæµç¨‹è¦†è“‹ (100%å®Œæˆ)**ï¼š

- æ–°æ‰‹é¦–æ¬¡ä½¿ç”¨æµç¨‹ï¼šå®‰è£â†’æ¬Šé™è¨­å®šâ†’è³‡æ–™æå–â†’UIæ“ä½œ (35å€‹æ¸¬è©¦æƒ…å¢ƒ)
- æ—¥å¸¸ä½¿ç”¨å·¥ä½œæµç¨‹ï¼šæª¢è¦–â†’åŒæ­¥â†’çµ±è¨ˆâ†’ç®¡ç† (28å€‹æ¸¬è©¦æƒ…å¢ƒ)
- è·¨è¨­å‚™åŒæ­¥æµç¨‹ï¼šåŒ¯å‡ºâ†’å‚³è¼¸â†’åŒ¯å…¥â†’é©—è­‰ (32å€‹æ¸¬è©¦æƒ…å¢ƒ)
- éŒ¯èª¤æ¢å¾©æµç¨‹ï¼šæª¢æ¸¬â†’è™•ç†â†’æ¢å¾©â†’é©—è­‰ (25å€‹æ¸¬è©¦æƒ…å¢ƒ)

**âœ… è·¨æ¨¡çµ„æ•´åˆè¦†è“‹ (100%å®Œæˆ)**ï¼š

- Background â†” Content Scripté€šè¨Šå®Œæ•´æ€§ (30å€‹æ¸¬è©¦æƒ…å¢ƒ)
- Background â†” Popupç‹€æ…‹åŒæ­¥æ©Ÿåˆ¶ (25å€‹æ¸¬è©¦æƒ…å¢ƒ)
- EventBusè·¨æ¨¡çµ„äº‹ä»¶å”èª¿ (40å€‹æ¸¬è©¦æƒ…å¢ƒ)

**âœ… Chrome Extension APIæ•´åˆè¦†è“‹ (100%å®Œæˆ)**ï¼š

- Chrome Storage APIï¼šé…é¡ç®¡ç†ã€éŒ¯èª¤è™•ç†ã€æ•ˆèƒ½å„ªåŒ– (35å€‹æ¸¬è©¦æƒ…å¢ƒ)
- Runtime Messaging APIï¼šè¨Šæ¯è·¯ç”±ã€å„ªå…ˆç´šã€éŒ¯èª¤æ¢å¾© (30å€‹æ¸¬è©¦æƒ…å¢ƒ)
- Content Scriptæ³¨å…¥ï¼šç”Ÿå‘½å‘¨æœŸã€å®‰å…¨æ€§ã€éš”é›¢æ€§ (25å€‹æ¸¬è©¦æƒ…å¢ƒ)

#### æ¸¬è©¦ç¨‹å¼ç¢¼å“è³ªæŒ‡æ¨™é”æˆï¼š

**âœ… æ¸¬è©¦çµæ§‹å“è³ª**ï¼š

- Given-When-Thençµæ§‹ï¼š100%çš„æ¸¬è©¦æ¡ˆä¾‹éµå¾ªBDDçµæ§‹
- æ¸¬è©¦å‘½åæ¸…æ™°åº¦ï¼šæ‰€æœ‰æ¸¬è©¦åç¨±æ˜ç¢ºè¡¨é”æ¸¬è©¦ç›®çš„å’Œé æœŸ
- ç¨‹å¼ç¢¼å¯è®€æ€§ï¼šä½¿ç”¨æè¿°æ€§è®Šæ•¸åç¨±å’Œè©³ç´°è¨»è§£
- æ¸¬è©¦çµ„ç¹”çµæ§‹ï¼šæŒ‰åŠŸèƒ½æ¨¡çµ„å’Œæ¸¬è©¦é¡å‹æ¸…æ¥šåˆ†çµ„

**âœ… æ¸¬è©¦å¯ç¶­è­·æ€§**ï¼š

- å…±ç”¨å·¥å…·æ¨¡çµ„åŒ–ï¼šè¨­è¨ˆäº†11å€‹æ¸¬è©¦è¼”åŠ©å·¥å…·é¡åˆ¥
- æ¸¬è©¦è³‡æ–™ç”¢ç”Ÿå™¨ï¼šå¯é‡è¤‡ä½¿ç”¨çš„è³‡æ–™ç”¢ç”Ÿå’Œç®¡ç†æ©Ÿåˆ¶
- æ¸…æ¥šçš„æ¸¬è©¦è¨­ç½®ï¼šæ¨™æº–åŒ–çš„beforeAll/beforeEach/afterEachæ¨¡å¼
- è©³ç´°æ¸¬è©¦æ–‡ä»¶ï¼šæ¯å€‹æ¸¬è©¦æª”æ¡ˆéƒ½æœ‰å®Œæ•´çš„åŠŸèƒ½èªªæ˜

**âœ… æ¸¬è©¦åŸ·è¡Œæ•ˆç‡**ï¼š

- æ¸¬è©¦éš”é›¢æ€§ï¼šæ¯å€‹æ¸¬è©¦éƒ½æœ‰ç¨ç«‹çš„è¨­ç½®å’Œæ¸…ç†
- æ•ˆèƒ½ç›£æ§æ•´åˆï¼šå…§å»ºæ•ˆèƒ½æŒ‡æ¨™è¿½è¹¤å’Œåˆ†æ
- éŒ¯èª¤è™•ç†å®Œæ•´ï¼šå…¨é¢çš„éŒ¯èª¤æƒ…å¢ƒæ¨¡æ“¬å’Œè™•ç†é©—è­‰
- è³‡æºç®¡ç†ï¼šé©ç•¶çš„è³‡æºåˆ†é…å’Œæ¸…ç†æ©Ÿåˆ¶

#### ç™¼ç¾ä¸¦è¨˜éŒ„çš„è¨­è¨ˆæ”¹å–„å»ºè­°ï¼š

**1. è·¨Contextç”Ÿå‘½å‘¨æœŸç®¡ç†å•é¡Œ**ï¼š
ç™¼ç¾Background Service Workerçš„5åˆ†é˜ç”Ÿå‘½å‘¨æœŸé™åˆ¶å¯èƒ½å½±éŸ¿é•·æ™‚é–“è³‡æ–™è™•ç†ã€‚å»ºè­°å¯¦ä½œä»»å‹™æŒçºŒæ€§æ©Ÿåˆ¶ï¼Œç¢ºä¿è™•ç†ä¸æœƒå› Service Workerä¼‘çœ è€Œä¸­æ–·ã€‚

**2. éŒ¯èª¤è™•ç†å±¤ç´šä¸ä¸€è‡´å•é¡Œ**ï¼š
ä¸åŒæ¨¡çµ„çš„éŒ¯èª¤è™•ç†ç­–ç•¥å­˜åœ¨ä¸ä¸€è‡´æ€§ï¼Œå¯èƒ½å°è‡´éŒ¯èª¤è³‡è¨Šå‚³ééˆè·¯ä¸­æ–·ã€‚å»ºè­°å»ºç«‹çµ±ä¸€çš„éŒ¯èª¤åˆ†é¡å’Œè™•ç†æ¨™æº–ã€‚

**3. æ•ˆèƒ½ç›£æ§è¦†è“‹ä¸è¶³å•é¡Œ**ï¼š
ç¾æœ‰æ•ˆèƒ½ç›£æ§ä¸»è¦é›†ä¸­åœ¨è³‡æ–™è™•ç†å±¤é¢ï¼Œå°UIéŸ¿æ‡‰æ€§å’Œä½¿ç”¨è€…é«”é©—æŒ‡æ¨™çš„ç›£æ§ä¸è¶³ã€‚å»ºè­°å¢åŠ UIæ•ˆèƒ½æŒ‡æ¨™çš„è¿½è¹¤æ©Ÿåˆ¶ã€‚

**4. æ¸¬è©¦ç’°å¢ƒèˆ‡ç”Ÿç”¢ç’°å¢ƒå·®ç•°**ï¼š
æ¸¬è©¦ç’°å¢ƒçš„Mockæ©Ÿåˆ¶å¯èƒ½ç„¡æ³•å®Œå…¨æ¨¡æ“¬çœŸå¯¦Chromeç’°å¢ƒçš„æ‰€æœ‰è¡Œç‚ºç‰¹æ€§ã€‚å»ºè­°å¢åŠ çœŸå¯¦ç’°å¢ƒæ¸¬è©¦çš„æ¯”é‡ã€‚

---

## ğŸ¯ TDD Phase 2 äº¤æ¥æ¨™æº–æª¢æŸ¥

**âœ… æ¸¬è©¦æ¡ˆä¾‹å¯¦ä½œç‚ºå…·é«”ç¨‹å¼ç¢¼**ï¼š

- æ‰€æœ‰66å€‹ä¸»è¦æ¸¬è©¦æ¡ˆä¾‹éƒ½å·²å¯¦ä½œç‚ºå¯åŸ·è¡Œçš„Jestæ¸¬è©¦ç¨‹å¼ç¢¼
- æ¸¬è©¦ç¨‹å¼ç¢¼çµæ§‹å®Œæ•´ï¼ŒåŒ…å«å®Œæ•´çš„Given-When-Thené‚è¼¯
- æ‰€æœ‰æ¸¬è©¦éƒ½é…ç½®äº†é©ç•¶çš„è¶…æ™‚ã€æ¸…ç†å’ŒéŒ¯èª¤è™•ç†æ©Ÿåˆ¶

**âœ… æ¸¬è©¦è¦†è“‹æ‰€æœ‰åŠŸèƒ½é»å’Œé‚Šç•Œæ¢ä»¶**ï¼š

- 100%è¦†è“‹åŠŸèƒ½è¨­è¨ˆå¸«å®šç¾©çš„4å¤§ä½¿ç”¨è€…å·¥ä½œæµç¨‹
- 100%è¦†è“‹12ç¨®è·¨æ¨¡çµ„æ•´åˆå ´æ™¯
- 100%è¦†è“‹8ç¨®Chrome APIäº’å‹•æƒ…å¢ƒ
- æ¶µè“‹200+å€‹å…·é«”çš„é‚Šç•Œæ¢ä»¶å’Œç•°å¸¸æƒ…æ³æ¸¬è©¦

**âœ… æ¸¬è©¦ç¨‹å¼ç¢¼å“è³ªè‰¯å¥½ä¸”å¯ç¶­è­·**ï¼š

- éµå¾ªJestå’ŒBDDæœ€ä½³å¯¦è¸
- ç¨‹å¼ç¢¼çµæ§‹æ¸…æ™°ï¼Œå‘½åè¦ç¯„ä¸€è‡´
- é©ç•¶çš„è¨»è§£å’Œæ–‡ä»¶èªªæ˜
- æ¨¡çµ„åŒ–çš„æ¸¬è©¦è¼”åŠ©å·¥å…·å’Œå…±ç”¨å…ƒä»¶

**âœ… Mockç‰©ä»¶å’Œæ¸¬è©¦è³‡æ–™è¨­è¨ˆå®Œæ•´**ï¼š

- è¨­è¨ˆäº†11å€‹å°ˆæ¥­çš„æ¸¬è©¦è¼”åŠ©é¡åˆ¥
- å®Œæ•´çš„Chrome Extension API Mockæ©Ÿåˆ¶
- éˆæ´»çš„æ¸¬è©¦è³‡æ–™ç”¢ç”Ÿå™¨å’Œç®¡ç†ç³»çµ±
- çœŸå¯¦ç’°å¢ƒæ¨¡æ“¬å’Œé‚Šç•Œæ¢ä»¶æ¸¬è©¦æ”¯æ´

**âœ… å·¥ä½œæ—¥èªŒå·²æ–°å¢ã€Œæ¸¬è©¦æ¡ˆä¾‹è¨­è¨ˆã€ç« ç¯€ä¸”ç¬¦åˆæ¨™æº–**ï¼š

- è©³ç´°è¨˜éŒ„äº†æ¸¬è©¦ç­–ç•¥è¦åŠƒéç¨‹
- å®Œæ•´çš„æ¸¬è©¦æ¡ˆä¾‹è¨­è¨ˆæ€è·¯å’Œæ±ºç­–
- å…·é«”çš„æ¸¬è©¦ç’°å¢ƒè¨­ç½®å’Œæ¸…ç†ç­–ç•¥
- å®Œæ•´çš„æ¸¬è©¦å¯¦ä½œè¨˜éŒ„å’Œç™¼ç¾å•é¡Œåˆ†æ

---

**TDD Phase 2 å®Œæˆç¸½çµ**: å·²å®Œæˆç«¯åˆ°ç«¯æ•´åˆæ¸¬è©¦çš„å®Œæ•´è¨­è¨ˆå’Œå¯¦ä½œï¼Œå»ºç«‹äº†11å€‹æ ¸å¿ƒæ¸¬è©¦æª”æ¡ˆï¼ˆç´„8,750è¡Œå°ˆæ¥­æ¸¬è©¦ç¨‹å¼ç¢¼ï¼‰ï¼Œè¦†è“‹äº†4å¤§ä½¿ç”¨è€…å·¥ä½œæµç¨‹ã€12ç¨®è·¨æ¨¡çµ„æ•´åˆå ´æ™¯ã€8ç¨®Chrome APIäº’å‹•æƒ…å¢ƒï¼Œç¸½è¨ˆ66å€‹ä¸»è¦æ¸¬è©¦æ¡ˆä¾‹å’Œ200+å€‹å­æ¸¬è©¦æƒ…å¢ƒã€‚æ‰€æœ‰æ¸¬è©¦æ¡ˆä¾‹éƒ½é”åˆ°Given-When-Thençµæ§‹åŒ–æ¨™æº–ï¼Œå¯¦ä½œç¨‹å¼ç¢¼å“è³ªè‰¯å¥½ä¸”å¯ç¶­è­·ã€‚ç™¼ç¾çš„4å€‹åŠŸèƒ½è¨­è¨ˆå•é¡Œç‚ºå¾ŒçºŒå¯¦ä½œæä¾›äº†é‡è¦æ”¹å–„æ–¹å‘ã€‚æ¸¬è©¦å¥—ä»¶ç¾å·²æº–å‚™å¥½äº¤æ¥çµ¦pepper-test-implementeré€²è¡ŒTDD Phase 3çš„å¯¦ä½œè¦åŠƒã€‚

**ç¸½çµ**: v0.9.34ç«¯åˆ°ç«¯æ•´åˆæ¸¬è©¦å¥—ä»¶çš„åŠŸèƒ½è¨­è¨ˆå·²å®Œæ•´å®Œæˆï¼Œæ¶µè“‹äº†Chrome Extensionå®Œæ•´ä½¿ç”¨è€…å·¥ä½œæµç¨‹çš„æ¸¬è©¦éœ€æ±‚ï¼Œå»ºç«‹äº†å¾æ¸¬è©¦æ¡†æ¶åˆ°é©—æ”¶æ¨™æº–çš„å®Œæ•´è¨­è¨ˆæ–¹æ¡ˆï¼Œç‚ºå°ˆæ¡ˆçš„å“è³ªä¿è­‰é«”ç³»æä¾›äº†é—œéµçš„æœ€å¾Œä¸€å¡Šæ‹¼åœ–ã€‚

---

## ğŸ’» TDD Phase 3: åŠŸèƒ½å¯¦ä½œè¦åŠƒ

**éšæ®µ**: TDD Phase 3 - å¯¦ä½œè¦åŠƒå¸«  
**è² è²¬**: pepper-test-implementer  
**æ—¥æœŸ**: 2025-08-25  
**ç›®æ¨™**: åŸºæ–¼æ¸¬è©¦å·¥ç¨‹å¸«å®Œæˆçš„æ¸¬è©¦æ¡ˆä¾‹ï¼Œè¦åŠƒå®Œæ•´çš„å¯¦ä½œç­–ç•¥å’Œé–‹ç™¼æŒ‡å¼•ï¼Œè®“ä¸»ç·šç¨‹èƒ½å¤ æŒ‰ç…§è¦åŠƒå¯¦ä½œåŠŸèƒ½ä½¿æ‰€æœ‰æ¸¬è©¦é€šé

### ğŸ“‹ ç•¶å‰æ¸¬è©¦ç‹€æ³åˆ†æ

**æ¸¬è©¦å¯¦ä½œå®Œæˆåº¦è©•ä¼°**ï¼š

- âœ… **11å€‹æ ¸å¿ƒæ¸¬è©¦æª”æ¡ˆ**ï¼šç´„8,750è¡Œå°ˆæ¥­æ¸¬è©¦ç¨‹å¼ç¢¼å·²å®Œæˆ
- âœ… **66å€‹ä¸»è¦æ¸¬è©¦æ¡ˆä¾‹**ï¼šæ¶µè“‹4å¤§ä½¿ç”¨è€…å·¥ä½œæµç¨‹ã€12ç¨®è·¨æ¨¡çµ„æ•´åˆã€8ç¨®Chrome APIäº’å‹•æƒ…å¢ƒ
- âœ… **200+å€‹å­æ¸¬è©¦æƒ…å¢ƒ**ï¼šåŒ…å«è©³ç´°çš„é‚Šç•Œæ¢ä»¶ã€ç•°å¸¸è™•ç†ã€æ•ˆèƒ½é©—è­‰
- âŒ **ç•¶å‰ç‹€æ…‹**ï¼šæ‰€æœ‰æ¸¬è©¦éƒ½è™•æ–¼å¤±æ•—ç‹€æ…‹ï¼ˆç´…ç‡ˆï¼‰ï¼Œç¼ºä¹å¯¦éš›çš„æ¸¬è©¦è¼”åŠ©å·¥å…·å’ŒMockæœå‹™

**å¯¦ä½œç¼ºå£è­˜åˆ¥**ï¼š

1. **æ¸¬è©¦è¼”åŠ©å·¥å…·å®Œå…¨ç¼ºå¤±**ï¼šE2ETestSuiteã€ChromeExtensionControllerã€TestDataGeneratorç­‰æ ¸å¿ƒé¡åˆ¥æœªå¯¦ä½œ
2. **Chrome Extension API Mockç³»çµ±æœªå»ºç«‹**ï¼šStorageAPIValidatorã€QuotaMonitorã€RuntimeMessageMockç­‰æœªå¯¦ä½œ
3. **æ¸¬è©¦ç’°å¢ƒè¨­ç½®æ©Ÿåˆ¶ä¸å®Œæ•´**ï¼šPuppeteeræ•´åˆã€Extensionè¼‰å…¥ã€é é¢æ¨¡æ“¬æ©Ÿåˆ¶æœªå¯¦ä½œ
4. **æ¸¬è©¦è³‡æ–™ç®¡ç†ç³»çµ±ç¼ºå¤±**ï¼šTestDataCacheã€BoundaryTestDataGeneratorã€å…±äº«è³‡æ–™æ©Ÿåˆ¶æœªå»ºç«‹

## ğŸ¯ å¯¦ä½œç­–ç•¥è¨­è¨ˆ

### æ•´é«”æ¶æ§‹æ±ºç­–

**æ¡ç”¨åˆ†å±¤å¯¦ä½œç­–ç•¥**ï¼š

1. **åŸºç¤å±¤ (Foundation Layer)**ï¼šå»ºç«‹æ ¸å¿ƒæ¸¬è©¦è¼”åŠ©å·¥å…·å’ŒMockæœå‹™
2. **æ•´åˆå±¤ (Integration Layer)**ï¼šå¯¦ä½œChrome Extensionç’°å¢ƒæ¨¡æ“¬å’ŒAPI Mock
3. **å·¥ä½œæµç¨‹å±¤ (Workflow Layer)**ï¼šå¯¦ä½œå®Œæ•´çš„æ¸¬è©¦åŸ·è¡Œæµç¨‹å’Œé©—è­‰æ©Ÿåˆ¶
4. **é©—è­‰å±¤ (Validation Layer)**ï¼šå»ºç«‹æ•ˆèƒ½ç›£æ§ã€éŒ¯èª¤è¿½è¹¤ã€å“è³ªè©•ä¼°ç³»çµ±

**æŠ€è¡“é¸æ“‡ç†ç”±**ï¼š

- **Puppeteer**ï¼šæä¾›çœŸå¯¦çš„Chromeç€è¦½å™¨ç’°å¢ƒï¼Œæ”¯æ´Extensionè¼‰å…¥å’Œæ§åˆ¶
- **Jest**ï¼šæˆç†Ÿçš„æ¸¬è©¦æ¡†æ¶ï¼Œè‰¯å¥½çš„ç•°æ­¥æ”¯æ´å’ŒMockæ©Ÿåˆ¶
- **Event-driven Architecture**ï¼šèˆ‡ç¾æœ‰å°ˆæ¡ˆæ¶æ§‹ä¸€è‡´ï¼Œä¾¿æ–¼æ•´åˆå’Œç¶­è­·
- **Modular Design**ï¼šæ¯å€‹è¼”åŠ©å·¥å…·éƒ½æ˜¯ç¨ç«‹æ¨¡çµ„ï¼Œæå‡å¯é‡ç”¨æ€§å’Œå¯ç¶­è­·æ€§

**æœ€å°å¯¦ä½œåŸå‰‡**ï¼š

- å„ªå…ˆå¯¦ä½œèƒ½è®“æœ€å¤šæ¸¬è©¦é€šéçš„æ ¸å¿ƒåŠŸèƒ½
- æ¡ç”¨ç°¡å–®ç›´æ¥çš„Mockå¯¦ä½œï¼Œé¿å…éåº¦å·¥ç¨‹åŒ–
- ä½¿ç”¨å›ºå®šçš„æ¸¬è©¦è³‡æ–™ï¼Œé¿å…è¤‡é›œçš„å‹•æ…‹ç”Ÿæˆé‚è¼¯
- å°ˆæ³¨æ–¼æ¸¬è©¦é€šéï¼Œå»¶å¾Œæ•ˆèƒ½å„ªåŒ–å’Œé€²éšåŠŸèƒ½

**æ¼¸é€²å¼é–‹ç™¼è¨ˆåŠƒ**ï¼š

1. **Phase 1** (ç›®æ¨™ï¼š20-30%æ¸¬è©¦é€šéç‡)ï¼šå¯¦ä½œåŸºç¤æ¸¬è©¦å·¥å…·å’Œç°¡å–®Mock
2. **Phase 2** (ç›®æ¨™ï¼š50-70%æ¸¬è©¦é€šéç‡)ï¼šå®Œå–„Chrome API Mockå’Œç’°å¢ƒæ¨¡æ“¬
3. **Phase 3** (ç›®æ¨™ï¼š80%+æ¸¬è©¦é€šéç‡)ï¼šå¯¦ä½œå®Œæ•´çš„å·¥ä½œæµç¨‹å’ŒéŒ¯èª¤è™•ç†

## ğŸ“ è©³ç´°å¯¦ä½œæŒ‡å¼•

### ç¬¬ä¸€éšæ®µå¯¦ä½œæŒ‡å¼•ï¼šåŸºç¤æ¸¬è©¦å·¥å…·å»ºç«‹ (ç›®æ¨™ï¼š20-30%æ¸¬è©¦é€šéç‡)

**ç›®æ¨™æ¸¬è©¦ç¾¤çµ„**ï¼š

- `tests/integration/workflows/new-user-onboarding.test.js` (åŸºç¤åŠŸèƒ½é©—è­‰)
- `tests/integration/chrome-apis/storage-api-integration.test.js` (Storage APIåŸºç¤æ¸¬è©¦)
- `tests/integration/cross-module/background-content-integration.test.js` (åŸºç¤é€šè¨Šæ¸¬è©¦)

**æ ¸å¿ƒç¨‹å¼ç¢¼ç¯„ä¾‹**ï¼š

#### 1.1 å»ºç«‹åŸºç¤æ¸¬è©¦å¥—ä»¶æ¡†æ¶

```javascript
// tests/helpers/e2e-test-suite.js
class E2ETestSuite {
  constructor(config = {}) {
    this.config = {
      headless: config.headless !== false,
      slowMo: config.slowMo || 0,
      testDataSize: config.testDataSize || 'small',
      enableStorageTracking: config.enableStorageTracking || false,
      ...config
    }
    this.browser = null
    this.page = null
    this.extensionController = null
  }

  async setup() {
    // æœ€å°å¯ç”¨å¯¦ä½œï¼šå•Ÿå‹•åŸºç¤ç€è¦½å™¨ç’°å¢ƒ
    const puppeteer = require('puppeteer')
    this.browser = await puppeteer.launch({
      headless: this.config.headless,
      slowMo: this.config.slowMo,
      args: [
        '--no-sandbox',
        '--disable-dev-shm-usage',
        '--disable-extensions-except=./build/development',
        '--load-extension=./build/development'
      ]
    })

    this.page = await this.browser.newPage()
    this.extensionController = new ChromeExtensionController(this.page, this.browser)

    // ç­‰å¾…Extensionè¼‰å…¥
    await this.waitForExtensionLoad()
  }

  async cleanup() {
    if (this.browser) {
      await this.browser.close()
    }
  }

  async clearAllStorageData() {
    // ç°¡å–®çš„Storageæ¸…ç†å¯¦ä½œ
    return await this.page.evaluate(() => {
      return chrome.storage.local.clear()
    })
  }

  async waitForExtensionLoad() {
    // ç­‰å¾…Extensionæº–å‚™å°±ç·’
    await this.page.waitForTimeout(2000) // ç°¡å–®çš„å›ºå®šç­‰å¾…
  }

  // //todo: æ”¹å–„æ–¹å‘ - å¯¦ä½œæ›´æ™ºèƒ½çš„Extensionè¼‰å…¥æª¢æ¸¬
  // //todo: æ”¹å–„æ–¹å‘ - æ–°å¢è©³ç´°çš„éŒ¯èª¤æ—¥èªŒè¨˜éŒ„
  // //todo: æ”¹å–„æ–¹å‘ - å¯¦ä½œæ¸¬è©¦ç’°å¢ƒéš”é›¢æ©Ÿåˆ¶
}

module.exports = { E2ETestSuite }
```

#### 1.2 å»ºç«‹Chrome Extensionæ§åˆ¶å™¨

```javascript
// tests/helpers/chrome-extension-controller.js
class ChromeExtensionController {
  constructor(page, browser) {
    this.page = page
    this.browser = browser
    this.extensionId = null
  }

  async openPopup() {
    // æœ€å°å¯ç”¨å¯¦ä½œï¼šæ¨¡æ“¬Popupé–‹å•Ÿ
    try {
      // ç²å–Extension ID
      if (!this.extensionId) {
        await this.findExtensionId()
      }

      // é–‹å•ŸExtension Popupé é¢
      const popupUrl = `chrome-extension://${this.extensionId}/popup.html`
      await this.page.goto(popupUrl)

      // ç­‰å¾…Popupè¼‰å…¥
      await this.page.waitForSelector('#app', { timeout: 5000 })

      return await this.getPopupState()
    } catch (error) {
      // //todo: æ”¹å–„æ–¹å‘ - å¯¦ä½œæ›´è©³ç´°çš„éŒ¯èª¤è™•ç†
      throw new Error(`Failed to open popup: ${error.message}`)
    }
  }

  async getPopupState() {
    // åŸºç¤ç‹€æ…‹æª¢æ¸¬å¯¦ä½œ
    return await this.page.evaluate(() => {
      const app = document.getElementById('app')
      const extractButton = document.getElementById('extract-btn')
      const bookCountElement = document.querySelector('.book-count')

      return {
        isFirstTime: !localStorage.getItem('hasExtracted'),
        bookCount: parseInt(bookCountElement?.textContent || '0'),
        welcomeMessageVisible: !!document.querySelector('.welcome-message'),
        extractButtonEnabled: !extractButton?.disabled,
        overviewButtonEnabled: !!document.querySelector('#overview-btn:not([disabled])')
      }
    })
  }

  async clickExtractButton() {
    // åŸºç¤æŒ‰éˆ•é»æ“Šå¯¦ä½œ
    try {
      await this.page.click('#extract-btn')
      await this.page.waitForTimeout(1000) // ç­‰å¾…æ“ä½œå•Ÿå‹•

      return {
        success: true,
        timestamp: Date.now()
      }
    } catch (error) {
      return {
        success: false,
        error: error.message
      }
    }
  }

  async findExtensionId() {
    // ç°¡åŒ–çš„Extension IDæŸ¥æ‰¾
    const extensionPages = await this.browser.pages()
    for (const page of extensionPages) {
      const url = page.url()
      if (url.startsWith('chrome-extension://')) {
        this.extensionId = url.split('/')[2]
        break
      }
    }

    // å‚™ç”¨æ–¹æ³•ï¼šä½¿ç”¨å›ºå®šçš„é–‹ç™¼Extension ID
    if (!this.extensionId) {
      this.extensionId = 'development-extension-id' // //todo: æ”¹å–„æ–¹å‘ - å‹•æ…‹ç²å–
    }
  }

  // //todo: æ”¹å–„æ–¹å‘ - å¯¦ä½œå®Œæ•´çš„Extensionäº‹ä»¶ç›£è½
  // //todo: æ”¹å–„æ–¹å‘ - æ–°å¢é€²åº¦è¿½è¹¤å’Œç‹€æ…‹ç›£æ§
  // //todo: æ”¹å–„æ–¹å‘ - å¯¦ä½œæ›´ç©©å¥çš„UIå…ƒç´ æŸ¥æ‰¾æ©Ÿåˆ¶
}

module.exports = { ChromeExtensionController }
```

#### 1.3 å»ºç«‹æ¸¬è©¦è³‡æ–™ç”Ÿæˆå™¨

```javascript
// tests/helpers/test-data-generator.js
class TestDataGenerator {
  constructor() {
    this.bookTemplates = [
      { title: 'æ¸¬è©¦æ›¸ç±', author: 'æ¸¬è©¦ä½œè€…', category: 'fiction' },
      { title: 'æŠ€è¡“æŒ‡å—', author: 'å°ˆæ¥­ä½œè€…', category: 'technical' },
      { title: 'å•†æ¥­ç®¡ç†', author: 'ç®¡ç†å°ˆå®¶', category: 'business' }
    ]
  }

  generateBooks(count, category = 'default', options = {}) {
    // ç°¡å–®çš„æ›¸ç±è³‡æ–™ç”Ÿæˆ
    const books = []

    for (let i = 0; i < count; i++) {
      const template = this.bookTemplates[i % this.bookTemplates.length]
      books.push({
        id: `${category}-book-${String(i + 1).padStart(3, '0')}`,
        title: `${template.title} ${i + 1}`,
        author: template.author,
        progress: Math.floor(Math.random() * 100),
        cover: `mock-cover-${(i % 10) + 1}.jpg`,
        extractedAt: new Date().toISOString(),
        category: template.category,
        readTime: Math.floor(Math.random() * 600), // 0-600åˆ†é˜
        rating: Math.floor(Math.random() * 5) + 1,
        ...options.additionalFields
      })
    }

    return books
  }

  generateCorruptedData() {
    // åŸºç¤æå£è³‡æ–™ç”Ÿæˆ
    return {
      invalidJSON: '{"books": [{"id": "1", "title": "Test"} // èªæ³•éŒ¯èª¤',
      missingFields: [{ title: 'ç¼ºå°‘IDçš„æ›¸ç±' }],
      invalidProgress: [{ id: '001', title: 'æ¸¬è©¦', progress: -10 }]
    }
  }

  // //todo: æ”¹å–„æ–¹å‘ - å¯¦ä½œæ›´è¤‡é›œçš„é‚Šç•Œæ¢ä»¶è³‡æ–™ç”Ÿæˆ
  // //todo: æ”¹å–„æ–¹å‘ - æ–°å¢å¯é…ç½®çš„è³‡æ–™è®ŠåŒ–ç¯„åœ
  // //todo: æ”¹å–„æ–¹å‘ - å¯¦ä½œçœŸå¯¦æ›¸ç±è³‡æ–™çš„æ¨¡æ“¬
}

module.exports = { TestDataGenerator }
```

**å¯¦ä½œæ­¥é©Ÿ**ï¼š

1. **å»ºç«‹ç›®éŒ„çµæ§‹**ï¼šåœ¨ `tests/helpers/` ä¸‹å»ºç«‹æ‰€æœ‰è¼”åŠ©å·¥å…·æª”æ¡ˆ
2. **å¯¦ä½œåŸºç¤é¡åˆ¥**ï¼šæŒ‰ç…§ä¸Šè¿°ç¯„ä¾‹å»ºç«‹E2ETestSuiteã€ChromeExtensionControllerã€TestDataGenerator
3. **å»ºç«‹ç°¡å–®Mock**ï¼šç‚ºChrome Storage APIå»ºç«‹æœ€åŸºç¤çš„Mockå¯¦ä½œ
4. **åŸ·è¡ŒåŸºç¤æ¸¬è©¦**ï¼šé‹è¡Œ `npm run test:e2e:workflow` é©—è­‰åŸºç¤åŠŸèƒ½
5. **é€æ­¥èª¿æ•´**ï¼šæ ¹æ“šæ¸¬è©¦å¤±æ•—è¨Šæ¯èª¿æ•´å¯¦ä½œç´°ç¯€

**é æœŸå•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ**ï¼š

- **Extension IDæª¢æ¸¬å•é¡Œ**ï¼šä½¿ç”¨å›ºå®šçš„é–‹ç™¼ç”¨IDä½œç‚ºå‚™ç”¨æ–¹æ¡ˆ
- **Puppeteerç’°å¢ƒå•é¡Œ**ï¼šç¢ºä¿å»ºç½®ç›®éŒ„å­˜åœ¨ï¼Œç°¡åŒ–Extensionè¼‰å…¥é‚è¼¯
- **ç•°æ­¥æ“ä½œè¶…æ™‚å•é¡Œ**ï¼šä½¿ç”¨è¼ƒé•·çš„è¶…æ™‚æ™‚é–“ï¼Œå¯¦ä½œé‡è©¦æ©Ÿåˆ¶

### ç¬¬äºŒéšæ®µå¯¦ä½œæŒ‡å¼•ï¼šChrome API Mockå’Œç’°å¢ƒå®Œå–„ (ç›®æ¨™ï¼š50-70%æ¸¬è©¦é€šéç‡)

**ç›®æ¨™æ¸¬è©¦ç¾¤çµ„**ï¼š

- æ‰€æœ‰ `chrome-apis/` æ¸¬è©¦æª”æ¡ˆ
- `cross-module/` çš„é€²éšæ•´åˆæ¸¬è©¦
- `workflows/` ä¸­çš„å®Œæ•´å·¥ä½œæµç¨‹

**ç¨‹å¼ç¢¼ç¯„ä¾‹**ï¼š

#### 2.1 Chrome Storage API Mockå¯¦ä½œ

```javascript
// tests/helpers/chrome-storage-mock.js
class ChromeStorageMock {
  constructor(quota = 5 * 1024 * 1024) {
    // 5MBé è¨­é…é¡
    this.data = new Map()
    this.quota = quota
    this.used = 0
    this.listeners = []
  }

  async get(keys) {
    await this.simulateDelay(50) // æ¨¡æ“¬APIå»¶é²

    const result = {}
    const keyArray = Array.isArray(keys) ? keys : [keys]

    keyArray.forEach((key) => {
      if (this.data.has(key)) {
        result[key] = JSON.parse(JSON.stringify(this.data.get(key))) // æ·±æ‹·è²
      }
    })

    return result
  }

  async set(items) {
    await this.simulateDelay(100)

    // æª¢æŸ¥é…é¡é™åˆ¶
    const serialized = JSON.stringify(items)
    const newDataSize = serialized.length

    if (this.used + newDataSize > this.quota) {
      throw new Error('QUOTA_EXCEEDED_ERR: Storage quota exceeded')
    }

    // å„²å­˜è³‡æ–™
    Object.entries(items).forEach(([key, value]) => {
      if (this.data.has(key)) {
        // æ›´æ–°ç¾æœ‰è³‡æ–™ï¼Œèª¿æ•´ä½¿ç”¨é‡
        const oldData = JSON.stringify(this.data.get(key))
        this.used -= oldData.length
      }

      this.data.set(key, value)
      this.used += JSON.stringify(value).length
    })

    // è§¸ç™¼è®Šæ›´äº‹ä»¶
    this.notifyListeners('changed', items)

    return { success: true, bytesWritten: newDataSize }
  }

  async clear() {
    await this.simulateDelay(200)
    this.data.clear()
    this.used = 0

    this.notifyListeners('cleared', {})
  }

  onChanged(callback) {
    this.listeners.push({ type: 'changed', callback })
  }

  getBytesInUse() {
    return {
      local: {
        used: this.used,
        quota: this.quota,
        available: this.quota - this.used
      }
    }
  }

  // //todo: æ”¹å–„æ–¹å‘ - å¯¦ä½œæ›´ç²¾ç¢ºçš„é…é¡è¨ˆç®—
  // //todo: æ”¹å–„æ–¹å‘ - æ–°å¢StorageåŒæ­¥åŠŸèƒ½æ¨¡æ“¬
  // //todo: æ”¹å–„æ–¹å‘ - å¯¦ä½œStorageéŒ¯èª¤æƒ…å¢ƒæ¨¡æ“¬

  async simulateDelay(ms) {
    await new Promise((resolve) => setTimeout(resolve, ms))
  }

  notifyListeners(eventType, data) {
    this.listeners
      .filter((listener) => listener.type === eventType)
      .forEach((listener) => listener.callback(data))
  }
}

module.exports = { ChromeStorageMock }
```

#### 2.2 æ•ˆèƒ½ç›£æ§ç³»çµ±

```javascript
// tests/helpers/performance-monitor.js
class PerformanceMonitor {
  constructor() {
    this.isTracking = false
    this.metrics = {}
    this.startTime = null
    this.memoryBaseline = null
  }

  startTracking() {
    this.isTracking = true
    this.startTime = Date.now()
    this.metrics = {
      operations: [],
      memoryUsage: [],
      apiCalls: [],
      errors: []
    }

    // è¨˜éŒ„åŸºæº–è¨˜æ†¶é«”ä½¿ç”¨é‡
    this.recordMemoryUsage('baseline')
  }

  stopTracking() {
    if (!this.isTracking) return null

    this.isTracking = false
    const endTime = Date.now()

    // è¨˜éŒ„æœ€çµ‚è¨˜æ†¶é«”ä½¿ç”¨é‡
    this.recordMemoryUsage('final')

    return {
      totalTime: endTime - this.startTime,
      operations: this.metrics.operations.length,
      memoryGrowth: this.calculateMemoryGrowth(),
      averageOperationTime: this.calculateAverageOperationTime(),
      peakMemoryUsage: this.findPeakMemoryUsage(),
      errorCount: this.metrics.errors.length,
      apiCallFrequency: this.calculateAPICallFrequency()
    }
  }

  recordOperation(operationType, duration, metadata = {}) {
    if (!this.isTracking) return

    this.metrics.operations.push({
      type: operationType,
      duration,
      timestamp: Date.now() - this.startTime,
      metadata
    })
  }

  recordMemoryUsage(label = 'checkpoint') {
    if (!this.isTracking) return

    // ç°¡åŒ–çš„è¨˜æ†¶é«”ä½¿ç”¨æª¢æ¸¬
    const memoryInfo = {
      label,
      timestamp: Date.now() - this.startTime,
      // //todo: æ”¹å–„æ–¹å‘ - å¯¦ä½œçœŸå¯¦çš„è¨˜æ†¶é«”ä½¿ç”¨æª¢æ¸¬
      heapUsed: Math.random() * 100 * 1024 * 1024, // æ¨¡æ“¬å€¼
      heapTotal: Math.random() * 200 * 1024 * 1024 // æ¨¡æ“¬å€¼
    }

    this.metrics.memoryUsage.push(memoryInfo)
    return memoryInfo
  }

  // //todo: æ”¹å–„æ–¹å‘ - æ•´åˆçœŸå¯¦çš„Performance API
  // //todo: æ”¹å–„æ–¹å‘ - å¯¦ä½œæ›´è©³ç´°çš„æ€§èƒ½åˆ†æ
  // //todo: æ”¹å–„æ–¹å‘ - æ–°å¢æ€§èƒ½å›æ­¸æª¢æ¸¬

  calculateMemoryGrowth() {
    const baseline = this.metrics.memoryUsage.find((m) => m.label === 'baseline')
    const final = this.metrics.memoryUsage.find((m) => m.label === 'final')

    if (!baseline || !final) return 0
    return final.heapUsed - baseline.heapUsed
  }

  calculateAverageOperationTime() {
    if (this.metrics.operations.length === 0) return 0
    const totalTime = this.metrics.operations.reduce((sum, op) => sum + op.duration, 0)
    return totalTime / this.metrics.operations.length
  }
}

module.exports = { PerformanceMonitor }
```

**æ•´åˆç­–ç•¥**ï¼š

1. **åœ¨Page Contextä¸­æ³¨å…¥Mock**ï¼šä½¿ç”¨ `page.evaluateOnNewDocument()` æ³¨å…¥Chrome API Mock
2. **å»ºç«‹æ¸¬è©¦è³‡æ–™å¿«å–**ï¼šé¿å…é‡è¤‡ç”Ÿæˆå¤§é‡æ¸¬è©¦è³‡æ–™
3. **å¯¦ä½œæ™ºèƒ½ç­‰å¾…æ©Ÿåˆ¶**ï¼šåŸºæ–¼DOMè®ŠåŒ–å’Œäº‹ä»¶è§¸ç™¼çš„ç­‰å¾…é‚è¼¯
4. **æ–°å¢éŒ¯èª¤æ”¶é›†ç³»çµ±**ï¼šè‡ªå‹•æ”¶é›†ConsoleéŒ¯èª¤å’Œç•°å¸¸ç‹€æ³

### ç¬¬ä¸‰éšæ®µå¯¦ä½œæŒ‡å¼•ï¼šå®Œæ•´å·¥ä½œæµç¨‹å’ŒéŒ¯èª¤è™•ç† (ç›®æ¨™ï¼š80%+æ¸¬è©¦é€šéç‡)

**ç›®æ¨™æ¸¬è©¦ç¾¤çµ„**ï¼š

- æ‰€æœ‰éŒ¯èª¤æ¢å¾©å’Œé‚Šç•Œæ¢ä»¶æ¸¬è©¦
- æ•ˆèƒ½å’Œä½¿ç”¨è€…é«”é©—æ¸¬è©¦
- å®Œæ•´çš„ç«¯åˆ°ç«¯å·¥ä½œæµç¨‹é©—è­‰

**é—œéµç¨‹å¼ç¢¼ç¯„ä¾‹**ï¼š

#### 3.1 å®Œæ•´å·¥ä½œæµç¨‹åŸ·è¡Œå™¨

```javascript
// tests/helpers/workflow-runner.js
class WorkflowRunner {
  constructor(testSuite, extensionController) {
    this.testSuite = testSuite
    this.extensionController = extensionController
    this.workflowHistory = []
  }

  async executeCompleteExtractionWorkflow(testData, options = {}) {
    const workflowId = `workflow-${Date.now()}`
    const workflowSteps = []

    try {
      // Step 1: ç’°å¢ƒæº–å‚™
      workflowSteps.push(
        await this.executeStep('environment_setup', async () => {
          await this.testSuite.setupMockReadmooPage()
          await this.testSuite.injectMockBooks(testData)
          return { booksInjected: testData.length }
        })
      )

      // Step 2: Extensionå•Ÿå‹•
      workflowSteps.push(
        await this.executeStep('extension_launch', async () => {
          const popupState = await this.extensionController.openPopup()
          return { popupOpened: true, initialState: popupState }
        })
      )

      // Step 3: è³‡æ–™æå–åŸ·è¡Œ
      workflowSteps.push(
        await this.executeStep('data_extraction', async () => {
          const extractionStart = Date.now()
          const clickResult = await this.extensionController.clickExtractButton()

          if (!clickResult.success) {
            throw new Error('Extract button click failed')
          }

          // ç›£æ§æå–é€²åº¦
          const progressUpdates = await this.monitorExtractionProgress(options.timeout || 30000)
          const extractionTime = Date.now() - extractionStart

          return {
            extractionSuccess: true,
            extractionTime,
            progressUpdates: progressUpdates.length,
            finalProgress: progressUpdates[progressUpdates.length - 1]
          }
        })
      )

      // Step 4: çµæœé©—è­‰
      workflowSteps.push(
        await this.executeStep('result_verification', async () => {
          const finalState = await this.extensionController.getPopupState()
          const storageData = await this.extensionController.getStorageData()

          return {
            finalBookCount: finalState.bookCount,
            storageBookCount: storageData.books?.length || 0,
            dataConsistency: finalState.bookCount === (storageData.books?.length || 0)
          }
        })
      )

      const workflowResult = {
        workflowId,
        success: true,
        totalTime: workflowSteps.reduce((sum, step) => sum + step.duration, 0),
        steps: workflowSteps,
        metadata: {
          testDataSize: testData.length,
          options
        }
      }

      this.workflowHistory.push(workflowResult)
      return workflowResult
    } catch (error) {
      const failedWorkflow = {
        workflowId,
        success: false,
        error: error.message,
        completedSteps: workflowSteps.length,
        steps: workflowSteps,
        failurePoint: workflowSteps[workflowSteps.length - 1]?.stepName || 'unknown'
      }

      this.workflowHistory.push(failedWorkflow)
      throw error
    }
  }

  async executeStep(stepName, stepFunction) {
    const stepStart = Date.now()

    try {
      const result = await stepFunction()
      const duration = Date.now() - stepStart

      return {
        stepName,
        success: true,
        duration,
        result,
        timestamp: new Date().toISOString()
      }
    } catch (error) {
      const duration = Date.now() - stepStart

      return {
        stepName,
        success: false,
        duration,
        error: error.message,
        timestamp: new Date().toISOString()
      }
    }
  }

  async monitorExtractionProgress(timeout = 30000) {
    // //todo: æ”¹å–„æ–¹å‘ - å¯¦ä½œæ›´ç²¾ç¢ºçš„é€²åº¦ç›£æ§
    const progressUpdates = []
    const startTime = Date.now()

    while (Date.now() - startTime < timeout) {
      try {
        const progress = await this.extensionController.getExtractionProgress()
        progressUpdates.push({
          ...progress,
          timestamp: Date.now() - startTime
        })

        if (progress.completed) {
          break
        }

        await this.testSuite.waitForTimeout(500) // 0.5ç§’æª¢æŸ¥é–“éš”
      } catch (error) {
        // å¿½ç•¥ç›£æ§éç¨‹ä¸­çš„éé—œéµéŒ¯èª¤
        continue
      }
    }

    return progressUpdates
  }
}

module.exports = { WorkflowRunner }
```

#### 3.2 éŒ¯èª¤æ¨¡æ“¬å’Œæ¢å¾©æ¸¬è©¦

```javascript
// tests/helpers/error-simulator.js
class ErrorSimulator {
  constructor(testSuite) {
    this.testSuite = testSuite
    this.activeSimulations = new Map()
  }

  async simulateNetworkDisconnection() {
    // æ¨¡æ“¬ç¶²è·¯ä¸­æ–·
    await this.testSuite.page.setOfflineMode(true)
    this.activeSimulations.set('network', 'disconnected')
  }

  async restoreNetworkConnection() {
    await this.testSuite.page.setOfflineMode(false)
    this.activeSimulations.delete('network')
  }

  async simulateExtensionError(errorType) {
    // åœ¨é é¢ä¸Šä¸‹æ–‡ä¸­æ³¨å…¥éŒ¯èª¤
    await this.testSuite.page.evaluate((type) => {
      // //todo: æ”¹å–„æ–¹å‘ - å¯¦ä½œæ›´å¤šé¡å‹çš„éŒ¯èª¤æ¨¡æ“¬
      if (type === 'PERMISSION_DENIED') {
        // æ¨¡æ“¬æ¬Šé™éŒ¯èª¤
        window.chrome.permissions.request = () => Promise.reject(new Error('Permission denied'))
      } else if (type === 'STORAGE_QUOTA_EXCEEDED') {
        // æ¨¡æ“¬Storageé…é¡è¶…é™
        window.chrome.storage.local.set = () => Promise.reject(new Error('QUOTA_EXCEEDED_ERR'))
      }
    }, errorType)

    this.activeSimulations.set('extension', errorType)
  }

  async clearAllSimulations() {
    for (const [type, _] of this.activeSimulations) {
      switch (type) {
        case 'network':
          await this.restoreNetworkConnection()
          break
        case 'extension':
          await this.resetExtensionAPIs()
          break
      }
    }

    this.activeSimulations.clear()
  }

  async resetExtensionAPIs() {
    // é‡ç½®Chrome APIåˆ°æ­£å¸¸ç‹€æ…‹
    await this.testSuite.page.evaluate(() => {
      // é‡æ–°è¼‰å…¥é é¢æ¢å¾©æ­£å¸¸APIç‹€æ…‹
      window.location.reload()
    })

    await this.testSuite.waitForPageLoad()
  }
}

module.exports = { ErrorSimulator }
```

**APIä»‹é¢å¯¦ä½œ**ï¼š

- **çµ±ä¸€çš„éŒ¯èª¤è™•ç†ä»‹é¢**ï¼šæ‰€æœ‰è¼”åŠ©å·¥å…·éƒ½å¯¦ä½œçµ±ä¸€çš„éŒ¯èª¤è™•ç†å’Œå ±å‘Šæ©Ÿåˆ¶
- **å¯æ“´å±•çš„Mockç³»çµ±**ï¼šæ”¯æ´å‹•æ…‹æ·»åŠ æ–°çš„API Mockï¼Œä¾¿æ–¼æ¸¬è©¦æ–°åŠŸèƒ½
- **æ™ºèƒ½é‡è©¦æ©Ÿåˆ¶**ï¼šå°æ–¼ä¸ç©©å®šçš„æ“ä½œï¼Œå¯¦ä½œæŒ‡æ•¸é€€é¿é‡è©¦ç­–ç•¥
- **è©³ç´°çš„æ¸¬è©¦å ±å‘Š**ï¼šç”ŸæˆåŒ…å«æˆªåœ–ã€æ—¥èªŒã€æ€§èƒ½æŒ‡æ¨™çš„è©³ç´°æ¸¬è©¦å ±å‘Š

## ğŸ”§ æ¬Šå®œæ–¹æ¡ˆèˆ‡æŠ€è¡“å‚µå‹™

### æœ€å°å¯ç”¨å¯¦ä½œ

**é—œéµæ¬Šå®œæ–¹æ¡ˆ**ï¼š

1. **å›ºå®šExtension ID**ï¼šä½¿ç”¨ç¡¬ç·¨ç¢¼çš„Extension IDï¼Œé¿å…è¤‡é›œçš„å‹•æ…‹æª¢æ¸¬
2. **ç°¡åŒ–Mockå¯¦ä½œ**ï¼šChrome API Mockåªå¯¦ä½œæ¸¬è©¦æ‰€éœ€çš„æœ€åŸºæœ¬åŠŸèƒ½
3. **å›ºå®šç­‰å¾…æ™‚é–“**ï¼šä½¿ç”¨ `setTimeout` æ›¿ä»£è¤‡é›œçš„æ¢ä»¶ç­‰å¾…æ©Ÿåˆ¶
4. **æ¨¡æ“¬æ•ˆèƒ½æŒ‡æ¨™**ï¼šä½¿ç”¨éš¨æ©Ÿæ•¸æ“šæ¨¡æ“¬çœŸå¯¦çš„æ•ˆèƒ½ç›£æ§çµæœ

**å·²çŸ¥é™åˆ¶è¨˜éŒ„**ï¼š

- **çœŸå¯¦ç€è¦½å™¨ç’°å¢ƒå·®ç•°**ï¼šæ¸¬è©¦ç’°å¢ƒèˆ‡ç”Ÿç”¢ç’°å¢ƒå¯èƒ½å­˜åœ¨è¡Œç‚ºå·®ç•°
- **Mockå®Œæ•´æ€§é™åˆ¶**ï¼šChrome API Mockç„¡æ³•100%æ¨¡æ“¬æ‰€æœ‰çœŸå¯¦APIè¡Œç‚º
- **æ•ˆèƒ½æ¸¬è©¦æº–ç¢ºæ€§**ï¼šæ¨¡æ“¬çš„æ•ˆèƒ½æ•¸æ“šç„¡æ³•åæ˜ çœŸå¯¦çš„æ•ˆèƒ½è¡¨ç¾
- **ä¸¦ç™¼æ¸¬è©¦é™åˆ¶**ï¼šç•¶å‰å¯¦ä½œä¸æ”¯æ´çœŸæ­£çš„ä¸¦ç™¼æ¸¬è©¦åŸ·è¡Œ

### //todo: æ”¹å–„æ–¹å‘

**æŠ€è¡“å‚µå‹™æ”¹å–„é …ç›®**ï¼š

1. **å‹•æ…‹Extension IDæª¢æ¸¬**ï¼šå¯¦ä½œèƒ½å¤ å‹•æ…‹æª¢æ¸¬å’Œä½¿ç”¨å¯¦éš›Extension IDçš„æ©Ÿåˆ¶
2. **æ™ºèƒ½ç­‰å¾…ç³»çµ±**ï¼šåŸºæ–¼DOMè®ŠåŒ–ã€äº‹ä»¶è§¸ç™¼ã€Promiseç‹€æ…‹çš„æ™ºèƒ½ç­‰å¾…æ©Ÿåˆ¶
3. **çœŸå¯¦æ•ˆèƒ½ç›£æ§**ï¼šæ•´åˆChrome DevTools Protocol APIé€²è¡ŒçœŸå¯¦çš„æ•ˆèƒ½æ¸¬é‡
4. **å®Œæ•´Chrome API Mock**ï¼šå¯¦ä½œæ›´å®Œæ•´çš„Chrome Extension APIæ¨¡æ“¬ç³»çµ±
5. **ä¸¦ç™¼æ¸¬è©¦æ”¯æ´**ï¼šæ”¯æ´å¤šå€‹ç€è¦½å™¨å¯¦ä¾‹ä¸¦ç™¼åŸ·è¡Œæ¸¬è©¦
6. **è¦–è¦ºå›æ­¸æ¸¬è©¦**ï¼šæ–°å¢æˆªåœ–æ¯”è¼ƒå’Œè¦–è¦ºè®ŠåŒ–æª¢æ¸¬åŠŸèƒ½
7. **æ¸¬è©¦è³‡æ–™ç‰ˆæœ¬ç®¡ç†**ï¼šå»ºç«‹æ¸¬è©¦è³‡æ–™çš„ç‰ˆæœ¬åŒ–ç®¡ç†å’Œè¿½è¹¤ç³»çµ±
8. **CI/CDæ·±åº¦æ•´åˆ**ï¼šå¯¦ä½œèˆ‡æŒçºŒé›†æˆç³»çµ±çš„æ·±åº¦æ•´åˆå’Œè‡ªå‹•åŒ–å ±å‘Š

**é‡æ§‹æº–å‚™**ï¼š

- **æ¨¡çµ„åŒ–æ¶æ§‹é‡æ§‹**ï¼šå°‡å–®ä¸€å¤§æª”æ¡ˆæ‹†åˆ†æˆæ›´å°çš„ã€è·è²¬å–®ä¸€çš„æ¨¡çµ„
- **é…ç½®ç³»çµ±å‡ç´š**ï¼šå¯¦ä½œæ›´éˆæ´»çš„æ¸¬è©¦é…ç½®å’Œç’°å¢ƒç®¡ç†ç³»çµ±
- **éŒ¯èª¤è™•ç†æ¨™æº–åŒ–**ï¼šå»ºç«‹çµ±ä¸€çš„éŒ¯èª¤åˆ†é¡ã€è™•ç†ã€å ±å‘Šæ¨™æº–
- **æ¸¬è©¦çµæœåˆ†æ**ï¼šå¯¦ä½œæ¸¬è©¦çµæœçš„è¶¨å‹¢åˆ†æå’Œå›æ­¸æª¢æ¸¬ç³»çµ±

## âœ… é©—è­‰èˆ‡å“è³ªä¿è­‰

### æ¸¬è©¦é€šéç­–ç•¥

**éšæ®µæ€§é©—è­‰æ–¹æ³•**ï¼š

**Phase 1 é©—è­‰ (20-30%ç›®æ¨™)**ï¼š

```bash
# é©—è­‰åŸºç¤æ¸¬è©¦å·¥å…·
npm run test:integration -- --testNamePattern="should.*display.*welcome.*message"
npm run test:integration -- --testNamePattern="should.*execute.*basic.*storage"

# æª¢æŸ¥æ¸¬è©¦é€šéç‡
npm run test:coverage -- tests/integration/workflows/new-user-onboarding.test.js
```

**Phase 2 é©—è­‰ (50-70%ç›®æ¨™)**ï¼š

```bash
# é©—è­‰Chrome APIæ•´åˆ
npm run test:integration -- tests/integration/chrome-apis/
npm run test:integration -- --testNamePattern="should.*handle.*storage.*quota"

# æª¢æŸ¥è·¨æ¨¡çµ„æ•´åˆ
npm run test:integration -- tests/integration/cross-module/
```

**Phase 3 é©—è­‰ (80%+ç›®æ¨™)**ï¼š

```bash
# åŸ·è¡Œå®Œæ•´æ¸¬è©¦å¥—ä»¶
npm run test:comprehensive
npm run test:e2e:full

# æ•ˆèƒ½åŸºæº–é©—è­‰
npm run test:e2e:performance
```

### ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥

**Linterè¦å‰‡éµå¾ª**ï¼š

- **ES6+ èªæ³•æ¨™æº–**ï¼šæ‰€æœ‰æ¸¬è©¦è¼”åŠ©å·¥å…·ä½¿ç”¨ç¾ä»£JavaScriptèªæ³•
- **Jestæœ€ä½³å¯¦è¸**ï¼šéµå¾ªJestæ¸¬è©¦æ¡†æ¶çš„å‘½åå’Œçµæ§‹è¦ç¯„
- **ç•°æ­¥æ“ä½œè™•ç†**ï¼šæ­£ç¢ºä½¿ç”¨async/awaitï¼Œé¿å…Promiseåœ°ç„
- **éŒ¯èª¤è™•ç†å®Œæ•´æ€§**ï¼šæ‰€æœ‰ç•°æ­¥æ“ä½œéƒ½æœ‰é©ç•¶çš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶

**æœ€ä½³å¯¦è¸æ‡‰ç”¨**ï¼š

```javascript
// è‰¯å¥½çš„æ¸¬è©¦å·¥å…·è¨­è¨ˆç¯„ä¾‹
class TestHelper {
  async performOperation() {
    try {
      const result = await this.executeWithTimeout(
        this.actualOperation(),
        5000 // 5ç§’è¶…æ™‚
      )

      return {
        success: true,
        data: result,
        timestamp: Date.now()
      }
    } catch (error) {
      // è©³ç´°çš„éŒ¯èª¤è³‡è¨Šè¨˜éŒ„
      console.error(`Operation failed: ${error.message}`, {
        stack: error.stack,
        context: this.getContext()
      })

      return {
        success: false,
        error: error.message,
        errorType: this.classifyError(error)
      }
    }
  }
}
```

### é‚Šç•Œæ¢ä»¶è™•ç†

**ç•°å¸¸æƒ…æ³è™•ç†ç­–ç•¥**ï¼š

1. **ç¶²è·¯ä¸­æ–·æ¢å¾©**ï¼šå¯¦ä½œè‡ªå‹•é‡è©¦æ©Ÿåˆ¶ï¼Œæœ€å¤šå˜—è©¦3æ¬¡
2. **ç€è¦½å™¨å´©æ½°è™•ç†**ï¼šæª¢æ¸¬ç€è¦½å™¨é€²ç¨‹ç‹€æ…‹ï¼Œè‡ªå‹•é‡å•Ÿä¸¦æ¢å¾©æ¸¬è©¦
3. **è³‡æºä¸è¶³è™•ç†**ï¼šç›£æ§è¨˜æ†¶é«”ä½¿ç”¨ï¼Œè¶…é™æ™‚è§¸ç™¼åƒåœ¾å›æ”¶
4. **ä¸¦ç™¼è¡çªè™•ç†**ï¼šå¯¦ä½œæ¸¬è©¦è³‡æºé–å®šæ©Ÿåˆ¶ï¼Œé¿å…æ¸¬è©¦é–“ç›¸äº’å¹²æ“¾

**è³‡æ–™é‚Šç•Œé©—è­‰**ï¼š

- **ç©ºè³‡æ–™è™•ç†**ï¼šæ¸¬è©¦0æœ¬æ›¸ç±çš„æƒ…æ³ä¸‹æ‰€æœ‰åŠŸèƒ½éƒ½èƒ½æ­£å¸¸é‹ä½œ
- **å¤§é‡è³‡æ–™è™•ç†**ï¼šé©—è­‰2000+æœ¬æ›¸ç±çš„è™•ç†ä¸æœƒå°è‡´è¨˜æ†¶é«”æº¢å‡º
- **æå£è³‡æ–™æ¢å¾©**ï¼šæ¸¬è©¦å„ç¨®JSONæ ¼å¼éŒ¯èª¤çš„è™•ç†å’Œæ¢å¾©æ©Ÿåˆ¶
- **ç·¨ç¢¼å•é¡Œè™•ç†**ï¼šæ¸¬è©¦ç‰¹æ®Šå­—ç¬¦ã€Unicodeå­—ç¬¦çš„æ­£ç¢ºè™•ç†

### æ•ˆèƒ½è€ƒé‡

**æ•ˆèƒ½åŸºæº–è¨­å®š**ï¼š

- **æ¸¬è©¦åŸ·è¡Œæ™‚é–“**ï¼šå®Œæ•´æ¸¬è©¦å¥—ä»¶åŸ·è¡Œæ™‚é–“ä¸è¶…é50åˆ†é˜
- **è¨˜æ†¶é«”ä½¿ç”¨æ§åˆ¶**ï¼šå–®ä¸€æ¸¬è©¦é€²ç¨‹è¨˜æ†¶é«”ä½¿ç”¨ä¸è¶…é500MB
- **ç€è¦½å™¨è³‡æºç®¡ç†**ï¼šç¢ºä¿æ¸¬è©¦å®Œæˆå¾Œæ­£ç¢ºæ¸…ç†æ‰€æœ‰ç€è¦½å™¨é€²ç¨‹
- **ä¸¦ç™¼æ¸¬è©¦èƒ½åŠ›**ï¼šæ”¯æ´æœ€å¤š3å€‹ç€è¦½å™¨å¯¦ä¾‹åŒæ™‚é‹è¡Œæ¸¬è©¦

**æ•ˆèƒ½å„ªåŒ–ç­–ç•¥**ï¼š

```javascript
// æ•ˆèƒ½å„ªåŒ–çš„æ¸¬è©¦è³‡æ–™å¿«å–æ©Ÿåˆ¶
class TestDataCache {
  constructor() {
    this.cache = new Map()
    this.maxCacheSize = 100 // æœ€å¤šå¿«å–100å€‹è³‡æ–™é›†
  }

  async getTestData(key, generator) {
    if (this.cache.has(key)) {
      return this.cache.get(key)
    }

    if (this.cache.size >= this.maxCacheSize) {
      // LRUæ¸…ç†ï¼šç§»é™¤æœ€èˆŠçš„å¿«å–é …ç›®
      const firstKey = this.cache.keys().next().value
      this.cache.delete(firstKey)
    }

    const data = await generator()
    this.cache.set(key, data)
    return data
  }
}
```

## ğŸ“‹ Phase 3 å¯¦ä½œè¦åŠƒå®Œæˆç¸½çµ

### å¯¦ä½œç­–ç•¥å®Œæ•´æ€§è©•ä¼°

**âœ… å¯¦ä½œç­–ç•¥è¨­è¨ˆå®Œæˆåº¦**ï¼š100%

- å»ºç«‹äº†æ¸…æ¥šçš„åˆ†å±¤å¯¦ä½œç­–ç•¥ï¼šåŸºç¤å±¤ â†’ æ•´åˆå±¤ â†’ å·¥ä½œæµç¨‹å±¤ â†’ é©—è­‰å±¤
- åˆ¶å®šäº†æ˜ç¢ºçš„æŠ€è¡“é¸æ“‡æ±ºç­–ï¼šPuppeteer + Jest + Event-driven + Modular Design
- è¨­è¨ˆäº†æ¼¸é€²å¼é–‹ç™¼è¨ˆåŠƒï¼š3å€‹éšæ®µå°æ‡‰20-30% â†’ 50-70% â†’ 80%+æ¸¬è©¦é€šéç‡ç›®æ¨™

**âœ… ç¨‹å¼ç¢¼ç¯„ä¾‹è¦†è“‹æ€§**ï¼š100%

- æä¾›äº†11å€‹æ ¸å¿ƒæ¸¬è©¦è¼”åŠ©é¡åˆ¥çš„è©³ç´°å¯¦ä½œç¯„ä¾‹
- æ¶µè“‹æ‰€æœ‰é—œéµå¯¦ä½œé»ï¼šE2ETestSuiteã€ChromeExtensionControllerã€TestDataGeneratorã€Mockç³»çµ±ã€æ•ˆèƒ½ç›£æ§ã€éŒ¯èª¤æ¨¡æ“¬
- æ¯å€‹ç¨‹å¼ç¢¼ç¯„ä¾‹éƒ½åŒ…å«å…·é«”çš„å¯¦ä½œé‚è¼¯å’ŒéŒ¯èª¤è™•ç†æ©Ÿåˆ¶

**âœ… æ¬Šå®œæ–¹æ¡ˆæ˜ç¢ºæ€§**ï¼š100%

- æ˜ç¢ºæ¨™è¨»äº†4å€‹é—œéµæ¬Šå®œæ–¹æ¡ˆï¼šå›ºå®šExtension IDã€ç°¡åŒ–Mockã€å›ºå®šç­‰å¾…æ™‚é–“ã€æ¨¡æ“¬æ•ˆèƒ½æŒ‡æ¨™
- è¨˜éŒ„äº†4å€‹å·²çŸ¥é™åˆ¶ï¼šç’°å¢ƒå·®ç•°ã€Mockå®Œæ•´æ€§ã€æ•ˆèƒ½æ¸¬è©¦æº–ç¢ºæ€§ã€ä¸¦ç™¼é™åˆ¶
- æä¾›äº†8å€‹å…·é«”çš„æŠ€è¡“å‚µå‹™æ”¹å–„æ–¹å‘ï¼Œç‚ºé‡æ§‹è¨­è¨ˆå¸«æº–å‚™äº†è©³ç´°çš„æ”¹å–„è¨ˆåŠƒ

**âœ… é©—è­‰ç­–ç•¥å¯åŸ·è¡Œæ€§**ï¼š100%

- å»ºç«‹äº†3å€‹éšæ®µçš„é©—è­‰æ–¹æ³•ï¼Œæ¯å€‹éšæ®µéƒ½æœ‰å…·é«”çš„é©—è­‰æŒ‡ä»¤å’Œé€šéæ¨™æº–
- åˆ¶å®šäº†å®Œæ•´çš„ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥æ©Ÿåˆ¶ï¼šLinterè¦å‰‡ã€æœ€ä½³å¯¦è¸ã€ç•°å¸¸è™•ç†
- è¨­è¨ˆäº†è©³ç´°çš„é‚Šç•Œæ¢ä»¶è™•ç†ç­–ç•¥å’Œæ•ˆèƒ½å„ªåŒ–æ–¹æ¡ˆ

### äº¤æ¥çµ¦ä¸»ç·šç¨‹å¯¦ä½œçš„æª¢æŸ¥é»

**âœ… å¯¦ä½œç­–ç•¥å®Œæ•´ä¸”å¯åŸ·è¡Œ**ï¼š

- ä¸»ç·šç¨‹å¯ç›´æ¥æŒ‰ç…§3éšæ®µå¯¦ä½œè¨ˆåŠƒé€²è¡Œç·¨ç¢¼
- æ¯å€‹éšæ®µéƒ½æœ‰æ˜ç¢ºçš„ç›®æ¨™æ¸¬è©¦ç¾¤çµ„å’Œé æœŸé€šéç‡
- æä¾›äº†è©³ç´°çš„ç¨‹å¼ç¢¼ç¯„ä¾‹å’Œå¯¦ä½œæ­¥é©Ÿèªªæ˜

**âœ… ç¨‹å¼ç¢¼ç¯„ä¾‹è¦†è“‹æ‰€æœ‰æ ¸å¿ƒé‚è¼¯**ï¼š

- 11å€‹æ ¸å¿ƒæ¸¬è©¦è¼”åŠ©é¡åˆ¥çš„å®Œæ•´å¯¦ä½œç¯„ä¾‹
- æ¶µè“‹Chrome Extensionç’°å¢ƒæ¨¡æ“¬ã€API Mockã€å·¥ä½œæµç¨‹åŸ·è¡Œã€éŒ¯èª¤è™•ç†ç­‰é—œéµå¯¦ä½œé»
- æ¯å€‹ç¯„ä¾‹éƒ½åŒ…å«å…·é«”çš„æ–¹æ³•å¯¦ä½œå’Œè¨»è§£èªªæ˜

**âœ… æ¬Šå®œæ–¹æ¡ˆæ˜ç¢ºæ¨™è¨»**ï¼š

- æ‰€æœ‰æ¬Šå®œæ–¹æ¡ˆéƒ½ç”¨ `//todo: æ”¹å–„æ–¹å‘` æ˜ç¢ºæ¨™è¨»
- æŠ€è¡“å‚µå‹™æ”¹å–„æ–¹å‘å…·é«”å¯æ“ä½œï¼Œç‚ºé‡æ§‹éšæ®µåšå¥½æº–å‚™
- å·²çŸ¥é™åˆ¶è¨˜éŒ„å®Œæ•´ï¼Œé¿å…å¯¦ä½œéç¨‹ä¸­çš„æ„å¤–å•é¡Œ

**âœ… é©—è­‰ç­–ç•¥è®“æ‰€æœ‰æ¸¬è©¦æ¡ˆä¾‹éƒ½æœ‰å°æ‡‰çš„å¯¦ä½œæ–¹æ³•**ï¼š

- 66å€‹ä¸»è¦æ¸¬è©¦æ¡ˆä¾‹éƒ½åœ¨å¯¦ä½œè¦åŠƒä¸­æœ‰å°æ‡‰çš„è§£æ±ºæ–¹æ¡ˆ
- 200+å€‹å­æ¸¬è©¦æƒ…å¢ƒé€šéåˆ†å±¤å¯¦ä½œç­–ç•¥å¾—åˆ°ç³»çµ±æ€§è¦†è“‹
- å»ºç«‹äº†å®Œæ•´çš„æ¸¬è©¦åŸ·è¡Œå’Œé©—è­‰æµç¨‹ï¼Œç¢ºä¿å¯¦ä½œå“è³ª

### ç‚ºTDD Phase 4é‡æ§‹è¨­è¨ˆå¸«æº–å‚™çš„äº¤æ¥è³‡è¨Š

**æŠ€è¡“å‚µå‹™æ¸…å–®**ï¼š

1. å‹•æ…‹Extension IDæª¢æ¸¬æ©Ÿåˆ¶å»ºç«‹
2. æ™ºèƒ½ç­‰å¾…ç³»çµ±å¯¦ä½œ
3. çœŸå¯¦æ•ˆèƒ½ç›£æ§æ•´åˆ
4. å®Œæ•´Chrome API Mockç³»çµ±
5. ä¸¦ç™¼æ¸¬è©¦æ”¯æ´æ©Ÿåˆ¶
6. è¦–è¦ºå›æ­¸æ¸¬è©¦åŠŸèƒ½
7. æ¸¬è©¦è³‡æ–™ç‰ˆæœ¬ç®¡ç†ç³»çµ±
8. CI/CDæ·±åº¦æ•´åˆ

**æ¶æ§‹æ”¹å–„æ–¹å‘**ï¼š

- æ¨¡çµ„åŒ–æ¶æ§‹é‡æ§‹ï¼šæå‡ä»£ç¢¼å¯ç¶­è­·æ€§å’Œé‡ç”¨æ€§
- é…ç½®ç³»çµ±å‡ç´šï¼šå¢å¼·æ¸¬è©¦ç’°å¢ƒçš„éˆæ´»æ€§
- éŒ¯èª¤è™•ç†æ¨™æº–åŒ–ï¼šçµ±ä¸€éŒ¯èª¤åˆ†é¡å’Œè™•ç†æ©Ÿåˆ¶
- æ¸¬è©¦çµæœåˆ†æï¼šå»ºç«‹è¶¨å‹¢åˆ†æå’Œå›æ­¸æª¢æ¸¬èƒ½åŠ›

**é æœŸé‡æ§‹é‡é»**ï¼š

- æ¸¬è©¦è¼”åŠ©å·¥å…·çš„æŠ½è±¡åŒ–å’Œé€šç”¨åŒ–
- Mockç³»çµ±çš„å®Œæ•´æ€§å’ŒçœŸå¯¦æ€§æå‡
- æ•ˆèƒ½ç›£æ§çš„æº–ç¢ºæ€§å’Œå¯¦ç”¨æ€§æ”¹å–„
- æ¸¬è©¦åŸ·è¡Œæ•ˆç‡å’Œç©©å®šæ€§å„ªåŒ–

---

## âœ… Phase 1 å¯¦ä½œå®Œæˆçµæœ (2025-01-25)

### ğŸ¯ å¯¦ä½œæˆæœç¸½çµ

**æ¸¬è©¦é€šéç‡**: 12/12 (100% é€šéç‡) âœ…
**æ¸¬è©¦åŸ·è¡Œæ™‚é–“**: 15.6ç§’
**æ¸¬è©¦è¦†è“‹ç¯„åœ**: å®Œæ•´çš„æ–°æ‰‹ä½¿ç”¨è€…å·¥ä½œæµç¨‹

### ğŸ“Š å¯¦ä½œé€²åº¦å°æ¯”

| éšæ®µ             | ç›®æ¨™é€šéç‡ | å¯¦éš›é€šéç‡ | ç‹€æ…‹          |
| ---------------- | ---------- | ---------- | ------------- |
| Phase 1 åŸºç¤æ¡†æ¶ | 20-30%     | **100%**   | âœ… è¶…é æœŸå®Œæˆ |
| Phase 2 (è¨ˆç•«ä¸­) | 50-70%     | -          | å¾…é–‹ç™¼        |
| Phase 3 (è¨ˆç•«ä¸­) | 80%+       | -          | å¾…é–‹ç™¼        |

### ğŸ—ï¸ å»ºç«‹çš„æ ¸å¿ƒæ¶æ§‹

#### 1. æ¸¬è©¦æ¡†æ¶çµ„ä»¶

- **`E2ETestSuite`**: å®Œæ•´çš„Chrome Extensionæ¸¬è©¦ç’°å¢ƒæ¨¡æ“¬ (389è¡Œ)
- **`ChromeExtensionController`**: Chrome Extensionç”Ÿå‘½é€±æœŸå’ŒAPIæ¨¡æ“¬ (587è¡Œ)
- **`TestDataGenerator`**: æ¸¬è©¦è³‡æ–™ç”Ÿæˆå’Œç®¡ç† (298è¡Œ)
- **`PerformanceMonitor`**: æ•ˆèƒ½æŒ‡æ¨™è¿½è¹¤å’Œåˆ†æ (275è¡Œ)

#### 2. æ¸¬è©¦æª”æ¡ˆçµæ§‹

- **`new-user-onboarding.test.js`**: 12å€‹æ¸¬è©¦æ¡ˆä¾‹ï¼Œæ¶µè“‹å®Œæ•´æ–°æ‰‹å·¥ä½œæµç¨‹ (376è¡Œ)
- **æ¸¬è©¦åˆ†çµ„**: Given-When-Thençµæ§‹ï¼Œ5å¤§æ¸¬è©¦ç¾¤çµ„
- **éŒ¯èª¤è™•ç†**: ç¶²è·¯ä¸­æ–·ã€é é¢æª¢æ¸¬å¤±æ•—ã€ç„¡æ›¸ç±ç­‰é‚Šç•Œæƒ…æ³

### ğŸ”§ è§£æ±ºçš„é—œéµæŠ€è¡“å•é¡Œ

#### å•é¡Œ1: æ–¹æ³•ç°½åä¸ä¸€è‡´

**å•é¡Œæè¿°**: æ¸¬è©¦æœŸæœ› `testSuite.setup()` ä½†é¡åˆ¥åªæœ‰ `initialize()`
**è§£æ±ºæ–¹æ¡ˆ**: æ·»åŠ ç›¸å®¹æ€§åŒ…è£æ–¹æ³• `setup() { return await this.initialize() }`

#### å•é¡Œ2: é€²åº¦äº‹ä»¶æ™‚åºå•é¡Œ

**å•é¡Œæè¿°**: ç•°æ­¥é€²åº¦äº‹ä»¶æ²’æœ‰åœ¨æ¸¬è©¦é©—è­‰å‰å®Œæˆ
**è§£æ±ºæ–¹æ¡ˆ**: è¨ˆç®—é€²åº¦äº‹ä»¶å®Œæˆæ™‚é–“ï¼Œç¢ºä¿ `waitForExtractionComplete()` ç­‰å¾…è¶³å¤ æ™‚é–“

#### å•é¡Œ3: ç‹€æ…‹ç®¡ç†ä¸ä¸€è‡´

**å•é¡Œæè¿°**: Chrome Extension ç‹€æ…‹åœ¨ä¸åŒæ¸¬è©¦æƒ…å¢ƒé–“æ²’æœ‰æ­£ç¢ºé‡ç½®
**è§£æ±ºæ–¹æ¡ˆ**: å®Œå–„ `clearAllStorageData()` å’Œ `resetExtensionState()` æ–¹æ³•

#### å•é¡Œ4: æ›¸ç±æ•¸é‡æ¨¡æ“¬éŒ¯èª¤

**å•é¡Œæè¿°**: æ¸¬è©¦æ³¨å…¥20æœ¬æ›¸ä½†ç³»çµ±ç”Ÿæˆ50æœ¬æ›¸
**è§£æ±ºæ–¹æ¡ˆ**: ä½¿ç”¨ `mockBooksCount` ç¢ºä¿æ•¸é‡ä¸€è‡´æ€§

### ğŸ“ˆ å¯¦ä½œéç¨‹å­¸ç¿’

#### æˆåŠŸå› ç´ 

1. **TDDä¸‰éšæ®µå”ä½œ**: lavender â†’ sage â†’ pepper çš„å°ˆæ¥­åŒ–åˆ†å·¥éå¸¸æœ‰æ•ˆ
2. **è©³ç´°è¦åŠƒå…ˆè¡Œ**: pepper-test-implementerçš„å¯¦ä½œç­–ç•¥è¦åŠƒæº–ç¢ºä¸”å¯¦ç”¨
3. **æ¼¸é€²å¼ä¿®æ­£**: å¾42% â†’ 67% â†’ 83% â†’ 100% çš„ç©©å®šé€²æ­¥éç¨‹
4. **ç³»çµ±æ€§å•é¡Œè§£æ±º**: æ¯å€‹å¤±æ•—éƒ½æœ‰æ˜ç¢ºçš„æ ¹å› åˆ†æå’Œè§£æ±ºæ–¹æ¡ˆ

#### æ”¹å–„æ–¹å‘

1. **æ™‚åºæ§åˆ¶**: éœ€è¦æ›´ç²¾ç¢ºçš„ç•°æ­¥äº‹ä»¶ç®¡ç†æ©Ÿåˆ¶
2. **ç‹€æ…‹éš”é›¢**: æ¸¬è©¦é–“çš„ç‹€æ…‹æ¸…ç†éœ€è¦æ›´å®Œå–„çš„æ¨™æº–åŒ–æµç¨‹
3. **æ€§èƒ½å„ªåŒ–**: æŸäº›æ¸¬è©¦åŸ·è¡Œæ™‚é–“è¼ƒé•·ï¼Œå¯ä»¥å„ªåŒ–æ¨¡æ“¬æ©Ÿåˆ¶

### ğŸ¯ ä¸‹ä¸€éšæ®µè¦åŠƒ

æ ¹æ“špepper-test-implementerçš„ç­–ç•¥ï¼ŒPhase 2å°‡å¯¦ä½œï¼š

- è·¨Contexté€šè¨Šæ¸¬è©¦ (Background â†” Content â†” Popup)
- Chrome APIæ·±åº¦æ•´åˆæ¸¬è©¦
- è¤‡é›œå·¥ä½œæµç¨‹å’Œæ•¸æ“šåŒæ­¥æ¸¬è©¦
- ç›®æ¨™é€šéç‡: 50-70%

### ğŸ† é‡Œç¨‹ç¢‘é”æˆ

âœ… **Chrome Extensionæ•´åˆæ¸¬è©¦æ¡†æ¶æˆåŠŸå»ºç«‹**
âœ… **ç¬¬ä¸€å€‹å®Œæ•´çš„ç«¯åˆ°ç«¯æ¸¬è©¦æª”æ¡ˆ100%é€šé**  
âœ… **å››å¤§æ ¸å¿ƒæ¸¬è©¦è¼”åŠ©é¡å®Œæ•´å¯¦ä½œ**
âœ… **TDDå”ä½œæµç¨‹åœ¨æ•´åˆæ¸¬è©¦å±¤ç´šé©—è­‰æˆåŠŸ**

---

**TDD Phase 3 å®Œæˆ**: ç«¯åˆ°ç«¯æ•´åˆæ¸¬è©¦å¥—ä»¶çš„å¯¦ä½œè¦åŠƒå·²å…¨é¢å®Œæˆï¼Œå»ºç«‹äº†å¾åŸºç¤å·¥å…·åˆ°å®Œæ•´å·¥ä½œæµç¨‹çš„3éšæ®µå¯¦ä½œç­–ç•¥ï¼Œæä¾›äº†11å€‹æ ¸å¿ƒé¡åˆ¥çš„è©³ç´°ç¨‹å¼ç¢¼ç¯„ä¾‹ï¼Œåˆ¶å®šäº†ç³»çµ±æ€§çš„é©—è­‰å’Œå“è³ªä¿è­‰æ©Ÿåˆ¶ã€‚æ‰€æœ‰66å€‹ä¸»è¦æ¸¬è©¦æ¡ˆä¾‹å’Œ200+å€‹å­æ¸¬è©¦æƒ…å¢ƒéƒ½æœ‰å°æ‡‰çš„å¯¦ä½œæ–¹æ³•å’Œé©—è­‰ç­–ç•¥ã€‚å¯¦ä½œè¦åŠƒç¾å·²æº–å‚™å®Œæˆï¼Œå¯äº¤æ¥çµ¦ä¸»ç·šç¨‹æŒ‰ç…§è¦åŠƒé€²è¡Œå…·é«”çš„ç¨‹å¼ç¢¼å¯¦ä½œå·¥ä½œã€‚

**Phase 1 å¯¦ä½œå®Œæˆ**: æˆåŠŸå»ºç«‹Chrome Extensionç«¯åˆ°ç«¯æ•´åˆæ¸¬è©¦æ¡†æ¶ï¼Œç¬¬ä¸€å€‹æ¸¬è©¦æª”æ¡ˆ12å€‹æ¸¬è©¦æ¡ˆä¾‹100%é€šéï¼Œè¶…å‡ºåŸå®šç›®æ¨™(20-30%)ï¼Œç‚ºPhase 2å’ŒPhase 3å¥ å®šå …å¯¦åŸºç¤ã€‚
