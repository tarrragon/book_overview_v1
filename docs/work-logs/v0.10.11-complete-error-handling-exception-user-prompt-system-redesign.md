# v0.10.11 å®Œæ•´éŒ¯èª¤è™•ç†ã€Exceptionæ©Ÿåˆ¶ã€ä½¿ç”¨è€…æç¤ºç³»çµ±é‡æ–°è¨­è¨ˆ

**é–‹ç™¼ç‰ˆæœ¬**: v0.10.11  
**é–‹ç™¼æ—¥æœŸ**: 2025-09-03  
**ä¸»è¦ä»»å‹™**: å®Œæ•´éŒ¯èª¤è™•ç†ã€Exceptionæ©Ÿåˆ¶ã€ä½¿ç”¨è€…æç¤ºç³»çµ±é‡æ–°è¨­è¨ˆ  
**å·¥ä½œç‹€æ…‹**: ğŸ”„ é€²è¡Œä¸­ - TDD Phase 1 åŠŸèƒ½è¨­è¨ˆéšæ®µ  
**é–‹ç™¼è€…**: Claude Code (TDDåŠŸèƒ½è¨­è¨ˆå¸«å°ˆå®¶)

## ğŸ¯ å·¥ä½œç›®æ¨™èˆ‡èƒŒæ™¯

### å®Œæ•´ç³»çµ±éœ€æ±‚ç†è§£

åŸºæ–¼æ›¸åº«ç®¡ç†ç³»çµ±çš„äº”å€‹ä¸»è¦éšæ®µï¼ˆæ“·å–â†’åŒæ­¥â†’æ›´æ–°â†’åˆ†é¡â†’åŒ¯å‡ºï¼‰ï¼Œä»¥åŠç„¡è‡ªå‹•åŒ–æµç¨‹çš„æ‰‹å‹•æ“ä½œç‰¹æ€§ï¼Œé‡æ–°è¨­è¨ˆå®Œæ•´çš„éŒ¯èª¤è™•ç†ç”Ÿæ…‹ç³»çµ±ã€‚

#### æ¥­å‹™æµç¨‹èƒŒæ™¯åˆ†æ
**æ›¸åº«ç®¡ç†ç³»çµ±äº”éšæ®µ**ï¼š
1. **æ“·å–éšæ®µ** - å¾Readmooç­‰å¹³å°æ“·å–æ›¸ç±è³‡æ–™
2. **åŒæ­¥éšæ®µ** - è³‡æ–™åŒæ­¥å’Œä¸€è‡´æ€§æª¢æŸ¥  
3. **æ›´æ–°éšæ®µ** - æ›¸ç±è³‡æ–™æ›´æ–°å’Œç¶­è­·
4. **åˆ†é¡éšæ®µ** - æ›¸ç±åˆ†é¡å’Œæ¨™ç±¤ç®¡ç†
5. **åŒ¯å‡ºéšæ®µ** - è³‡æ–™åŒ¯å‡ºå’Œå‚™ä»½

**é—œéµç‰¹æ€§**ï¼š
- **ç„¡è‡ªå‹•åŒ–æµç¨‹** - æ¯ä¸€æ­¥éƒ½ä»°è³´ä½¿ç”¨è€…æ‰‹å‹•æ“ä½œ
- **æ“ä½œå¼•å°éœ€æ±‚** - æ¯å€‹ç•°å¸¸éƒ½éœ€è¦å°ä½¿ç”¨è€…æä¾›æ­£ç¢ºçš„æç¤ºå’ŒæŒ‡å¼•
- **åˆ†éšæ®µå¯¦ä½œ** - 1.0éšæ®µå»ºç«‹åŸºç¤ï¼Œ2.0éšæ®µåŠ å…¥å®Œæ•´Exceptionå’Œä½¿ç”¨è€…æç¤ºç³»çµ±

## ğŸ“… 2025-09-03 TDD Phase 1 å®Œæ•´è¨­è¨ˆè¨˜éŒ„

### 1. åŠŸèƒ½éœ€æ±‚åˆ†æéšæ®µ âœ…

#### æ ¸å¿ƒåƒ¹å€¼é‡æ–°å®šç¾©

**æ›¸åº«ç®¡ç†å®Œæ•´éŒ¯èª¤è™•ç†ç”Ÿæ…‹ç³»çµ±åƒ¹å€¼**ï¼š
- **ä½¿ç”¨è€…æ“ä½œå¼•å°**: å°‡æŠ€è¡“ç•°å¸¸è½‰æ›ç‚ºå…·é«”å¯åŸ·è¡Œçš„ä½¿ç”¨è€…æŒ‡å¼•
- **ç³»çµ±ç©©å®šæ€§ä¿è­‰**: ç¢ºä¿æ¯å€‹æ“ä½œéšæ®µçš„éŒ¯èª¤éƒ½èƒ½è¢«æ­£ç¢ºè™•ç†å’Œæ¢å¾©
- **é–‹ç™¼ç¶­è­·æ•ˆç‡**: çµ±ä¸€çš„éŒ¯èª¤è™•ç†æ¨¡å¼é™ä½é–‹ç™¼å’Œç¶­è­·æˆæœ¬
- **ä½¿ç”¨è€…é«”é©—å„ªåŒ–**: å‹å–„çš„éŒ¯èª¤æç¤ºå’Œè§£æ±ºæ–¹æ¡ˆæŒ‡å¼•

**Chrome Extensionç‰¹åŒ–åƒ¹å€¼**ï¼š
- **è·¨ç’°å¢ƒä¸€è‡´æ€§**: Background/Content/Popupä¸‰ç’°å¢ƒçš„çµ±ä¸€éŒ¯èª¤è™•ç†
- **è¨˜æ†¶é«”æ•ˆèƒ½å„ªåŒ–**: é©æ‡‰Chrome Extensionçš„è³‡æºé™åˆ¶
- **é›¢ç·šå®¹éŒ¯èƒ½åŠ›**: ç¶²è·¯ç•°å¸¸æ™‚çš„æœ¬åœ°éŒ¯èª¤è™•ç†å’Œæš«å­˜æ©Ÿåˆ¶
- **ä½¿ç”¨è€…ä»‹é¢æ•´åˆ**: Popup UIçš„å³æ™‚éŒ¯èª¤å±•ç¤ºå’Œæ“ä½œå¼•å°

#### ä½¿ç”¨è€…å ´æ™¯å®Œæ•´åˆ†æ

**éšæ®µ1: æ“·å–éšæ®µç•°å¸¸å ´æ™¯**

*å ´æ™¯1.1: å¹³å°é€£æ¥å¤±æ•—*
- **ç•°å¸¸æƒ…å¢ƒ**: Readmooç™»å…¥éæœŸã€ç¶²è·¯é€£ç·šä¸ç©©å®šã€å¹³å°æš«æ™‚ç¶­è­·
- **ä½¿ç”¨è€…é«”é©—**: æ˜ç¢ºå‘ŠçŸ¥é€£æ¥å¤±æ•—åŸå› ï¼Œæä¾›é‡æ–°ç™»å…¥æˆ–ç¨å¾Œé‡è©¦çš„æŒ‡å¼•
- **æŠ€è¡“è™•ç†**: NetworkException â†’ é‡è©¦æ©Ÿåˆ¶ â†’ ä½¿ç”¨è€…å¼•å°
- **é æœŸæ“ä½œ**: å¼•å°ä½¿ç”¨è€…é‡æ–°æˆæ¬Šã€æª¢æŸ¥ç¶²è·¯ç‹€æ…‹ã€æä¾›å‚™é¸æ™‚é–“

*å ´æ™¯1.2: è³‡æ–™æ ¼å¼è®ŠåŒ–*
- **ç•°å¸¸æƒ…å¢ƒ**: å¹³å°æ›´æ–°å°è‡´è³‡æ–™çµæ§‹æ”¹è®Šã€APIå›æ‡‰æ ¼å¼ä¸ç¬¦é æœŸ
- **ä½¿ç”¨è€…é«”é©—**: é€šçŸ¥ä½¿ç”¨è€…å¹³å°å¯èƒ½å·²æ›´æ–°ï¼Œå»ºè­°è¯ç¹«æ”¯æ´æˆ–ç­‰å¾…ç³»çµ±æ›´æ–°
- **æŠ€è¡“è™•ç†**: DataFormatException â†’ é™ç´šè™•ç† â†’ é€šçŸ¥æ©Ÿåˆ¶
- **é æœŸæ“ä½œ**: æä¾›æ›¿ä»£è³‡æ–™ä¾†æºã€è¯ç¹«æŠ€è¡“æ”¯æ´çš„ç®¡é“

**éšæ®µ2: åŒæ­¥éšæ®µç•°å¸¸å ´æ™¯**

*å ´æ™¯2.1: è³‡æ–™è¡çªè™•ç†*
- **ç•°å¸¸æƒ…å¢ƒ**: æœ¬åœ°èˆ‡é›²ç«¯è³‡æ–™ä¸ä¸€è‡´ã€ç‰ˆæœ¬è¡çªã€éƒ¨åˆ†è³‡æ–™ç¼ºå¤±
- **ä½¿ç”¨è€…é«”é©—**: æ¸…æ¥šå±•ç¤ºè¡çªçš„è³‡æ–™é …ç›®ï¼Œæä¾›ä¿ç•™é¸é …å’Œåˆä½µå»ºè­°
- **æŠ€è¡“è™•ç†**: DataConflictException â†’ è¡çªåˆ†æ â†’ é¸æ“‡ä»‹é¢
- **é æœŸæ“ä½œ**: äº’å‹•å¼è¡çªè§£æ±ºã€è³‡æ–™å‚™ä»½ç¢ºèªã€åˆä½µç­–ç•¥é¸æ“‡

*å ´æ™¯2.2: åŒæ­¥è¶…æ™‚*
- **ç•°å¸¸æƒ…å¢ƒ**: å¤§é‡è³‡æ–™åŒæ­¥è¶…æ™‚ã€ç¶²è·¯ä¸ç©©å®šå°è‡´ä¸­æ–·
- **ä½¿ç”¨è€…é«”é©—**: é¡¯ç¤ºåŒæ­¥é€²åº¦ã€æä¾›æš«åœ/æ¢å¾©é¸é …ã€ä¼°ç®—å‰©é¤˜æ™‚é–“
- **æŠ€è¡“è™•ç†**: SyncTimeoutException â†’ é€²åº¦ä¿å­˜ â†’ æ–·é»çºŒå‚³
- **é æœŸæ“ä½œ**: åˆ†æ‰¹åŒæ­¥å»ºè­°ã€ç¶²è·¯æª¢æ¸¬ã€æ‰‹å‹•é‡è©¦é¸é …

**éšæ®µ3: æ›´æ–°éšæ®µç•°å¸¸å ´æ™¯**

*å ´æ™¯3.1: è³‡æ–™é©—è­‰å¤±æ•—*
- **ç•°å¸¸æƒ…å¢ƒ**: æ›¸ç±è³‡è¨Šä¸å®Œæ•´ã€æ ¼å¼éŒ¯èª¤ã€å¿…è¦æ¬„ä½ç¼ºå¤±
- **ä½¿ç”¨è€…é«”é©—**: é«˜äº®é¡¯ç¤ºéŒ¯èª¤æ¬„ä½ã€æä¾›æ ¼å¼ç¯„ä¾‹ã€å»ºè­°é è¨­å€¼
- **æŠ€è¡“è™•ç†**: ValidationException â†’ æ¬„ä½æª¢æŸ¥ â†’ ä¿®æ­£å»ºè­°
- **é æœŸæ“ä½œ**: æ™ºæ…§å‹æ¬„ä½è£œå…¨ã€æ ¼å¼è½‰æ›å·¥å…·ã€è·³ééå¿…è¦æ¬„ä½

*å ´æ™¯3.2: æ‰¹æ¬¡æ›´æ–°å¤±æ•—*
- **ç•°å¸¸æƒ…å¢ƒ**: éƒ¨åˆ†æ›¸ç±æ›´æ–°å¤±æ•—ã€è³‡æ–™åº«å¯«å…¥éŒ¯èª¤
- **ä½¿ç”¨è€…é«”é©—**: é¡¯ç¤ºæˆåŠŸ/å¤±æ•—çµ±è¨ˆã€åˆ—å‡ºå¤±æ•—é …ç›®ã€æä¾›é‡è©¦é¸é …
- **æŠ€è¡“è™•ç†**: BatchUpdateException â†’ çµæœåˆ†æ â†’ é¸æ“‡æ€§é‡è©¦
- **é æœŸæ“ä½œ**: é€é …æª¢è¦–å¤±æ•—åŸå› ã€æ‰¹æ¬¡é‡è©¦ã€åŒ¯å‡ºéŒ¯èª¤å ±å‘Š

**éšæ®µ4: åˆ†é¡éšæ®µç•°å¸¸å ´æ™¯**

*å ´æ™¯4.1: åˆ†é¡è¦å‰‡è¡çª*
- **ç•°å¸¸æƒ…å¢ƒ**: åˆ†é¡æ¨™ç±¤é‡è¤‡ã€è¦å‰‡é‚è¼¯çŸ›ç›¾ã€åˆ†é¡ç³»çµ±ç•°å¸¸
- **ä½¿ç”¨è€…é«”é©—**: è¦–è¦ºåŒ–è¦å‰‡è¡çªã€æä¾›è¦å‰‡ç·¨è¼¯ç•Œé¢ã€å»ºè­°è§£æ±ºæ–¹æ¡ˆ
- **æŠ€è¡“è™•ç†**: ClassificationException â†’ è¦å‰‡åˆ†æ â†’ è¡çªè§£æ±º
- **é æœŸæ“ä½œ**: è¦å‰‡é‡æ–°å®šç¾©ã€æ¨™ç±¤åˆä½µã€åˆ†é¡ç³»çµ±é‡è¨­

*å ´æ™¯4.2: è‡ªå‹•åˆ†é¡å¤±æ•—*
- **ç•°å¸¸æƒ…å¢ƒ**: åˆ†é¡æ¼”ç®—æ³•å¤±æ•ˆã€æ›¸ç±è³‡è¨Šä¸è¶³ä»¥åˆ†é¡
- **ä½¿ç”¨è€…é«”é©—**: æä¾›æ‰‹å‹•åˆ†é¡é¸é …ã€é¡¯ç¤ºç›¸ä¼¼æ›¸ç±åƒè€ƒã€åˆ†é¡å»ºè­°
- **æŠ€è¡“è™•ç†**: AutoClassificationException â†’ æ‰‹å‹•ä»‹å…¥ â†’ å­¸ç¿’æ©Ÿåˆ¶
- **é æœŸæ“ä½œ**: æ‰‹å‹•åˆ†é¡ç•Œé¢ã€ç›¸ä¼¼æ›¸ç±æ¯”å°ã€åˆ†é¡è¦å‰‡è¨“ç·´

**éšæ®µ5: åŒ¯å‡ºéšæ®µç•°å¸¸å ´æ™¯**

*å ´æ™¯5.1: åŒ¯å‡ºæ ¼å¼ä¸æ”¯æ´*
- **ç•°å¸¸æƒ…å¢ƒ**: é¸æ“‡çš„æª”æ¡ˆæ ¼å¼ä¸æ”¯æ´ã€æ ¼å¼è½‰æ›å¤±æ•—
- **ä½¿ç”¨è€…é«”é©—**: é¡¯ç¤ºæ”¯æ´æ ¼å¼æ¸…å–®ã€æä¾›æ ¼å¼é è¦½ã€è½‰æ›å»ºè­°
- **æŠ€è¡“è™•ç†**: ExportFormatException â†’ æ ¼å¼æª¢æŸ¥ â†’ æ›¿ä»£æ–¹æ¡ˆ
- **é æœŸæ“ä½œ**: æ ¼å¼é¸æ“‡å™¨ã€é è¦½åŠŸèƒ½ã€è½‰æ›å·¥å…·æ¨è–¦

*å ´æ™¯5.2: å„²å­˜ç©ºé–“ä¸è¶³*
- **ç•°å¸¸æƒ…å¢ƒ**: æœ¬åœ°å„²å­˜ç©ºé–“ä¸è¶³ã€æª”æ¡ˆæ¬Šé™å•é¡Œ
- **ä½¿ç”¨è€…é«”é©—**: é¡¯ç¤ºç©ºé–“ä½¿ç”¨æƒ…æ³ã€å»ºè­°æ¸…ç†æ–¹æ¡ˆã€æä¾›é›²ç«¯é¸é …
- **æŠ€è¡“è™•ç†**: StorageException â†’ ç©ºé–“åˆ†æ â†’ å„²å­˜ç­–ç•¥
- **é æœŸæ“ä½œ**: ç©ºé–“æ¸…ç†å·¥å…·ã€å£“ç¸®é¸é …ã€é›²ç«¯å„²å­˜æ•´åˆ

#### æœŸæœ›æ•ˆæœèˆ‡æˆåŠŸæ¨™æº–

**ä½¿ç”¨è€…é«”é©—æå‡**ï¼š
- éŒ¯èª¤è¨Šæ¯æ¸…æ™°åº¦æå‡ 200% (å¾æŠ€è¡“éŒ¯èª¤è½‰ç‚ºæ“ä½œæŒ‡å¼•)
- å•é¡Œè§£æ±ºæˆåŠŸç‡æå‡ 150% (æä¾›å…·é«”è§£æ±ºæ­¥é©Ÿ)
- ä½¿ç”¨è€…æ»¿æ„åº¦æå‡ 80% (å‹å–„çš„éŒ¯èª¤è™•ç†é«”é©—)
- å®¢æœè«®è©¢æ¸›å°‘ 60% (è‡ªåŠ©è§£æ±ºèƒ½åŠ›æå‡)

**ç³»çµ±ç©©å®šæ€§æå‡**ï¼š
- ç•°å¸¸æ¢å¾©æˆåŠŸç‡é”åˆ° 95%
- è³‡æ–™å®Œæ•´æ€§ä¿è­‰é”åˆ° 99.9%
- ç³»çµ±å¯ç”¨æ€§æå‡è‡³ 99.5%
- éŒ¯èª¤è™•ç†è¦†è“‹ç‡é”åˆ° 100%

**é–‹ç™¼ç¶­è­·æ•ˆç‡**ï¼š
- éŒ¯èª¤è™•ç†é–‹ç™¼æ™‚é–“æ¸›å°‘ 50%
- Bugä¿®å¾©æ™‚é–“æ¸›å°‘ 40%
- æ–°åŠŸèƒ½æ•´åˆæ™‚é–“æ¸›å°‘ 30%
- ç¶­è­·æˆæœ¬é™ä½ 45%

### 2. åŠŸèƒ½è¦æ ¼è¨­è¨ˆéšæ®µ âœ…

#### éšæ®µ1 (v1.0) - åŸºç¤éŒ¯èª¤è™•ç†æ¶æ§‹

**æ ¸å¿ƒçµ„ä»¶è¨­è¨ˆ**ï¼š

```javascript
// 1. çµ±ä¸€éŒ¯èª¤åŸºç¤é¡åˆ¥
class SimpleError {
  constructor(code, type, message, context = {}) {
    this.code = code                    // æ¨™æº–éŒ¯èª¤ä»£ç¢¼
    this.type = type                    // éŒ¯èª¤é¡å‹æšèˆ‰
    this.message = message              // ä½¿ç”¨è€…å‹å–„è¨Šæ¯
    this.timestamp = Date.now()         // ç™¼ç”Ÿæ™‚é–“
    this.context = context              // ä¸Šä¸‹æ–‡è³‡è¨Š
    this.severity = this.calculateSeverity(type) // åš´é‡ç¨‹åº¦
    this.retryable = this.isRetryable(type)      // æ˜¯å¦å¯é‡è©¦
    this.id = this.generateErrorId()            // å”¯ä¸€è­˜åˆ¥
  }
  
  // å»ºç«‹éŒ¯èª¤éˆ
  withCause(cause) {
    this.cause = cause
    return this
  }
  
  // æ·»åŠ ä¸Šä¸‹æ–‡
  addContext(key, value) {
    this.context[key] = value
    return this
  }
  
  // åºåˆ—åŒ–ç‚ºè¼•é‡ç´šæ ¼å¼
  toJSON() {
    return {
      code: this.code,
      type: this.type,
      message: this.message,
      severity: this.severity,
      retryable: this.retryable,
      timestamp: this.timestamp,
      context: this.sanitizeContext(this.context)
    }
  }
}

// 2. æ¨™æº–åŒ–æ“ä½œçµæœ
class OperationResult {
  constructor(success, data = null, error = null, metadata = {}) {
    this.success = success
    this.data = data
    this.error = error
    this.metadata = {
      timestamp: Date.now(),
      version: '0.10.11',
      requestId: this.generateRequestId(),
      ...metadata
    }
  }
  
  static success(data, metadata = {}) {
    return new OperationResult(true, data, null, metadata)
  }
  
  static failure(error, metadata = {}) {
    return new OperationResult(false, null, error, metadata)
  }
  
  // éŒ¯èª¤æ¢å¾©å˜—è©¦
  async attemptRecovery(recoveryStrategy) {
    if (!this.error || !this.error.retryable) {
      return this
    }
    
    try {
      const recoveredData = await recoveryStrategy.execute(this.error)
      return OperationResult.success(recoveredData, {
        recovered: true,
        originalError: this.error.code
      })
    } catch (recoveryError) {
      return OperationResult.failure(
        new SimpleError('RECOVERY_FAILED', 'SYSTEM_ERROR', 'æ¢å¾©å˜—è©¦å¤±æ•—')
          .withCause(this.error)
          .addContext('recoveryAttempt', recoveryError.message)
      )
    }
  }
}

// 3. è¨Šæ¯å­—å…¸ç®¡ç†ç³»çµ±
class MessageDictionary {
  constructor() {
    this.messages = new Map()
    this.fallbackLanguage = 'zh-TW'
    this.currentLanguage = 'zh-TW'
    this.loadDefaultMessages()
  }
  
  // è¼‰å…¥é è¨­è¨Šæ¯
  loadDefaultMessages() {
    // åŸºç¤éŒ¯èª¤è¨Šæ¯
    this.addCategory('ERRORS', {
      NETWORK_FAILED: 'ç¶²è·¯é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥æ‚¨çš„ç¶²è·¯ç‹€æ…‹',
      VALIDATION_FAILED: 'è³‡æ–™é©—è­‰å¤±æ•—ï¼Œè«‹æª¢æŸ¥è¼¸å…¥å…§å®¹',
      STORAGE_FULL: 'å„²å­˜ç©ºé–“ä¸è¶³ï¼Œè«‹æ¸…ç†éƒ¨åˆ†æª”æ¡ˆ',
      PERMISSION_DENIED: 'æ¬Šé™ä¸è¶³ï¼Œè«‹ç¢ºèªç€è¦½å™¨æ¬Šé™è¨­å®š',
      PLATFORM_CHANGED: 'å¹³å°æ ¼å¼å¯èƒ½å·²æ›´æ–°ï¼Œå»ºè­°è¯ç¹«æŠ€è¡“æ”¯æ´',
      DATA_CONFLICT: 'è³‡æ–™è¡çªï¼Œéœ€è¦æ‚¨é¸æ“‡ä¿ç•™çš„ç‰ˆæœ¬',
      SYNC_TIMEOUT: 'åŒæ­¥è¶…æ™‚ï¼Œå»ºè­°åˆ†æ‰¹è™•ç†æˆ–æª¢æŸ¥ç¶²è·¯'
    })
    
    // ä½¿ç”¨è€…æ“ä½œæŒ‡å¼•
    this.addCategory('USER_GUIDES', {
      RETRY_OPERATION: 'æ‚¨å¯ä»¥é»æ“Šã€Œé‡è©¦ã€æŒ‰éˆ•ï¼Œæˆ–ç¨å¾Œå†è©¦',
      CHECK_NETWORK: 'è«‹æª¢æŸ¥ç¶²è·¯é€£ç·šï¼Œç¢ºèªå¯ä»¥æ­£å¸¸è¨ªå•æ›¸åº«ç¶²ç«™',
      CONTACT_SUPPORT: 'å¦‚å•é¡ŒæŒçºŒç™¼ç”Ÿï¼Œè«‹é€éè¨­å®šé é¢è¯ç¹«æŠ€è¡“æ”¯æ´',
      BACKUP_DATA: 'å»ºè­°å…ˆå‚™ä»½æ‚¨çš„è³‡æ–™ï¼Œé¿å…è³‡æ–™éºå¤±',
      CLEAR_CACHE: 'å˜—è©¦æ¸…é™¤ç€è¦½å™¨å¿«å–ï¼Œç„¶å¾Œé‡æ–°è¼‰å…¥',
      UPDATE_PERMISSIONS: 'è«‹åœ¨Chromeè¨­å®šä¸­ç¢ºèªæ“´å……åŠŸèƒ½æ¬Šé™',
      DIVIDE_BATCH: 'è³‡æ–™é‡è¼ƒå¤§æ™‚ï¼Œå»ºè­°åˆ†æ‰¹è™•ç†ä»¥æé«˜æˆåŠŸç‡'
    })
    
    // éšæ®µç‰¹å®šè¨Šæ¯
    this.addCategory('STAGE_MESSAGES', {
      EXTRACTION_START: 'é–‹å§‹æ“·å–æ›¸åº«è³‡æ–™...',
      EXTRACTION_PROGRESS: 'å·²æ“·å– {count} æœ¬æ›¸ç±ï¼Œå…± {total} æœ¬',
      SYNC_START: 'é–‹å§‹åŒæ­¥è³‡æ–™...',
      SYNC_CONFLICT: 'ç™¼ç¾ {count} é …è³‡æ–™è¡çªï¼Œéœ€è¦æ‚¨çš„ç¢ºèª',
      UPDATE_BATCH: 'æ­£åœ¨æ›´æ–° {count} æœ¬æ›¸ç±çš„è³‡è¨Š',
      CLASSIFICATION_AUTO: 'è‡ªå‹•åˆ†é¡ {success} æœ¬æˆåŠŸï¼Œ{failed} æœ¬éœ€è¦æ‰‹å‹•è™•ç†',
      EXPORT_FORMAT: 'æ­£åœ¨å°‡è³‡æ–™åŒ¯å‡ºç‚º {format} æ ¼å¼'
    })
  }
  
  // æ–°å¢è¨Šæ¯åˆ†é¡
  addCategory(categoryName, messages) {
    if (!this.messages.has(categoryName)) {
      this.messages.set(categoryName, new Map())
    }
    
    const category = this.messages.get(categoryName)
    Object.entries(messages).forEach(([key, message]) => {
      category.set(key, message)
    })
  }
  
  // å–å¾—è¨Šæ¯
  get(category, key, params = {}) {
    const categoryMap = this.messages.get(category)
    if (!categoryMap) {
      return `[Missing Category: ${category}]`
    }
    
    let message = categoryMap.get(key)
    if (!message) {
      return `[Missing Message: ${category}.${key}]`
    }
    
    // åƒæ•¸æ’å€¼
    return this.interpolateParams(message, params)
  }
  
  // åƒæ•¸æ’å€¼
  interpolateParams(template, params) {
    return template.replace(/\{(\w+)\}/g, (match, key) => {
      return params[key] !== undefined ? params[key] : match
    })
  }
}
```

**æ“´å±•é ç•™ä»‹é¢** (ç‚º2.0éšæ®µæº–å‚™)ï¼š

```javascript
// Exceptioné«”ç³»åŸºç¤ä»‹é¢
class BaseException extends SimpleError {
  constructor(code, type, message, context = {}) {
    super(code, type, message, context)
    this.stage = null           // æ›¸åº«ç®¡ç†éšæ®µ
    this.userGuidance = null    // ä½¿ç”¨è€…æŒ‡å¼•
    this.recoveryStrategies = []  // æ¢å¾©ç­–ç•¥
    this.affectedOperations = []  // å½±éŸ¿çš„æ“ä½œ
  }
  
  // é ç•™çµ¦2.0éšæ®µçš„ä½¿ç”¨è€…æŒ‡å¼•ä»‹é¢
  generateUserGuidance() {
    // 2.0éšæ®µå¯¦ç¾
    return {
      problem: this.getUserProblemDescription(),
      causes: this.getPossibleCauses(),
      solutions: this.getSuggestedSolutions(),
      alternatives: this.getAlternatives(),
      helpResources: this.getHelpResources()
    }
  }
  
  // é ç•™çµ¦2.0éšæ®µçš„æ¢å¾©ç­–ç•¥ä»‹é¢
  getRecoveryStrategies() {
    // 2.0éšæ®µå¯¦ç¾
    return this.recoveryStrategies
  }
}

// ä½¿ç”¨è€…æç¤ºç³»çµ±åŸºç¤ä»‹é¢
class UserPromptSystem {
  constructor(messageDict) {
    this.messageDict = messageDict
    this.promptQueue = []
    this.activePrompts = new Map()
  }
  
  // é ç•™çµ¦2.0éšæ®µçš„æç¤ºç”Ÿæˆä»‹é¢
  generatePrompt(exception, uiContext) {
    // 2.0éšæ®µå¯¦ç¾å®Œæ•´çš„ä½¿ç”¨è€…æç¤ºç”Ÿæˆ
    return {
      type: 'error_prompt',
      content: this.createPromptContent(exception),
      actions: this.createPromptActions(exception),
      display: this.createDisplayOptions(exception, uiContext)
    }
  }
}
```

#### éšæ®µ2 (v2.0) - å®Œæ•´Exceptionæ©Ÿåˆ¶è¨­è¨ˆ

**äº”éšæ®µæ¥­å‹™ç•°å¸¸é«”ç³»**ï¼š

```javascript
// æ“·å–éšæ®µç•°å¸¸
class ExtractionStageException extends BaseException {
  constructor(code, context = {}) {
    super(code, 'EXTRACTION_ERROR', '', context)
    this.stage = 'EXTRACTION'
    this.platform = context.platform || 'unknown'
    this.extractionType = context.extractionType || 'books'
  }
}

class PlatformConnectionException extends ExtractionStageException {
  constructor(platform, reason, context = {}) {
    super('PLATFORM_CONNECTION_FAILED', { platform, reason, ...context })
    this.message = `ç„¡æ³•é€£æ¥åˆ°${platform}ï¼ŒåŸå› ï¼š${reason}`
    this.userGuidance = {
      problem: `èˆ‡${platform}çš„é€£ç·šä¸­æ–·`,
      causes: [
        'ç™»å…¥é©—è­‰å·²éæœŸ',
        'ç¶²è·¯é€£ç·šä¸ç©©å®š',
        'å¹³å°æš«æ™‚ç¶­è­·ä¸­',
        'ç€è¦½å™¨æ¬Šé™é™åˆ¶'
      ],
      solutions: [
        { action: 'reauth', label: 'é‡æ–°ç™»å…¥', priority: 'high' },
        { action: 'checkNetwork', label: 'æª¢æŸ¥ç¶²è·¯ç‹€æ…‹', priority: 'medium' },
        { action: 'retryLater', label: 'ç¨å¾Œé‡è©¦', priority: 'medium' },
        { action: 'contactSupport', label: 'è¯ç¹«æŠ€è¡“æ”¯æ´', priority: 'low' }
      ],
      alternatives: [
        'ä½¿ç”¨åŒ¯å…¥åŠŸèƒ½æ‰‹å‹•åŠ å…¥æ›¸ç±',
        'ç­‰å¾…å¹³å°æ¢å¾©å¾Œå†é€²è¡Œæ“·å–'
      ]
    }
  }
}

class DataFormatException extends ExtractionStageException {
  constructor(expectedFormat, actualFormat, context = {}) {
    super('DATA_FORMAT_CHANGED', { expectedFormat, actualFormat, ...context })
    this.message = `è³‡æ–™æ ¼å¼ä¸ç¬¦é æœŸï¼Œå¯èƒ½å¹³å°å·²æ›´æ–°`
    this.userGuidance = {
      problem: 'å¹³å°è³‡æ–™æ ¼å¼ç™¼ç”Ÿè®ŠåŒ–',
      causes: [
        'æ›¸åº«å¹³å°é€²è¡Œäº†ç³»çµ±æ›´æ–°',
        'APIä»‹é¢æ”¹ç‰ˆ',
        'è³‡æ–™çµæ§‹èª¿æ•´'
      ],
      solutions: [
        { action: 'updateExtension', label: 'æª¢æŸ¥æ“´å……åŠŸèƒ½æ›´æ–°', priority: 'high' },
        { action: 'reportFormat', label: 'å›å ±æ ¼å¼å•é¡Œ', priority: 'high' },
        { action: 'useBackup', label: 'ä½¿ç”¨å‚™ä»½è³‡æ–™', priority: 'medium' }
      ],
      alternatives: [
        'æ‰‹å‹•æ•´ç†æ›¸åº«è³‡æ–™',
        'ç­‰å¾…ç›¸å®¹æ€§æ›´æ–°'
      ]
    }
  }
}

// åŒæ­¥éšæ®µç•°å¸¸
class SyncStageException extends BaseException {
  constructor(code, context = {}) {
    super(code, 'SYNC_ERROR', '', context)
    this.stage = 'SYNC'
    this.syncType = context.syncType || 'full'
    this.conflictCount = context.conflictCount || 0
  }
}

class DataConflictException extends SyncStageException {
  constructor(conflicts, context = {}) {
    super('DATA_CONFLICT_DETECTED', { conflicts, conflictCount: conflicts.length, ...context })
    this.message = `ç™¼ç¾ ${conflicts.length} é …è³‡æ–™è¡çªï¼Œéœ€è¦æ‚¨çš„é¸æ“‡`
    this.conflicts = conflicts
    this.userGuidance = {
      problem: `æœ¬åœ°è³‡æ–™èˆ‡é›²ç«¯è³‡æ–™å­˜åœ¨å·®ç•°`,
      causes: [
        'åœ¨å¤šå€‹è£ç½®ä¸Šé€²è¡Œäº†ä¸åŒçš„ä¿®æ”¹',
        'åŒæ­¥éç¨‹ä¸­ç™¼ç”Ÿä¸­æ–·',
        'è³‡æ–™ç‰ˆæœ¬ä¸ä¸€è‡´'
      ],
      solutions: [
        { action: 'reviewConflicts', label: 'é€é …æª¢è¦–è¡çª', priority: 'high' },
        { action: 'keepLocal', label: 'ä¿ç•™æœ¬åœ°ç‰ˆæœ¬', priority: 'medium' },
        { action: 'keepRemote', label: 'ä¿ç•™é›²ç«¯ç‰ˆæœ¬', priority: 'medium' },
        { action: 'manualMerge', label: 'æ‰‹å‹•åˆä½µ', priority: 'high' }
      ],
      alternatives: [
        'å‚™ä»½ç›®å‰è³‡æ–™å¾Œé‡æ–°åŒæ­¥',
        'åˆ†æ‰¹è™•ç†è¡çªé …ç›®'
      ]
    }
  }
}

// æ›´æ–°éšæ®µç•°å¸¸
class UpdateStageException extends BaseException {
  constructor(code, context = {}) {
    super(code, 'UPDATE_ERROR', '', context)
    this.stage = 'UPDATE'
    this.updateType = context.updateType || 'batch'
    this.affectedCount = context.affectedCount || 0
  }
}

class ValidationException extends UpdateStageException {
  constructor(field, value, rule, context = {}) {
    super('VALIDATION_FAILED', { field, value, rule, ...context })
    this.message = `æ¬„ä½ ${field} é©—è­‰å¤±æ•—ï¼š${rule}`
    this.userGuidance = {
      problem: `æ›¸ç±è³‡æ–™ä¸ç¬¦åˆæ ¼å¼è¦æ±‚`,
      causes: [
        'å¿…è¦è³‡è¨Šç¼ºå¤±',
        'è³‡æ–™æ ¼å¼éŒ¯èª¤',
        'å…§å®¹é•·åº¦è¶…å‡ºé™åˆ¶'
      ],
      solutions: [
        { action: 'fixField', label: `ä¿®æ­£ ${field} æ¬„ä½`, priority: 'high' },
        { action: 'useDefault', label: 'ä½¿ç”¨é è¨­å€¼', priority: 'medium' },
        { action: 'skipField', label: 'è·³éæ­¤æ¬„ä½', priority: 'low' }
      ],
      alternatives: [
        'æ‰¹æ¬¡ä¿®æ­£ç›¸ä¼¼éŒ¯èª¤',
        'åŒ¯å…¥æ­£ç¢ºæ ¼å¼ç¯„æœ¬'
      ]
    }
  }
}

// åˆ†é¡éšæ®µç•°å¸¸
class ClassificationStageException extends BaseException {
  constructor(code, context = {}) {
    super(code, 'CLASSIFICATION_ERROR', '', context)
    this.stage = 'CLASSIFICATION'
    this.classificationMethod = context.method || 'auto'
  }
}

class ClassificationRuleException extends ClassificationStageException {
  constructor(rule, conflict, context = {}) {
    super('CLASSIFICATION_RULE_CONFLICT', { rule, conflict, ...context })
    this.message = `åˆ†é¡è¦å‰‡è¡çªï¼š${rule} èˆ‡ ${conflict}`
    this.userGuidance = {
      problem: 'åˆ†é¡è¦å‰‡å­˜åœ¨é‚è¼¯è¡çª',
      causes: [
        'è¦å‰‡å®šç¾©é‡è¤‡æˆ–çŸ›ç›¾',
        'æ¨™ç±¤åˆ†é¡äº¤å‰é‡ç–Š',
        'è‡ªå‹•åˆ†é¡çµæœä¸æ˜ç¢º'
      ],
      solutions: [
        { action: 'editRule', label: 'ç·¨è¼¯åˆ†é¡è¦å‰‡', priority: 'high' },
        { action: 'mergeRules', label: 'åˆä½µé‡è¤‡è¦å‰‡', priority: 'medium' },
        { action: 'manualClassify', label: 'æ‰‹å‹•åˆ†é¡', priority: 'medium' }
      ],
      alternatives: [
        'é‡æ–°è¨­è¨ˆåˆ†é¡é«”ç³»',
        'ä½¿ç”¨é è¨­åˆ†é¡æ–¹æ¡ˆ'
      ]
    }
  }
}

// åŒ¯å‡ºéšæ®µç•°å¸¸  
class ExportStageException extends BaseException {
  constructor(code, context = {}) {
    super(code, 'EXPORT_ERROR', '', context)
    this.stage = 'EXPORT'
    this.exportFormat = context.format || 'json'
    this.exportSize = context.size || 0
  }
}

class ExportFormatException extends ExportStageException {
  constructor(requestedFormat, availableFormats, context = {}) {
    super('EXPORT_FORMAT_UNSUPPORTED', { requestedFormat, availableFormats, ...context })
    this.message = `ä¸æ”¯æ´ ${requestedFormat} æ ¼å¼ï¼Œå¯ç”¨æ ¼å¼ï¼š${availableFormats.join(', ')}`
    this.userGuidance = {
      problem: `åŒ¯å‡ºæ ¼å¼ä¸å—æ”¯æ´`,
      causes: [
        'é¸æ“‡äº†æœªå¯¦ä½œçš„æ ¼å¼',
        'æ ¼å¼è½‰æ›å™¨ç¼ºå¤±',
        'è³‡æ–™é‡è¶…å‡ºæ ¼å¼é™åˆ¶'
      ],
      solutions: [
        { action: 'changeFormat', label: 'é¸æ“‡å…¶ä»–æ ¼å¼', priority: 'high' },
        { action: 'splitExport', label: 'åˆ†æ‰¹åŒ¯å‡º', priority: 'medium' },
        { action: 'customExport', label: 'è‡ªå®šç¾©åŒ¯å‡º', priority: 'low' }
      ],
      alternatives: [
        'ä½¿ç”¨ç¬¬ä¸‰æ–¹è½‰æ›å·¥å…·',
        'ç›´æ¥è¤‡è£½è³‡æ–™åˆ°å‰ªè²¼ç°¿'
      ]
    }
  }
}

class StorageQuotaException extends ExportStageException {
  constructor(required, available, context = {}) {
    super('STORAGE_QUOTA_EXCEEDED', { required, available, ...context })
    this.message = `å„²å­˜ç©ºé–“ä¸è¶³ï¼Œéœ€è¦ ${required}MBï¼Œå¯ç”¨ ${available}MB`
    this.userGuidance = {
      problem: 'æœ¬åœ°å„²å­˜ç©ºé–“ä¸è¶³',
      causes: [
        'æª”æ¡ˆé«”ç©éå¤§',
        'ç³»çµ±å‰©é¤˜ç©ºé–“ä¸è¶³',
        'ç€è¦½å™¨å„²å­˜é…é¡é™åˆ¶'
      ],
      solutions: [
        { action: 'cleanStorage', label: 'æ¸…ç†å„²å­˜ç©ºé–“', priority: 'high' },
        { action: 'compressExport', label: 'å£“ç¸®åŒ¯å‡ºæª”æ¡ˆ', priority: 'high' },
        { action: 'cloudExport', label: 'åŒ¯å‡ºåˆ°é›²ç«¯', priority: 'medium' }
      ],
      alternatives: [
        'é¸æ“‡è¼ƒå°çš„åŒ¯å‡ºç¯„åœ',
        'ä½¿ç”¨å¤–éƒ¨å„²å­˜è£ç½®'
      ]
    }
  }
}
```

**ä½¿ç”¨è€…æç¤ºå¼•æ“è¨­è¨ˆ**ï¼š

```javascript
class UserPromptEngine {
  constructor(messageDict, uiManager) {
    this.messageDict = messageDict
    this.uiManager = uiManager
    this.promptTemplates = new Map()
    this.activePrompts = new Map()
    this.promptHistory = []
    this.setupPromptTemplates()
  }
  
  // å»ºç«‹æç¤ºç¯„æœ¬
  setupPromptTemplates() {
    // éŒ¯èª¤æç¤ºç¯„æœ¬
    this.promptTemplates.set('error', {
      title: 'ç™¼ç”Ÿå•é¡Œ',
      icon: 'error',
      structure: ['problem', 'causes', 'solutions', 'alternatives'],
      actionTypes: ['primary', 'secondary', 'tertiary'],
      displayDuration: 0, // ä¸è‡ªå‹•é—œé–‰
      dismissible: false,
      accessibility: true
    })
    
    // ç¢ºèªæç¤ºç¯„æœ¬
    this.promptTemplates.set('confirmation', {
      title: 'ç¢ºèªæ“ä½œ',
      icon: 'question',
      structure: ['description', 'consequences', 'options'],
      actionTypes: ['confirm', 'cancel'],
      displayDuration: 0,
      dismissible: true,
      accessibility: true
    })
    
    // é€²åº¦æç¤ºç¯„æœ¬
    this.promptTemplates.set('progress', {
      title: 'è™•ç†ä¸­',
      icon: 'progress',
      structure: ['status', 'progress', 'estimate'],
      actionTypes: ['pause', 'cancel'],
      displayDuration: -1, // æ‰‹å‹•æ§åˆ¶é—œé–‰
      dismissible: false,
      accessibility: true
    })
  }
  
  // æ ¹æ“šç•°å¸¸ç”Ÿæˆä½¿ç”¨è€…æç¤º
  generatePrompt(exception, uiContext = {}) {
    const template = this.promptTemplates.get('error')
    const guidance = exception.generateUserGuidance()
    
    const prompt = {
      id: this.generatePromptId(),
      type: 'error',
      template,
      content: {
        title: this.getLocalizedTitle(exception),
        problem: guidance.problem,
        causes: guidance.causes,
        icon: this.getErrorIcon(exception.severity)
      },
      actions: this.createPromptActions(guidance.solutions, exception),
      alternatives: guidance.alternatives,
      metadata: {
        errorCode: exception.code,
        stage: exception.stage,
        timestamp: Date.now(),
        context: uiContext
      },
      accessibility: {
        ariaLabel: `éŒ¯èª¤ï¼š${guidance.problem}`,
        description: guidance.causes.join('ï¼Œ'),
        keyboardNav: true,
        screenReader: true
      }
    }
    
    return prompt
  }
  
  // å»ºç«‹æç¤ºå‹•ä½œ
  createPromptActions(solutions, exception) {
    return solutions.map(solution => ({
      id: `action_${solution.action}`,
      label: solution.label,
      priority: solution.priority,
      handler: () => this.executeAction(solution.action, exception),
      keyboard: this.getKeyboardShortcut(solution.action),
      accessibility: {
        description: `åŸ·è¡Œï¼š${solution.label}`,
        shortcut: this.getKeyboardShortcut(solution.action)
      }
    }))
  }
  
  // åŸ·è¡Œä½¿ç”¨è€…å‹•ä½œ
  async executeAction(action, exception) {
    const actionHandlers = {
      reauth: () => this.handleReAuthentication(exception),
      checkNetwork: () => this.handleNetworkCheck(exception),
      retryOperation: () => this.handleRetry(exception),
      editRule: () => this.handleRuleEdit(exception),
      reviewConflicts: () => this.handleConflictReview(exception),
      changeFormat: () => this.handleFormatChange(exception),
      cleanStorage: () => this.handleStorageCleanup(exception),
      contactSupport: () => this.handleSupportContact(exception)
    }
    
    const handler = actionHandlers[action]
    if (handler) {
      try {
        const result = await handler()
        this.recordActionResult(action, exception, result)
        return result
      } catch (actionError) {
        console.error(`Action ${action} failed:`, actionError)
        return { success: false, error: actionError }
      }
    }
    
    return { success: false, error: 'Unknown action' }
  }
  
  // é‡æ–°èªè­‰è™•ç†
  async handleReAuthentication(exception) {
    return {
      success: true,
      action: 'redirect',
      url: this.getPlatformAuthUrl(exception.platform),
      message: 'æ­£åœ¨è·³è½‰åˆ°ç™»å…¥é é¢...'
    }
  }
  
  // ç¶²è·¯æª¢æŸ¥è™•ç†
  async handleNetworkCheck(exception) {
    const networkStatus = await this.checkNetworkConnectivity()
    if (networkStatus.online) {
      return {
        success: true,
        action: 'retry_suggested',
        message: 'ç¶²è·¯é€£ç·šæ­£å¸¸ï¼Œå»ºè­°é‡è©¦æ“ä½œ'
      }
    } else {
      return {
        success: false,
        action: 'wait_network',
        message: 'ç¶²è·¯é€£ç·šç•°å¸¸ï¼Œè«‹æª¢æŸ¥å¾Œé‡è©¦'
      }
    }
  }
  
  // è¡çªæª¢è¦–è™•ç†
  async handleConflictReview(exception) {
    const conflicts = exception.conflicts || []
    return {
      success: true,
      action: 'open_conflict_resolver',
      data: conflicts,
      message: `æº–å‚™æª¢è¦– ${conflicts.length} é …è¡çª`
    }
  }
}
```

#### Chrome Extensionæ•´åˆè¨­è¨ˆ

**Popup UIç•°å¸¸å±•ç¤ºç³»çµ±**ï¼š

```javascript
class PopupErrorDisplayManager {
  constructor(promptEngine) {
    this.promptEngine = promptEngine
    this.container = null
    this.activeDisplay = null
    this.displayQueue = []
    this.initialize()
  }
  
  initialize() {
    this.createErrorDisplayContainer()
    this.setupKeyboardHandlers()
    this.setupAccessibilityFeatures()
  }
  
  // å»ºç«‹éŒ¯èª¤é¡¯ç¤ºå®¹å™¨
  createErrorDisplayContainer() {
    this.container = document.createElement('div')
    this.container.id = 'error-display-container'
    this.container.className = 'error-display-container'
    this.container.setAttribute('role', 'alert')
    this.container.setAttribute('aria-live', 'assertive')
    
    // æ’å…¥åˆ° popup çš„é©ç•¶ä½ç½®
    const popupBody = document.getElementById('popup-body')
    if (popupBody) {
      popupBody.insertBefore(this.container, popupBody.firstChild)
    }
  }
  
  // é¡¯ç¤ºéŒ¯èª¤æç¤º
  async displayError(exception, uiContext = {}) {
    const prompt = this.promptEngine.generatePrompt(exception, uiContext)
    
    // å¦‚æœæœ‰æ´»èºé¡¯ç¤ºï¼ŒåŠ å…¥ä½‡åˆ—
    if (this.activeDisplay) {
      this.displayQueue.push(prompt)
      return
    }
    
    this.activeDisplay = prompt
    await this.renderErrorDisplay(prompt)
  }
  
  // æ¸²æŸ“éŒ¯èª¤é¡¯ç¤º
  async renderErrorDisplay(prompt) {
    const displayElement = document.createElement('div')
    displayElement.className = `error-display severity-${prompt.metadata.stage?.toLowerCase()}`
    displayElement.setAttribute('role', 'alertdialog')
    displayElement.setAttribute('aria-labelledby', 'error-title')
    displayElement.setAttribute('aria-describedby', 'error-description')
    
    displayElement.innerHTML = `
      <div class="error-header">
        <div class="error-icon">
          <i class="icon icon-${prompt.content.icon}" aria-hidden="true"></i>
        </div>
        <h3 id="error-title" class="error-title">${prompt.content.title}</h3>
      </div>
      
      <div class="error-body">
        <div id="error-description" class="error-problem">
          ${prompt.content.problem}
        </div>
        
        <div class="error-causes">
          <h4>å¯èƒ½åŸå› ï¼š</h4>
          <ul>
            ${prompt.content.causes.map(cause => `<li>${cause}</li>`).join('')}
          </ul>
        </div>
        
        <div class="error-actions">
          <h4>å»ºè­°è§£æ±ºæ–¹æ¡ˆï¼š</h4>
          ${this.renderActions(prompt.actions)}
        </div>
        
        ${prompt.alternatives.length > 0 ? `
          <details class="error-alternatives">
            <summary>å…¶ä»–é¸é …</summary>
            <ul>
              ${prompt.alternatives.map(alt => `<li>${alt}</li>`).join('')}
            </ul>
          </details>
        ` : ''}
      </div>
    `
    
    this.container.appendChild(displayElement)
    this.setupActionHandlers(displayElement, prompt)
    
    // ç„¦é»ç®¡ç†
    displayElement.focus()
    this.trapFocus(displayElement)
  }
  
  // æ¸²æŸ“å‹•ä½œæŒ‰éˆ•
  renderActions(actions) {
    return actions.map(action => `
      <button 
        class="error-action priority-${action.priority}" 
        data-action="${action.id}"
        aria-describedby="action-${action.id}-desc"
        ${action.keyboard ? `title="å¿«æ·éµ: ${action.keyboard}"` : ''}
      >
        ${action.label}
        ${action.keyboard ? `<span class="keyboard-hint">${action.keyboard}</span>` : ''}
      </button>
      <div id="action-${action.id}-desc" class="sr-only">
        ${action.accessibility.description}
      </div>
    `).join('')
  }
  
  // è¨­å®šå‹•ä½œè™•ç†å™¨
  setupActionHandlers(displayElement, prompt) {
    const actionButtons = displayElement.querySelectorAll('.error-action')
    
    actionButtons.forEach(button => {
      const actionId = button.getAttribute('data-action')
      const action = prompt.actions.find(a => a.id === actionId)
      
      if (action) {
        button.addEventListener('click', async () => {
          button.disabled = true
          button.textContent = 'è™•ç†ä¸­...'
          
          try {
            const result = await action.handler()
            this.handleActionResult(result, prompt)
          } catch (error) {
            console.error('Action handler error:', error)
            this.showActionError(error)
          }
        })
      }
    })
  }
  
  // è™•ç†å‹•ä½œçµæœ
  handleActionResult(result, prompt) {
    if (result.success) {
      switch (result.action) {
        case 'redirect':
          chrome.tabs.create({ url: result.url })
          break
          
        case 'retry_suggested':
          this.showSuccessMessage(result.message)
          this.dismissDisplay()
          break
          
        case 'open_conflict_resolver':
          this.openConflictResolver(result.data)
          break
          
        default:
          this.showSuccessMessage(result.message || 'æ“ä½œå®Œæˆ')
          this.dismissDisplay()
      }
    } else {
      this.showActionError(result.error || result.message)
    }
  }
  
  // é—œé–‰é¡¯ç¤º
  dismissDisplay() {
    if (this.activeDisplay && this.container.firstChild) {
      this.container.removeChild(this.container.firstChild)
      this.activeDisplay = null
      
      // è™•ç†ä½‡åˆ—ä¸­çš„ä¸‹ä¸€å€‹é¡¯ç¤º
      if (this.displayQueue.length > 0) {
        const nextPrompt = this.displayQueue.shift()
        setTimeout(() => this.renderErrorDisplay(nextPrompt), 300)
      }
    }
  }
  
  // ç„¦é»é™·é˜± (ç„¡éšœç¤™åŠŸèƒ½)
  trapFocus(element) {
    const focusableElements = element.querySelectorAll(
      'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
    )
    
    if (focusableElements.length === 0) return
    
    const firstElement = focusableElements[0]
    const lastElement = focusableElements[focusableElements.length - 1]
    
    element.addEventListener('keydown', (e) => {
      if (e.key === 'Tab') {
        if (e.shiftKey) {
          if (document.activeElement === firstElement) {
            e.preventDefault()
            lastElement.focus()
          }
        } else {
          if (document.activeElement === lastElement) {
            e.preventDefault()
            firstElement.focus()
          }
        }
      }
      
      if (e.key === 'Escape') {
        this.dismissDisplay()
      }
    })
  }
}
```

### 3. é‚Šç•Œæ¢ä»¶åˆ†æéšæ®µ âœ…

#### Chrome Extensionç’°å¢ƒé™åˆ¶

**Service Workerè¨˜æ†¶é«”å„ªåŒ–**ï¼š
- **è¨˜æ†¶é«”å£“åŠ›æª¢æ¸¬**: ç›£æ§è¨˜æ†¶é«”ä½¿ç”¨é‡ï¼Œè¶…é8MBæ™‚è§¸ç™¼æ¸…ç†æ©Ÿåˆ¶
- **éŒ¯èª¤è³‡æ–™å£“ç¸®**: ä½¿ç”¨JSONå£“ç¸®å’Œå¾ªç’°ç·©è¡å€ï¼Œå°‡éŒ¯èª¤å„²å­˜å¤§å°æ§åˆ¶åœ¨500KBä»¥ä¸‹
- **æ‰¹æ¬¡è™•ç†æ©Ÿåˆ¶**: ç´¯ç©10å€‹éŒ¯èª¤æˆ–5ç§’å¾Œæ‰¹æ¬¡å‚³è¼¸ï¼Œæ¸›å°‘è¨Šæ¯å‚³éé »ç‡
- **å„ªé›…é™ç´š**: è¨˜æ†¶é«”ä¸è¶³æ™‚é™ç´šåˆ°åŸºæœ¬éŒ¯èª¤è™•ç†ï¼Œåƒ…ä¿ç•™é—œéµåŠŸèƒ½

**Content Scriptéš”é›¢é™åˆ¶**ï¼š
- **è·¨ç’°å¢ƒé€šè¨Š**: ä½¿ç”¨chrome.runtime.sendMessageé€²è¡ŒéŒ¯èª¤å ±å‘Šï¼Œå…·å‚™é‡è©¦æ©Ÿåˆ¶å’Œè¶…æ™‚è™•ç†
- **DOMå­˜å–é™åˆ¶**: åœ¨å—CSPé™åˆ¶çš„é é¢ä½¿ç”¨è¢«å‹•å¼éŒ¯èª¤æ”¶é›†ï¼Œé¿å…ä¸»å‹•DOMæ“ä½œ
- **æ¬Šé™æª¢æŸ¥**: å‹•æ…‹æª¢æŸ¥å¯ç”¨æ¬Šé™ï¼Œæ ¹æ“šæ¬Šé™ç‹€æ…‹èª¿æ•´éŒ¯èª¤è™•ç†ç­–ç•¥
- **é›¢ç·šè™•ç†**: ç¶²è·¯ç•°å¸¸æ™‚æœ¬åœ°æš«å­˜éŒ¯èª¤ï¼Œé€£ç·šæ¢å¾©å¾Œè‡ªå‹•åŒæ­¥

#### æ¥µç«¯æƒ…æ³è™•ç†ç­–ç•¥

**å¹³å°APIå¤§å¹…è®ŠåŒ–**ï¼š
- **æƒ…å¢ƒ**: Readmooç­‰å¹³å°é€²è¡Œé‡å¤§æ›´æ–°ï¼ŒAPIæ ¼å¼å®Œå…¨æ”¹è®Š
- **æª¢æ¸¬æ©Ÿåˆ¶**: é€£çºŒ3æ¬¡è³‡æ–™æ ¼å¼éŒ¯èª¤è§¸ç™¼æ ¼å¼è®ŠåŒ–è­¦å‘Š
- **è™•ç†ç­–ç•¥**: 
  - è‡ªå‹•åˆ‡æ›åˆ°å‘ä¸‹ç›¸å®¹æ¨¡å¼
  - æç¤ºä½¿ç”¨è€…æª¢æŸ¥æ“´å……åŠŸèƒ½æ›´æ–°
  - æä¾›æ‰‹å‹•è³‡æ–™åŒ¯å…¥é¸é …ä½œç‚ºå‚™æ´
- **æ¢å¾©æ©Ÿåˆ¶**: å®šæœŸæª¢æŸ¥æ–°ç‰ˆæœ¬ç›¸å®¹æ€§ï¼Œè‡ªå‹•æ¢å¾©æ­£å¸¸æ¨¡å¼

**å¤§é‡è³‡æ–™è™•ç†ç•°å¸¸**ï¼š
- **æƒ…å¢ƒ**: ä½¿ç”¨è€…æœ‰è¶…é10,000æœ¬æ›¸ç±ï¼Œæ‰¹æ¬¡è™•ç†è¶…æ™‚æˆ–è¨˜æ†¶é«”ä¸è¶³
- **æª¢æ¸¬æ©Ÿåˆ¶**: è³‡æ–™é‡è¶…é1000ç­†æ™‚å•Ÿå‹•åˆ†æ‰¹è™•ç†æ¨¡å¼
- **è™•ç†ç­–ç•¥**:
  - å‹•æ…‹èª¿æ•´æ‰¹æ¬¡å¤§å°ï¼ˆ100-500ç­†ï¼‰
  - å¯¦ä½œæš«åœ/æ¢å¾©æ©Ÿåˆ¶
  - æä¾›é€²åº¦ä¼°ç®—å’Œå–æ¶ˆé¸é …
- **å®¹éŒ¯æ©Ÿåˆ¶**: å–®æ‰¹å¤±æ•—ä¸å½±éŸ¿æ•´é«”è™•ç†ï¼Œæ”¯æ´æ–·é»çºŒå‚³

**è·¨è£ç½®åŒæ­¥è¡çª**ï¼š
- **æƒ…å¢ƒ**: ä½¿ç”¨è€…åœ¨å¤šè£ç½®ä¸ŠåŒæ™‚æ“ä½œï¼Œç”¢ç”Ÿå¤§é‡è³‡æ–™è¡çª
- **æª¢æ¸¬æ©Ÿåˆ¶**: åŒæ­¥æ™‚æª¢æŸ¥æ™‚é–“æˆ³å’Œè®Šæ›´æ¨™è¨˜ï¼Œè­˜åˆ¥è¡çªé …ç›®
- **è™•ç†ç­–ç•¥**:
  - è¦–è¦ºåŒ–è¡çªæ¯”è¼ƒä»‹é¢
  - æä¾›æ‰¹æ¬¡è§£æ±ºé¸é …ï¼ˆå…¨éƒ¨ä¿ç•™æœ¬åœ°/é ç«¯ï¼‰
  - æ™ºæ…§åˆä½µå»ºè­°ï¼ˆåŸºæ–¼æœ€å¾Œä¿®æ”¹æ™‚é–“ï¼‰
- **é é˜²æ©Ÿåˆ¶**: å¯¦ä½œæ“ä½œé–å®šï¼Œé¿å…åŒæ­¥æœŸé–“çš„ä¿®æ”¹æ“ä½œ

**ç€è¦½å™¨ç’°å¢ƒç•°å¸¸**ï¼š
- **æƒ…å¢ƒ**: Chromeç‰ˆæœ¬æ›´æ–°å°è‡´APIè®ŠåŒ–ï¼Œæˆ–å…¶ä»–ç€è¦½å™¨çš„ç›¸å®¹æ€§å•é¡Œ
- **æª¢æ¸¬æ©Ÿåˆ¶**: å•Ÿå‹•æ™‚æª¢æŸ¥Chromeç‰ˆæœ¬å’Œå¯ç”¨API
- **è™•ç†ç­–ç•¥**:
  - æä¾›ç€è¦½å™¨ç›¸å®¹æ€§å ±å‘Š
  - è‡ªå‹•é™ç´šåˆ°ç›¸å®¹æ¨¡å¼
  - å¼•å°ä½¿ç”¨è€…æ›´æ–°ç€è¦½å™¨æˆ–æ“´å……åŠŸèƒ½
- **ç›£æ§æ©Ÿåˆ¶**: æ”¶é›†ç€è¦½å™¨ç’°å¢ƒè³‡è¨Šï¼Œç”¨æ–¼ç›¸å®¹æ€§æ”¹é€²

#### ä½¿ç”¨è€…æ“ä½œé‚Šç•Œæƒ…æ³

**ç„¡æ¬Šé™ç‹€æ…‹è™•ç†**ï¼š
```javascript
class PermissionBoundaryHandler {
  async handleInsufficientPermissions(requiredPerms, currentPerms) {
    const missingPerms = requiredPerms.filter(p => !currentPerms.includes(p))
    
    // å»ºç«‹æ¬Šé™è«‹æ±‚ç•°å¸¸
    const permException = new PermissionException('INSUFFICIENT_PERMISSIONS', {
      required: requiredPerms,
      missing: missingPerms,
      current: currentPerms
    })
    
    // ç”Ÿæˆä½¿ç”¨è€…æŒ‡å¼•
    permException.userGuidance = {
      problem: `éœ€è¦é¡å¤–çš„ç€è¦½å™¨æ¬Šé™æ‰èƒ½å®Œæˆæ­¤æ“ä½œ`,
      causes: [
        'æ“´å……åŠŸèƒ½æ¬Šé™è¨­å®šä¸å®Œæ•´',
        'ç€è¦½å™¨å®‰å…¨æ”¿ç­–é™åˆ¶',
        'é¦–æ¬¡ä½¿ç”¨éœ€è¦æˆæ¬Š'
      ],
      solutions: [
        { action: 'requestPermissions', label: 'è«‹æ±‚æ¬Šé™', priority: 'high' },
        { action: 'manualSetup', label: 'æ‰‹å‹•è¨­å®š', priority: 'medium' },
        { action: 'limitedMode', label: 'ä½¿ç”¨æœ‰é™åŠŸèƒ½', priority: 'low' }
      ],
      alternatives: [
        'ä½¿ç”¨æ‰‹å‹•åŒ¯å…¥åŠŸèƒ½',
        'è¯ç¹«æŠ€è¡“æ”¯æ´ç²å¾—å”åŠ©'
      ]
    }
    
    return permException
  }
}
```

**ç¶²è·¯ç•°å¸¸æƒ…æ³è™•ç†**ï¼š
```javascript
class NetworkBoundaryHandler {
  async handleNetworkFailures(operation, retryCount = 0) {
    const maxRetries = 3
    const backoffDelay = Math.min(1000 * Math.pow(2, retryCount), 10000)
    
    if (retryCount >= maxRetries) {
      return new NetworkException('MAX_RETRIES_EXCEEDED', {
        operation,
        totalAttempts: maxRetries + 1,
        userGuidance: {
          problem: 'ç¶²è·¯é€£ç·šæŒçºŒç•°å¸¸ï¼Œç„¡æ³•å®Œæˆæ“ä½œ',
          solutions: [
            { action: 'checkConnection', label: 'æª¢æŸ¥ç¶²è·¯é€£ç·š', priority: 'high' },
            { action: 'retryLater', label: 'ç¨å¾Œé‡è©¦', priority: 'medium' },
            { action: 'offlineMode', label: 'åˆ‡æ›åˆ°é›¢ç·šæ¨¡å¼', priority: 'low' }
          ]
        }
      })
    }
    
    // æŒ‡æ•¸é€€é¿é‡è©¦
    await new Promise(resolve => setTimeout(resolve, backoffDelay))
    return this.handleNetworkFailures(operation, retryCount + 1)
  }
}
```

### 4. API/ä»‹é¢è¨­è¨ˆéšæ®µ âœ…

#### çµ±ä¸€éŒ¯èª¤è™•ç†API

**æ ¸å¿ƒè™•ç†å™¨ä»‹é¢**ï¼š
```javascript
// çµ±ä¸€éŒ¯èª¤è™•ç†å™¨ - æ‰€æœ‰ç’°å¢ƒé€šç”¨
class UniversalErrorHandler {
  constructor(environment, config = {}) {
    this.environment = environment // 'background' | 'content' | 'popup'
    this.config = {
      enableUserPrompts: true,
      enableAutoRecovery: true,
      maxRetries: 3,
      batchSize: 10,
      memoryLimit: 5 * 1024 * 1024, // 5MB
      ...config
    }
    
    this.messageDict = new MessageDictionary()
    this.promptEngine = new UserPromptEngine(this.messageDict)
    this.recoveryManager = new RecoveryManager()
    this.boundaryHandlers = new Map()
    
    this.setupBoundaryHandlers()
    this.initializeEnvironment()
  }
  
  // ä¸»è¦éŒ¯èª¤è™•ç†æ¥å£
  async handleError(error, context = {}, options = {}) {
    try {
      // 1. å»ºç«‹æ¨™æº–åŒ–éŒ¯èª¤
      const standardError = await this.createStandardError(error, context)
      
      // 2. åŸ·è¡Œé‚Šç•Œæ¢ä»¶æª¢æŸ¥
      const boundaryCheck = await this.checkBoundaryConditions(standardError)
      if (boundaryCheck.requiresSpecialHandling) {
        return await this.handleBoundaryCase(standardError, boundaryCheck)
      }
      
      // 3. ç”Ÿæˆä½¿ç”¨è€…æç¤º (å¦‚æœéœ€è¦)
      if (this.config.enableUserPrompts && standardError.severity !== 'debug') {
        const prompt = await this.promptEngine.generatePrompt(standardError, context)
        await this.displayPrompt(prompt)
      }
      
      // 4. å˜—è©¦è‡ªå‹•æ¢å¾© (å¦‚æœå¯èƒ½)
      if (this.config.enableAutoRecovery && standardError.retryable) {
        const recoveryResult = await this.recoveryManager.attemptRecovery(standardError)
        if (recoveryResult.success) {
          return OperationResult.success(recoveryResult.data, {
            recovered: true,
            originalError: standardError.code
          })
        }
      }
      
      // 5. è¨˜éŒ„å’Œå‚³æ’­
      await this.logError(standardError)
      await this.propagateError(standardError)
      
      return OperationResult.failure(standardError)
      
    } catch (handlingError) {
      // éŒ¯èª¤è™•ç†éç¨‹æœ¬èº«ç™¼ç”ŸéŒ¯èª¤çš„é™ç´šè™•ç†
      console.error('Error in error handler:', handlingError)
      return this.createFallbackResult(error, handlingError)
    }
  }
  
  // å»ºç«‹æ¨™æº–åŒ–éŒ¯èª¤
  async createStandardError(error, context) {
    // å¦‚æœå·²ç¶“æ˜¯æ¨™æº–éŒ¯èª¤ï¼Œç›´æ¥ä½¿ç”¨
    if (error instanceof BaseException) {
      return error.addContext('environment', this.environment)
    }
    
    // åˆ†æéŒ¯èª¤é¡å‹å’Œéšæ®µ
    const classifier = new ErrorClassifier()
    const classification = await classifier.classify(error, context)
    
    // æ ¹æ“šåˆ†é¡å»ºç«‹å°æ‡‰çš„ç•°å¸¸ç‰©ä»¶
    const ExceptionClass = this.getExceptionClass(classification)
    const standardError = new ExceptionClass(
      classification.code,
      this.sanitizeContext({ ...context, originalError: error.message })
    )
    
    // æ·»åŠ ç’°å¢ƒç‰¹å®šè³‡è¨Š
    standardError.addContext('environment', this.environment)
    standardError.addContext('timestamp', Date.now())
    standardError.addContext('sessionId', await this.getSessionId())
    
    return standardError
  }
  
  // å–å¾—å°æ‡‰çš„ç•°å¸¸é¡åˆ¥
  getExceptionClass(classification) {
    const exceptionMap = {
      'PLATFORM_CONNECTION': PlatformConnectionException,
      'DATA_FORMAT': DataFormatException,
      'DATA_CONFLICT': DataConflictException,
      'VALIDATION': ValidationException,
      'CLASSIFICATION_RULE': ClassificationRuleException,
      'EXPORT_FORMAT': ExportFormatException,
      'STORAGE_QUOTA': StorageQuotaException,
      'PERMISSION': PermissionException,
      'NETWORK': NetworkException
    }
    
    return exceptionMap[classification.type] || BaseException
  }
}
```

**ç’°å¢ƒç‰¹åŒ–è™•ç†å™¨**ï¼š

```javascript
// Backgroundç’°å¢ƒç‰¹åŒ–è™•ç†å™¨
class BackgroundErrorProcessor extends UniversalErrorHandler {
  constructor(config = {}) {
    super('background', {
      enableCentralizedLogging: true,
      enableSystemMonitoring: true,
      enableRecoveryOrchestration: true,
      ...config
    })
    
    this.systemMonitor = new SystemHealthMonitor()
    this.errorAggregator = new ErrorAggregator()
    this.recoveryOrchestrator = new RecoveryOrchestrator()
  }
  
  // Backgroundç‰¹æœ‰çš„ç³»çµ±ç´šéŒ¯èª¤è™•ç†
  async handleSystemError(error, context = {}) {
    const standardError = await this.createStandardError(error, context)
    
    // æª¢æŸ¥ç³»çµ±å¥åº·åº¦
    const healthCheck = await this.systemMonitor.assessHealth()
    if (healthCheck.critical) {
      // è§¸ç™¼ç·Šæ€¥æ¢å¾©å”å®š
      return await this.recoveryOrchestrator.executeEmergencyProtocol(healthCheck)
    }
    
    // èšåˆç›¸ä¼¼éŒ¯èª¤
    await this.errorAggregator.aggregate(standardError)
    
    // æ­£å¸¸éŒ¯èª¤è™•ç†æµç¨‹
    return await this.handleError(error, context)
  }
  
  // è·¨ç’°å¢ƒéŒ¯èª¤å”èª¿
  async coordinateErrorHandling(errors, sourceEnvironment) {
    const coordinationPlan = {
      errors: errors.map(e => e.toJSON()),
      sourceEnvironment,
      coordinationId: this.generateCoordinationId(),
      timestamp: Date.now()
    }
    
    // é€šçŸ¥å…¶ä»–ç’°å¢ƒ
    await this.notifyEnvironments(coordinationPlan, ['content', 'popup'])
    
    // åŸ·è¡Œé›†ä¸­å¼æ¢å¾©ç­–ç•¥
    return await this.recoveryOrchestrator.coordinateRecovery(coordinationPlan)
  }
}

// Content Scriptç’°å¢ƒç‰¹åŒ–è™•ç†å™¨
class ContentErrorProcessor extends UniversalErrorHandler {
  constructor(config = {}) {
    super('content', {
      enablePageContextCollection: true,
      enableBatchTransmission: true,
      enableFallbackStorage: true,
      ...config
    })
    
    this.pageContextCollector = new PageContextCollector()
    this.transmissionManager = new TransmissionManager()
    this.fallbackStorage = new FallbackStorage()
  }
  
  // Content Scriptç‰¹æœ‰çš„é é¢ç›¸é—œéŒ¯èª¤è™•ç†
  async handlePageError(error, pageContext = {}) {
    // æ”¶é›†é é¢ä¸Šä¸‹æ–‡
    const enrichedContext = await this.pageContextCollector.collect({
      ...pageContext,
      url: window.location.href,
      title: document.title,
      platform: await this.detectCurrentPlatform(),
      userAgent: navigator.userAgent
    })
    
    const standardError = await this.createStandardError(error, enrichedContext)
    
    // æª¢æŸ¥å‚³è¼¸å¯ç”¨æ€§
    if (await this.transmissionManager.isAvailable()) {
      return await this.handleError(error, enrichedContext)
    } else {
      // ä½¿ç”¨é™ç´šå„²å­˜
      await this.fallbackStorage.store(standardError)
      return OperationResult.failure(standardError, { stored: 'fallback' })
    }
  }
  
  // å¹³å°ç‰¹å®šéŒ¯èª¤æª¢æ¸¬
  async detectCurrentPlatform() {
    const platformIndicators = {
      'readmoo': ['readmoo.com', '.readmoo-'],
      'kobo': ['kobo.com', 'kobo-'],
      'books': ['books.google.com', 'googlebooks'],
      'amazon': ['amazon.', 'kindle']
    }
    
    const currentUrl = window.location.href.toLowerCase()
    const currentDOM = document.documentElement.innerHTML.toLowerCase()
    
    for (const [platform, indicators] of Object.entries(platformIndicators)) {
      if (indicators.some(indicator => 
        currentUrl.includes(indicator) || currentDOM.includes(indicator)
      )) {
        return platform
      }
    }
    
    return 'unknown'
  }
}

// Popupç’°å¢ƒç‰¹åŒ–è™•ç†å™¨  
class PopupErrorProcessor extends UniversalErrorHandler {
  constructor(config = {}) {
    super('popup', {
      enableUIErrorDisplay: true,
      enableUserInteraction: true,
      enableAccessibility: true,
      ...config
    })
    
    this.uiDisplayManager = new PopupErrorDisplayManager(this.promptEngine)
    this.interactionTracker = new UserInteractionTracker()
    this.accessibilityManager = new AccessibilityManager()
  }
  
  // Popupç‰¹æœ‰çš„UIéŒ¯èª¤è™•ç†
  async handleUIError(error, uiContext = {}) {
    const standardError = await this.createStandardError(error, uiContext)
    
    // UIéŒ¯èª¤éœ€è¦ç«‹å³é¡¯ç¤º
    await this.uiDisplayManager.displayError(standardError, uiContext)
    
    // è¿½è¹¤ä½¿ç”¨è€…äº’å‹•
    this.interactionTracker.trackErrorEncounter(standardError.id, uiContext)
    
    // ç¢ºä¿ç„¡éšœç¤™åŠŸèƒ½
    await this.accessibilityManager.announceError(standardError)
    
    return await this.handleError(error, uiContext, { 
      immediateDisplay: true,
      blockUI: standardError.severity === 'critical'
    })
  }
  
  // éŒ¯èª¤ç‹€æ…‹ç®¡ç†
  async manageErrorState(standardError, userResponse) {
    // æ›´æ–°éŒ¯èª¤ç‹€æ…‹
    this.interactionTracker.trackUserResponse(standardError.id, userResponse)
    
    // æ ¹æ“šä½¿ç”¨è€…å›æ‡‰åŸ·è¡Œå¾ŒçºŒå‹•ä½œ
    switch (userResponse.action) {
      case 'retry':
        return await this.executeRetry(standardError)
      case 'dismiss':
        return await this.dismissError(standardError)
      case 'escalate':
        return await this.escalateToSupport(standardError)
      default:
        return OperationResult.success(null, { action: 'acknowledged' })
    }
  }
}
```

#### è·¨ç’°å¢ƒé€šè¨Šå”å®šè¨­è¨ˆ

**è¨Šæ¯è·¯ç”±ç³»çµ±**ï¼š
```javascript
class ErrorMessageRouter {
  constructor(environment) {
    this.environment = environment
    this.messageHandlers = new Map()
    this.correlationMap = new Map()
    this.messageQueue = []
    this.setupMessageHandlers()
  }
  
  // è¨­å®šè¨Šæ¯è™•ç†å™¨
  setupMessageHandlers() {
    this.messageHandlers.set('ERROR_REPORT', this.handleErrorReport.bind(this))
    this.messageHandlers.set('ERROR_RECOVERY', this.handleErrorRecovery.bind(this))
    this.messageHandlers.set('ERROR_COORDINATION', this.handleErrorCoordination.bind(this))
    this.messageHandlers.set('SYSTEM_HEALTH_CHECK', this.handleSystemHealthCheck.bind(this))
    
    // è¨­å®šChrome Extensionè¨Šæ¯ç›£è½
    if (typeof chrome !== 'undefined' && chrome.runtime) {
      chrome.runtime.onMessage.addListener(this.routeMessage.bind(this))
    }
  }
  
  // ç™¼é€éŒ¯èª¤å ±å‘Š
  async sendErrorReport(errors, targetEnvironment = 'background') {
    const message = {
      type: 'ERROR_REPORT',
      source: this.environment,
      target: targetEnvironment,
      payload: {
        errors: errors.map(e => e.toJSON()),
        batchId: this.generateBatchId(),
        priority: this.calculateBatchPriority(errors),
        timestamp: Date.now()
      },
      routing: {
        messageId: this.generateMessageId(),
        correlationId: this.generateCorrelationId(),
        ttl: 30000, // 30ç§’TTL
        retryCount: 0,
        maxRetries: 3
      }
    }
    
    return await this.transmitMessage(message)
  }
  
  // è«‹æ±‚éŒ¯èª¤æ¢å¾©å”åŠ©
  async requestErrorRecovery(error, recoveryType = 'automatic') {
    const message = {
      type: 'ERROR_RECOVERY',
      source: this.environment,
      target: 'background',
      payload: {
        error: error.toJSON(),
        recoveryType,
        urgency: this.calculateUrgency(error),
        context: {
          userPresent: this.environment === 'popup',
          operationInProgress: await this.checkOperationStatus(),
          retryHistory: error.context.retryHistory || []
        }
      },
      routing: {
        messageId: this.generateMessageId(),
        correlationId: this.generateCorrelationId(),
        ttl: 60000, // 1åˆ†é˜TTL  
        requiresResponse: true
      }
    }
    
    return await this.sendAndWaitForResponse(message, 15000) // 15ç§’è¶…æ™‚
  }
  
  // è™•ç†éŒ¯èª¤å ±å‘Š
  async handleErrorReport(message, sender) {
    const { errors, batchId, priority } = message.payload
    
    // è¨˜éŒ„æ¥æ”¶åˆ°çš„éŒ¯èª¤
    console.info(`Received error batch ${batchId} from ${message.source}:`, errors.length, 'errors')
    
    // æ ¹æ“šå„ªå…ˆç´šè™•ç†
    if (priority === 'critical') {
      await this.handleCriticalErrors(errors, message.source)
    } else {
      await this.queueErrorsForProcessing(errors, message.source)
    }
    
    // ç™¼é€ç¢ºèªå›æ‡‰
    return { success: true, processed: errors.length, batchId }
  }
  
  // è™•ç†éŒ¯èª¤æ¢å¾©è«‹æ±‚
  async handleErrorRecovery(message, sender) {
    const { error, recoveryType, urgency } = message.payload
    
    try {
      // å»ºç«‹æ¢å¾©ç­–ç•¥
      const recoveryStrategy = await this.createRecoveryStrategy(error, recoveryType, urgency)
      
      // åŸ·è¡Œæ¢å¾©
      const recoveryResult = await recoveryStrategy.execute()
      
      return {
        success: true,
        recoveryResult,
        strategy: recoveryStrategy.name,
        executionTime: recoveryResult.executionTime
      }
    } catch (recoveryError) {
      return {
        success: false,
        error: recoveryError.message,
        fallbackSuggestions: await this.getFallbackSuggestions(error)
      }
    }
  }
}
```

#### æ¸¬è©¦æ¡†æ¶æ•´åˆè¨­è¨ˆ

**Chrome Extensionç’°å¢ƒæ¸¬è©¦å·¥å…·**ï¼š
```javascript
export class ExtensionErrorTestSuite {
  constructor() {
    this.mockEnvironments = new Map()
    this.errorSimulator = new ErrorSimulator()
    this.testReporter = new TestReporter()
  }
  
  // è¨­å®šæ¸¬è©¦ç’°å¢ƒ
  setupTestEnvironment(environments = ['background', 'content', 'popup']) {
    environments.forEach(env => {
      const mockEnv = this.createMockEnvironment(env)
      this.mockEnvironments.set(env, mockEnv)
    })
  }
  
  // å»ºç«‹æ¨¡æ“¬ç’°å¢ƒ
  createMockEnvironment(environment) {
    const mockChrome = {
      runtime: {
        sendMessage: jest.fn().mockImplementation((message) => {
          return new Promise(resolve => {
            setTimeout(() => resolve({ success: true }), 10)
          })
        }),
        onMessage: {
          addListener: jest.fn()
        }
      },
      storage: {
        local: {
          get: jest.fn().mockResolvedValue({}),
          set: jest.fn().mockResolvedValue(),
          clear: jest.fn().mockResolvedValue()
        }
      }
    }
    
    const mockEnvironment = {
      chrome: mockChrome,
      errorProcessor: this.createMockErrorProcessor(environment),
      messageRouter: this.createMockMessageRouter(environment)
    }
    
    return mockEnvironment
  }
  
  // æ¸¬è©¦éŒ¯èª¤è™•ç†æµç¨‹
  async testErrorHandlingFlow(errorType, sourceEnvironment, expectedFlow) {
    const mockEnv = this.mockEnvironments.get(sourceEnvironment)
    const testError = this.errorSimulator.createError(errorType, {
      environment: sourceEnvironment,
      timestamp: Date.now()
    })
    
    // åŸ·è¡ŒéŒ¯èª¤è™•ç†
    const startTime = Date.now()
    const result = await mockEnv.errorProcessor.handleError(testError)
    const executionTime = Date.now() - startTime
    
    // é©—è­‰çµæœ
    this.verifyErrorHandlingResult(result, expectedFlow)
    
    // è¨˜éŒ„æ¸¬è©¦å ±å‘Š
    this.testReporter.recordTest({
      type: 'error_handling_flow',
      errorType,
      sourceEnvironment,
      result,
      executionTime,
      expectedFlow,
      success: result.success || result.error?.retryable
    })
    
    return result
  }
  
  // æ¸¬è©¦è·¨ç’°å¢ƒéŒ¯èª¤å‚³æ’­
  async testCrossEnvironmentPropagation(errorType, sourceEnv, targetEnvs) {
    const mockSourceEnv = this.mockEnvironments.get(sourceEnv)
    const testError = this.errorSimulator.createError(errorType)
    
    // åŸ·è¡ŒéŒ¯èª¤è™•ç†ä¸¦è¿½è¹¤å‚³æ’­
    const propagationTrace = []
    
    // è¨­å®šè¨Šæ¯æ””æˆªå™¨
    targetEnvs.forEach(targetEnv => {
      const mockTargetEnv = this.mockEnvironments.get(targetEnv)
      mockTargetEnv.chrome.runtime.sendMessage.mockImplementation((message) => {
        if (message.type === 'ERROR_REPORT') {
          propagationTrace.push({
            target: targetEnv,
            message,
            timestamp: Date.now()
          })
        }
        return Promise.resolve({ success: true })
      })
    })
    
    // åŸ·è¡ŒéŒ¯èª¤è™•ç†
    const result = await mockSourceEnv.errorProcessor.handleError(testError)
    
    // ç­‰å¾…å‚³æ’­å®Œæˆ
    await new Promise(resolve => setTimeout(resolve, 100))
    
    // é©—è­‰å‚³æ’­çµæœ
    expect(propagationTrace).toHaveLength(targetEnvs.length)
    propagationTrace.forEach(trace => {
      expect(trace.message.payload.errors).toContainEqual(
        expect.objectContaining({
          code: testError.code,
          type: testError.type
        })
      )
    })
    
    return { result, propagationTrace }
  }
  
  // æ¸¬è©¦ä½¿ç”¨è€…æç¤ºç³»çµ±
  async testUserPromptSystem(errorType, uiContext) {
    const mockPopupEnv = this.mockEnvironments.get('popup')
    const testError = this.errorSimulator.createError(errorType)
    
    // æ¨¡æ“¬UIå®¹å™¨
    const mockContainer = document.createElement('div')
    mockContainer.id = 'error-display-container'
    document.body.appendChild(mockContainer)
    
    try {
      // åŸ·è¡ŒUIéŒ¯èª¤è™•ç†
      const result = await mockPopupEnv.errorProcessor.handleUIError(testError, uiContext)
      
      // ç­‰å¾…UIæ¸²æŸ“
      await new Promise(resolve => setTimeout(resolve, 50))
      
      // é©—è­‰UIé¡¯ç¤º
      const errorDisplay = mockContainer.querySelector('.error-display')
      expect(errorDisplay).toBeTruthy()
      
      // é©—è­‰ç„¡éšœç¤™å±¬æ€§
      expect(errorDisplay.getAttribute('role')).toBe('alertdialog')
      expect(errorDisplay.getAttribute('aria-labelledby')).toBeTruthy()
      
      // é©—è­‰å‹•ä½œæŒ‰éˆ•
      const actionButtons = errorDisplay.querySelectorAll('.error-action')
      expect(actionButtons.length).toBeGreaterThan(0)
      
      actionButtons.forEach(button => {
        expect(button.getAttribute('aria-describedby')).toBeTruthy()
      })
      
      return { result, uiElements: { errorDisplay, actionButtons } }
      
    } finally {
      document.body.removeChild(mockContainer)
    }
  }
  
  // é©—è­‰éŒ¯èª¤è™•ç†çµæœ
  verifyErrorHandlingResult(result, expectedFlow) {
    // çµæ§‹åŒ–é©—è­‰ï¼Œé¿å…å­—ä¸²æ¯”å°
    expect(result).toHaveProperty('success')
    expect(result).toHaveProperty('error')
    expect(result).toHaveProperty('metadata')
    
    if (expectedFlow.shouldSucceed) {
      expect(result.success).toBe(true)
    } else {
      expect(result.success).toBe(false)
      expect(result.error.code).toBeTruthy()
      expect(result.error.type).toBeTruthy()
    }
    
    if (expectedFlow.shouldRetry) {
      expect(result.error.retryable).toBe(true)
    }
    
    if (expectedFlow.shouldNotifyUser) {
      expect(result.metadata.userNotified).toBe(true)
    }
    
    if (expectedFlow.shouldPropagateToOtherEnvironments) {
      expect(result.metadata.propagated).toBe(true)
    }
  }
}

// éŒ¯èª¤æ¨¡æ“¬å™¨
export class ErrorSimulator {
  // å»ºç«‹å„ç¨®é¡å‹çš„æ¸¬è©¦éŒ¯èª¤
  createError(type, context = {}) {
    const errorFactories = {
      PLATFORM_CONNECTION: () => new PlatformConnectionException('readmoo', 'ç™»å…¥éæœŸ', context),
      DATA_FORMAT: () => new DataFormatException('BookList', 'UnknownFormat', context),
      DATA_CONFLICT: () => new DataConflictException([{ field: 'title', local: 'A', remote: 'B' }], context),
      VALIDATION: () => new ValidationException('title', '', 'å¿…å¡«æ¬„ä½', context),
      EXPORT_FORMAT: () => new ExportFormatException('pdf', ['json', 'csv'], context),
      STORAGE_QUOTA: () => new StorageQuotaException(100, 50, context),
      NETWORK: () => new NetworkException('CONNECTION_TIMEOUT', context),
      PERMISSION: () => new PermissionException(['activeTab'], context)
    }
    
    const factory = errorFactories[type]
    if (!factory) {
      throw new Error(`Unknown error type: ${type}`)
    }
    
    return factory()
  }
  
  // æ¨¡æ“¬éŒ¯èª¤æ¢å¾©å ´æ™¯
  simulateRecoveryScenario(errorType, recoverySuccess = true) {
    const error = this.createError(errorType)
    
    if (recoverySuccess) {
      error.retryable = true
      error.addContext('mockRecovery', 'success')
    } else {
      error.retryable = false
      error.addContext('mockRecovery', 'failure')
    }
    
    return error
  }
}
```

### 5. é©—æ”¶æ¨™æº–åˆ¶å®šéšæ®µ âœ…

#### åŠŸèƒ½æ­£ç¢ºæ€§é©—è­‰æ¨™æº–

**éšæ®µ1 (v1.0) - åŸºç¤æ¶æ§‹é©—è­‰**ï¼š
- [ ] SimpleErroré¡åˆ¥å¯ä»¥æ­£ç¢ºå»ºç«‹å’Œåºåˆ—åŒ–éŒ¯èª¤ç‰©ä»¶
- [ ] OperationResultå¯ä»¥çµ±ä¸€åŒ…è£æˆåŠŸå’Œå¤±æ•—çµæœ
- [ ] MessageDictionaryå¯ä»¥æ­£ç¢ºè¼‰å…¥å’Œæ’å€¼è¨Šæ¯æ¨¡æ¿
- [ ] éŒ¯èª¤åˆ†é¡å™¨å¯ä»¥æ­£ç¢ºè­˜åˆ¥éŒ¯èª¤é¡å‹å’Œåš´é‡ç¨‹åº¦
- [ ] åŸºç¤æ¢å¾©æ©Ÿåˆ¶å¯ä»¥è™•ç†å¯é‡è©¦çš„éŒ¯èª¤

**éšæ®µ2 (v2.0) - å®Œæ•´Exceptionç³»çµ±é©—è­‰**ï¼š

*äº”éšæ®µæ¥­å‹™ç•°å¸¸é©—è­‰*ï¼š
- [ ] æ“·å–éšæ®µï¼šPlatformConnectionExceptionå’ŒDataFormatExceptionæ­£ç¢ºè™•ç†å¹³å°ç›¸é—œéŒ¯èª¤
- [ ] åŒæ­¥éšæ®µï¼šDataConflictExceptionå’ŒSyncTimeoutExceptionæ­£ç¢ºè™•ç†åŒæ­¥å•é¡Œ
- [ ] æ›´æ–°éšæ®µï¼šValidationExceptionå’ŒBatchUpdateExceptionæ­£ç¢ºè™•ç†è³‡æ–™æ›´æ–°éŒ¯èª¤
- [ ] åˆ†é¡éšæ®µï¼šClassificationRuleExceptionæ­£ç¢ºè™•ç†åˆ†é¡é‚è¼¯éŒ¯èª¤  
- [ ] åŒ¯å‡ºéšæ®µï¼šExportFormatExceptionå’ŒStorageQuotaExceptionæ­£ç¢ºè™•ç†åŒ¯å‡ºå•é¡Œ

*ä½¿ç”¨è€…æç¤ºç³»çµ±é©—è­‰*ï¼š
- [ ] UserPromptEngineå¯ä»¥æ ¹æ“šç•°å¸¸é¡å‹ç”Ÿæˆé©ç•¶çš„ä½¿ç”¨è€…æŒ‡å¼•
- [ ] ä½¿ç”¨è€…æŒ‡å¼•åŒ…å«å•é¡Œæè¿°ã€å¯èƒ½åŸå› ã€å»ºè­°è§£æ±ºæ–¹æ¡ˆã€æ›¿ä»£æ–¹æ¡ˆ
- [ ] PopupErrorDisplayManagerå¯ä»¥åœ¨Chrome Extensionç’°å¢ƒæ­£ç¢ºé¡¯ç¤ºéŒ¯èª¤
- [ ] éŒ¯èª¤æç¤ºæ”¯æ´ç„¡éšœç¤™åŠŸèƒ½ï¼ˆéµç›¤å°èˆªã€è¢å¹•é–±è®€å™¨ï¼‰
- [ ] ä½¿ç”¨è€…å‹•ä½œå¯ä»¥æ­£ç¢ºåŸ·è¡Œå’Œè¿½è¹¤çµæœ

**Chrome Extensionç‰¹åŒ–é©—è­‰**ï¼š
- [ ] è·¨ç’°å¢ƒéŒ¯èª¤å‚³æ’­ï¼šBackgroundâ†”Contentâ†”Popupä¸‰ç’°å¢ƒæ­£ç¢ºå‚³ééŒ¯èª¤
- [ ] Service Workerè¨˜æ†¶é«”å„ªåŒ–ï¼šéŒ¯èª¤è™•ç†ä¸è¶…é5MBè¨˜æ†¶é«”é™åˆ¶
- [ ] Content Scriptéš”é›¢è™•ç†ï¼šåœ¨å—é™ç’°å¢ƒä¸‹æ­£ç¢ºæ”¶é›†å’Œå‚³ééŒ¯èª¤
- [ ] Popup UIæ•´åˆï¼šéŒ¯èª¤é¡¯ç¤ºä¸é˜»å¡æ­£å¸¸æ“ä½œï¼Œæ”¯æ´ä½¿ç”¨è€…äº’å‹•
- [ ] Chrome APIæ•´åˆï¼šstorageã€runtimeã€tabsç­‰APIéŒ¯èª¤æ­£ç¢ºåŒ…è£ç‚ºå°æ‡‰ç•°å¸¸

#### æ•ˆèƒ½è¦æ±‚æ¨™æº–

**è¨˜æ†¶é«”æ•ˆèƒ½è¦æ±‚**ï¼š
- Backgroundç’°å¢ƒéŒ¯èª¤è™•ç†è¨˜æ†¶é«”å ç”¨ï¼š< 5MB
- Content ScriptéŒ¯èª¤è™•ç†è¨˜æ†¶é«”å ç”¨ï¼š< 1MB per page  
- Popupç’°å¢ƒéŒ¯èª¤è™•ç†è¨˜æ†¶é«”å ç”¨ï¼š< 500KB
- å–®ä¸€éŒ¯èª¤ç‰©ä»¶åºåˆ—åŒ–å¤§å°ï¼š< 1KB
- éŒ¯èª¤æ­·å²å¿«å–ç¸½å¤§å°ï¼š< 1MB

**è™•ç†æ™‚é–“è¦æ±‚**ï¼š
- åŸºç¤éŒ¯èª¤è™•ç†æ™‚é–“ï¼š< 1ms
- Exceptionå»ºç«‹å’Œåˆ†é¡æ™‚é–“ï¼š< 2ms
- è·¨ç’°å¢ƒéŒ¯èª¤å‚³éæ™‚é–“ï¼š< 10ms
- ä½¿ç”¨è€…æç¤ºç”Ÿæˆæ™‚é–“ï¼š< 5ms
- UIéŒ¯èª¤é¡¯ç¤ºæ¸²æŸ“æ™‚é–“ï¼š< 50ms

**ä¸¦ç™¼æ•ˆèƒ½è¦æ±‚**ï¼š
- Backgroundç’°å¢ƒä¸¦ç™¼è™•ç†èƒ½åŠ›ï¼š100+ errors/second
- Content Scriptç’°å¢ƒä¸¦ç™¼è™•ç†èƒ½åŠ›ï¼š50+ errors/second per page
- Popupç’°å¢ƒä¸¦ç™¼è™•ç†èƒ½åŠ›ï¼š20+ errors/second
- è·¨ç’°å¢ƒè¨Šæ¯å‚³éèƒ½åŠ›ï¼š200+ messages/second
- éŒ¯èª¤æ¢å¾©è™•ç†èƒ½åŠ›ï¼š10+ recovery attempts/second

#### ä½¿ç”¨è€…é«”é©—æ¨™æº–

**éŒ¯èª¤è¨Šæ¯å“è³ª**ï¼š
- æ‰€æœ‰éŒ¯èª¤è¨Šæ¯ä½¿ç”¨ç¹é«”ä¸­æ–‡ï¼Œç¬¦åˆå°ç£ä½¿ç”¨è€…èªè¨€ç¿’æ…£
- æŠ€è¡“éŒ¯èª¤è½‰æ›ç‚ºä½¿ç”¨è€…å¯ç†è§£çš„å•é¡Œæè¿°ï¼Œç†è§£åº¦æå‡200%
- æ¯å€‹éŒ¯èª¤æä¾›è‡³å°‘3ç¨®è§£æ±ºå»ºè­°ï¼Œè§£æ±ºæˆåŠŸç‡é”åˆ°80%
- éŒ¯èª¤è¨Šæ¯é¿å…ä½¿ç”¨æŠ€è¡“è¡“èªï¼Œæ™®é€šä½¿ç”¨è€…å¯è®€æ€§é”åˆ°90%

**äº’å‹•é«”é©—å“è³ª**ï¼š
- éŒ¯èª¤æç¤ºä¸é˜»å¡ä½¿ç”¨è€…æ­£å¸¸æ“ä½œï¼Œé˜»å¡ç‡<10%
- é—œéµéŒ¯èª¤çš„è§£æ±ºæ–¹æ¡ˆé»æ“Šå¯é”æ€§100%ï¼ˆä¸€éµåŸ·è¡Œï¼‰
- éŒ¯èª¤ç‹€æ…‹è¿½è¹¤é¿å…é‡è¤‡é€šçŸ¥ï¼Œé‡è¤‡ç‡<5%
- éŒ¯èª¤æ¢å¾©éç¨‹æä¾›é€²åº¦å›é¥‹ï¼Œä½¿ç”¨è€…ç­‰å¾…ç„¦æ…®åº¦é™ä½60%

**ç„¡éšœç¤™é«”é©—å“è³ª**ï¼š
- éŒ¯èª¤æç¤ºæ”¯æ´è¢å¹•é–±è®€å™¨å®Œæ•´èªéŸ³è¼¸å‡ºï¼Œç›¸å®¹æ€§é”åˆ°WCAG 2.1 AA
- éŒ¯èª¤è§£æ±ºå‹•ä½œæ”¯æ´ç´”éµç›¤æ“ä½œï¼ŒTabé †åºé‚è¼¯åˆç†
- éŒ¯èª¤è¨Šæ¯è‰²å½©å°æ¯”åº¦â‰¥4.5:1ï¼Œç¬¦åˆè¦–è¦ºç„¡éšœç¤™æ¨™æº–
- éŒ¯èª¤ç‹€æ…‹è®ŠåŒ–æä¾›é©ç•¶çš„éŸ³æ•ˆæˆ–è§¸è¦ºåé¥‹

**é–‹ç™¼è€…å”ä½œé«”é©—**ï¼š
- æ–°å·¥ç¨‹å¸«ç†è§£éŒ¯èª¤è™•ç†æ¨™æº–æ™‚é–“ï¼š< 2å°æ™‚
- éŒ¯èª¤è™•ç†ç¨‹å¼ç¢¼éµå¾ªçµ±ä¸€æ¨¡å¼ï¼Œç¨‹å¼ç¢¼å¯©æŸ¥æ•ˆç‡æå‡40%
- è·¨æ¨¡çµ„æ•´åˆéŒ¯èª¤è™•ç†ï¼Œæ•´åˆå•é¡Œæ¸›å°‘90%
- éŒ¯èª¤é™¤éŒ¯è³‡è¨Šå®Œæ•´åº¦é”åˆ°95%ï¼Œå•é¡Œå®šä½æ™‚é–“æ¸›å°‘70%

#### ç³»çµ±ç©©å®šæ€§æ¨™æº–

**éŒ¯èª¤è™•ç†ç©©å®šæ€§**ï¼š
- éŒ¯èª¤è™•ç†å™¨æœ¬èº«çš„ç•°å¸¸ç‡ï¼š< 0.1%ï¼ˆéŒ¯èª¤è™•ç†éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤çš„æ©Ÿç‡ï¼‰
- éŒ¯èª¤æ¢å¾©æˆåŠŸç‡ï¼šâ‰¥ 85%ï¼ˆå¯æ¢å¾©éŒ¯èª¤çš„è‡ªå‹•ä¿®å¾©æˆåŠŸç‡ï¼‰
- ç³»çµ±é™ç´šè™•ç†æˆåŠŸç‡ï¼šâ‰¥ 99%ï¼ˆç„¡æ³•è™•ç†çš„éŒ¯èª¤èƒ½æ­£ç¢ºé™ç´šï¼‰
- éŒ¯èª¤å‚³æ’­å®Œæ•´æ€§ï¼šâ‰¥ 98%ï¼ˆè·¨ç’°å¢ƒéŒ¯èª¤å‚³éä¸ä¸Ÿå¤±ï¼‰

**è³‡æ–™å®Œæ•´æ€§**ï¼š
- éŒ¯èª¤è™•ç†éç¨‹ä¸­ä½¿ç”¨è€…è³‡æ–™éºå¤±ç‡ï¼š< 0.01%
- éŒ¯èª¤æ—¥èªŒè¨˜éŒ„å®Œæ•´æ€§ï¼šâ‰¥ 99.9%
- éŒ¯èª¤ç‹€æ…‹åŒæ­¥ä¸€è‡´æ€§ï¼šâ‰¥ 99%
- ä½¿ç”¨è€…æ“ä½œè¿½è¹¤æº–ç¢ºæ€§ï¼šâ‰¥ 95%

**ç³»çµ±å¯ç”¨æ€§**ï¼š
- éŒ¯èª¤è™•ç†ç³»çµ±å¯ç”¨æ€§ï¼šâ‰¥ 99.9%
- é‡å¤§éŒ¯èª¤éŸ¿æ‡‰æ™‚é–“ï¼š< 100ms
- ç³»çµ±æ¢å¾©æ™‚é–“ï¼š< 30ç§’ï¼ˆå¾éŒ¯èª¤æª¢æ¸¬åˆ°æ¢å¾©å®Œæˆï¼‰
- ä½¿ç”¨è€…é«”é©—ä¸­æ–·æ™‚é–“ï¼š< 5ç§’ï¼ˆéŒ¯èª¤è™•ç†å°ä½¿ç”¨è€…æ“ä½œçš„å½±éŸ¿æ™‚é–“ï¼‰

---

## ğŸ“‹ äº¤æ¥çµ¦ sage-test-architect çš„æª¢æŸ¥é»

### TDD Phase 1 åŠŸèƒ½è¨­è¨ˆå®Œæ•´æ€§ç¢ºèª âœ…

- [x] **åŠŸèƒ½éœ€æ±‚æ¸…æ¥šä¸”å…·é«”**: é‡æ–°å®šç¾©ç‚ºå®Œæ•´çš„éŒ¯èª¤è™•ç†ç”Ÿæ…‹ç³»çµ±ï¼Œæ¶µè“‹æ›¸åº«ç®¡ç†äº”éšæ®µçš„ç•°å¸¸è™•ç†å’Œä½¿ç”¨è€…æç¤ºç³»çµ±
- [x] **APIä»‹é¢å®šç¾©å®Œæ•´**: è¨­è¨ˆäº†çµ±ä¸€éŒ¯èª¤è™•ç†APIã€ç’°å¢ƒç‰¹åŒ–è™•ç†å™¨ã€è·¨ç’°å¢ƒé€šè¨Šå”å®šå’Œæ¸¬è©¦æ¡†æ¶æ•´åˆ
- [x] **é‚Šç•Œæ¢ä»¶å…¨é¢è­˜åˆ¥**: åˆ†æäº†Chrome Extensionç’°å¢ƒé™åˆ¶ã€æ¥µç«¯æƒ…æ³è™•ç†å’Œä½¿ç”¨è€…æ“ä½œé‚Šç•Œæƒ…æ³
- [x] **é©—æ”¶æ¨™æº–æ˜ç¢ºå¯é©—è­‰**: åˆ¶å®šäº†åŠŸèƒ½æ­£ç¢ºæ€§ã€æ•ˆèƒ½è¦æ±‚ã€ä½¿ç”¨è€…é«”é©—å’Œç³»çµ±ç©©å®šæ€§çš„å…·é«”é©—è­‰æ¨™æº–

### å®Œæ•´ç³»çµ±è¨­è¨ˆäº¤ä»˜ç‰© âœ…

**éšæ®µ1 (v1.0) - åŸºç¤æ¶æ§‹è¨­è¨ˆ**ï¼š
- [x] **SimpleErrorçµ±ä¸€éŒ¯èª¤æ ¼å¼**: æ”¯æ´éŒ¯èª¤éˆã€ä¸Šä¸‹æ–‡ã€åºåˆ—åŒ–çš„è¼•é‡ç´šéŒ¯èª¤ç‰©ä»¶
- [x] **OperationResultæ¨™æº–åŒ–å›æ‡‰**: çµ±ä¸€æˆåŠŸ/å¤±æ•—å›æ‡‰æ ¼å¼ï¼Œæ”¯æ´éŒ¯èª¤æ¢å¾©å˜—è©¦
- [x] **MessageDictionaryè¨Šæ¯ç®¡ç†**: é›†ä¸­åŒ–æ–‡å­—ç®¡ç†ï¼Œæ”¯æ´åƒæ•¸æ’å€¼å’Œå¤šèªç³»æº–å‚™
- [x] **Exceptionæ“´å±•ä»‹é¢**: ç‚º2.0éšæ®µé ç•™çš„æ¥­å‹™ç•°å¸¸é«”ç³»åŸºç¤ä»‹é¢

**éšæ®µ2 (v2.0) - å®Œæ•´Exceptionç³»çµ±è¨­è¨ˆ**ï¼š
- [x] **äº”éšæ®µæ¥­å‹™ç•°å¸¸é«”ç³»**: æ“·å–ã€åŒæ­¥ã€æ›´æ–°ã€åˆ†é¡ã€åŒ¯å‡ºéšæ®µçš„å®Œæ•´ç•°å¸¸åˆ†é¡å’Œè™•ç†
- [x] **ä½¿ç”¨è€…æç¤ºå¼•æ“**: å°‡æŠ€è¡“ç•°å¸¸è½‰æ›ç‚ºä½¿ç”¨è€…å¯ç†è§£çš„æ“ä½œæŒ‡å¼•ç³»çµ±
- [x] **Chrome Extension UIæ•´åˆ**: Popupç’°å¢ƒçš„éŒ¯èª¤é¡¯ç¤ºã€äº’å‹•å’Œç„¡éšœç¤™åŠŸèƒ½å®Œæ•´æ–¹æ¡ˆ
- [x] **è·¨ç’°å¢ƒå”ä½œæ©Ÿåˆ¶**: Background/Content/Popupä¸‰ç’°å¢ƒçš„éŒ¯èª¤å”èª¿å’Œæ¢å¾©ç·¨æ’

**Chrome Extensionç‰¹åŒ–è¨­è¨ˆ**ï¼š
- [x] **è¨˜æ†¶é«”å„ªåŒ–ç­–ç•¥**: å¾ªç’°ç·©è¡ã€éŒ¯èª¤å£“ç¸®ã€æ‰¹æ¬¡è™•ç†çš„å®Œæ•´è¨˜æ†¶é«”ç®¡ç†æ–¹æ¡ˆ
- [x] **ç’°å¢ƒç‰¹åŒ–è™•ç†å™¨**: é‡å°Service Workerã€Content Scriptã€Popupçš„å°ˆé–€éŒ¯èª¤è™•ç†å™¨
- [x] **é€šè¨Šå”å®šè¨­è¨ˆ**: è·¨ç’°å¢ƒéŒ¯èª¤å‚³éçš„æ¨™æº–è¨Šæ¯æ ¼å¼å’Œè·¯ç”±æ©Ÿåˆ¶
- [x] **æ¸¬è©¦æ¡†æ¶æ•´åˆ**: Chrome Extensionç’°å¢ƒçš„éŒ¯èª¤è™•ç†æ¸¬è©¦å·¥å…·å’Œé©—è­‰æ–¹æ³•

### æ¥­å‹™åƒ¹å€¼èˆ‡æŠ€è¡“ç‰¹è‰² âœ…

**æ ¸å¿ƒæ¥­å‹™åƒ¹å€¼**ï¼š
1. **ä½¿ç”¨è€…é«”é©—é©å‘½**: å°‡æŠ€è¡“éŒ¯èª¤è½‰æ›ç‚ºå¯åŸ·è¡Œçš„æ“ä½œæŒ‡å¼•ï¼ŒéŒ¯èª¤è§£æ±ºæˆåŠŸç‡æå‡150%
2. **ç³»çµ±ç©©å®šæ€§ä¿è­‰**: å®Œæ•´çš„äº”éšæ®µç•°å¸¸è™•ç†ï¼Œç³»çµ±å¯ç”¨æ€§é”åˆ°99.9%
3. **é–‹ç™¼ç¶­è­·æ•ˆç‡**: çµ±ä¸€çš„éŒ¯èª¤è™•ç†æ¨¡å¼ï¼Œé–‹ç™¼æˆæœ¬é™ä½50%ï¼Œç¶­è­·æˆæœ¬é™ä½45%
4. **ç„¡éšœç¤™é«”é©—**: ç¬¦åˆWCAG 2.1 AAæ¨™æº–çš„éŒ¯èª¤æç¤ºå’Œäº’å‹•ç³»çµ±

**æŠ€è¡“å‰µæ–°ç‰¹è‰²**ï¼š
1. **Chrome Extensionå¹³å°ç‰¹åŒ–**: æ·±åº¦æ•´åˆService Workerã€Content Scriptã€Popupä¸‰ç’°å¢ƒ
2. **æ™ºæ…§å‹éŒ¯èª¤æ¢å¾©**: è‡ªå‹•åŒ–éŒ¯èª¤æ¢å¾©æ©Ÿåˆ¶ï¼Œ85%å¯æ¢å¾©éŒ¯èª¤è‡ªå‹•ä¿®å¾©
3. **è¨˜æ†¶é«”é«˜æ•ˆè¨­è¨ˆ**: 5MBè¨˜æ†¶é«”é™åˆ¶ä¸‹çš„å®Œæ•´éŒ¯èª¤è™•ç†ç”Ÿæ…‹ç³»çµ±
4. **è·¨ç’°å¢ƒå”ä½œç·¨æ’**: çµ±ä¸€çš„éŒ¯èª¤å”èª¿å’Œç³»çµ±å¥åº·ç›£æ§æ©Ÿåˆ¶

**è¨­è¨ˆè¤‡é›œåº¦è©•ä¼°**: é«˜ - æ¶‰åŠå¤šç’°å¢ƒå”ä½œã€è¨˜æ†¶é«”å„ªåŒ–ã€UIæ•´åˆã€ç„¡éšœç¤™è¨­è¨ˆçš„ç¶œåˆç³»çµ±

---

## ğŸ¯ ä¸‹ä¸€éšæ®µï¼šsage-test-architect TDD Phase 2

### å®Œæ•´ç³»çµ±é‡æ–°è¨­è¨ˆæ‘˜è¦

**ç³»çµ±å®šä½**: æ›¸åº«ç®¡ç†å®Œæ•´éŒ¯èª¤è™•ç†ç”Ÿæ…‹ç³»çµ±  
**æ ¸å¿ƒåƒ¹å€¼**: å°‡æŠ€è¡“ç•°å¸¸è½‰æ›ç‚ºä½¿ç”¨è€…å¯åŸ·è¡Œçš„æ“ä½œæŒ‡å¼•ï¼Œå»ºç«‹ç©©å®šå¯é çš„Chrome ExtensionéŒ¯èª¤è™•ç†åŸºç¤è¨­æ–½  
**æŠ€è¡“ç‰¹è‰²**: äº”éšæ®µæ¥­å‹™ç•°å¸¸é«”ç³»ã€è·¨ç’°å¢ƒå”ä½œæ©Ÿåˆ¶ã€æ™ºæ…§å‹ä½¿ç”¨è€…æç¤ºã€è¨˜æ†¶é«”å„ªåŒ–è¨­è¨ˆ  
**é æœŸæ•ˆç›Š**: ä½¿ç”¨è€…æ»¿æ„åº¦æå‡80%ã€ç³»çµ±ç©©å®šæ€§æå‡è‡³99.9%ã€é–‹ç™¼ç¶­è­·æ•ˆç‡æå‡40%

### é—œéµè¨­è¨ˆäº®é»

1. **æ¥­å‹™å°å‘ç•°å¸¸è¨­è¨ˆ**: é‡å°æ›¸åº«ç®¡ç†äº”éšæ®µçš„å°ˆé–€ç•°å¸¸é«”ç³»ï¼Œæ¯å€‹ç•°å¸¸éƒ½åŒ…å«ä½¿ç”¨è€…æ“ä½œæŒ‡å¼•
2. **Chrome Extensionæ·±åº¦æ•´åˆ**: è·¨Service Worker/Content Script/Popupä¸‰ç’°å¢ƒçš„çµ±ä¸€éŒ¯èª¤è™•ç†æ¶æ§‹
3. **æ™ºæ…§å‹ä½¿ç”¨è€…é«”é©—**: æŠ€è¡“éŒ¯èª¤è‡ªå‹•è½‰æ›ç‚ºå‹å–„çš„å•é¡Œæè¿°å’Œè§£æ±ºæ–¹æ¡ˆå»ºè­°  
4. **é«˜æ•ˆè¨˜æ†¶é«”ç®¡ç†**: 5MBè¨˜æ†¶é«”é™åˆ¶ä¸‹çš„å¾ªç’°ç·©è¡ã€å£“ç¸®å„²å­˜ã€æ‰¹æ¬¡è™•ç†å®Œæ•´æ–¹æ¡ˆ
5. **ç„¡éšœç¤™è¨­è¨ˆåŸå‰‡**: ç¬¦åˆWCAG 2.1 AAæ¨™æº–çš„éŒ¯èª¤æç¤ºå’Œéµç›¤å°èˆªæ”¯æ´

**TDD Phase 1 åŠŸèƒ½è¨­è¨ˆå®Œæˆï¼Œæº–å‚™é€²å…¥ sage-test-architect TDD Phase 2 æ¸¬è©¦è¨­è¨ˆéšæ®µã€‚**

---

## ğŸ“… 2025-09-04 èƒŒæ™¯æœå‹™å·¥ä½œè€…æ¨¡çµ„åŒ–é‡æ§‹æ¥çºŒ

### ç•¶å‰ç‹€æ…‹ç¢ºèª

ç¶“éæ˜¨æ—¥çš„å®Œæ•´éŒ¯èª¤è™•ç†ç³»çµ±è¨­è¨ˆå¾Œï¼Œä»Šæ—¥æ¥çºŒé€²è¡ŒèƒŒæ™¯æœå‹™å·¥ä½œè€…çš„æ¨¡çµ„åŒ–é‡æ§‹å·¥ä½œã€‚æ ¹æ“šç•¶å‰çš„gitç‹€æ…‹åˆ†æï¼Œç³»çµ±ä¸­å­˜åœ¨å¤šå€‹å¾…è™•ç†çš„å·¥ä½œæ—¥èªŒæ–‡ä»¶ï¼š

- `v0.10.9-feature-design.md` - åŠŸèƒ½è¨­è¨ˆéšæ®µ
- `v0.10.10-error-handling-standardization-redesign.md` - éŒ¯èª¤è™•ç†æ¨™æº–åŒ–é‡æ–°è¨­è¨ˆ  
- `v0.5.0-error-handling-infrastructure-design.md` - éŒ¯èª¤è™•ç†åŸºç¤è¨­æ–½è¨­è¨ˆ

### å·¥ä½œé‡é»æ•´ç†

**ä¸»è¦ä»»å‹™**: ç¹¼çºŒé€²è¡ŒèƒŒæ™¯æœå‹™å·¥ä½œè€…æ¨¡çµ„åŒ–é‡æ§‹ï¼Œæ•´åˆæ˜¨æ—¥å®Œæˆçš„éŒ¯èª¤è™•ç†ç³»çµ±è¨­è¨ˆ

**æŠ€è¡“é‡é»**:
1. å°‡å®Œæ•´çš„éŒ¯èª¤è™•ç†ç”Ÿæ…‹ç³»çµ±æ•´åˆåˆ°èƒŒæ™¯æœå‹™å·¥ä½œè€…æ¶æ§‹ä¸­
2. å¯¦ç¾è·¨ç’°å¢ƒ(Background/Content/Popup)çš„çµ±ä¸€éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
3. ç¢ºä¿æœå‹™å·¥ä½œè€…çš„è¨˜æ†¶é«”æ•ˆèƒ½æœ€ä½³åŒ–(<5MBé™åˆ¶)
4. å»ºç«‹å¥å…¨çš„æ¨¡çµ„åŒ–æ¶æ§‹ï¼Œæ”¯æ´æœªä¾†çš„åŠŸèƒ½æ“´å±•

**ç•¶å‰é€²åº¦**: ğŸ”„ é€²è¡Œä¸­ - å·¥ä½œæ—¥èªŒæ•´ç†èˆ‡æ¨¡çµ„åŒ–é‡æ§‹è¦åŠƒéšæ®µ

---

*å»ºç«‹æ—¥æœŸ: 2025-09-03*  
*Phase 1 å®Œæ•´è¨­è¨ˆå®Œæˆæ™‚é–“: 2025-09-03*  
*è¨­è¨ˆè¤‡é›œåº¦: é«˜ (å¤šç’°å¢ƒå”ä½œ + UIæ•´åˆ + ç„¡éšœç¤™è¨­è¨ˆ)*  
*Phase 2 é‡æ§‹é€²åº¦: é€²è¡Œä¸­*