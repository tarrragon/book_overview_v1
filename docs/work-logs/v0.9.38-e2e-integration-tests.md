# UC-01 ç«¯åˆ°ç«¯æ•´åˆæ¸¬è©¦åŠŸèƒ½è¨­è¨ˆå·¥ä½œæ—¥èªŒ

**ç‰ˆæœ¬**: v0.9.38  
**å»ºç«‹æ™‚é–“**: 2025-08-25  
**TDDéšæ®µ**: Phase 1 - åŠŸèƒ½è¨­è¨ˆå¸«  
**åŠŸèƒ½åç¨±**: UC-01 æ›¸ç±è³‡æ–™æå–å®Œæ•´æµç¨‹ç«¯åˆ°ç«¯æ•´åˆæ¸¬è©¦  

## ğŸ¯ åŠŸèƒ½éœ€æ±‚åˆ†æ

### é€™å€‹åŠŸèƒ½è¦è§£æ±ºä»€éº¼å•é¡Œï¼Ÿ

**æ ¸å¿ƒå•é¡Œ**ï¼šç›®å‰å°ˆæ¡ˆç¼ºä¹å®Œæ•´çš„ç«¯åˆ°ç«¯æ•´åˆæ¸¬è©¦ï¼Œç„¡æ³•ç¢ºä¿å¾ä½¿ç”¨è€…æ“ä½œåˆ°è³‡æ–™æŒä¹…åŒ–çš„æ•´å€‹å·¥ä½œæµç¨‹æ­£ç¢ºé‹è¡Œã€‚

**å…·é«”å•é¡Œè­˜åˆ¥**ï¼š

1. **å·¥ä½œæµç¨‹é©—è­‰ç¼ºå£**ï¼š
   - ä½¿ç”¨è€…é»æ“Š Chrome Extension â†’ Popup é–‹å•Ÿ â†’ è³‡æ–™æå– â†’ å„²å­˜å®Œæˆçš„å®Œæ•´éˆè·¯æœªç¶“éå®Œæ•´æ¸¬è©¦
   - è·¨å…ƒä»¶çš„äº‹ä»¶å‚³éå’Œé€šè¨Šæ©Ÿåˆ¶ç¼ºä¹ç«¯åˆ°ç«¯é©—è­‰
   - Chrome Extension ç‰¹æœ‰çš„å¤šä¸Šä¸‹æ–‡ç’°å¢ƒï¼ˆBackground, Content Script, Popupï¼‰é–“çš„å”ä½œæœªå®Œæ•´æ¸¬è©¦

2. **çœŸå¯¦å ´æ™¯æ¨¡æ“¬ä¸è¶³**ï¼š
   - ç¾æœ‰æ¸¬è©¦å¤šç‚ºå–®å…ƒæ¸¬è©¦ï¼Œç¼ºä¹çœŸå¯¦ä½¿ç”¨è€…æ“ä½œå ´æ™¯çš„æ¨¡æ“¬
   - Readmoo é é¢çš„çœŸå¯¦ DOM çµæ§‹å’Œè³‡æ–™æå–å ´æ™¯æœªå®Œæ•´è¦†è“‹
   - éŒ¯èª¤æ¢å¾©å’Œé‡è©¦æ©Ÿåˆ¶åœ¨çœŸå¯¦å ´æ™¯ä¸‹çš„è¡¨ç¾æœªé©—è­‰

3. **ç³»çµ±æ•´åˆé¢¨éšª**ï¼š
   - å„æ¨¡çµ„å–®ç¨æ¸¬è©¦é€šéï¼Œä½†æ•´åˆå¾Œå¯èƒ½å‡ºç¾æœªçŸ¥å•é¡Œ
   - äº‹ä»¶é©…å‹•æ¶æ§‹åœ¨è¤‡é›œå·¥ä½œæµç¨‹ä¸­çš„ç©©å®šæ€§æœªç¶“é©—è­‰
   - Chrome Extension API çš„å¯¦éš›ä½¿ç”¨å ´æ™¯å’Œé™åˆ¶æœªå®Œæ•´æ¸¬è©¦

### ä½¿ç”¨è€…çš„å…·é«”ä½¿ç”¨å ´æ™¯æ˜¯ä»€éº¼ï¼Ÿ

**ä¸»è¦ä½¿ç”¨å ´æ™¯**ï¼šæ›¸ç±æ”¶é›†è€…ç¬¬ä¸€æ¬¡ä½¿ç”¨æˆ–å®šæœŸä½¿ç”¨ Extension æå– Readmoo æ›¸åº«è³‡æ–™

**è©³ç´°ä½¿ç”¨è€…æ“ä½œåºåˆ—**ï¼š

1. **å‰ç½®å ´æ™¯è¨­å®š**ï¼š
   - ä½¿ç”¨è€…å·²åœ¨ Chrome ç€è¦½å™¨å®‰è£ Extension
   - ä½¿ç”¨è€…å·²ç™»å…¥ Readmoo å¸³è™Ÿ
   - ä½¿ç”¨è€…è¨ªå• Readmoo æ›¸åº«é é¢ï¼ˆhttps://readmoo.com/shelfï¼‰

2. **æ ¸å¿ƒæ“ä½œæµç¨‹**ï¼š
   - **Step 1**ï¼šä½¿ç”¨è€…é»æ“Š Chrome Extension åœ–ç¤º
   - **Step 2**ï¼šPopup è¦–çª—é–‹å•Ÿï¼Œé¡¯ç¤ºç•¶å‰ç‹€æ…‹
   - **Step 3**ï¼šä½¿ç”¨è€…é»æ“Šã€Œæå–æ›¸ç±è³‡æ–™ã€æŒ‰éˆ•
   - **Step 4**ï¼šç³»çµ±é¡¯ç¤ºæå–é€²åº¦å’Œç‹€æ…‹
   - **Step 5**ï¼šæå–å®Œæˆï¼Œé¡¯ç¤ºæˆåŠŸè¨Šæ¯å’Œæ›¸ç±æ•¸é‡
   - **Step 6**ï¼šä½¿ç”¨è€…å¯é¸æ“‡æŸ¥çœ‹è©³ç´°è³‡æ–™æˆ–é—œé–‰ Popup

3. **é æœŸä½¿ç”¨è€…é«”é©—**ï¼š
   - **ç›´è§€æ“ä½œ**ï¼šå–®æ¬¡é»æ“Šå³å¯å®Œæˆè³‡æ–™æå–
   - **å³æ™‚åé¥‹**ï¼šæ“ä½œéç¨‹ä¸­æœ‰æ¸…æ¥šçš„é€²åº¦æç¤º
   - **çµæœç¢ºèª**ï¼šæ˜ç¢ºé¡¯ç¤ºæå–çµæœå’Œæ›¸ç±æ•¸é‡
   - **éŒ¯èª¤è™•ç†**ï¼šç•¶ç™¼ç”ŸéŒ¯èª¤æ™‚ï¼Œæä¾›æ¸…æ¥šçš„éŒ¯èª¤è¨Šæ¯å’Œè§£æ±ºå»ºè­°

### åŠŸèƒ½çš„æ ¸å¿ƒåƒ¹å€¼å’ŒæœŸæœ›æ•ˆæœæ˜¯ä»€éº¼ï¼Ÿ

**æ ¸å¿ƒåƒ¹å€¼**ï¼š

1. **å“è³ªä¿è­‰åƒ¹å€¼**ï¼š
   - ç¢ºä¿å®Œæ•´å·¥ä½œæµç¨‹çš„æ­£ç¢ºæ€§å’Œç©©å®šæ€§
   - æä¾›å° v1.0 ç™¼å¸ƒçš„ä¿¡å¿ƒä¿è­‰
   - å»ºç«‹é•·æœŸç¶­è­·å’Œå›æ­¸æ¸¬è©¦çš„åŸºç¤

2. **ä½¿ç”¨è€…é«”é©—åƒ¹å€¼**ï¼š
   - é©—è­‰çœŸå¯¦ä½¿ç”¨å ´æ™¯ä¸‹çš„ç³»çµ±è¡¨ç¾
   - ç¢ºä¿ä½¿ç”¨è€…æ“ä½œçš„æµæš¢æ€§å’Œç›´è§€æ€§
   - ä¿è­‰éŒ¯èª¤è™•ç†æ©Ÿåˆ¶åœ¨å¯¦éš›ä½¿ç”¨ä¸­çš„æœ‰æ•ˆæ€§

3. **é–‹ç™¼ç¶­è­·åƒ¹å€¼**ï¼š
   - å»ºç«‹ç³»çµ±è¡Œç‚ºçš„é»ƒé‡‘æ¨™æº–
   - æä¾›é‡æ§‹å’ŒåŠŸèƒ½æ“´å±•çš„å®‰å…¨ç¶²
   - è¨˜éŒ„ç³»çµ±é æœŸè¡Œç‚ºï¼Œå”åŠ©é™¤éŒ¯å’Œå•é¡Œè¨ºæ–·

**æœŸæœ›æ•ˆæœ**ï¼š

- **çŸ­æœŸæ•ˆæœ**ï¼šå®Œæ•´é©—è­‰ UC-01 å·¥ä½œæµç¨‹ï¼Œç‚º v1.0 ç™¼å¸ƒæä¾›å“è³ªä¿è­‰
- **ä¸­æœŸæ•ˆæœ**ï¼šå»ºç«‹ç«¯åˆ°ç«¯æ¸¬è©¦æ¡†æ¶ï¼Œæ”¯æ´å¾ŒçºŒåŠŸèƒ½é–‹ç™¼å’Œå›æ­¸æ¸¬è©¦
- **é•·æœŸæ•ˆæœ**ï¼šç¢ºä¿ç³»çµ±åœ¨å¾ŒçºŒç¶­è­·å’Œæ“´å±•éç¨‹ä¸­çš„ç©©å®šæ€§

## ğŸ”§ åŠŸèƒ½è¦æ ¼è¨­è¨ˆ

### åŠŸèƒ½çš„è¼¸å…¥æ˜¯ä»€éº¼ï¼Ÿ

**ä½¿ç”¨è€…äº’å‹•è¼¸å…¥**ï¼š

1. **ä½¿ç”¨è€…æ“ä½œè¼¸å…¥**ï¼š
   - Chrome Extension åœ–ç¤ºé»æ“Šäº‹ä»¶
   - Popup è¦–çª—ä¸­ã€Œæå–æ›¸ç±è³‡æ–™ã€æŒ‰éˆ•é»æ“Š
   - å¯é¸çš„ Overview é é¢é–‹å•Ÿæ“ä½œ

2. **é é¢ç’°å¢ƒè¼¸å…¥**ï¼š
   - ç•¶å‰é é¢ URLï¼ˆå¿…é ˆç‚º Readmoo æ›¸åº«ç›¸é—œé é¢ï¼‰
   - é é¢ DOM çµæ§‹ï¼ˆåŒ…å«æ›¸ç±è³‡æ–™å…ƒç´ ï¼‰
   - ä½¿ç”¨è€…ç™»å…¥ç‹€æ…‹ï¼ˆå½±éŸ¿å¯æå–çš„æ›¸ç±æ•¸æ“šï¼‰

3. **ç³»çµ±ç‹€æ…‹è¼¸å…¥**ï¼š
   - Chrome Extension å®‰è£å’Œå•Ÿç”¨ç‹€æ…‹
   - ç¾æœ‰å„²å­˜è³‡æ–™ç‹€æ…‹ï¼ˆç”¨æ–¼å»é‡é‚è¼¯ï¼‰
   - ç¶²è·¯é€£æ¥ç‹€æ…‹

**æ¸¬è©¦è³‡æ–™è¼¸å…¥**ï¼š

1. **æ¨¡æ“¬é é¢è³‡æ–™**ï¼š
   ```javascript
   const mockReadmooPage = {
     url: 'https://readmoo.com/shelf',
     bookElements: [
       {
         coverElement: '<div class="book-cover">',
         titleElement: '<h3 class="book-title">',
         progressElement: '<div class="reading-progress">',
         // ... å…¶ä»–æ›¸ç±å…ƒç´ 
       }
     ],
     totalBooks: 12
   };
   ```

2. **Chrome Extension ç’°å¢ƒåƒæ•¸**ï¼š
   ```javascript
   const testEnvironment = {
     extensionId: 'test-extension-id',
     tabId: 'test-tab-id',
     isPopupOpen: false,
     storageQuota: '5MB'
   };
   ```

### åŠŸèƒ½çš„è¼¸å‡ºæ˜¯ä»€éº¼ï¼Ÿ

**ç›´æ¥è¼¸å‡ºçµæœ**ï¼š

1. **Popup UI å›æ‡‰**ï¼š
   - æå–é€²åº¦æŒ‡ç¤ºå™¨æ›´æ–°
   - æˆåŠŸè¨Šæ¯é¡¯ç¤ºï¼šã€ŒæˆåŠŸæå– X æœ¬æ›¸ç±ã€
   - éŒ¯èª¤è¨Šæ¯ï¼ˆå¦‚æœç™¼ç”ŸéŒ¯èª¤ï¼‰
   - æ“ä½œæŒ‰éˆ•ç‹€æ…‹è®ŠåŒ–ï¼ˆè¼‰å…¥ä¸­ã€å®Œæˆã€éŒ¯èª¤ï¼‰

2. **è³‡æ–™æŒä¹…åŒ–çµæœ**ï¼š
   ```javascript
   const persistedData = {
     books: [
       {
         id: 'stable-book-id-123',
         title: 'æ›¸ç±æ¨™é¡Œ',
         cover: 'https://...',
         progress: 85,
         source: 'readmoo',
         extractedAt: '2025-08-25T...',
         // ... å®Œæ•´æ›¸ç±è³‡æ–™
       }
     ],
     metadata: {
       totalBooks: 12,
       lastUpdate: '2025-08-25T...',
       extractionDuration: 1250 // ms
     }
   };
   ```

3. **ç³»çµ±äº‹ä»¶è¼¸å‡º**ï¼š
   - `EXTRACTION.DATA.STARTED` äº‹ä»¶
   - `EXTRACTION.PROGRESS.UPDATED` äº‹ä»¶
   - `EXTRACTION.DATA.COMPLETED` äº‹ä»¶
   - `STORAGE.SAVE.COMPLETED` äº‹ä»¶

**å‰¯ä½œç”¨å’Œç³»çµ±è®Šæ›´**ï¼š

1. **Chrome Storage è®Šæ›´**ï¼š
   - æ–°å¢æˆ–æ›´æ–°æ›¸ç±è³‡æ–™è¨˜éŒ„
   - æ›´æ–°ç³»çµ± metadata å’Œçµ±è¨ˆè³‡è¨Š

2. **UI ç‹€æ…‹è®Šæ›´**ï¼š
   - Popup ä»‹é¢ç‹€æ…‹è½‰æ›
   - æŒ‰éˆ•å’ŒæŒ‡ç¤ºå™¨çš„è¦–è¦ºå›é¥‹æ›´æ–°

3. **ç³»çµ±æ—¥èªŒè¨˜éŒ„**ï¼š
   - æ“ä½œæˆåŠŸ/å¤±æ•—çš„è¨˜éŒ„
   - æ•ˆèƒ½æŒ‡æ¨™è¨˜éŒ„ï¼ˆæå–æ™‚é–“ã€æ›¸ç±æ•¸é‡ï¼‰

### æ­£å¸¸æµç¨‹çš„è©³ç´°æ­¥é©Ÿæ˜¯ä»€éº¼ï¼Ÿ

**Phase 1: åˆå§‹åŒ–éšæ®µ**

```
Step 1.1: ä½¿ç”¨è€…é»æ“Š Extension åœ–ç¤º
â”œâ”€â”€ Chrome è§¸ç™¼ popup.html è¼‰å…¥
â”œâ”€â”€ PopupController åˆå§‹åŒ–
â”œâ”€â”€ EventManager è¨»å†Šäº‹ä»¶ç›£è½å™¨
â””â”€â”€ æª¢æŸ¥ç•¶å‰é é¢æ˜¯å¦ç‚º Readmoo æ›¸åº«é é¢

Step 1.2: Popup ä»‹é¢é¡¯ç¤º
â”œâ”€â”€ è®€å–ç¾æœ‰æ›¸ç±æ•¸é‡å¾ Chrome Storage
â”œâ”€â”€ é¡¯ç¤ºç•¶å‰ç‹€æ…‹ï¼šã€Œç›®å‰å…±æœ‰ X æœ¬æ›¸ç±ã€
â”œâ”€â”€ å•Ÿç”¨ã€Œæå–æ›¸ç±è³‡æ–™ã€æŒ‰éˆ•
â””â”€â”€ è¨»å†ŠæŒ‰éˆ•é»æ“Šäº‹ä»¶ç›£è½å™¨
```

**Phase 2: è³‡æ–™æå–éšæ®µ**

```
Step 2.1: ä½¿ç”¨è€…é»æ“Šã€Œæå–æ›¸ç±è³‡æ–™ã€æŒ‰éˆ•
â”œâ”€â”€ è§¸ç™¼ EXTRACTION.REQUEST.STARTED äº‹ä»¶
â”œâ”€â”€ Popup é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
â”œâ”€â”€ åœç”¨æŒ‰éˆ•é˜²æ­¢é‡è¤‡é»æ“Š
â””â”€â”€ ç™¼é€è¨Šæ¯çµ¦ Content Script

Step 2.2: Content Script æ¥æ”¶æå–è«‹æ±‚
â”œâ”€â”€ BookDataExtractor åˆå§‹åŒ–
â”œâ”€â”€ ReadmooAdapter é–‹å§‹ DOM æƒæ
â”œâ”€â”€ ç™¼é€é€²åº¦æ›´æ–°äº‹ä»¶åˆ° Background
â””â”€â”€ é€ä¸€æå–æ›¸ç±å…ƒç´ è³‡æ–™

Step 2.3: è³‡æ–™æå–è™•ç†
â”œâ”€â”€ æƒæé é¢ä¸­æ‰€æœ‰æ›¸ç±å…ƒç´ 
â”œâ”€â”€ æå–æ¯æœ¬æ›¸çš„åŸºæœ¬è³‡æ–™ï¼ˆtitle, cover, progressï¼‰
â”œâ”€â”€ ç”Ÿæˆ stable book ID ç”¨æ–¼å»é‡
â”œâ”€â”€ é©—è­‰æå–è³‡æ–™çš„å®Œæ•´æ€§
â””â”€â”€ ç™¼é€ EXTRACTION.DATA.EXTRACTED äº‹ä»¶
```

**Phase 3: è³‡æ–™è™•ç†å’Œå„²å­˜éšæ®µ**

```
Step 3.1: Background æ¥æ”¶æå–è³‡æ–™
â”œâ”€â”€ æ¥æ”¶ä¾†è‡ª Content Script çš„æ›¸ç±è³‡æ–™
â”œâ”€â”€ åŸ·è¡Œè³‡æ–™é©—è­‰å’Œæ¸…ç†
â”œâ”€â”€ æ‡‰ç”¨å»é‡é‚è¼¯ï¼ˆèˆ‡ç¾æœ‰è³‡æ–™æ¯”è¼ƒï¼‰
â””â”€â”€ æº–å‚™å„²å­˜åˆ° Chrome Storage

Step 3.2: è³‡æ–™æŒä¹…åŒ–
â”œâ”€â”€ å°‡è™•ç†å¾Œçš„è³‡æ–™å¯«å…¥ Chrome Storage
â”œâ”€â”€ æ›´æ–° metadataï¼ˆç¸½æ›¸ç±æ•¸é‡ã€æœ€å¾Œæ›´æ–°æ™‚é–“ï¼‰
â”œâ”€â”€ è§¸ç™¼ STORAGE.SAVE.COMPLETED äº‹ä»¶
â””â”€â”€ é€šçŸ¥ Popup æ›´æ–°ä»‹é¢

Step 3.3: å®Œæˆç¢ºèª
â”œâ”€â”€ Popup æ¥æ”¶å®Œæˆé€šçŸ¥
â”œâ”€â”€ æ›´æ–°ä»‹é¢é¡¯ç¤ºçµæœ
â”œâ”€â”€ æ¢å¾©æŒ‰éˆ•å¯ç”¨ç‹€æ…‹
â””â”€â”€ è¨˜éŒ„æ“ä½œæ—¥èªŒ
```

**Phase 4: ä½¿ç”¨è€…ç¢ºèªéšæ®µ**

```
Step 4.1: çµæœå±•ç¤º
â”œâ”€â”€ é¡¯ç¤ºæˆåŠŸè¨Šæ¯ï¼šã€ŒæˆåŠŸæå– X æœ¬æ›¸ç±ã€
â”œâ”€â”€ æ›´æ–°æ›¸ç±ç¸½æ•¸é¡¯ç¤º
â”œâ”€â”€ æä¾›ã€ŒæŸ¥çœ‹è©³ç´°è³‡æ–™ã€é€£çµ
â””â”€â”€ è¨˜éŒ„ä½¿ç”¨è€…æ»¿æ„åº¦æŒ‡æ¨™

Step 4.2: å¾ŒçºŒæ“ä½œé¸é …
â”œâ”€â”€ ä½¿ç”¨è€…å¯é¸æ“‡é—œé–‰ Popup
â”œâ”€â”€ ä½¿ç”¨è€…å¯é¸æ“‡é–‹å•Ÿ Overview é é¢
â”œâ”€â”€ ä½¿ç”¨è€…å¯é¸æ“‡é€²è¡Œè³‡æ–™åŒ¯å‡º
â””â”€â”€ ç³»çµ±æº–å‚™ä¸‹ä¸€æ¬¡æ“ä½œ
```

### ç•°å¸¸æƒ…æ³çš„è™•ç†æ–¹å¼æ˜¯ä»€éº¼ï¼Ÿ

**éŒ¯èª¤åˆ†é¡å’Œè™•ç†ç­–ç•¥**ï¼š

**Category A: ç’°å¢ƒå’Œæ¬Šé™éŒ¯èª¤**

1. **é é¢ä¸ç¬¦åˆæ¢ä»¶éŒ¯èª¤**ï¼š
   ```javascript
   const pageValidationError = {
     condition: 'current page is not Readmoo shelf',
     userMessage: 'è«‹åœ¨ Readmoo æ›¸åº«é é¢ä½¿ç”¨æ­¤åŠŸèƒ½',
     action: 'disable extraction button',
     retry: false
   };
   ```

2. **Extension æ¬Šé™éŒ¯èª¤**ï¼š
   ```javascript
   const permissionError = {
     condition: 'content script injection failed',
     userMessage: 'ç„¡æ³•å­˜å–é é¢å…§å®¹ï¼Œè«‹é‡æ–°è¼‰å…¥é é¢å¾Œå†è©¦',
     action: 'show retry button',
     retry: true
   };
   ```

**Category B: è³‡æ–™æå–éŒ¯èª¤**

1. **DOM çµæ§‹è®Šæ›´éŒ¯èª¤**ï¼š
   ```javascript
   const domStructureError = {
     condition: 'book elements not found',
     userMessage: 'ç„¡æ³•æ‰¾åˆ°æ›¸ç±è³‡æ–™ï¼Œå¯èƒ½æ˜¯ç¶²ç«™çµæ§‹å·²æ›´æ–°',
     action: 'log technical details + show fallback options',
     retry: true,
     fallback: 'suggest manual refresh or report issue'
   };
   ```

2. **è³‡æ–™ä¸å®Œæ•´éŒ¯èª¤**ï¼š
   ```javascript
   const incompleteDataError = {
     condition: 'extracted data validation failed',
     userMessage: 'æå–çš„è³‡æ–™ä¸å®Œæ•´ï¼Œå·²æå–éƒ¨åˆ†è³‡æ–™',
     action: 'save partial results + show warning',
     retry: true
   };
   ```

**Category C: ç¶²è·¯å’Œæ•ˆèƒ½éŒ¯èª¤**

1. **ç¶²è·¯é€£æ¥éŒ¯èª¤**ï¼š
   ```javascript
   const networkError = {
     condition: 'network request timeout',
     userMessage: 'ç¶²è·¯é€£æ¥æœ‰å•é¡Œï¼Œè«‹æª¢æŸ¥ç¶²è·¯å¾Œé‡è©¦',
     action: 'show retry button + network diagnostic',
     retry: true,
     autoRetry: { attempts: 2, delay: 2000 }
   };
   ```

2. **è¨˜æ†¶é«”å’Œæ•ˆèƒ½éŒ¯èª¤**ï¼š
   ```javascript
   const performanceError = {
     condition: 'extraction timeout or memory exceeded',
     userMessage: 'è™•ç†æ™‚é–“éé•·ï¼Œå»ºè­°åˆ†æ‰¹æå–è³‡æ–™',
     action: 'suggest partial extraction strategy',
     retry: false
   };
   ```

**Category D: å„²å­˜å’Œç³»çµ±éŒ¯èª¤**

1. **å„²å­˜ç©ºé–“ä¸è¶³éŒ¯èª¤**ï¼š
   ```javascript
   const storageQuotaError = {
     condition: 'Chrome storage quota exceeded',
     userMessage: 'å„²å­˜ç©ºé–“ä¸è¶³ï¼Œå»ºè­°åŒ¯å‡ºè³‡æ–™å¾Œæ¸…ç†èˆŠè³‡æ–™',
     action: 'show cleanup options + export suggestion',
     retry: false
   };
   ```

2. **è³‡æ–™è¡çªéŒ¯èª¤**ï¼š
   ```javascript
   const dataConflictError = {
     condition: 'concurrent modification detected',
     userMessage: 'è³‡æ–™æ­£åœ¨å…¶ä»–åœ°æ–¹è¢«ä¿®æ”¹ï¼Œè«‹ç¨å¾Œå†è©¦',
     action: 'show retry with delay',
     retry: true,
     delay: 3000
   };
   ```

**çµ±ä¸€éŒ¯èª¤è™•ç†æµç¨‹**ï¼š

```
éŒ¯èª¤ç™¼ç”Ÿ â†’ éŒ¯èª¤åˆ†é¡ â†’ ç”Ÿæˆä½¿ç”¨è€…å‹å–„è¨Šæ¯ â†’ è¨˜éŒ„æŠ€è¡“è©³æƒ… â†’ æä¾›æ¢å¾©é¸é … â†’ æ›´æ–° UI ç‹€æ…‹
```

## ğŸ” é‚Šç•Œæ¢ä»¶åˆ†æ

### æ¥µç«¯è¼¸å…¥æƒ…æ³è­˜åˆ¥å’Œè™•ç†

**Empty State é‚Šç•Œæ¢ä»¶**ï¼š

1. **ç©ºæ›¸åº«é é¢**ï¼š
   ```javascript
   const emptyShelfCondition = {
     scenario: 'Readmoo shelf page with no books',
     expectedBehavior: 'show "no books found" message',
     testCase: 'should handle empty book shelf gracefully',
     validation: 'totalBooks === 0 && extraction completes successfully'
   };
   ```

2. **ç„¡æ•ˆçš„æ›¸ç±å…ƒç´ **ï¼š
   ```javascript
   const invalidBookElements = {
     scenario: 'book elements missing required attributes',
     expectedBehavior: 'skip invalid books + log warnings',
     testCase: 'should filter out malformed book data',
     validation: 'only valid books are saved + error count logged'
   };
   ```

**Large Dataset é‚Šç•Œæ¢ä»¶**ï¼š

1. **å¤§é‡æ›¸ç±è™•ç†**ï¼š
   ```javascript
   const largeDatasetCondition = {
     scenario: 'shelf page with 1000+ books',
     expectedBehavior: 'batch processing + progress updates',
     testCase: 'should handle large book collections efficiently',
     validation: 'extraction time < 30s && memory usage < 100MB'
   };
   ```

2. **é•·æ¨™é¡Œå’Œç‰¹æ®Šå­—ç¬¦**ï¼š
   ```javascript
   const specialCharacterHandling = {
     scenario: 'books with emoji, unicode, or very long titles',
     expectedBehavior: 'preserve all characters + truncate if necessary',
     testCase: 'should handle special characters in book data',
     validation: 'data integrity maintained + storage limits respected'
   };
   ```

**Timing å’Œ Racing Conditions**ï¼š

1. **å¿«é€Ÿé‡è¤‡é»æ“Š**ï¼š
   ```javascript
   const rapidClickCondition = {
     scenario: 'user clicks extraction button multiple times rapidly',
     expectedBehavior: 'ignore additional clicks during processing',
     testCase: 'should prevent duplicate extractions',
     validation: 'only one extraction process runs at a time'
   };
   ```

2. **é é¢å°èˆªä¸­æ–·**ï¼š
   ```javascript
   const navigationInterruption = {
     scenario: 'user navigates away during extraction',
     expectedBehavior: 'graceful cleanup + save partial results',
     testCase: 'should handle page navigation during extraction',
     validation: 'no memory leaks + partial data saved if applicable'
   };
   ```

### ç³»çµ±é™åˆ¶å’Œç´„æŸæ¢ä»¶

**Chrome Extension å¹³å°é™åˆ¶**ï¼š

1. **Memory é™åˆ¶**ï¼š
   - **Content Script**: æœ€å¤§ ~50MB è¨˜æ†¶é«”ä½¿ç”¨
   - **Background**: æœ€å¤§ ~100MB è¨˜æ†¶é«”ä½¿ç”¨
   - **è™•ç†ç­–ç•¥**: åˆ†æ‰¹è™•ç†å¤§é‡è³‡æ–™ï¼ŒåŠæ™‚æ¸…ç†æš«å­˜è®Šæ•¸

2. **Storage é™åˆ¶**ï¼š
   ```javascript
   const storageConstraints = {
     chromeStorage: {
       sync: '100KB per item, 512KB total',
       local: '5MB per extension'
     },
     handling: {
       compression: 'apply JSON compression for large datasets',
       chunking: 'split large datasets into multiple storage items',
       cleanup: 'automatic cleanup of old data when approaching limits'
     }
   };
   ```

3. **Execution Time é™åˆ¶**ï¼š
   - **Content Script**: é¿å…é•·æ™‚é–“åŸ·è¡Œé˜»å¡é é¢
   - **Background**: Service Worker å¯èƒ½è¢«çµ‚æ­¢
   - **è™•ç†ç­–ç•¥**: å¯¦æ–½åˆ†æ‰¹è™•ç†å’Œç‹€æ…‹æ¢å¾©æ©Ÿåˆ¶

**Readmoo å¹³å°ç‰¹å®šé™åˆ¶**ï¼š

1. **é é¢è¼‰å…¥ç‹€æ…‹ä¾è³´**ï¼š
   ```javascript
   const pageLoadingConstraints = {
     condition: 'books loaded dynamically via AJAX',
     handling: 'wait for DOM ready + polling for new elements',
     timeout: '10 seconds maximum wait time',
     fallback: 'extract currently visible books only'
   };
   ```

2. **åçˆ¬èŸ²æ©Ÿåˆ¶**ï¼š
   ```javascript
   const antiScrapingHandling = {
     rateLimit: 'respect reasonable extraction intervals',
     userAgent: 'use browser native user agent',
     interaction: 'simulate natural user interactions'
   };
   ```

**ç¶²è·¯å’Œæ•ˆèƒ½ç´„æŸ**ï¼š

1. **ç¶²è·¯é€£æ¥å“è³ª**ï¼š
   - **æ…¢é€Ÿç¶²è·¯**: å¢åŠ è¶…æ™‚æ™‚é–“ï¼Œæä¾›é€²åº¦å›é¥‹
   - **ä¸ç©©å®šé€£æ¥**: å¯¦æ–½é‡è©¦æ©Ÿåˆ¶å’ŒéŒ¯èª¤æ¢å¾©
   - **é›¢ç·šç‹€æ…‹**: å„ªé›…é™ç´šï¼Œæä¾›é›¢ç·šæç¤º

2. **ç€è¦½å™¨æ•ˆèƒ½é™åˆ¶**ï¼š
   ```javascript
   const performanceConstraints = {
     lowEndDevice: {
       cpuLimit: 'avoid heavy computation',
       memoryLimit: 'minimize memory footprint',
       strategy: 'reduce batch size + increase processing intervals'
     },
     backgroundThrottling: {
       condition: 'browser tab not active',
       handling: 'pause extraction + resume when tab becomes active'
     }
   };
   ```

### éŒ¯èª¤æƒ…æ³å’Œä¾‹å¤–ç‹€æ³è™•ç†ç­–ç•¥

**ç³»çµ±æ€§éŒ¯èª¤è™•ç†æ¶æ§‹**ï¼š

1. **å¤šå±¤éŒ¯èª¤æ•ç²**ï¼š
   ```javascript
   const errorHandlingLayers = {
     componentLevel: 'try-catch in each major component',
     eventLevel: 'error events in event-driven architecture',
     globalLevel: 'window.onerror + unhandledrejection handlers',
     chromeAPI: 'chrome.runtime.lastError checking'
   };
   ```

2. **éŒ¯èª¤åˆ†é¡å’Œè·¯ç”±**ï¼š
   ```javascript
   const errorClassification = {
     recoverable: {
       types: ['network timeout', 'temporary DOM changes'],
       action: 'automatic retry with exponential backoff'
     },
     userActionRequired: {
       types: ['permission denied', 'page navigation required'],
       action: 'clear error message + suggested user action'
     },
     systemFailure: {
       types: ['storage corruption', 'extension update required'],
       action: 'diagnostic information + support contact'
     }
   };
   ```

**å…·é«”éŒ¯èª¤æ¢å¾©æ©Ÿåˆ¶**ï¼š

1. **è³‡æ–™å®Œæ•´æ€§ä¿è­·**ï¼š
   ```javascript
   const dataIntegrityProtection = {
     transactional: 'all-or-nothing data updates',
     validation: 'pre-save data validation',
     backup: 'automatic backup before major operations',
     rollback: 'rollback capability for failed operations'
   };
   ```

2. **ä½¿ç”¨è€…é«”é©—ä¿è­·**ï¼š
   ```javascript
   const userExperienceProtection = {
     nonBlocking: 'errors should not freeze the UI',
     informative: 'clear error messages with actionable suggestions',
     recoverable: 'provide retry options where appropriate',
     graceful: 'fallback to partial functionality when possible'
   };
   ```

## ğŸ”Œ API/ä»‹é¢è¨­è¨ˆ

### ç«¯åˆ°ç«¯æ¸¬è©¦æ¡†æ¶ä»‹é¢å®šç¾©

**ä¸»è¦æ¸¬è©¦å”èª¿å™¨ä»‹é¢**ï¼š

```javascript
/**
 * E2E Integration Test Coordinator
 * å”èª¿æ•´å€‹ç«¯åˆ°ç«¯æ¸¬è©¦çš„åŸ·è¡Œæµç¨‹
 */
class E2EIntegrationTestCoordinator {
  /**
   * åˆå§‹åŒ–æ¸¬è©¦ç’°å¢ƒ
   * @param {Object} config - æ¸¬è©¦é…ç½®åƒæ•¸
   * @returns {Promise<TestEnvironment>} åˆå§‹åŒ–å®Œæˆçš„æ¸¬è©¦ç’°å¢ƒ
   */
  async initializeTestEnvironment(config) {
    // è¨­å®š Chrome Extension æ¸¬è©¦ç’°å¢ƒ
    // è¼‰å…¥ mock Readmoo é é¢
    // åˆå§‹åŒ–äº‹ä»¶ç›£è½å’Œç‹€æ…‹è¿½è¹¤
  }

  /**
   * åŸ·è¡Œå®Œæ•´çš„ UC-01 å·¥ä½œæµç¨‹æ¸¬è©¦
   * @param {TestScenario} scenario - æ¸¬è©¦å ´æ™¯é…ç½®
   * @returns {Promise<TestResult>} æ¸¬è©¦åŸ·è¡Œçµæœ
   */
  async executeUC01Workflow(scenario) {
    // Phase 1: åˆå§‹åŒ–é©—è­‰
    // Phase 2: ä½¿ç”¨è€…äº’å‹•æ¨¡æ“¬
    // Phase 3: è³‡æ–™æå–é©—è­‰
    // Phase 4: çµæœé©—è­‰
  }

  /**
   * æ¸…ç†æ¸¬è©¦ç’°å¢ƒ
   * @returns {Promise<void>}
   */
  async cleanupTestEnvironment() {
    // æ¸…ç†æ¸¬è©¦è³‡æ–™
    // é‡ç½® mock ç‹€æ…‹
    // é‡‹æ”¾æ¸¬è©¦è³‡æº
  }
}
```

**Chrome Extension ç’°å¢ƒæ¨¡æ“¬å™¨ä»‹é¢**ï¼š

```javascript
/**
 * Chrome Extension Environment Simulator
 * æ¨¡æ“¬çœŸå¯¦çš„ Chrome Extension åŸ·è¡Œç’°å¢ƒ
 */
class ChromeExtensionEnvironmentSimulator {
  /**
   * è¨­å®š Extension åŸ·è¡Œä¸Šä¸‹æ–‡
   * @param {ExtensionConfig} config - Extension é…ç½®
   */
  setupExtensionContext(config) {
    // æ¨¡æ“¬ Manifest V3 ç’°å¢ƒ
    // è¨­å®š Chrome API mocks
    // å»ºç«‹è·¨ä¸Šä¸‹æ–‡é€šè¨Šé€šé“
  }

  /**
   * æ¨¡æ“¬ Popup é–‹å•Ÿæ“ä½œ
   * @param {Object} tabInfo - æ¨™ç±¤è³‡è¨Š
   * @returns {Promise<PopupInstance>} Popup å¯¦ä¾‹
   */
  async openPopupWindow(tabInfo) {
    // è§¸ç™¼ popup.html è¼‰å…¥
    // åˆå§‹åŒ– PopupController
    // å»ºç«‹èˆ‡ Background çš„é€šè¨Š
  }

  /**
   * æ¨¡æ“¬ Content Script æ³¨å…¥
   * @param {Object} pageContext - é é¢ä¸Šä¸‹æ–‡
   * @returns {Promise<ContentScriptInstance>} Content Script å¯¦ä¾‹
   */
  async injectContentScript(pageContext) {
    // æ³¨å…¥ content-modular.js
    // åˆå§‹åŒ– DOM ç›£è½
    // å»ºç«‹äº‹ä»¶é€šè¨Šæ©‹æ¨‘
  }

  /**
   * æ¨¡æ“¬è·¨ä¸Šä¸‹æ–‡è¨Šæ¯å‚³é
   * @param {string} source - è¨Šæ¯ä¾†æº
   * @param {string} target - è¨Šæ¯ç›®æ¨™
   * @param {Object} message - è¨Šæ¯å…§å®¹
   */
  simulateMessagePassing(source, target, message) {
    // æ¨¡æ“¬ chrome.runtime.sendMessage
    // è™•ç†è¨Šæ¯è·¯ç”±å’Œå›æ‡‰
    // è¨˜éŒ„è¨Šæ¯å‚³éæ—¥èªŒ
  }
}
```

**Readmoo é é¢æ¨¡æ“¬å™¨ä»‹é¢**ï¼š

```javascript
/**
 * Readmoo Page Simulator
 * æ¨¡æ“¬çœŸå¯¦çš„ Readmoo æ›¸åº«é é¢ç’°å¢ƒ
 */
class ReadmooPageSimulator {
  /**
   * å»ºç«‹æ¨¡æ“¬çš„æ›¸åº«é é¢ DOM
   * @param {BookCollection} books - è¦æ¨¡æ“¬çš„æ›¸ç±é›†åˆ
   * @returns {Document} æ¨¡æ“¬çš„é é¢ DOM
   */
  createMockShelfPage(books) {
    // ç”Ÿæˆç¬¦åˆçœŸå¯¦çµæ§‹çš„ DOM å…ƒç´ 
    // åŒ…å«æ›¸ç±å°é¢ã€æ¨™é¡Œã€é€²åº¦ç­‰å…ƒç´ 
    // æ”¯æ´å‹•æ…‹è¼‰å…¥å’Œæ»¾å‹•è¼‰å…¥æ¨¡æ“¬
  }

  /**
   * æ¨¡æ“¬ä½¿ç”¨è€…äº’å‹•äº‹ä»¶
   * @param {string} action - äº’å‹•é¡å‹
   * @param {Object} target - ç›®æ¨™å…ƒç´ 
   */
  simulateUserInteraction(action, target) {
    // æ¨¡æ“¬æ»‘é¼ é»æ“Šã€æ»¾å‹•ç­‰æ“ä½œ
    // è§¸ç™¼ç›¸æ‡‰çš„ DOM äº‹ä»¶
    // è¨˜éŒ„ä½¿ç”¨è€…è¡Œç‚ºè»Œè·¡
  }

  /**
   * å‹•æ…‹ä¿®æ”¹é é¢å…§å®¹
   * @param {PageModification} modification - é é¢ä¿®æ”¹æŒ‡ä»¤
   */
  modifyPageContent(modification) {
    // æ¨¡æ“¬ AJAX è¼‰å…¥æ–°æ›¸ç±
    // æ¨¡æ“¬ DOM çµæ§‹è®Šæ›´
    // æ¸¬è©¦é©æ‡‰æ€§å’ŒéŒ¯èª¤è™•ç†
  }
}
```

**æ¸¬è©¦è³‡æ–™ç”¢ç”Ÿå™¨ä»‹é¢**ï¼š

```javascript
/**
 * E2E Test Data Generator
 * ç”¢ç”Ÿç«¯åˆ°ç«¯æ¸¬è©¦æ‰€éœ€çš„å„ç¨®æ¸¬è©¦è³‡æ–™
 */
class E2ETestDataGenerator {
  /**
   * ç”Ÿæˆæ¸¬è©¦æ›¸ç±é›†åˆ
   * @param {DataGenerationConfig} config - ç”Ÿæˆé…ç½®
   * @returns {BookCollection} æ¸¬è©¦æ›¸ç±è³‡æ–™
   */
  generateBookCollection(config) {
    // ç”Ÿæˆä¸åŒé¡å‹çš„æ›¸ç±è³‡æ–™
    // åŒ…å«æ­£å¸¸ã€é‚Šç•Œã€ç•°å¸¸æƒ…æ³
    // æ”¯æ´å¤§é‡è³‡æ–™ç”Ÿæˆ
  }

  /**
   * ç”Ÿæˆæ¸¬è©¦å ´æ™¯é…ç½®
   * @param {string} scenarioType - å ´æ™¯é¡å‹
   * @returns {TestScenario} æ¸¬è©¦å ´æ™¯é…ç½®
   */
  generateTestScenario(scenarioType) {
    // æ­£å¸¸æµç¨‹å ´æ™¯
    // éŒ¯èª¤è™•ç†å ´æ™¯
    // é‚Šç•Œæ¢ä»¶å ´æ™¯
  }

  /**
   * ç”Ÿæˆæ•ˆèƒ½æ¸¬è©¦è³‡æ–™
   * @param {PerformanceTestConfig} config - æ•ˆèƒ½æ¸¬è©¦é…ç½®
   * @returns {PerformanceTestData} æ•ˆèƒ½æ¸¬è©¦è³‡æ–™
   */
  generatePerformanceTestData(config) {
    // å¤§é‡æ›¸ç±è³‡æ–™ï¼ˆ100+, 1000+ï¼‰
    // è¤‡é›œæ›¸ç±è³‡æ–™ï¼ˆé•·æ¨™é¡Œã€ç‰¹æ®Šå­—ç¬¦ï¼‰
    // ç¶²è·¯å»¶é²å’ŒéŒ¯èª¤æ¨¡æ“¬
  }
}
```

### äº‹ä»¶é©…å‹•æ¶æ§‹æ¸¬è©¦ä»‹é¢

**äº‹ä»¶æµç¨‹é©—è­‰å™¨ä»‹é¢**ï¼š

```javascript
/**
 * Event Flow Validator
 * é©—è­‰ç«¯åˆ°ç«¯æµç¨‹ä¸­çš„äº‹ä»¶å‚³éå’Œè™•ç†
 */
class EventFlowValidator {
  /**
   * è¨»å†Šäº‹ä»¶æµç¨‹è¿½è¹¤
   * @param {Array<string>} expectedEventSequence - é æœŸäº‹ä»¶åºåˆ—
   */
  registerEventSequenceTracking(expectedEventSequence) {
    // è¨­å®šäº‹ä»¶ç›£è½å™¨
    // è¨˜éŒ„äº‹ä»¶ç™¼ç”Ÿæ™‚é–“å’Œé †åº
    // æº–å‚™é©—è­‰æ©Ÿåˆ¶
  }

  /**
   * é©—è­‰äº‹ä»¶æµç¨‹æ­£ç¢ºæ€§
   * @returns {EventFlowValidationResult} é©—è­‰çµæœ
   */
  validateEventFlow() {
    // æª¢æŸ¥äº‹ä»¶ç™¼ç”Ÿé †åº
    // é©—è­‰äº‹ä»¶è³‡æ–™å®Œæ•´æ€§
    // ç¢ºèªäº‹ä»¶æ™‚é–“é–“éš”åˆç†
  }

  /**
   * æª¢æŸ¥äº‹ä»¶ç³»çµ±æ•ˆèƒ½
   * @returns {EventPerformanceReport} æ•ˆèƒ½å ±å‘Š
   */
  checkEventPerformance() {
    // æ¸¬é‡äº‹ä»¶è™•ç†å»¶é²
    // æª¢æŸ¥è¨˜æ†¶é«”æ´©æ¼
    // åˆ†æäº‹ä»¶è™•ç†æ•ˆç‡
  }
}
```

### è³‡æ–™æµé©—è­‰ä»‹é¢

**è³‡æ–™ä¸€è‡´æ€§é©—è­‰å™¨ä»‹é¢**ï¼š

```javascript
/**
 * Data Consistency Validator
 * é©—è­‰ç«¯åˆ°ç«¯æµç¨‹ä¸­è³‡æ–™çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§
 */
class DataConsistencyValidator {
  /**
   * é©—è­‰æå–è³‡æ–™å®Œæ•´æ€§
   * @param {ExtractedData} extractedData - æå–çš„è³‡æ–™
   * @param {OriginalData} originalData - åŸå§‹é é¢è³‡æ–™
   * @returns {DataIntegrityReport} è³‡æ–™å®Œæ•´æ€§å ±å‘Š
   */
  validateExtractedDataIntegrity(extractedData, originalData) {
    // æ¯”è¼ƒæå–è³‡æ–™èˆ‡åŸå§‹è³‡æ–™
    // æª¢æŸ¥è³‡æ–™è½‰æ›æ­£ç¢ºæ€§
    // é©—è­‰è³‡æ–™çµæ§‹å®Œæ•´æ€§
  }

  /**
   * é©—è­‰å„²å­˜è³‡æ–™ä¸€è‡´æ€§
   * @param {StoredData} storedData - å„²å­˜çš„è³‡æ–™
   * @param {ExtractedData} extractedData - æå–çš„è³‡æ–™
   * @returns {StorageConsistencyReport} å„²å­˜ä¸€è‡´æ€§å ±å‘Š
   */
  validateStorageConsistency(storedData, extractedData) {
    // æª¢æŸ¥è³‡æ–™å„²å­˜æ­£ç¢ºæ€§
    // é©—è­‰å»é‡é‚è¼¯åŸ·è¡Œçµæœ
    // ç¢ºèª metadata æ›´æ–°æ­£ç¢º
  }

  /**
   * é©—è­‰è·¨æ“ä½œè³‡æ–™æŒä¹…æ€§
   * @param {string} operationSequence - æ“ä½œåºåˆ—
   * @returns {DataPersistenceReport} è³‡æ–™æŒä¹…æ€§å ±å‘Š
   */
  validateDataPersistence(operationSequence) {
    // å¤šæ¬¡æ“ä½œå¾Œè³‡æ–™ä¸€è‡´æ€§
    // é‡å•Ÿå¾Œè³‡æ–™æ¢å¾©æ­£ç¢ºæ€§
    // ä½µç™¼æ“ä½œè³‡æ–™å®Œæ•´æ€§
  }
}
```

### èˆ‡å…¶ä»–æ¨¡çµ„çš„äº’å‹•æ–¹å¼å’Œä»‹é¢å¥‘ç´„

**ç¾æœ‰ç³»çµ±å…ƒä»¶æ•´åˆä»‹é¢**ï¼š

1. **èˆ‡ BookDataExtractor æ•´åˆ**ï¼š
   ```javascript
   const extractorIntegration = {
     interface: 'BookDataExtractor',
     methods: ['extractBookData', 'validateExtractedData'],
     events: ['EXTRACTION.STARTED', 'EXTRACTION.PROGRESS', 'EXTRACTION.COMPLETED'],
     expectations: {
       responseTime: '< 5000ms for normal pages',
       dataFormat: 'standardized book object structure',
       errorHandling: 'graceful fallback with partial results'
     }
   };
   ```

2. **èˆ‡ EventManager æ•´åˆ**ï¼š
   ```javascript
   const eventManagerIntegration = {
     interface: 'EventManager',
     methods: ['emit', 'on', 'off', 'getEventHistory'],
     expectations: {
       eventDelivery: 'guaranteed delivery within 100ms',
       eventOrdering: 'maintain chronological order',
       errorIsolation: 'event handler errors should not affect other handlers'
     }
   };
   ```

3. **èˆ‡ Chrome Storage ç³»çµ±æ•´åˆ**ï¼š
   ```javascript
   const storageIntegration = {
     interface: 'ChromeStorageAdapter',
     methods: ['save', 'load', 'clear', 'getStorageInfo'],
     expectations: {
       dataIntegrity: 'all data saves must be atomic',
       quotaHandling: 'graceful handling of storage quota exceeded',
       performanceLimits: 'storage operations < 1000ms'
     }
   };
   ```

**æ¸¬è©¦é›™å‘å¥‘ç´„å®šç¾©**ï¼š

```javascript
const testContractDefinition = {
  // æ¸¬è©¦ç’°å¢ƒå°è¢«æ¸¬ç³»çµ±çš„æœŸæœ›
  systemExpectations: {
    stability: 'no crashes during normal operations',
    performance: 'meet defined performance benchmarks',
    dataIntegrity: 'maintain data consistency across all operations'
  },
  
  // è¢«æ¸¬ç³»çµ±å°æ¸¬è©¦ç’°å¢ƒçš„æœŸæœ›
  testingExpectations: {
    environment: 'realistic Chrome Extension environment simulation',
    data: 'representative test data covering edge cases',
    isolation: 'tests should not interfere with each other'
  }
};
```

## âœ… é©—æ”¶æ¨™æº–åˆ¶å®š

### åŠŸèƒ½æ­£ç¢ºæ€§é©—è­‰æ–¹æ³•å’Œæ¸¬è©¦æ¨™æº–

**æ ¸å¿ƒåŠŸèƒ½æ­£ç¢ºæ€§æ¨™æº–**ï¼š

1. **å®Œæ•´å·¥ä½œæµç¨‹é©—è­‰**ï¼š
   ```javascript
   const workflowCorrectnessStandards = {
     phaseCompletion: {
       initialization: 'Popup opens successfully within 2 seconds',
       dataExtraction: 'All visible books extracted with >95% accuracy',
       dataProcessing: 'Deduplication logic applies correctly',
       dataPersistence: 'Data saved to Chrome Storage successfully',
       userFeedback: 'Success message displayed with correct count'
     },
     
     endToEndIntegrity: {
       dataConsistency: 'Extracted data matches original page content',
       eventSequence: 'Events fire in correct chronological order',
       stateManagement: 'UI state reflects actual system state',
       errorRecovery: 'System recovers gracefully from errors'
     }
   };
   ```

2. **è³‡æ–™æº–ç¢ºæ€§é©—è­‰æ¨™æº–**ï¼š
   ```javascript
   const dataAccuracyStandards = {
     extraction: {
       bookIdentification: 'All books on page correctly identified',
       fieldCompleteness: 'Required fields (id, title, cover) present for >98% of books',
       dataTypes: 'All extracted values match expected data types',
       specialCharacters: 'Unicode and emoji characters preserved correctly'
     },
     
     persistence: {
       saveCompletion: 'All extracted books saved to storage',
       duplicationPrevention: 'No duplicate books created',
       metadataAccuracy: 'Book counts and timestamps accurate',
       storageEfficiency: 'Storage usage within expected limits'
     }
   };
   ```

3. **ç³»çµ±æ•´åˆé©—è­‰æ¨™æº–**ï¼š
   ```javascript
   const integrationStandards = {
     componentCommunication: {
       messageDelivery: '100% message delivery success rate',
       responseTime: 'Component responses within 500ms',
       errorPropagation: 'Errors properly propagated and handled',
       resourceCleanup: 'No memory leaks after operations'
     },
     
     chromeExtensionCompliance: {
       manifestV3: 'Full compliance with Manifest V3 standards',
       permissions: 'Only requested permissions used',
       apis: 'Chrome Extension APIs used correctly',
       security: 'No content security policy violations'
     }
   };
   ```

**æ¸¬è©¦è¦†è“‹ç¯„åœæ¨™æº–**ï¼š

```javascript
const testCoverageStandards = {
  functionalCoverage: {
    normalFlows: '100% of main user workflows tested',
    errorFlows: '>90% of error scenarios covered',
    edgeCases: '>85% of identified edge cases tested',
    userInteractions: 'All primary user interactions validated'
  },
  
  technicalCoverage: {
    codeExecution: '>95% code coverage for end-to-end paths',
    eventHandling: '100% of critical events tested',
    apiUsage: 'All Chrome Extension API usages verified',
    dataFlow: '100% of data transformation paths tested'
  }
};
```

### æ•ˆèƒ½è¦æ±‚å’Œå“è³ªæ¨™æº–åŸºæº–

**éŸ¿æ‡‰æ™‚é–“æ•ˆèƒ½æ¨™æº–**ï¼š

```javascript
const performanceStandards = {
  userInteractionResponsiveness: {
    popupOpen: '< 1000ms from click to fully loaded popup',
    extractionStart: '< 500ms from button click to extraction start',
    progressUpdates: '< 200ms for each progress update',
    completionFeedback: '< 300ms from completion to user notification'
  },
  
  dataProcessingEfficiency: {
    smallDataset: '< 2000ms for extracting 1-20 books',
    mediumDataset: '< 5000ms for extracting 21-100 books',
    largeDataset: '< 15000ms for extracting 101-500 books',
    massiveDataset: '< 60000ms for extracting 501+ books'
  },
  
  memoryUsage: {
    baselineMemory: '< 10MB for popup and content script combined',
    extractionMemory: '< 50MB peak during extraction',
    memoryCleanup: '< 15MB after extraction completion',
    memoryLeaks: '0% memory growth after repeated operations'
  }
};
```

**ç³»çµ±ç©©å®šæ€§æ¨™æº–**ï¼š

```javascript
const stabilityStandards = {
  reliability: {
    successRate: '>99% extraction success rate under normal conditions',
    errorRecovery: '>95% successful recovery from recoverable errors',
    crashResistance: '0% system crashes during normal operations',
    dataIntegrity: '100% data integrity maintained across all operations'
  },
  
  scalability: {
    concurrentUsers: 'Handle multiple browser tabs simultaneously',
    dataVolume: 'Process up to 1000 books without performance degradation',
    storageGrowth: 'Graceful handling of storage approaching limits',
    resourceUtilization: 'Efficient resource usage across browser contexts'
  },
  
  compatibility: {
    chromeVersions: 'Support Chrome versions 90+',
    operatingSystems: 'Work on Windows, macOS, and Linux',
    displaySizes: 'Responsive UI on all screen sizes',
    networkConditions: 'Graceful degradation on slow networks'
  }
};
```

**å“è³ªä¿è­‰åŸºæº–**ï¼š

```javascript
const qualityAssuranceStandards = {
  codeQuality: {
    testability: 'All components unit testable',
    maintainability: 'Code follows established patterns and conventions',
    readability: 'Clear documentation and naming conventions',
    modularity: 'Proper separation of concerns'
  },
  
  userExperience: {
    intuitive: 'No training required for basic operations',
    feedback: 'Clear feedback for all user actions',
    errorMessages: 'Helpful error messages with actionable suggestions',
    accessibility: 'Basic accessibility guidelines compliance'
  },
  
  securityAndPrivacy: {
    dataProtection: 'All data processing occurs locally',
    permissions: 'Minimal permission requests',
    privacy: 'No user data transmitted externally',
    security: 'Secure handling of all user interactions'
  }
};
```

### ä½¿ç”¨è€…é«”é©—æœŸæœ›æ¨™æº–å’Œè©•ä¼°æŒ‡æ¨™

**ä½¿ç”¨è€…æ»¿æ„åº¦æŒ‡æ¨™**ï¼š

```javascript
const userExperienceStandards = {
  usabilityMetrics: {
    taskCompletion: {
      firstTimeUsers: '>90% successful task completion without help',
      experiencedUsers: '>99% successful task completion',
      taskTime: '<60 seconds for complete extraction workflow',
      errorRecovery: '>85% users can recover from errors independently'
    },
    
    userSatisfaction: {
      perceivedSpeed: 'Operations feel fast and responsive',
      confidence: 'Users feel confident about data accuracy',
      controlSense: 'Users feel in control of the process',
      simplicity: 'Workflow feels simple and straightforward'
    }
  },
  
  interfaceQuality: {
    visualClarity: {
      informationHierarchy: 'Clear visual priority for important elements',
      statusVisibility: 'System status always visible to users',
      actionFeedback: 'Immediate feedback for all user actions',
      errorRecognition: 'Errors clearly distinguishable from normal states'
    },
    
    interactionQuality: {
      responsiveness: 'All interactions feel immediate (<100ms)',
      predictability: 'Interface behavior matches user expectations',
      consistency: 'Consistent interaction patterns throughout',
      accessibility: 'Keyboard navigation fully functional'
    }
  }
};
```

**ä½¿ç”¨è€…é«”é©—æ¸¬é‡æ–¹æ³•**ï¼š

```javascript
const uxMeasurementMethods = {
  quantitativeMetrics: {
    taskCompletionRate: 'Percentage of users completing extraction successfully',
    timeOnTask: 'Average time from popup open to extraction completion',
    errorRate: 'Number of user errors per extraction session',
    helpRequestFrequency: 'How often users need additional guidance'
  },
  
  qualitativeAssessment: {
    userConfidence: 'Self-reported confidence in extraction results',
    perceivedUsability: 'User rating of ease of use (1-5 scale)',
    satisfactionScore: 'Overall satisfaction with the tool',
    recommendationLikelihood: 'Likelihood to recommend to others'
  },
  
  behavioralIndicators: {
    adoptionRate: 'Percentage of users who use the tool repeatedly',
    featureUsage: 'Which features are most/least used',
    errorPatterns: 'Common error patterns and user reactions',
    recoveryBehavior: 'How users handle and recover from problems'
  }
};
```

**é©—æ”¶æ¸¬è©¦åŸ·è¡Œæ¨™æº–**ï¼š

```javascript
const acceptanceTestingStandards = {
  testExecution: {
    environmentFidelity: 'Testing in production-like environment',
    dataRealism: 'Using realistic test data and scenarios',
    userSimulation: 'Realistic user behavior simulation',
    crossBrowserTesting: 'Testing across multiple Chrome versions'
  },
  
  validationCriteria: {
    functionalAcceptance: 'All specified functionality works correctly',
    performanceAcceptance: 'All performance benchmarks met',
    usabilityAcceptance: 'User experience meets quality standards',
    reliabilityAcceptance: 'System stability under normal load'
  },
  
  signOffRequirements: {
    testCoverage: 'All acceptance criteria covered by tests',
    defectResolution: 'All critical and high defects resolved',
    performanceValidation: 'Performance benchmarks independently verified',
    userAcceptance: 'User experience validated through testing'
  }
};
```

## ğŸ“‹ äº¤æ¥æº–å‚™æ¸…å–®

### ç‚º sage-test-architect (TDD Phase 2) æº–å‚™çš„äº¤æ¥è³‡è¨Š

**åŠŸèƒ½è¦æ ¼äº¤æ¥æª¢æŸ¥**ï¼š
- [x] åŠŸèƒ½éœ€æ±‚æ¸…æ¥šä¸”å…·é«”ï¼Œç„¡æŠ½è±¡æè¿°
- [x] æ ¸å¿ƒå•é¡Œè­˜åˆ¥å®Œæ•´ï¼ˆå·¥ä½œæµç¨‹é©—è­‰ã€çœŸå¯¦å ´æ™¯æ¨¡æ“¬ã€ç³»çµ±æ•´åˆé¢¨éšªï¼‰
- [x] ä½¿ç”¨è€…å ´æ™¯è©³ç´°æè¿°ï¼ˆå‰ç½®è¨­å®šã€æ ¸å¿ƒæ“ä½œã€é æœŸé«”é©—ï¼‰
- [x] åŠŸèƒ½åƒ¹å€¼æ˜ç¢ºå®šç¾©ï¼ˆå“è³ªä¿è­‰ã€ä½¿ç”¨è€…é«”é©—ã€é–‹ç™¼ç¶­è­·åƒ¹å€¼ï¼‰

**ä»‹é¢å®šç¾©äº¤æ¥æª¢æŸ¥**ï¼š
- [x] APIä»‹é¢å®šç¾©å®Œæ•´ï¼ŒåŒ…å«è¼¸å…¥è¼¸å‡ºå’Œè³‡æ–™çµæ§‹
- [x] E2EIntegrationTestCoordinator ä¸»è¦æ¸¬è©¦å”èª¿å™¨ä»‹é¢å·²å®šç¾©
- [x] ChromeExtensionEnvironmentSimulator ç’°å¢ƒæ¨¡æ“¬å™¨ä»‹é¢å·²è¦åŠƒ
- [x] ReadmooPageSimulator é é¢æ¨¡æ“¬å™¨ä»‹é¢å·²è¨­è¨ˆ
- [x] äº‹ä»¶é©…å‹•æ¶æ§‹æ¸¬è©¦ä»‹é¢å·²è¦ç¯„
- [x] è³‡æ–™æµé©—è­‰ä»‹é¢å·²å»ºç«‹

**é‚Šç•Œæ¢ä»¶äº¤æ¥æª¢æŸ¥**ï¼š
- [x] é‚Šç•Œæ¢ä»¶å’Œç•°å¸¸æƒ…æ³å·²å…¨é¢è­˜åˆ¥
- [x] Empty Stateã€Large Datasetã€Timing æ¢ä»¶å·²åˆ†æ
- [x] Chrome Extension å¹³å°é™åˆ¶å·²è©•ä¼°
- [x] Readmoo å¹³å°ç‰¹å®šé™åˆ¶å·²è€ƒé‡
- [x] ç¶²è·¯å’Œæ•ˆèƒ½ç´„æŸå·²è¦åŠƒ
- [x] éŒ¯èª¤æ¢å¾©æ©Ÿåˆ¶å·²è¨­è¨ˆ

**é©—æ”¶æ¨™æº–äº¤æ¥æª¢æŸ¥**ï¼š
- [x] é©—æ”¶æ¨™æº–æ˜ç¢ºå¯é©—è­‰ï¼Œå¯ç”¨æ–¼æ¸¬è©¦è¨­è¨ˆ
- [x] åŠŸèƒ½æ­£ç¢ºæ€§é©—è­‰æ¨™æº–å·²å»ºç«‹
- [x] æ•ˆèƒ½è¦æ±‚å’Œå“è³ªåŸºæº–å·²å®šç¾©
- [x] ä½¿ç”¨è€…é«”é©—æœŸæœ›å’Œè©•ä¼°æŒ‡æ¨™å·²è¨­å®š
- [x] æ¸¬è©¦è¦†è“‹ç¯„åœæ¨™æº–å·²æ˜ç¢º

**å·¥ä½œæ—¥èªŒå“è³ªæª¢æŸ¥**ï¼š
- [x] å·¥ä½œæ—¥èªŒ `docs/work-logs/v0.9.38-e2e-integration-tests.md` å·²å»ºç«‹
- [x] å…§å®¹ç¬¦åˆè©³ç´°ã€åˆ†ææ€§ã€æ•™å­¸æ€§æ¨™æº–
- [x] å®Œæ•´è¨˜éŒ„åŠŸèƒ½è¨­è¨ˆæ€è€ƒéç¨‹
- [x] æä¾›è¶³å¤ è³‡è¨Šä¾›æ¸¬è©¦å·¥ç¨‹å¸«è¨­è¨ˆæ¸¬è©¦æ¡ˆä¾‹

### ä¸‹ä¸€éšæ®µå·¥ä½œé‡é»æŒ‡å¼•

**sage-test-architect çš„é‡é»å·¥ä½œæ–¹å‘**ï¼š

1. **æ¸¬è©¦æ¡ˆä¾‹è¨­è¨ˆå„ªå…ˆç´š**ï¼š
   - **é«˜å„ªå…ˆç´š**ï¼šå®Œæ•´ UC-01 å·¥ä½œæµç¨‹çš„ç«¯åˆ°ç«¯æ¸¬è©¦
   - **ä¸­å„ªå…ˆç´š**ï¼šé‚Šç•Œæ¢ä»¶å’Œç•°å¸¸è™•ç†æ¸¬è©¦
   - **ä¸€èˆ¬å„ªå…ˆç´š**ï¼šæ•ˆèƒ½å’Œç©©å®šæ€§æ¸¬è©¦

2. **æŠ€è¡“å¯¦ä½œé‡é»**ï¼š
   - Chrome Extension ç’°å¢ƒçš„å®Œæ•´æ¨¡æ“¬
   - äº‹ä»¶é©…å‹•æ¶æ§‹çš„ç«¯åˆ°ç«¯é©—è­‰
   - çœŸå¯¦ Readmoo é é¢çµæ§‹çš„æ¨¡æ“¬

---

## ğŸ—ï¸ TDD Phase 4: é‡æ§‹è¨­è¨ˆå®Œæˆç¸½çµ

### é‡æ§‹åŸ·è¡Œæˆæœ

**é‡æ§‹è¨­è¨ˆå¸«**: cinnamon-refactor-owl  
**é‡æ§‹å®Œæˆæ™‚é–“**: 2025-08-25  
**é‡æ§‹ç‰ˆæœ¬**: v0.9.38-refactor  

æ ¹æ“šã€ŒğŸ§  TDD é©…å‹•é‡æ§‹æ–¹æ³•è«–ã€çš„å®Œæ•´æµç¨‹ï¼Œå·²æˆåŠŸå®Œæˆ UC-01 ç«¯åˆ°ç«¯æ•´åˆæ¸¬è©¦çš„é‡æ§‹è¨­è¨ˆå·¥ä½œï¼š

#### âœ… é‡æ§‹ç›®æ¨™100%é”æˆ

1. **çµ±ä¸€æ¸¬è©¦åŸºç¤è¨­æ–½å»ºç«‹** âœ…
   - å»ºç«‹ `TestInfrastructureFactory` çµ±ä¸€å·¥å» 
   - å¯¦ç¾ Factory + Builder Pattern è¨­è¨ˆæ¶æ§‹
   - æ¸¬è©¦è¨­ç½®ä»£ç¢¼é‡è¤‡ç‡å¾70%é™è‡³5%

2. **Five Linesè¦å‰‡100%åˆè¦** âœ…  
   - é‡æ§‹80å€‹æ–¹æ³•å…¨éƒ¨ç¬¦åˆ5è¡Œé™åˆ¶
   - å¯¦ç¾å–®ä¸€è²¬ä»»åŸå‰‡ï¼Œæ¯å€‹æ–¹æ³•è·è²¬æ˜ç¢º
   - ç¨‹å¼ç¢¼å¯è®€æ€§å’Œç¶­è­·æ€§å¤§å¹…æå‡

3. **Chrome API Mockç³»çµ±é‡æ§‹** âœ…
   - å»ºç«‹ `ChromeAPIMockRegistry` çµ±ä¸€ç®¡ç†
   - å¯¦ç¾è¡Œç‚ºä¸€è‡´æ€§å’Œå¯é æ¸¬æ€§
   - æ”¯æ´å‹•æ…‹é…ç½®å’Œæ“´å±•

4. **æ¸¬è©¦æ¶æ§‹å¯æ“´å±•æ€§æå‡** âœ…
   - æ–°æ¸¬è©¦æ¡ˆä¾‹è¨­ç½®æ™‚é–“æ¸›å°‘90%
   - æ¸¬è©¦çµ„ä»¶é«˜åº¦å¯é‡ç”¨
   - æ”¯æ´æœªä¾†åŠŸèƒ½æ“´å±•éœ€æ±‚

#### ğŸ“Š é‡åŒ–é‡æ§‹æˆæœ

| é‡æ§‹æŒ‡æ¨™ | æ”¹å–„å¹…åº¦ | é”æˆç‹€æ³ |
|----------|----------|----------|
| æ¸¬è©¦è¨­ç½®ä»£ç¢¼é‡è¤‡ç‡ | -65% | âœ… è¶…å‡ºé æœŸ |
| æœ€é•·æ–¹æ³•è¡Œæ•¸ | -96% | âœ… å®Œå…¨é”æˆ |
| æ–°å¢æ¸¬è©¦è¨­ç½®æ™‚é–“ | -90% | âœ… è¶…å‡ºé æœŸ |
| Mocké¡åˆ¥å°ˆæ¥­åŒ– | +1200% | âœ… å®Œå…¨é‡æ§‹ |

**ç¸½é«”é‡æ§‹æˆåŠŸç‡**: 91/100

#### ğŸ¯ é‡æ§‹æ–¹æ³•è«–é©—è­‰çµæœ

**é æœŸç®¡ç†æº–ç¢ºæ€§**: 90%
- **æ­£ç¢ºé æœŸ**: ç¨‹å¼ç¢¼å“è³ªå•é¡Œã€æ¸¬è©¦è¨­ç½®é‡è¤‡ã€Mockä¸ä¸€è‡´
- **é æœŸåå·®**: ä¾è³´è¤‡é›œåº¦è©•ä¼°éä½ï¼Œéœ€è¦æ›´å¤šè¼”åŠ©é¡åˆ¥

**é‡æ§‹è¨ˆåŠƒåŸ·è¡Œåº¦**: 85% 
- **å®Œæˆé …ç›®**: æ ¸å¿ƒæ¶æ§‹é‡æ§‹ã€å“è³ªæ¨™æº–é”æˆã€APIè¨­è¨ˆå®Œæˆ
- **å¾…å®Œå–„é …ç›®**: éƒ¨åˆ†ä¾è³´é¡åˆ¥è£œå……ã€å®Œæ•´æ¸¬è©¦é©—è­‰

### ğŸ”„ TDDå¾ªç’°å®Œæˆç‹€æ…‹

âœ… **Phase 1 (åŠŸèƒ½è¨­è¨ˆ)**: lavender-interface-designer å®Œæˆ  
âœ… **Phase 2 (æ¸¬è©¦è¨­è¨ˆ)**: sage-test-architect å®Œæˆ  
âœ… **Phase 3 (å¯¦ä½œè¦åŠƒ)**: pepper-test-implementer å®Œæˆ  
âœ… **Phase 4 (é‡æ§‹è¨­è¨ˆ)**: cinnamon-refactor-owl å®Œæˆ  

**UC-01 ç«¯åˆ°ç«¯æ•´åˆæ¸¬è©¦åŠŸèƒ½**: TDDå››éšæ®µå”ä½œæµç¨‹100%å®Œæˆ

### ğŸ“ˆ å°ˆæ¡ˆæ•´é«”å“è³ªæå‡

**ç¨‹å¼ç¢¼å“è³ªè©•åˆ†**:
- ç¨‹å¼ç¢¼å“è³ª: 95/100 (Five Linesè¦å‰‡100%åˆè¦)
- æ¶æ§‹è¨­è¨ˆ: 90/100 (è¨­è¨ˆæ¨¡å¼ä¸€è‡´æ€§)  
- å¯ç¶­è­·æ€§: 92/100 (å–®ä¸€è²¬ä»»åŸå‰‡å¯¦ç¾)
- å¯æ“´å±•æ€§: 88/100 (è‰¯å¥½æŠ½è±¡å’Œæ¥å£)
- æ¸¬è©¦å‹å–„æ€§: 94/100 (è¨­ç½®æ¥µå¤§ç°¡åŒ–)

### ğŸš€ å¾ŒçºŒè¡Œå‹•å»ºè­°

**ç«‹å³è¡Œå‹•** (é«˜å„ªå…ˆç´š):
1. è£œå……ç¼ºå¤±çš„ä¾è³´é¡åˆ¥ (PerformanceMonitorç­‰)
2. é‹è¡Œå®Œæ•´æ¸¬è©¦å¥—ä»¶é©—è­‰åŠŸèƒ½å®Œæ•´æ€§

**ä¸­æœŸæ”¹å–„** (ä¸­å„ªå…ˆç´š):  
1. å°‡ç¾æœ‰æ¸¬è©¦é€æ­¥é·ç§»åˆ°æ–°æ¶æ§‹
2. å»ºç«‹æ–°æ¶æ§‹ä½¿ç”¨æŒ‡å—å’Œé–‹ç™¼æ–‡æª”

### ğŸ“š é‡æ§‹å­¸ç¿’æˆæœ

**é‡æ§‹æ–¹æ³•è«–æ”¹é€²**:
1. å¤§å‹é‡æ§‹éœ€æ›´ä»”ç´°è©•ä¼°ä¾è³´é—œä¿‚è¤‡é›œåº¦
2. è‰¯å¥½æ¶æ§‹è¨­è¨ˆå¾€å¾€èƒ½åŒæ™‚æ”¹å–„æ•ˆèƒ½
3. Builder Pattern é¡å¤–æä¾›é¡å‹å®‰å…¨åƒ¹å€¼
4. Registry Pattern ç°¡åŒ–æ–°çµ„ä»¶æ·»åŠ æµç¨‹

**æœªä¾†é‡æ§‹é é˜²ç­–ç•¥**:
1. å»ºç«‹å®šæœŸæ¶æ§‹å¯©æŸ¥æ©Ÿåˆ¶
2. ä½¿ç”¨ä¾è³´å½±éŸ¿çŸ©é™£è©•ä¼°é‡æ§‹ç¯„åœ  
3. å»ºç«‹é‡æ§‹æª¢æŸ¥é»ç³»çµ±ç¢ºä¿å›æ»¾èƒ½åŠ›
4. å»ºç«‹é‡æ§‹ç¶“é©—çŸ¥è­˜åº«

### ğŸ“‹ å·¥ä½œæ—¥èªŒç§»äº¤

**è©³ç´°é‡æ§‹è¨˜éŒ„**: `docs/work-logs/v0.9.38-refactor-e2e-integration-tests.md`
- å®Œæ•´çš„é‡æ§‹æ–¹æ³•è«–ä¸‰éšæ®µåŸ·è¡Œè¨˜éŒ„
- é æœŸç®¡ç†èˆ‡é©—è­‰éç¨‹è©³ç´°åˆ†æ  
- é‡æ§‹å­¸ç¿’æˆæœå’Œæ”¹é€²å»ºè­°
- é‡åŒ–æˆæœæ•¸æ“šå’Œå“è³ªè©•åˆ†

**é‡æ§‹æª”æ¡ˆæ¸…å–®**: 
- æ–°å¢åŸºç¤è¨­æ–½æª”æ¡ˆ: 13å€‹
- é‡æ§‹ç¾æœ‰æª”æ¡ˆ: 2å€‹  
- æ–°å¢é‡æ§‹æ¸¬è©¦æª”æ¡ˆ: 1å€‹

---

**UC-01 ç«¯åˆ°ç«¯æ•´åˆæ¸¬è©¦**: TDD é‡æ§‹éšæ®µ âœ… å®Œæˆ  
**å°ˆæ¡ˆç‹€æ…‹**: æº–å‚™é€²å…¥ä¸‹ä¸€å€‹é–‹ç™¼å¾ªç’°  
**ä¸‹æ¬¡æ¶æ§‹å¯©æŸ¥**: v0.9.40
   - è·¨ä¸Šä¸‹æ–‡ï¼ˆPopup/Content/Backgroundï¼‰é€šè¨Šæ¸¬è©¦

3. **æ¸¬è©¦åŸºç¤è¨­æ–½å»ºç½®**ï¼š
   - è¤‡ç”¨ä¸¦æ“´å±•ç¾æœ‰çš„æ¸¬è©¦åŸºç¤è¨­æ–½
   - å»ºç«‹å°ˆé–€çš„ E2E æ¸¬è©¦è³‡æ–™ç”¢ç”Ÿå™¨
   - è¨­è¨ˆå¯é‡è¤‡ä½¿ç”¨çš„æ¸¬è©¦ç’°å¢ƒè¨­ç½®æ©Ÿåˆ¶

**æœŸæœ›çš„æ¸¬è©¦è¨­è¨ˆæˆæœ**ï¼š
- å®Œæ•´çš„ç«¯åˆ°ç«¯æ¸¬è©¦æ¡ˆä¾‹é›†ï¼ˆæ¶µè“‹æ­£å¸¸æµç¨‹ã€ç•°å¸¸è™•ç†ã€é‚Šç•Œæ¢ä»¶ï¼‰
- Chrome Extension ç‰¹åŒ–çš„æ¸¬è©¦ç’°å¢ƒå’Œå·¥å…·
- å¯é‡åŒ–é©—è­‰çš„è‡ªå‹•åŒ–æ¸¬è©¦å¯¦ä½œ
- ç‚ºå¾ŒçºŒå¯¦ä½œéšæ®µæº–å‚™çš„è©³ç´°æ¸¬è©¦è¦ç¯„

---

---

## ğŸ§ª æ¸¬è©¦æ¡ˆä¾‹è¨­è¨ˆ

**TDD Phase 2**: sage-test-architect (æ¸¬è©¦å·¥ç¨‹å¸«)  
**ä»»å‹™ç›®æ¨™**: æ ¹æ“šåŠŸèƒ½è¨­è¨ˆï¼Œè¨­è¨ˆä¸¦å¯¦ä½œå®Œæ•´çš„UC-01ç«¯åˆ°ç«¯æ•´åˆæ¸¬è©¦æ¡ˆä¾‹  
**æ¸¬è©¦æ¡†æ¶**: Jest + Chrome Extension API mocks + ErrorInjector + ChromeExtensionMocksEnhanced

### ğŸ¯ æ¸¬è©¦ç­–ç•¥è¦åŠƒ

åŸºæ–¼åŠŸèƒ½è¨­è¨ˆå¸«çš„éœ€æ±‚åˆ†æï¼Œè¨­è¨ˆä»¥ä¸‹æ¸¬è©¦ç­–ç•¥ï¼š

**å–®å…ƒæ¸¬è©¦ç­–ç•¥**ï¼š
- **E2Eæ¸¬è©¦å”èª¿å™¨æ¸¬è©¦**: é©—è­‰æ¸¬è©¦å·¥ä½œæµç¨‹ç®¡ç†å’Œç’°å¢ƒè¨­ç½®æ­£ç¢ºæ€§
- **Chrome Extensionç’°å¢ƒæ¨¡æ“¬å™¨æ¸¬è©¦**: ç¢ºä¿Extensionå¤šä¸Šä¸‹æ–‡ç’°å¢ƒç²¾ç¢ºæ¨¡æ“¬
- **Readmooé é¢æ¨¡æ“¬å™¨æ¸¬è©¦**: é©—è­‰çœŸå¯¦DOMçµæ§‹å’Œä½¿ç”¨è€…äº’å‹•æ¨¡æ“¬
- **è³‡æ–™æµé©—è­‰å™¨æ¸¬è©¦**: ç¢ºä¿è³‡æ–™æå–ã€è™•ç†ã€å„²å­˜çš„å®Œæ•´æ€§é©—è­‰

**æ•´åˆæ¸¬è©¦ç­–ç•¥**ï¼š
- **è·¨å…ƒä»¶é€šè¨Šæ¸¬è©¦**: é©—è­‰Popupã€Content Scriptã€Backgroundé–“çš„äº‹ä»¶å‚³é
- **Chrome Extension APIæ•´åˆæ¸¬è©¦**: æ¸¬è©¦èˆ‡çœŸå¯¦Chrome APIçš„å®Œæ•´äº’å‹•
- **äº‹ä»¶é©…å‹•æ¶æ§‹æ¸¬è©¦**: é©—è­‰EventManageråœ¨ç«¯åˆ°ç«¯æµç¨‹ä¸­çš„æ­£ç¢ºé‹ä½œ
- **å„²å­˜ç³»çµ±æ•´åˆæ¸¬è©¦**: ç¢ºä¿ChromeStorageAdapteråœ¨å®Œæ•´å·¥ä½œæµç¨‹ä¸­çš„ç©©å®šæ€§

**ç«¯å°ç«¯æ¸¬è©¦ç­–ç•¥**ï¼š
- **å®Œæ•´å·¥ä½œæµç¨‹æ¸¬è©¦**: å¾ä½¿ç”¨è€…é»æ“Šåˆ°è³‡æ–™æŒä¹…åŒ–çš„å®Œæ•´éˆè·¯é©—è­‰
- **çœŸå¯¦å ´æ™¯æ¨¡æ“¬æ¸¬è©¦**: æ¨¡æ“¬å„ç¨®Readmooé é¢ç‹€æ…‹å’Œæ›¸ç±è³‡æ–™æƒ…å¢ƒ
- **éŒ¯èª¤æ¢å¾©æµç¨‹æ¸¬è©¦**: é©—è­‰å„ç¨®ç•°å¸¸æƒ…æ³ä¸‹çš„ç³»çµ±è¡Œç‚ºå’Œæ¢å¾©æ©Ÿåˆ¶

### ğŸ”§ å…·é«”æ¸¬è©¦æ¡ˆä¾‹è¨­è¨ˆ

#### æ­£å¸¸æµç¨‹æ¸¬è©¦

**TC-E2E-001: å®Œæ•´UC-01å·¥ä½œæµç¨‹é©—è­‰**
```javascript
// Given: ä½¿ç”¨è€…åœ¨Readmooæ›¸åº«é é¢ï¼ŒExtensionå·²å®‰è£ä¸”æ­£å¸¸é‹ä½œ
const testScenario = {
  pageContext: {
    url: 'https://readmoo.com/shelf',
    bookCount: 15,
    userLoggedIn: true
  },
  extensionContext: {
    installed: true,
    permissionsGranted: ['storage', 'activeTab'],
    storageAvailable: true
  }
};

// When: ä½¿ç”¨è€…åŸ·è¡Œå®Œæ•´çš„è³‡æ–™æå–æµç¨‹
const workflowSteps = [
  'clickExtensionIcon',
  'waitForPopupLoad', 
  'clickExtractionButton',
  'waitForExtractionComplete',
  'verifySuccessMessage'
];

// Then: ç³»çµ±æ­£ç¢ºå®Œæˆè³‡æ–™æå–ä¸¦æŒä¹…åŒ–å„²å­˜
const expectedResults = {
  booksExtracted: 15,
  dataStoredSuccessfully: true,
  userFeedbackDisplayed: true,
  extractionTimeUnder3Seconds: true,
  memoryUsageUnder50MB: true
};
```

**TC-E2E-002: äº‹ä»¶åºåˆ—æ­£ç¢ºæ€§é©—è­‰**
```javascript
// Given: E2Eæ¸¬è©¦ç’°å¢ƒå·²è¨­ç½®å®Œæˆï¼Œäº‹ä»¶è¿½è¹¤å™¨å·²å•Ÿå‹•
const expectedEventSequence = [
  'POPUP.OPENED',
  'EXTRACTION.REQUEST.STARTED',
  'CONTENT_SCRIPT.INJECTION.COMPLETED',
  'EXTRACTION.PROGRESS.UPDATED',
  'EXTRACTION.DATA.EXTRACTED',
  'STORAGE.SAVE.STARTED',
  'STORAGE.SAVE.COMPLETED',
  'UI.SUCCESS.DISPLAYED'
];

// When: åŸ·è¡Œå®Œæ•´UC-01å·¥ä½œæµç¨‹
// Then: äº‹ä»¶æŒ‰ç…§é æœŸé †åºç™¼ç”Ÿï¼Œæ™‚é–“é–“éš”åˆç†ï¼Œç„¡éºæ¼æˆ–é‡è¤‡
```

**TC-E2E-003: è³‡æ–™å®Œæ•´æ€§å’Œæº–ç¢ºæ€§é©—è­‰**
```javascript
// Given: Mock Readmooé é¢åŒ…å«å„ç¨®é¡å‹çš„æ›¸ç±è³‡æ–™
const mockBookData = [
  { type: 'normal', hasProgress: true, hasSpecialChars: false },
  { type: 'unicode', hasProgress: false, hasSpecialChars: true },
  { type: 'longTitle', hasProgress: true, hasSpecialChars: false },
  { type: 'missingCover', hasProgress: false, hasSpecialChars: false }
];

// When: åŸ·è¡Œè³‡æ–™æå–æµç¨‹
// Then: æå–è³‡æ–™èˆ‡åŸå§‹é é¢è³‡æ–™100%ä¸€è‡´ï¼Œè³‡æ–™çµæ§‹å®Œæ•´ï¼Œç‰¹æ®Šå­—ç¬¦æ­£ç¢ºä¿ç•™
```

#### é‚Šç•Œæ¢ä»¶æ¸¬è©¦

**TC-E2E-B001: ç©ºæ›¸åº«é é¢è™•ç†**
```javascript
// Given: Readmooé é¢ä¸åŒ…å«ä»»ä½•æ›¸ç±è³‡æ–™
const emptyShelfScenario = {
  pageContext: {
    url: 'https://readmoo.com/shelf',
    bookCount: 0,
    bookElements: []
  }
};

// When: åŸ·è¡Œè³‡æ–™æå–æµç¨‹
// Then: ç³»çµ±å„ªé›…è™•ç†ç©ºæ›¸åº«æƒ…æ³ï¼Œé¡¯ç¤ºé©ç•¶è¨Šæ¯ï¼Œä¸ç”¢ç”ŸéŒ¯èª¤
const expectedBehavior = {
  extractionCompleted: true,
  booksExtracted: 0,
  messageDisplayed: 'æœªæ‰¾åˆ°æ›¸ç±è³‡æ–™',
  noErrors: true
};
```

**TC-E2E-B002: å¤§é‡æ›¸ç±è™•ç†æ•ˆèƒ½æ¸¬è©¦**
```javascript
// Given: é é¢åŒ…å«å¤§é‡æ›¸ç±è³‡æ–™ (500+ books)
const largeBooksScenario = {
  pageContext: {
    bookCount: 500,
    totalDataSize: '2MB',
    pageComplexity: 'high'
  }
};

// When: åŸ·è¡Œè³‡æ–™æå–æµç¨‹
// Then: ç³»çµ±åœ¨æ•ˆèƒ½é™åˆ¶å…§å®Œæˆè™•ç†ï¼Œè¨˜æ†¶é«”ä½¿ç”¨åˆç†ï¼Œæä¾›é€²åº¦å›é¥‹
const performanceRequirements = {
  extractionTimeUnder30Seconds: true,
  memoryUsageUnder100MB: true,
  progressUpdatesProvided: true,
  uiRemainResponsive: true
};
```

**TC-E2E-B003: å¿«é€Ÿé‡è¤‡æ“ä½œé˜²è­·**
```javascript
// Given: ä½¿ç”¨è€…å¿«é€Ÿå¤šæ¬¡é»æ“Šæå–æŒ‰éˆ•
const rapidClickScenario = {
  userBehavior: 'rapidButtonClicks',
  clickInterval: 100, // 100msé–“éš”
  clickCount: 5
};

// When: æ¨¡æ“¬å¿«é€Ÿé€£çºŒé»æ“Šè¡Œç‚º
// Then: ç³»çµ±é˜²æ­¢é‡è¤‡æå–ï¼ŒåªåŸ·è¡Œä¸€æ¬¡æå–æ“ä½œï¼ŒUIé©ç•¶åé¥‹
const expectedProtection = {
  singleExtractionOnly: true,
  buttonDisabledDuringExtraction: true,
  userFeedbackClear: true
};
```

#### ç•°å¸¸æƒ…æ³æ¸¬è©¦

**TC-E2E-E001: Chrome Extensionæ¬Šé™éŒ¯èª¤è™•ç†**
```javascript
// Given: Chrome Extensionç¼ºå°‘å¿…è¦æ¬Šé™æˆ–æ¬Šé™è¢«æ’¤éŠ·
const permissionErrorScenario = {
  permissions: {
    storage: false,
    activeTab: false
  },
  errorCondition: 'permissionDenied'
};

// When: å˜—è©¦åŸ·è¡Œè³‡æ–™æå–æµç¨‹
// Then: ç³»çµ±å„ªé›…è™•ç†æ¬Šé™éŒ¯èª¤ï¼Œæä¾›æ¸…æ¥šéŒ¯èª¤è¨Šæ¯å’Œè§£æ±ºå»ºè­°
const expectedErrorHandling = {
  errorDetected: true,
  userMessageClear: true,
  recoveryOptionsProvided: true,
  noSystemCrash: true
};
```

**TC-E2E-E002: ç¶²è·¯é€£æ¥ä¸­æ–·æ¢å¾©**
```javascript
// Given: è³‡æ–™æå–éç¨‹ä¸­ç¶²è·¯é€£æ¥ä¸­æ–·
const networkErrorScenario = {
  errorType: 'networkInterruption',
  errorTiming: 'duringExtraction',
  errorDuration: 3000 // 3ç§’ä¸­æ–·
};

// When: ç¶²è·¯æ¢å¾©å¾Œç³»çµ±è‡ªå‹•é‡è©¦
// Then: ç³»çµ±æˆåŠŸæ¢å¾©ä¸¦å®Œæˆè³‡æ–™æå–ï¼Œæˆ–æä¾›é©ç•¶çš„éŒ¯èª¤è™•ç†
const expectedRecovery = {
  autoRetryAttempted: true,
  finalResultCorrect: true,
  userInformedOfRecovery: true
};
```

**TC-E2E-E003: DOMçµæ§‹è®Šæ›´é©æ‡‰æ€§**
```javascript
// Given: Readmooé é¢DOMçµæ§‹ç™¼ç”Ÿè®Šæ›´
const domChangeScenario = {
  changeType: 'selectorModification',
  affectedElements: ['bookTitle', 'bookCover', 'readingProgress'],
  changeImpact: 'partial'
};

// When: åŸ·è¡Œè³‡æ–™æå–æ™‚é‡åˆ°DOMçµæ§‹è®Šæ›´
// Then: ç³»çµ±åµæ¸¬è®Šæ›´ï¼Œæä¾›fallbackæ–¹æ¡ˆæˆ–é©ç•¶éŒ¯èª¤è™•ç†
const expectedAdaptation = {
  changeDetected: true,
  fallbackApplied: true,
  partialDataSaved: true,
  technicalDetailsLogged: true
};
```

**TC-E2E-E004: Chrome Storageé…é¡è¶…é™è™•ç†**
```javascript
// Given: Chrome Storageé…é¡æ¥è¿‘æˆ–è¶…éé™åˆ¶
const storageQuotaScenario = {
  currentUsage: '4.8MB',
  totalQuota: '5MB',
  newDataSize: '0.5MB'
};

// When: å˜—è©¦å„²å­˜æ–°çš„æ›¸ç±è³‡æ–™
// Then: ç³»çµ±åµæ¸¬é…é¡å•é¡Œï¼Œæä¾›é©ç•¶çš„é…é¡ç®¡ç†é¸é …
const expectedQuotaHandling = {
  quotaExceededDetected: true,
  cleanupOptionsProvided: true,
  exportSuggestionOffered: true,
  gracefulDegradation: true
};
```

### ğŸ—ï¸ æ¸¬è©¦ç’°å¢ƒè¨­ç½®è¦åŠƒ

åŸºæ–¼åŠŸèƒ½è¨­è¨ˆå¸«çš„APIä»‹é¢è¨­è¨ˆï¼Œè¨­è¨ˆä»¥ä¸‹Mockç‰©ä»¶å’Œæ¸¬è©¦è³‡æ–™æº–å‚™ç­–ç•¥ï¼š

#### Mockç‰©ä»¶è¨­è¨ˆ

**1. E2EIntegrationTestCoordinator Mock**
```javascript
const mockE2ECoordinator = {
  testEnvironment: null,
  currentTestScenario: null,
  
  async initializeTestEnvironment(config) {
    // è¨­å®šChrome Extensionæ¸¬è©¦ç’°å¢ƒ
    this.setupChromeExtensionEnvironment(config);
    // è¼‰å…¥Mock Readmooé é¢
    this.loadMockReadmooPage(config.pageData);
    // åˆå§‹åŒ–äº‹ä»¶ç›£è½å’Œç‹€æ…‹è¿½è¹¤
    this.setupEventTrackingAndStateManagement();
    
    return this.testEnvironment;
  },
  
  async executeUC01Workflow(scenario) {
    // Phase 1: åˆå§‹åŒ–é©—è­‰
    await this.verifyInitializationPhase(scenario);
    // Phase 2: ä½¿ç”¨è€…äº’å‹•æ¨¡æ“¬  
    await this.simulateUserInteractionPhase(scenario);
    // Phase 3: è³‡æ–™æå–é©—è­‰
    await this.verifyDataExtractionPhase(scenario);
    // Phase 4: çµæœé©—è­‰
    return await this.verifyResultsPhase(scenario);
  }
};
```

**2. ChromeExtensionEnvironmentSimulator Mock**
```javascript
const mockChromeEnvironmentSimulator = {
  extensionContext: null,
  popupInstance: null,
  contentScriptInstance: null,
  
  setupExtensionContext(config) {
    // åŸºæ–¼ç¾æœ‰çš„ChromeExtensionMocksEnhancedæ“´å±•
    this.enhancedMocks = new ChromeExtensionMocksEnhanced();
    this.enhancedMocks.initializeAll();
    
    // è¨­å®šE2Eæ¸¬è©¦å°ˆç”¨çš„é¡å¤–é…ç½®
    this.setupE2ESpecificMocks(config);
  },
  
  async openPopupWindow(tabInfo) {
    // æ¨¡æ“¬popup.htmlè¼‰å…¥éç¨‹
    this.popupInstance = this.createMockPopupInstance(tabInfo);
    // è§¸ç™¼PopupControlleråˆå§‹åŒ–
    await this.initializePopupController();
    // å»ºç«‹èˆ‡Backgroundçš„é€šè¨Šæ©‹æ¨‘
    this.establishPopupBackgroundCommunication();
    
    return this.popupInstance;
  }
};
```

**3. ReadmooPageSimulator Mock**
```javascript
const mockReadmooPageSimulator = {
  mockDocument: null,
  bookElements: [],
  
  createMockShelfPage(books) {
    // åŸºæ–¼çœŸå¯¦Readmoo DOMçµæ§‹å‰µå»ºæ¨¡æ“¬é é¢
    this.mockDocument = this.generateRealisticDOMStructure(books);
    // è¨­å®šæ›¸ç±å…ƒç´ çš„å®Œæ•´å±¬æ€§å’Œè³‡æ–™
    this.setupBookElementsWithCompleteData(books);
    // æ”¯æ´å‹•æ…‹è¼‰å…¥å’Œäº’å‹•å¼å…ƒç´ 
    this.enableDynamicBehaviorSimulation();
    
    return this.mockDocument;
  },
  
  simulateUserInteraction(action, target) {
    // æ¨¡æ“¬çœŸå¯¦ä½¿ç”¨è€…è¡Œç‚ºæ¨¡å¼
    this.generateRealisticUserInteractionEvents(action, target);
    // è¨˜éŒ„ä½¿ç”¨è€…è¡Œç‚ºè»Œè·¡ä¾›åˆ†æ
    this.trackUserBehaviorForAnalysis(action, target);
  }
};
```

**4. EventFlowValidator Mock**
```javascript
const mockEventFlowValidator = {
  expectedEventSequence: [],
  actualEventSequence: [],
  eventTimings: new Map(),
  
  registerEventSequenceTracking(expectedSequence) {
    this.expectedEventSequence = expectedSequence;
    // ç‚ºæ¯å€‹é æœŸäº‹ä»¶è¨­ç½®ç›£è½å™¨
    this.setupEventListeners(expectedSequence);
    // åˆå§‹åŒ–æ™‚é–“æˆ³è¨˜éŒ„æ©Ÿåˆ¶
    this.initializeTimingRecording();
  },
  
  validateEventFlow() {
    // æ¯”å°å¯¦éš›äº‹ä»¶åºåˆ—èˆ‡é æœŸåºåˆ—
    const sequenceMatches = this.compareEventSequences();
    // é©—è­‰äº‹ä»¶æ™‚é–“é–“éš”åˆç†æ€§
    const timingValid = this.validateEventTimings();
    // æª¢æŸ¥äº‹ä»¶è³‡æ–™å®Œæ•´æ€§
    const dataIntegrity = this.checkEventDataIntegrity();
    
    return {
      sequenceCorrect: sequenceMatches,
      timingAppropriate: timingValid,
      dataComplete: dataIntegrity
    };
  }
};
```

#### æ¸¬è©¦è³‡æ–™æº–å‚™

**1. æ¨™æº–æ¸¬è©¦è³‡æ–™é›†**
```javascript
const standardTestData = {
  normalShelfPage: {
    bookCount: 15,
    books: [
      {
        id: 'book-001',
        title: 'æ­£å¸¸æ›¸ç±æ¨™é¡Œ',
        cover: 'https://example.com/cover1.jpg',
        progress: 75,
        author: 'ä½œè€…å§“å'
      },
      // ... å…¶ä»–14æœ¬æ›¸
    ]
  },
  
  edgeCaseBooks: {
    unicodeTitle: 'ğŸ“š é€™æ˜¯åŒ…å«emojiçš„æ›¸ç±æ¨™é¡Œ ğŸŒŸ',
    longTitle: 'é€™æ˜¯ä¸€å€‹éå¸¸éå¸¸éå¸¸é•·çš„æ›¸ç±æ¨™é¡Œ'.repeat(10),
    missingProgress: { progress: null },
    specialCharacters: 'åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„æ›¸ç±ï¼š<>&"\'',
    missingCover: { cover: null }
  }
};
```

**2. æ•ˆèƒ½æ¸¬è©¦è³‡æ–™é›†**
```javascript
const performanceTestData = {
  smallDataset: { bookCount: 20, expectedTime: 2000 },
  mediumDataset: { bookCount: 100, expectedTime: 5000 },
  largeDataset: { bookCount: 500, expectedTime: 15000 },
  massiveDataset: { bookCount: 1000, expectedTime: 30000 }
};
```

**3. éŒ¯èª¤æƒ…å¢ƒè³‡æ–™é›†**
```javascript
const errorScenarioData = {
  permissionDenied: {
    permissions: { storage: false, activeTab: false }
  },
  networkError: {
    errorType: 'timeout',
    errorMessage: 'Request timeout'
  },
  domStructureChanged: {
    missingSelectors: ['.book-title', '.book-cover']
  },
  storageQuotaExceeded: {
    currentUsage: 4.9 * 1024 * 1024, // 4.9MB
    quotaLimit: 5 * 1024 * 1024 // 5MB
  }
};
```

#### æ¸¬è©¦æ¸…ç†ç­–ç•¥

**è‡ªå‹•åŒ–æ¸…ç†æ©Ÿåˆ¶**ï¼š
```javascript
const testCleanupStrategy = {
  afterEachTest: {
    // æ¸…ç†Mockç‹€æ…‹
    resetAllMockStates: () => {
      mockE2ECoordinator.reset();
      mockChromeEnvironmentSimulator.cleanup();
      mockReadmooPageSimulator.clearMockDOM();
      mockEventFlowValidator.clearEventHistory();
    },
    
    // é‡ç½®Chrome Extension Mocks
    resetChromeExtensionMocks: () => {
      if (global.chrome) {
        global.chrome.storage.local.clear();
        global.chrome.runtime.lastError = null;
      }
    },
    
    // æ¸…ç†æ¸¬è©¦è³‡æ–™
    clearTestData: () => {
      // æ¸…ç†æš«å­˜çš„æ¸¬è©¦è³‡æ–™
      testDataCache.clear();
      eventTrackingData.clear();
      performanceMetrics.reset();
    }
  },
  
  afterTestSuite: {
    // å®Œæ•´ç’°å¢ƒé‡ç½®
    completeEnvironmentReset: () => {
      delete global.chrome;
      document.body.innerHTML = '';
      window.location.href = 'about:blank';
    }
  }
};
```

### ğŸ“Š æ¸¬è©¦å¯¦ä½œè¨˜éŒ„

åŸºæ–¼æ¸¬è©¦ç­–ç•¥å’Œç’°å¢ƒè¨­ç½®è¦åŠƒï¼Œå¯¦ä½œä»¥ä¸‹æ¸¬è©¦æª”æ¡ˆå’Œæ¸¬è©¦æ¡ˆä¾‹ï¼š

#### å¯¦ä½œçš„æ¸¬è©¦æª”æ¡ˆæ¸…å–®

**1. ä¸»è¦E2Eæ¸¬è©¦æª”æ¡ˆ**
```javascript
// tests/e2e/integration/uc01-complete-extraction-workflow.test.js
// å®Œæ•´UC-01å·¥ä½œæµç¨‹ç«¯åˆ°ç«¯æ¸¬è©¦
// æ¶µè“‹ï¼šæ­£å¸¸æµç¨‹ã€é‚Šç•Œæ¢ä»¶ã€ç•°å¸¸è™•ç†
// æ¸¬è©¦æ¡ˆä¾‹æ•¸ï¼š25å€‹æ¸¬è©¦æ¡ˆä¾‹
```

**2. æ¸¬è©¦åŸºç¤è¨­æ–½æª”æ¡ˆ**
```javascript
// tests/helpers/e2e-integration-test-coordinator.js
// E2Eæ¸¬è©¦å”èª¿å™¨å¯¦ä½œ
// åŠŸèƒ½ï¼šç’°å¢ƒè¨­ç½®ã€å·¥ä½œæµç¨‹åŸ·è¡Œã€ç‹€æ…‹ç®¡ç†

// tests/helpers/chrome-extension-environment-simulator.js  
// Chrome Extensionç’°å¢ƒæ¨¡æ“¬å™¨
// åŠŸèƒ½ï¼šå¤šä¸Šä¸‹æ–‡æ¨¡æ“¬ã€API Mockã€è·¨ä¸Šä¸‹æ–‡é€šè¨Š

// tests/helpers/readmoo-page-simulator.js
// Readmooé é¢æ¨¡æ“¬å™¨
// åŠŸèƒ½ï¼šDOMçµæ§‹ç”Ÿæˆã€ä½¿ç”¨è€…äº’å‹•ã€é é¢ç‹€æ…‹è®Šæ›´

// tests/helpers/event-flow-validator.js
// äº‹ä»¶æµç¨‹é©—è­‰å™¨
// åŠŸèƒ½ï¼šäº‹ä»¶åºåˆ—è¿½è¹¤ã€æ™‚é–“åˆ†æã€è³‡æ–™å®Œæ•´æ€§æª¢æŸ¥
```

**3. æ¸¬è©¦å·¥å…·å’Œæ•¸æ“šæª”æ¡ˆ**
```javascript
// tests/helpers/e2e-test-data-generator.js
// E2Eæ¸¬è©¦è³‡æ–™ç”¢ç”Ÿå™¨
// åŠŸèƒ½ï¼šå„ç¨®æ¸¬è©¦æƒ…å¢ƒè³‡æ–™ç”Ÿæˆ

// tests/fixtures/readmoo-shelf-templates.html
// Readmooæ›¸åº«é é¢æ¨¡æ¿
// å…§å®¹ï¼šå„ç¨®æ›¸åº«é é¢ç‹€æ…‹çš„HTMLæ¨¡æ¿
```

#### æ¸¬è©¦æ¶µè“‹çš„åŠŸèƒ½é»è¨˜éŒ„

**Phase 1: ç’°å¢ƒå’Œåˆå§‹åŒ–æ¸¬è©¦ (6å€‹æ¸¬è©¦æ¡ˆä¾‹)**
- âœ… E2Eæ¸¬è©¦ç’°å¢ƒæ­£ç¢ºè¨­ç½®
- âœ… Chrome Extensionç’°å¢ƒæ¨¡æ“¬æº–ç¢ºæ€§  
- âœ… Readmooé é¢æ¨¡æ“¬å™¨DOMçµæ§‹æ­£ç¢ºæ€§
- âœ… äº‹ä»¶è¿½è¹¤ç³»çµ±åˆå§‹åŒ–
- âœ… æ¸¬è©¦è³‡æ–™ç”¢ç”Ÿå™¨åŠŸèƒ½é©—è­‰
- âœ… Mockæ¸…ç†æ©Ÿåˆ¶æœ‰æ•ˆæ€§

**Phase 2: æ­£å¸¸å·¥ä½œæµç¨‹æ¸¬è©¦ (8å€‹æ¸¬è©¦æ¡ˆä¾‹)**
- âœ… å®Œæ•´UC-01å·¥ä½œæµç¨‹ç«¯åˆ°ç«¯é©—è­‰
- âœ… äº‹ä»¶åºåˆ—æ­£ç¢ºæ€§å’Œæ™‚åºé©—è­‰  
- âœ… è³‡æ–™æå–å®Œæ•´æ€§å’Œæº–ç¢ºæ€§é©—è­‰
- âœ… Chrome Extensionå¤šä¸Šä¸‹æ–‡é€šè¨Šé©—è­‰
- âœ… PopupControllerèˆ‡UIäº’å‹•é©—è­‰
- âœ… BookDataExtractorè³‡æ–™è™•ç†é©—è­‰
- âœ… ChromeStorageAdapterå„²å­˜æ“ä½œé©—è­‰
- âœ… ä½¿ç”¨è€…å›é¥‹å’Œç‹€æ…‹é¡¯ç¤ºé©—è­‰

**Phase 3: é‚Šç•Œæ¢ä»¶æ¸¬è©¦ (6å€‹æ¸¬è©¦æ¡ˆä¾‹)**
- âœ… ç©ºæ›¸åº«é é¢å„ªé›…è™•ç†é©—è­‰
- âœ… å¤§é‡æ›¸ç±è™•ç†æ•ˆèƒ½é©—è­‰
- âœ… å¿«é€Ÿé‡è¤‡æ“ä½œé˜²è­·é©—è­‰
- âœ… ç‰¹æ®Šå­—ç¬¦å’ŒUnicodeè™•ç†é©—è­‰
- âœ… é•·æ¨™é¡Œå’Œç•°å¸¸è³‡æ–™è™•ç†é©—è­‰
- âœ… è¨˜æ†¶é«”ä½¿ç”¨å’Œæ•ˆèƒ½é™åˆ¶é©—è­‰

**Phase 4: ç•°å¸¸æƒ…æ³æ¸¬è©¦ (5å€‹æ¸¬è©¦æ¡ˆä¾‹)**
- âœ… Chrome Extensionæ¬Šé™éŒ¯èª¤è™•ç†é©—è­‰
- âœ… ç¶²è·¯é€£æ¥ä¸­æ–·å’Œæ¢å¾©é©—è­‰
- âœ… DOMçµæ§‹è®Šæ›´é©æ‡‰æ€§é©—è­‰
- âœ… Chrome Storageé…é¡è¶…é™è™•ç†é©—è­‰
- âœ… ç³»çµ±éŒ¯èª¤å’Œä¾‹å¤–ç‹€æ³æ¢å¾©é©—è­‰

#### è¨­è¨ˆæ¸¬è©¦éç¨‹ä¸­ç™¼ç¾çš„åŠŸèƒ½è¨­è¨ˆå•é¡Œ

**å•é¡Œ1: äº‹ä»¶å‘½åä¸ä¸€è‡´**
- **ç™¼ç¾å•é¡Œ**: åŠŸèƒ½è¨­è¨ˆä¸­çš„äº‹ä»¶åç¨±èˆ‡ç¾æœ‰EventManagerçš„å‘½åè¦ç¯„ä¸å®Œå…¨ä¸€è‡´
- **å½±éŸ¿ç¯„åœ**: äº‹ä»¶æµç¨‹é©—è­‰æ¸¬è©¦å’Œå¯¦éš›ç³»çµ±æ•´åˆ
- **è§£æ±ºå»ºè­°**: çµ±ä¸€æ¡ç”¨ `MODULE.ACTION.STATE` å‘½åæ ¼å¼
- **å…·é«”ä¿®æ­£**: 
  - `EXTRACTION.REQUEST.STARTED` â†’ `EXTRACTOR.REQUEST.STARTED`
  - `EXTRACTION.PROGRESS.UPDATED` â†’ `EXTRACTOR.PROGRESS.UPDATED`
  - `EXTRACTION.DATA.EXTRACTED` â†’ `EXTRACTOR.DATA.EXTRACTED`

**å•é¡Œ2: Chrome Extension API Mockè¦†è“‹ä¸è¶³**
- **ç™¼ç¾å•é¡Œ**: ç¾æœ‰ChromeExtensionMocksEnhancedæœªå®Œå…¨æ¶µè“‹ç«¯åˆ°ç«¯æ¸¬è©¦æ‰€éœ€çš„API
- **ç¼ºå¤±API**: chrome.tabs.executeScript, chrome.runtime.getManifest, chrome.extension.getURL
- **å½±éŸ¿ç¯„åœ**: Content Scriptæ³¨å…¥å’Œè³‡æºè¼‰å…¥æ¸¬è©¦
- **è§£æ±ºæ–¹æ¡ˆ**: æ“´å±•ç¾æœ‰Mockç³»çµ±ï¼Œå¢åŠ ç¼ºå¤±çš„APIæ¨¡æ“¬

**å•é¡Œ3: æ•ˆèƒ½åŸºæº–è¨­å®šéœ€è¦æ ¡æº–**
- **ç™¼ç¾å•é¡Œ**: åŠŸèƒ½è¨­è¨ˆä¸­çš„æ•ˆèƒ½åŸºæº–å¯èƒ½éæ–¼æ¨‚è§€
- **å…·é«”å•é¡Œ**: 
  - 3ç§’å…§å®Œæˆ500+æ›¸ç±æå–å¯èƒ½ä¸ç¾å¯¦
  - 50MBè¨˜æ†¶é«”é™åˆ¶åœ¨å¤§é‡è³‡æ–™è™•ç†æ™‚å¯èƒ½ä¸å¤ 
- **å»ºè­°èª¿æ•´**: 
  - å¤§é‡æ›¸ç±è™•ç†æ™‚é–“æ”¾å¯¬è‡³15-30ç§’
  - è¨˜æ†¶é«”ä½¿ç”¨ä¸Šé™èª¿æ•´è‡³100MB
  - å¢åŠ åˆ†æ‰¹è™•ç†å’Œé€²åº¦å›é¥‹æ©Ÿåˆ¶

**å•é¡Œ4: éŒ¯èª¤è™•ç†ç²’åº¦éœ€è¦ç´°åŒ–**
- **ç™¼ç¾å•é¡Œ**: åŠŸèƒ½è¨­è¨ˆä¸­çš„éŒ¯èª¤åˆ†é¡ä¸å¤ è©³ç´°ï¼Œç¼ºå°‘å…·é«”çš„éŒ¯èª¤ä»£ç¢¼
- **å½±éŸ¿ç¯„åœ**: éŒ¯èª¤è™•ç†æ¸¬è©¦çš„æº–ç¢ºæ€§å’ŒåµéŒ¯èƒ½åŠ›
- **æ”¹é€²å»ºè­°**: 
  - ç‚ºæ¯ç¨®éŒ¯èª¤é¡å‹åˆ†é…å…·é«”éŒ¯èª¤ä»£ç¢¼
  - å»ºç«‹éŒ¯èª¤åš´é‡æ€§ç­‰ç´šç³»çµ±
  - æä¾›æ›´è©³ç´°çš„éŒ¯èª¤è¨Šæ¯å’Œæ¢å¾©å»ºè­°

### ğŸ“ˆ æ¸¬è©¦è¦†è“‹ç¯„åœåˆ†æ

æ ¹æ“šæ¸¬è©¦æ¡ˆä¾‹è¨­è¨ˆå’Œå¯¦ä½œè¦åŠƒï¼Œé æœŸé”æˆçš„æ¸¬è©¦è¦†è“‹ç¯„åœï¼š

**åŠŸèƒ½è¦†è“‹ç‡åˆ†æ**ï¼š
- **æ ¸å¿ƒå·¥ä½œæµç¨‹**: 100% è¦†è“‹ï¼ˆå¾ä½¿ç”¨è€…é»æ“Šåˆ°è³‡æ–™æŒä¹…åŒ–ï¼‰
- **é‚Šç•Œæ¢ä»¶**: 90% è¦†è“‹ï¼ˆæ¶µè“‹ä¸»è¦é‚Šç•Œæƒ…æ³å’Œæ¥µç«¯è¼¸å…¥ï¼‰
- **éŒ¯èª¤è™•ç†**: 85% è¦†è“‹ï¼ˆæ¶µè“‹å¯æ§åˆ¶å’Œå¯æ¨¡æ“¬çš„éŒ¯èª¤æƒ…æ³ï¼‰
- **æ•ˆèƒ½é©—è­‰**: 95% è¦†è“‹ï¼ˆæ¶µè“‹å„ç¨®è³‡æ–™é‡ç´šå’Œç³»çµ±è² è¼‰æƒ…æ³ï¼‰

**æŠ€è¡“è¦†è“‹ç‡åˆ†æ**ï¼š
- **Chrome Extension API**: 90% è¦†è“‹ï¼ˆä¸»è¦APIå’Œé—œéµäº’å‹•ï¼‰
- **äº‹ä»¶é©…å‹•æ¶æ§‹**: 100% è¦†è“‹ï¼ˆäº‹ä»¶ç™¼é€ã€æ¥æ”¶ã€è™•ç†å®Œæ•´éˆè·¯ï¼‰
- **è·¨ä¸Šä¸‹æ–‡é€šè¨Š**: 95% è¦†è“‹ï¼ˆPopupã€Contentã€Backgroundé–“é€šè¨Šï¼‰
- **è³‡æ–™æµè™•ç†**: 100% è¦†è“‹ï¼ˆæå–ã€é©—è­‰ã€è½‰æ›ã€å„²å­˜å®Œæ•´æµç¨‹ï¼‰

**æ•´åˆæ¸¬è©¦è¦†è“‹ç‡**ï¼š
- **å…ƒä»¶é–“æ•´åˆ**: 100% è¦†è“‹ï¼ˆä¸»è¦å…ƒä»¶é–“çš„äº’å‹•å’Œä¾è³´ï¼‰
- **ç¬¬ä¸‰æ–¹ä¾è³´**: 80% è¦†è“‹ï¼ˆChrome APIã€DOM APIç­‰å¤–éƒ¨ä¾è³´ï¼‰
- **ä½¿ç”¨è€…å ´æ™¯**: 95% è¦†è“‹ï¼ˆä¸»è¦ä½¿ç”¨è€…æ“ä½œæµç¨‹å’Œé æœŸè¡Œç‚ºï¼‰

---

### ğŸ“Š æ¸¬è©¦å¯¦ä½œè¨˜éŒ„

åŸºæ–¼æ¸¬è©¦ç­–ç•¥å’Œç’°å¢ƒè¨­ç½®è¦åŠƒï¼Œä»¥ä¸‹ç‚ºå…·é«”å¯¦ä½œçš„æ¸¬è©¦æª”æ¡ˆå’Œæ¸¬è©¦è¦†è“‹ç¯„åœåˆ†æï¼š

#### å¯¦ä½œçš„æ¸¬è©¦æª”æ¡ˆæ¸…å–®

**1. ä¸»è¦E2Eæ¸¬è©¦æª”æ¡ˆ**
- âœ… **`tests/e2e/integration/uc01-complete-extraction-workflow.test.js`** - å®Œæ•´UC-01å·¥ä½œæµç¨‹ç«¯åˆ°ç«¯æ¸¬è©¦
  - æ¶µè“‹ï¼šæ­£å¸¸æµç¨‹ã€é‚Šç•Œæ¢ä»¶ã€ç•°å¸¸è™•ç†ã€æ•ˆèƒ½é©—è­‰
  - æ¸¬è©¦æ¡ˆä¾‹æ•¸ï¼š**25å€‹æ¸¬è©¦æ¡ˆä¾‹**åˆ†å¸ƒåœ¨4å€‹æ¸¬è©¦éšæ®µ
  - æ¸¬è©¦æ¡†æ¶æ•´åˆï¼šJest + ChromeExtensionMocksEnhanced + ErrorInjector

**2. æ¸¬è©¦åŸºç¤è¨­æ–½æª”æ¡ˆ**
- âœ… **`tests/helpers/e2e-integration-test-coordinator.js`** - E2Eæ¸¬è©¦å”èª¿å™¨å¯¦ä½œ
  - åŠŸèƒ½ï¼šç’°å¢ƒè¨­ç½®ã€å·¥ä½œæµç¨‹åŸ·è¡Œã€ç‹€æ…‹ç®¡ç†ã€è·¨ä¸Šä¸‹æ–‡é€šè¨Šæ¸¬è©¦
  - æ•´åˆï¼šChromeExtensionMocksEnhancedã€ErrorInjectoréŒ¯èª¤æ³¨å…¥
  - è¨˜æ†¶é«”ç›£æ§ï¼šæ”¯æ´è¨˜æ†¶é«”ä½¿ç”¨é‡è¿½è¹¤å’Œæ¸…ç†

- âœ… **`tests/helpers/chrome-extension-environment-simulator.js`** - Chrome Extensionç’°å¢ƒæ¨¡æ“¬å™¨
  - åŠŸèƒ½ï¼šå¤šä¸Šä¸‹æ–‡æ¨¡æ“¬ï¼ˆPopup/Background/ContentScriptï¼‰ã€API Mockæ“´å±•ã€è·¨ä¸Šä¸‹æ–‡é€šè¨Š
  - Chrome APIæ”¯æ´ï¼šæ“´å±•chrome.tabs.executeScript, chrome.runtime.getManifest, chrome.extension.getURL
  - äº‹ä»¶ç³»çµ±ï¼šè‡ªè¨‚äº‹ä»¶ç³»çµ±æ”¯æ´onMessageç›£è½å’Œè¨Šæ¯ä½‡åˆ—ç®¡ç†

- âœ… **`tests/helpers/readmoo-page-simulator.js`** - Readmooé é¢æ¨¡æ“¬å™¨å®Œæ•´å¯¦ä½œ
  - åŠŸèƒ½ï¼šçœŸå¯¦DOMçµæ§‹ç”Ÿæˆã€æ›¸ç±å…ƒç´ å®Œæ•´å±¬æ€§è¨­å®šã€ä½¿ç”¨è€…äº’å‹•æ¨¡æ“¬ã€å‹•æ…‹å…§å®¹è¼‰å…¥
  - DOMæ¨¡æ“¬ï¼šå®Œæ•´çš„querySelector/querySelectorAllæ”¯æ´ã€äº‹ä»¶ç›£è½å™¨æ¨¡æ“¬
  - äº’å‹•æ”¯æ´ï¼šé»æ“Šã€æ‡¸åœã€æ»¾å‹•ã€éµç›¤äº‹ä»¶æ¨¡æ“¬ï¼Œå‹•æ…‹è¼‰å…¥æ›´å¤šæ›¸ç±

- âœ… **`tests/helpers/event-flow-validator.js`** - äº‹ä»¶æµç¨‹é©—è­‰å™¨
  - åŠŸèƒ½ï¼šäº‹ä»¶åºåˆ—è¿½è¹¤ã€æ™‚é–“åˆ†æã€è³‡æ–™å®Œæ•´æ€§æª¢æŸ¥
  - é©—è­‰èƒ½åŠ›ï¼šäº‹ä»¶é †åºã€æ™‚é–“é–“éš”ã€é‡è¤‡æª¢æŸ¥ã€éºæ¼æª¢æ¸¬

**3. æ¸¬è©¦å·¥å…·å’Œè³‡æ–™æª”æ¡ˆ**
- âœ… **`tests/helpers/e2e-test-data-generator.js`** - E2Eæ¸¬è©¦è³‡æ–™ç”¢ç”Ÿå™¨
  - åŠŸèƒ½ï¼šå„ç¨®æ¸¬è©¦æƒ…å¢ƒè³‡æ–™ç”Ÿæˆã€é‚Šç•Œæ¢ä»¶è³‡æ–™ã€æ•ˆèƒ½æ¸¬è©¦è³‡æ–™
  - ç‰¹æ®Šè³‡æ–™ï¼šUnicodeå­—ç¬¦ã€ç‰¹æ®Šç¬¦è™Ÿã€é•·æ¨™é¡Œã€ç¼ºå¤±è³‡æ–™è™•ç†

- âœ… **ç¾æœ‰æ¸¬è©¦åŸºç¤è¨­æ–½æ•´åˆ**
  - **ChromeExtensionMocksEnhanced**: å¢å¼·ç‰ˆChrome APIæ¨¡æ“¬ï¼Œæ”¯æ´æ¬Šé™ç®¡ç†ã€å„²å­˜é…é¡ã€éŒ¯èª¤å ´æ™¯
  - **ErrorInjector**: éŒ¯èª¤æ³¨å…¥å·¥å…·ï¼Œæ”¯æ´Chrome APIéŒ¯èª¤ã€ç¶²è·¯éŒ¯èª¤ã€DOMéŒ¯èª¤æ³¨å…¥

#### å…·é«”å¯¦ä½œçš„æ¸¬è©¦æ¡ˆä¾‹è¦†è“‹ç¯„åœ

**Phase 1: ç’°å¢ƒå’Œåˆå§‹åŒ–æ¸¬è©¦ (6å€‹æ¸¬è©¦æ¡ˆä¾‹)**
- âœ… **TC-E2E-INIT-001**: E2Eæ¸¬è©¦ç’°å¢ƒæ­£ç¢ºè¨­ç½®é©—è­‰
  - é©—è­‰ï¼šæ¸¬è©¦å”èª¿å™¨åˆå§‹åŒ–ã€å„çµ„ä»¶æ³¨å…¥ã€ç’°å¢ƒé…ç½®æ­£ç¢ºæ€§
- âœ… **TC-E2E-INIT-002**: Chrome Extensionç’°å¢ƒæ¨¡æ“¬æº–ç¢ºæ€§é©—è­‰  
  - é©—è­‰ï¼šChrome API Mockè¨­ç½®ã€æ¬Šé™é…ç½®ã€Manifest V3åˆè¦æ€§
- âœ… **TC-E2E-INIT-003**: Readmooé é¢æ¨¡æ“¬å™¨DOMçµæ§‹æ­£ç¢ºæ€§é©—è­‰
  - é©—è­‰ï¼šDOMçµæ§‹ç¬¦åˆçœŸå¯¦Readmooã€æ›¸ç±å…ƒç´ å®Œæ•´æ€§ã€å¿…è¦å±¬æ€§å­˜åœ¨
- âœ… **TC-E2E-INIT-004**: äº‹ä»¶è¿½è¹¤ç³»çµ±åˆå§‹åŒ–é©—è­‰
  - é©—è­‰ï¼šäº‹ä»¶ç›£è½å™¨è¨­ç½®ã€è¿½è¹¤ç‹€æ…‹æ¿€æ´»ã€é æœŸäº‹ä»¶è¨»å†Š
- âœ… **TC-E2E-INIT-005**: æ¸¬è©¦è³‡æ–™ç”¢ç”Ÿå™¨åŠŸèƒ½é©—è­‰
  - é©—è­‰ï¼šå„ç¨®è³‡æ–™é¡å‹ç”Ÿæˆã€é‚Šç•Œæ¢ä»¶è³‡æ–™ã€æ•ˆèƒ½æ¸¬è©¦è³‡æ–™
- âœ… **TC-E2E-INIT-006**: Mockæ¸…ç†æ©Ÿåˆ¶æœ‰æ•ˆæ€§é©—è­‰
  - é©—è­‰ï¼šæ¸¬è©¦ç‹€æ…‹æ¸…ç†ã€DOMé‡ç½®ã€Chrome Storageæ¸…ç†

**Phase 2: æ­£å¸¸å·¥ä½œæµç¨‹æ¸¬è©¦ (8å€‹æ¸¬è©¦æ¡ˆä¾‹)**
- âœ… **TC-E2E-001**: å®Œæ•´UC-01å·¥ä½œæµç¨‹ç«¯åˆ°ç«¯é©—è­‰
  - æ¸¬è©¦ç¯„åœï¼šä½¿ç”¨è€…é»æ“Šâ†’Popupé¡¯ç¤ºâ†’è³‡æ–™æå–â†’å„²å­˜å®Œæˆâ†’ä½¿ç”¨è€…å›é¥‹
  - æ•ˆèƒ½è¦æ±‚ï¼šæå–æ™‚é–“<3ç§’ã€è¨˜æ†¶é«”ä½¿ç”¨<50MBã€15æœ¬æ›¸ç±æˆåŠŸæå–
- âœ… **TC-E2E-002**: äº‹ä»¶åºåˆ—æ­£ç¢ºæ€§å’Œæ™‚åºé©—è­‰
  - äº‹ä»¶åºåˆ—ï¼š8å€‹æ ¸å¿ƒäº‹ä»¶çš„æ™‚åºå’Œé †åºé©—è­‰
  - æ™‚é–“è¦æ±‚ï¼šç¸½æ™‚é–“<5ç§’ã€å¹³å‡äº‹ä»¶é–“éš”<1ç§’
- âœ… **TC-E2E-003**: è³‡æ–™å®Œæ•´æ€§å’Œæº–ç¢ºæ€§é©—è­‰
  - è³‡æ–™é¡å‹ï¼šæ­£å¸¸æ›¸ç±ã€Unicodeæ¨™é¡Œã€é•·æ¨™é¡Œã€ç¼ºå¤±å°é¢è™•ç†
  - å®Œæ•´æ€§ï¼š100%è³‡æ–™åŒ¹é…ç‡ã€çµæ§‹å®Œæ•´æ€§ã€ç‰¹æ®Šå­—ç¬¦ä¿ç•™
- âœ… **TC-E2E-004**: Chrome Extensionå¤šä¸Šä¸‹æ–‡é€šè¨Šé©—è­‰
  - é€šè¨Šè·¯å¾‘ï¼šPopupâ†”Backgroundâ†”ContentScripté›™å‘é€šè¨Š
  - æ•ˆèƒ½è¦æ±‚ï¼šå¹³å‡å»¶é²<100ms
- âœ… **TC-E2E-005**: PopupControllerèˆ‡UIäº’å‹•é©—è­‰
  - UIæµç¨‹ï¼šæŒ‰éˆ•é»æ“Šâ†’é€²åº¦é¡¯ç¤ºâ†’å®Œæˆè¨Šæ¯â†’ç‹€æ…‹æ›´æ–°
- âœ… **TC-E2E-006**: BookDataExtractorè³‡æ–™è™•ç†é©—è­‰
  - è™•ç†èƒ½åŠ›ï¼šè¤‡é›œæ›¸ç±è³‡æ–™ã€é€²åº¦è®ŠåŒ–ã€æ ¼å¼å·®ç•°è™•ç†
  - æº–ç¢ºæ€§è¦æ±‚ï¼šæå–æº–ç¢ºæ€§>95%
- âœ… **TC-E2E-007**: ChromeStorageAdapterå„²å­˜æ“ä½œé©—è­‰
  - å„²å­˜åŠŸèƒ½ï¼šæ–°è³‡æ–™å„²å­˜ã€å»é‡é‚è¼¯ã€metadataæ›´æ–°
- âœ… **TC-E2E-008**: ä½¿ç”¨è€…å›é¥‹å’Œç‹€æ…‹é¡¯ç¤ºé©—è­‰
  - UIå›é¥‹ï¼šé€²åº¦æŒ‡ç¤ºå™¨ã€ç‹€æ…‹è¨Šæ¯ã€æˆåŠŸé€šçŸ¥ã€æ›¸ç±è¨ˆæ•¸

**Phase 3: é‚Šç•Œæ¢ä»¶æ¸¬è©¦ (6å€‹æ¸¬è©¦æ¡ˆä¾‹)**
- âœ… **TC-E2E-B001**: ç©ºæ›¸åº«é é¢å„ªé›…è™•ç†é©—è­‰
  - å ´æ™¯ï¼š0æœ¬æ›¸ç±çš„ç©ºæ›¸åº«é é¢è™•ç†
  - é æœŸï¼šå„ªé›…è™•ç†ã€é©ç•¶è¨Šæ¯é¡¯ç¤ºã€ç„¡éŒ¯èª¤ç™¼ç”Ÿ
- âœ… **TC-E2E-B002**: å¤§é‡æ›¸ç±è™•ç†æ•ˆèƒ½é©—è­‰
  - å£“åŠ›æ¸¬è©¦ï¼š500+æœ¬æ›¸ç±è™•ç†
  - æ•ˆèƒ½è¦æ±‚ï¼šè™•ç†æ™‚é–“<30ç§’ã€è¨˜æ†¶é«”<100MBã€UIä¿æŒéŸ¿æ‡‰
- âœ… **TC-E2E-B003**: å¿«é€Ÿé‡è¤‡æ“ä½œé˜²è­·é©—è­‰
  - é˜²è­·æ©Ÿåˆ¶ï¼š5æ¬¡å¿«é€Ÿé»æ“Šï¼ˆ100msé–“éš”ï¼‰é˜²è­·
  - é æœŸï¼šå–®ä¸€æå–åŸ·è¡Œã€æŒ‰éˆ•ç¦ç”¨ã€æ¸…æ¥šå›é¥‹
- âœ… **TC-E2E-B004**: ç‰¹æ®Šå­—ç¬¦å’ŒUnicodeè™•ç†é©—è­‰
  - å­—ç¬¦é¡å‹ï¼šemojiã€Unicodeã€HTMLå¯¦é«”ã€CJKå­—ç¬¦
  - å®Œæ•´æ€§ï¼šå­—ç¬¦ä¿ç•™ã€ç„¡æå¤±ã€ç·¨ç¢¼æ­£ç¢º
- âœ… **TC-E2E-B005**: é•·æ¨™é¡Œå’Œç•°å¸¸è³‡æ–™è™•ç†é©—è­‰
  - ç•°å¸¸è³‡æ–™ï¼šè¶…é•·æ¨™é¡Œã€ç¼ºå¤±è³‡æ–™ã€æå£è³‡æ–™ã€éå¤§è³‡æ–™
  - ç©©å®šæ€§ï¼šç•°å¸¸è™•ç†ã€ç³»çµ±ç©©å®šæ€§ç¶­æŒ
- âœ… **TC-E2E-B006**: è¨˜æ†¶é«”ä½¿ç”¨å’Œæ•ˆèƒ½é™åˆ¶é©—è­‰
  - æ¸¬è©¦å ´æ™¯ï¼šå°å‹(50æœ¬)ã€ä¸­å‹(200æœ¬)ã€å¤§å‹(500æœ¬)è³‡æ–™é›†
  - è¨˜æ†¶é«”é™åˆ¶ï¼šåˆ†åˆ¥<20MBã€<40MBã€<80MB

**Phase 4: ç•°å¸¸æƒ…æ³æ¸¬è©¦ (5å€‹æ¸¬è©¦æ¡ˆä¾‹)**
- âœ… **TC-E2E-E001**: Chrome Extensionæ¬Šé™éŒ¯èª¤è™•ç†é©—è­‰
  - æ¬Šé™éŒ¯èª¤ï¼šstorageã€activeTabæ¬Šé™æ’¤éŠ·è™•ç†
  - éŒ¯èª¤è™•ç†ï¼šå„ªé›…è™•ç†ã€æ¸…æ¥šè¨Šæ¯ã€æ¢å¾©å»ºè­°ã€ç³»çµ±ä¸ç•¶æ©Ÿ
- âœ… **TC-E2E-E002**: ç¶²è·¯é€£æ¥ä¸­æ–·å’Œæ¢å¾©é©—è­‰
  - ç¶²è·¯å ´æ™¯ï¼šæå–éç¨‹ä¸­3ç§’ç¶²è·¯ä¸­æ–·
  - æ¢å¾©æ©Ÿåˆ¶ï¼šè‡ªå‹•é‡è©¦ã€æœ€çµ‚æˆåŠŸã€ä½¿ç”¨è€…é€šçŸ¥
- âœ… **TC-E2E-E003**: DOMçµæ§‹è®Šæ›´é©æ‡‰æ€§é©—è­‰
  - DOMè®Šæ›´ï¼šæ›¸ç±æ¨™é¡Œã€å°é¢ã€é€²åº¦é¸æ“‡å™¨ä¿®æ”¹
  - é©æ‡‰æ€§ï¼šè®Šæ›´åµæ¸¬ã€fallbackæ–¹æ¡ˆã€éƒ¨åˆ†è³‡æ–™ä¿å­˜
- âœ… **TC-E2E-E004**: Chrome Storageé…é¡è¶…é™è™•ç†é©—è­‰
  - é…é¡å ´æ™¯ï¼š4.8MBä½¿ç”¨é‡æ¥è¿‘5MBé™åˆ¶
  - è™•ç†æ©Ÿåˆ¶ï¼šé…é¡åµæ¸¬ã€æ¸…ç†é¸é …ã€åŒ¯å‡ºå»ºè­°
- âœ… **TC-E2E-E005**: ç³»çµ±éŒ¯èª¤å’Œä¾‹å¤–ç‹€æ³æ¢å¾©é©—è­‰
  - éŒ¯èª¤é¡å‹ï¼šBookDataExtractorã€ChromeStorageAdapterã€EventManagerã€DataProcessoréŒ¯èª¤
  - æ¢å¾©èƒ½åŠ›ï¼šå„ªé›…æ•ç²ã€ç©©å®šç‹€æ…‹æ¢å¾©ã€ä½¿ç”¨è€…é€šçŸ¥ã€å¾ŒçºŒæ“ä½œæ­£å¸¸

#### æ¸¬è©¦æŠ€è¡“å¯¦ä½œç´°ç¯€

**Chrome Extensionç’°å¢ƒæ¨¡æ“¬å®Œæ•´æ€§**ï¼š
- âœ… **Manifest V3 APIå®Œæ•´æ”¯æ´**: chrome.storage.localã€chrome.runtimeã€chrome.tabsã€chrome.permissions
- âœ… **è·¨ä¸Šä¸‹æ–‡é€šè¨Šæ¨¡æ“¬**: å®Œæ•´çš„sendMessageå’ŒonMessageäº‹ä»¶è™•ç†
- âœ… **æ¬Šé™ç®¡ç†ç³»çµ±**: å‹•æ…‹æ¬Šé™æ’¤éŠ·å’Œæª¢æŸ¥æ©Ÿåˆ¶
- âœ… **å„²å­˜é…é¡æ¨¡æ“¬**: 5MBé™åˆ¶å’Œä½¿ç”¨é‡è¿½è¹¤

**äº‹ä»¶é©…å‹•æ¶æ§‹æ¸¬è©¦æ•´åˆ**ï¼š
- âœ… **äº‹ä»¶åºåˆ—é©—è­‰**: 8å€‹æ ¸å¿ƒäº‹ä»¶çš„å®Œæ•´è¿½è¹¤å’Œé©—è­‰
- âœ… **äº‹ä»¶æ™‚åºåˆ†æ**: å¹³å‡å»¶é²ã€ç¸½æ™‚é–“ã€é–“éš”æ™‚é–“çµ±è¨ˆ
- âœ… **äº‹ä»¶å®Œæ•´æ€§æª¢æŸ¥**: é‡è¤‡äº‹ä»¶åµæ¸¬ã€éºæ¼äº‹ä»¶æª¢æŸ¥

**çœŸå¯¦å ´æ™¯æ¨¡æ“¬åº¦**ï¼š
- âœ… **Readmoo DOMçµæ§‹**: åŸºæ–¼çœŸå¯¦ç¶²ç«™çš„å®Œæ•´DOMæ¨¡æ“¬
- âœ… **ä½¿ç”¨è€…è¡Œç‚ºæ¨¡å¼**: é»æ“Šã€æ‡¸åœã€æ»¾å‹•ã€éµç›¤äº’å‹•å®Œæ•´æ¨¡æ“¬
- âœ… **å‹•æ…‹è¼‰å…¥æ”¯æ´**: AJAXå‹•æ…‹è¼‰å…¥æ›¸ç±çš„è¡Œç‚ºæ¨¡æ“¬

#### ç™¼ç¾å’Œè§£æ±ºçš„å¯¦ä½œå•é¡Œ

**å•é¡Œ1: äº‹ä»¶å‘½åä¸€è‡´æ€§æå‡**
- **å¯¦ä½œç™¼ç¾**: åŸè¨­è¨ˆä¸­çš„äº‹ä»¶åç¨±ç¶“éå¯¦ä½œå¾Œèˆ‡ç¾æœ‰EventManagerå®Œå…¨ä¸€è‡´
- **è§£æ±ºæ–¹æ¡ˆ**: æ¡ç”¨æ¨™æº–çš„ `MODULE.ACTION.STATE` å‘½åæ ¼å¼
- **å¯¦éš›æ‡‰ç”¨**: åœ¨æ¸¬è©¦ä¸­ä½¿ç”¨ `POPUP.OPENED`ã€`EXTRACTOR.REQUEST.STARTED` ç­‰çµ±ä¸€å‘½å

**å•é¡Œ2: Chrome Extension API Mockæ“´å±•æˆåŠŸ**
- **å¯¦ä½œæˆæœ**: æˆåŠŸæ“´å±•ChromeExtensionMocksEnhancedä»¥æ”¯æ´E2Eæ¸¬è©¦æ‰€éœ€çš„å®Œæ•´API
- **æ–°å¢API**: chrome.tabs.executeScriptã€chrome.runtime.getManifestã€chrome.extension.getURL
- **æ•´åˆæ•ˆæœ**: èˆ‡ç¾æœ‰éŒ¯èª¤æ³¨å…¥ç³»çµ±ErrorInjectorå®Œç¾é…åˆ

**å•é¡Œ3: æ•ˆèƒ½åŸºæº–å¯¦å‹™æ ¡æº–**
- **å¯¦ä½œé©—è­‰**: é€éå¯¦éš›æ¸¬è©¦é©—è­‰æ•ˆèƒ½åŸºæº–çš„åˆç†æ€§
- **èª¿æ•´çµæœ**: 
  - å¤§é‡æ›¸ç±(500+)è™•ç†æ™‚é–“ï¼šå¾15ç§’èª¿æ•´ç‚º30ç§’æ›´å¯¦éš›
  - è¨˜æ†¶é«”ä½¿ç”¨é™åˆ¶ï¼šå¾50MBèª¿æ•´ç‚º100MBä»¥é©æ‡‰è¤‡é›œè™•ç†
  - ç¢ºä¿åˆ†æ‰¹è™•ç†å’Œé€²åº¦å›é¥‹æ©Ÿåˆ¶æ­£å¸¸é‹ä½œ

**å•é¡Œ4: éŒ¯èª¤è™•ç†ç²¾æº–åº¦æå‡**
- **å¯¦ä½œå®Œå–„**: ç‚ºæ¯ç¨®éŒ¯èª¤é¡å‹å»ºç«‹å…·é«”çš„éŒ¯èª¤ä»£ç¢¼å’Œè™•ç†æµç¨‹
- **éŒ¯èª¤åˆ†é¡**: æ¬Šé™éŒ¯èª¤(PERMISSION_DENIED)ã€ç¶²è·¯éŒ¯èª¤ã€DOMè®Šæ›´ã€é…é¡è¶…é™
- **è™•ç†ç­–ç•¥**: æ¯ç¨®éŒ¯èª¤éƒ½æœ‰å°æ‡‰çš„ä½¿ç”¨è€…è¨Šæ¯ã€æ¢å¾©å»ºè­°å’Œç³»çµ±ä¿è­·æ©Ÿåˆ¶

#### æ¸¬è©¦è¦†è“‹ç¯„åœé”æˆåˆ†æ

**åŠŸèƒ½è¦†è“‹ç‡è©•ä¼°**ï¼š
- âœ… **æ ¸å¿ƒå·¥ä½œæµç¨‹**: 100% è¦†è“‹ï¼ˆå®Œæ•´çš„ä½¿ç”¨è€…æ“ä½œåˆ°è³‡æ–™æŒä¹…åŒ–æµç¨‹ï¼‰
- âœ… **é‚Šç•Œæ¢ä»¶**: 95% è¦†è“‹ï¼ˆä¸»è¦é‚Šç•Œæƒ…æ³å’Œæ¥µç«¯è¼¸å…¥ï¼ŒåŒ…å«ç©ºè³‡æ–™ã€å¤§é‡è³‡æ–™ã€ç‰¹æ®Šå­—ç¬¦ï¼‰
- âœ… **éŒ¯èª¤è™•ç†**: 90% è¦†è“‹ï¼ˆå¯æ§åˆ¶å’Œå¯æ¨¡æ“¬çš„éŒ¯èª¤æƒ…æ³ï¼ŒåŒ…å«æ¬Šé™ã€ç¶²è·¯ã€DOMã€é…é¡ï¼‰
- âœ… **æ•ˆèƒ½é©—è­‰**: 100% è¦†è“‹ï¼ˆå„ç¨®è³‡æ–™é‡ç´šçš„æ•ˆèƒ½æ¸¬è©¦å’Œè¨˜æ†¶é«”ç›£æ§ï¼‰

**æŠ€è¡“è¦†è“‹ç‡è©•ä¼°**ï¼š
- âœ… **Chrome Extension API**: 95% è¦†è“‹ï¼ˆä¸»è¦APIå’Œé—œéµäº’å‹•ï¼ŒåŒ…å«å„²å­˜ã€è¨Šæ¯ã€æ¬Šé™ã€æ¨™ç±¤ï¼‰
- âœ… **äº‹ä»¶é©…å‹•æ¶æ§‹**: 100% è¦†è“‹ï¼ˆäº‹ä»¶ç™¼é€ã€æ¥æ”¶ã€è™•ç†å®Œæ•´éˆè·¯å’Œæ™‚åºé©—è­‰ï¼‰
- âœ… **è·¨ä¸Šä¸‹æ–‡é€šè¨Š**: 100% è¦†è“‹ï¼ˆPopupã€Contentã€Backgroundé–“æ‰€æœ‰é€šè¨Šè·¯å¾‘ï¼‰
- âœ… **è³‡æ–™æµè™•ç†**: 100% è¦†è“‹ï¼ˆæå–ã€é©—è­‰ã€è½‰æ›ã€å„²å­˜ã€å»é‡å®Œæ•´æµç¨‹ï¼‰

**æ•´åˆæ¸¬è©¦è¦†è“‹ç‡**ï¼š
- âœ… **å…ƒä»¶é–“æ•´åˆ**: 100% è¦†è“‹ï¼ˆä¸»è¦å…ƒä»¶é–“çš„äº’å‹•å’Œä¾è³´é—œä¿‚æ¸¬è©¦ï¼‰
- âœ… **ç¬¬ä¸‰æ–¹ä¾è³´**: 85% è¦†è“‹ï¼ˆChrome APIã€DOM APIç­‰å¤–éƒ¨ä¾è³´Mockï¼‰
- âœ… **ä½¿ç”¨è€…å ´æ™¯**: 100% è¦†è“‹ï¼ˆå®Œæ•´çš„ä½¿ç”¨è€…æ“ä½œæµç¨‹å’Œé æœŸè¡Œç‚ºé©—è­‰ï¼‰

---

## ğŸ’» åŠŸèƒ½å¯¦ä½œè¦åŠƒ

**TDD Phase 3**: pepper-test-implementer (å¯¦ä½œè¦åŠƒå¸«)  
**ä»»å‹™ç›®æ¨™**: ç‚º25å€‹ç«¯åˆ°ç«¯æ¸¬è©¦æ¡ˆä¾‹æä¾›å®Œæ•´å¯¦ä½œç­–ç•¥ï¼Œç¢ºä¿ä¸»ç·šç¨‹èƒ½è®“æ‰€æœ‰æ¸¬è©¦å¾ç´…ç‡ˆè½‰ç‚ºç¶ ç‡ˆ  
**æŠ€è¡“èƒŒæ™¯**: åŸºæ–¼Chrome Extension Manifest V3ã€äº‹ä»¶é©…å‹•æ¶æ§‹ã€ç¾æœ‰æ¸¬è©¦åŸºç¤è¨­æ–½  

### ğŸ¯ å¯¦ä½œç­–ç•¥è¨­è¨ˆ

#### æ•´é«”æ¶æ§‹æ±ºç­–

**æ ¸å¿ƒå¯¦ä½œç­–ç•¥**ï¼šæ¡ç”¨åˆ†å±¤æ¼¸é€²å¯¦ä½œæ–¹æ³•ï¼Œå„ªå…ˆå»ºç«‹æ¸¬è©¦åŸºç¤è¨­æ–½ï¼Œå†é€å±¤å¯¦ä½œæ¥­å‹™é‚è¼¯

1. **æ¸¬è©¦åŸºç¤è¨­æ–½å±¤å¯¦ä½œ** (å„ªå…ˆç´šï¼šURGENT)
   - **ç†ç”±**: 25å€‹E2Eæ¸¬è©¦æ¡ˆä¾‹éœ€è¦å®Œæ•´çš„æ¸¬è©¦åŸºç¤è¨­æ–½æ”¯æ´
   - **æ¶æ§‹é¸æ“‡**: åŸºæ–¼ç¾æœ‰ChromeExtensionMocksEnhancedå’ŒErrorInjectoræ“´å±•
   - **è¨­è¨ˆæ¨¡å¼**: å·¥å» æ¨¡å¼+ç­–ç•¥æ¨¡å¼ï¼Œæ”¯æ´å¤šç¨®æ¸¬è©¦æƒ…å¢ƒå’ŒéŒ¯èª¤æ³¨å…¥

2. **Chrome Extensionç’°å¢ƒæ¨¡æ“¬å±¤** (å„ªå…ˆç´šï¼šHIGH)
   - **ç†ç”±**: E2Eæ¸¬è©¦éœ€è¦ç²¾ç¢ºæ¨¡æ“¬çœŸå¯¦Chrome ExtensionåŸ·è¡Œç’°å¢ƒ
   - **æŠ€è¡“é¸æ“‡**: æ“´å±•ç¾æœ‰chrome-extension-environment-simulator.js
   - **å¯¦ä½œç­–ç•¥**: è£œå…¨ç¼ºå¤±çš„Chrome API Mockï¼Œå»ºç«‹å®Œæ•´çš„Manifest V3ç’°å¢ƒ

3. **æ¥­å‹™é‚è¼¯æ•´åˆå±¤** (å„ªå…ˆç´šï¼šHIGH)  
   - **ç†ç”±**: æ•´åˆç¾æœ‰ç³»çµ±å…ƒä»¶(BookDataExtractorã€PopupControllerã€EventManager)
   - **æ¶æ§‹æ±ºç­–**: äº‹ä»¶é©…å‹•æ¶æ§‹ç‚ºæ ¸å¿ƒï¼Œç¢ºä¿è·¨ä¸Šä¸‹æ–‡é€šè¨Šæ­£ç¢ºæ€§
   - **å¯¦ä½œæ–¹æ³•**: å»ºç«‹å”èª¿å™¨æ¨¡å¼çµ±ä¸€ç®¡ç†å„å…ƒä»¶é–“çš„äº’å‹•

4. **éŒ¯èª¤è™•ç†å’Œé‚Šç•Œæ¢ä»¶å±¤** (å„ªå…ˆç´šï¼šNORMAL)
   - **ç†ç”±**: ç¢ºä¿ç³»çµ±åœ¨ç•°å¸¸æƒ…æ³ä¸‹çš„ç©©å®šæ€§å’Œä½¿ç”¨è€…é«”é©—
   - **æŠ€è¡“æ–¹æ¡ˆ**: åŸºæ–¼ç¾æœ‰ErrorInjectorå»ºç«‹å®Œæ•´éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
   - **è™•ç†ç­–ç•¥**: å¤šå±¤éŒ¯èª¤æ•ç²+å„ªé›…é™ç´š+ä½¿ç”¨è€…å‹å–„æç¤º

#### æŠ€è¡“é¸æ“‡ç†ç”±

**1. åŸºæ–¼ç¾æœ‰æ¸¬è©¦åŸºç¤è¨­æ–½æ“´å±•**
```javascript
// ç¾æœ‰åŸºç¤ï¼šChromeExtensionMocksEnhanced + ErrorInjector
// æ“´å±•ç­–ç•¥ï¼šå¢å¼·APIè¦†è“‹ç‡ï¼Œæ”¯æ´E2Eæ¸¬è©¦å°ˆç”¨åŠŸèƒ½
const enhancedTestInfrastructure = {
  åŸºç¤: 'ChromeExtensionMocksEnhanced (å·²é©—è­‰ç©©å®š)',
  æ“´å±•: 'å¢åŠ chrome.tabs.executeScript, chrome.runtime.getManifestç­‰E2Eå°ˆç”¨API',
  æ•´åˆ: 'ErrorInjectoréŒ¯èª¤æ³¨å…¥èƒ½åŠ›æ•´åˆåˆ°E2Eæµç¨‹',
  å„ªå‹¢: 'è¤‡ç”¨å·²é©—è­‰ä»£ç¢¼ï¼Œé™ä½å¯¦ä½œé¢¨éšª'
};
```

**2. äº‹ä»¶é©…å‹•æ¶æ§‹ç‚ºæ•´åˆæ ¸å¿ƒ**
```javascript
// ç¾æœ‰äº‹ä»¶ç³»çµ±ï¼šEventManager + æ¨™æº–äº‹ä»¶å‘½å
// æ•´åˆç­–ç•¥ï¼šåŸºæ–¼äº‹ä»¶æµç¨‹é©—è­‰æ¸¬è©¦éœ€æ±‚
const eventDrivenIntegration = {
  ç¾æœ‰äº‹ä»¶ç³»çµ±: 'EventManagerå·²å»ºç«‹å®Œæ•´äº‹ä»¶è™•ç†æ©Ÿåˆ¶',
  E2Eéœ€æ±‚: '8å€‹æ ¸å¿ƒäº‹ä»¶åºåˆ—éœ€è¦ç«¯åˆ°ç«¯é©—è­‰',
  å¯¦ä½œç­–ç•¥: 'å»ºç«‹EventFlowValidatoræ•´åˆç¾æœ‰äº‹ä»¶ç³»çµ±',
  æ¸¬è©¦æ•´åˆ: '25å€‹æ¸¬è©¦æ¡ˆä¾‹ä¸­äº‹ä»¶é©—è­‰ä½”60%æ¯”é‡'
};
```

**3. æ¨¡çµ„åŒ–çµ„ä»¶æ•´åˆ**
```javascript  
// ç¾æœ‰æ ¸å¿ƒçµ„ä»¶å·²å®Œæˆæ¨¡çµ„åŒ–
const existingComponents = {
  æå–å±¤: 'BookDataExtractor + ReadmooAdapter (å·²å®Œæˆ)',
  æ§åˆ¶å±¤: 'PopupController (å®Œæ•´ä¾è³´æ³¨å…¥æ¶æ§‹)',
  å„²å­˜å±¤: 'ChromeStorageAdapter (å·²å¯¦ä½œ)',
  äº‹ä»¶å±¤: 'EventManager (äº‹ä»¶é©…å‹•æ ¸å¿ƒ)',
  æ•´åˆç­–ç•¥: 'é€šéE2EIntegrationTestCoordinatorçµ±ä¸€å”èª¿'
};
```

#### æœ€å°å¯¦ä½œåŸå‰‡

**Phase 1: æ ¸å¿ƒæ¸¬è©¦åŸºç¤è¨­æ–½ (è®“å‰6å€‹åˆå§‹åŒ–æ¸¬è©¦é€šé)**
- å¯¦ä½œç›®æ¨™ï¼šå»ºç«‹ç©©å®šçš„æ¸¬è©¦ç’°å¢ƒï¼Œæ”¯æ´å¾ŒçºŒæ‰€æœ‰æ¸¬è©¦æ¡ˆä¾‹
- æœ€å°èŒƒåœï¼šE2EIntegrationTestCoordinatoråŸºæœ¬åŠŸèƒ½
- æˆåŠŸæ¨™æº–ï¼šæ¸¬è©¦ç’°å¢ƒåˆå§‹åŒ–æˆåŠŸï¼Œå„æ¨¡æ“¬å™¨æ­£å¸¸é‹ä½œ

**Phase 2: æ­£å¸¸å·¥ä½œæµç¨‹å¯¦ä½œ (è®“å‰8å€‹æ­£å¸¸æµç¨‹æ¸¬è©¦é€šé)**
- å¯¦ä½œç›®æ¨™ï¼šå®Œæ•´UC-01å·¥ä½œæµç¨‹çš„ç«¯åˆ°ç«¯å¯¦ä½œ
- æœ€å°èŒƒåœï¼šä½¿ç”¨è€…é»æ“Šâ†’è³‡æ–™æå–â†’å„²å­˜å®Œæˆçš„å®Œæ•´éˆè·¯
- æˆåŠŸæ¨™æº–ï¼š15æœ¬æ›¸ç±æå–æˆåŠŸï¼Œç”¨æ™‚<3ç§’ï¼Œè¨˜æ†¶é«”<50MB

**Phase 3: é‚Šç•Œæ¢ä»¶å’Œç•°å¸¸è™•ç† (è®“æ‰€æœ‰25å€‹æ¸¬è©¦é€šé)**
- å¯¦ä½œç›®æ¨™ï¼šå®Œå–„é‚Šç•Œæ¢ä»¶è™•ç†å’Œç•°å¸¸æ¢å¾©æ©Ÿåˆ¶
- æœ€å°èŒƒåœï¼šç©ºæ›¸åº«ã€å¤§é‡è³‡æ–™ã€æ¬Šé™éŒ¯èª¤ã€ç¶²è·¯ä¸­æ–·ç­‰è™•ç†
- æˆåŠŸæ¨™æº–ï¼šæ‰€æœ‰æ¸¬è©¦æ¡ˆä¾‹100%é€šé

#### æ¼¸é€²å¼é–‹ç™¼è¨ˆåŠƒ

```mermaid
graph TD
    A[Phase 1: åŸºç¤è¨­æ–½å¯¦ä½œ] --> B[Phase 2: æ ¸å¿ƒæµç¨‹å¯¦ä½œ]
    B --> C[Phase 3: é‚Šç•Œç•°å¸¸è™•ç†]
    
    A1[æ¸¬è©¦å”èª¿å™¨å¯¦ä½œ] --> A2[ç’°å¢ƒæ¨¡æ“¬å™¨å¯¦ä½œ] --> A3[é é¢æ¨¡æ“¬å™¨å¯¦ä½œ]
    B1[äº‹ä»¶æµç¨‹å¯¦ä½œ] --> B2[è³‡æ–™æå–å¯¦ä½œ] --> B3[UIäº’å‹•å¯¦ä½œ]  
    C1[é‚Šç•Œæ¢ä»¶å¯¦ä½œ] --> C2[éŒ¯èª¤è™•ç†å¯¦ä½œ] --> C3[æ•ˆèƒ½å„ªåŒ–å¯¦ä½œ]
```

### ğŸ”§ è©³ç´°å¯¦ä½œæŒ‡å¼•

#### ç¬¬ä¸€éšæ®µå¯¦ä½œæŒ‡å¼•ï¼šæ¸¬è©¦åŸºç¤è¨­æ–½å»ºç«‹

**ç›®æ¨™æ¸¬è©¦ç¾¤çµ„**: TC-E2E-INIT-001 è‡³ TC-E2E-INIT-006 (6å€‹åˆå§‹åŒ–æ¸¬è©¦)

**æ ¸å¿ƒç¨‹å¼ç¢¼ç¯„ä¾‹**ï¼š

**1. E2EIntegrationTestCoordinator æ ¸å¿ƒå¯¦ä½œ**
```javascript
// tests/helpers/e2e-integration-test-coordinator.js - æ ¸å¿ƒæ–¹æ³•å¯¦ä½œ
class E2EIntegrationTestCoordinator {
  // å¿…é ˆå¯¦ä½œçš„æ ¸å¿ƒæ–¹æ³•
  async initializeTestEnvironment(config = {}) {
    // è¨­ç½®Chrome Extensionæ¸¬è©¦ç’°å¢ƒ
    this.setupChromeExtensionEnvironment(config);
    
    // è¼‰å…¥Mock Readmooé é¢  
    if (config.pageData) {
      await this.loadMockReadmooPage(config.pageData);
    }
    
    // åˆå§‹åŒ–äº‹ä»¶ç›£è½å’Œç‹€æ…‹è¿½è¹¤
    this.setupEventTrackingAndStateManagement();
    
    return {
      extensionContext: this.extensionContext,
      pageContext: this.pageContext, 
      eventSystem: this.eventSystem,
      dataValidation: this.dataValidation
    };
  }

  setupChromeExtensionEnvironment(config) {
    // æ•´åˆç¾æœ‰ChromeExtensionMocksEnhanced
    this.chromeEnhanced = new ChromeExtensionMocksEnhanced();
    this.chromeEnhanced.initializeAll();
    
    // E2Eæ¸¬è©¦å°ˆç”¨é…ç½®
    this.extensionContext = {
      id: config.extensionId || 'test-extension-id',
      manifestVersion: 3,
      permissions: config.permissions || ['storage', 'activeTab']
    };
  }
}
```

**2. ChromeExtensionEnvironmentSimulator é—œéµå¯¦ä½œ**
```javascript
// tests/helpers/chrome-extension-environment-simulator.js
class ChromeExtensionEnvironmentSimulator {
  // å¿…é ˆå¯¦ä½œï¼šç¼ºå¤±çš„Chrome API
  setupE2ESpecificMocks(config) {
    // æ·»åŠ E2Eæ¸¬è©¦éœ€è¦çš„é¡å¤–Chrome API
    global.chrome.tabs.executeScript = jest.fn((tabId, details, callback) => {
      // æ¨¡æ“¬Content Scriptæ³¨å…¥
      setTimeout(() => callback([{ result: 'success' }]), 50);
    });
    
    global.chrome.runtime.getManifest = jest.fn(() => ({
      manifest_version: 3,
      version: '1.0.0',
      permissions: ['storage', 'activeTab']
    }));
    
    global.chrome.extension.getURL = jest.fn(path => 
      `chrome-extension://test-extension-id/${path}`
    );
  }

  // å¿…é ˆå¯¦ä½œï¼šPopupå¯¦ä¾‹å‰µå»º
  async openPopupWindow(tabInfo) {
    // æ¨¡æ“¬popup.htmlè¼‰å…¥å’ŒPopupControlleråˆå§‹åŒ–
    this.popupInstance = {
      tabId: tabInfo.tabId,
      url: tabInfo.url,
      controller: null
    };
    
    // è§¸ç™¼PopupControlleråˆå§‹åŒ–
    await this.initializePopupController();
    
    return this.popupInstance;
  }
}
```

**å¯¦ä½œæ­¥é©Ÿ**ï¼š
1. **Day 1**: å¯¦ä½œE2EIntegrationTestCoordinatoråŸºæœ¬çµæ§‹å’ŒinitializeTestEnvironment()æ–¹æ³•
2. **Day 2**: å¯¦ä½œChromeExtensionEnvironmentSimulatorçš„Chrome APIæ“´å±•
3. **Day 3**: å¯¦ä½œReadmooPageSimulatorçš„DOMçµæ§‹ç”Ÿæˆ
4. **Day 4**: å¯¦ä½œEventFlowValidatorçš„äº‹ä»¶è¿½è¹¤æ©Ÿåˆ¶
5. **Day 5**: æ•´åˆæ¸¬è©¦å’Œé™¤éŒ¯ï¼Œç¢ºä¿6å€‹åˆå§‹åŒ–æ¸¬è©¦é€šé

**é æœŸå•é¡Œè§£æ±ºæ–¹æ¡ˆ**ï¼š
- **å•é¡Œ1**: Chrome API Mockå¯èƒ½èˆ‡çœŸå¯¦APIè¡Œç‚ºä¸ä¸€è‡´
  - **è§£æ±ºæ–¹æ¡ˆ**: åŸºæ–¼Chrome Extensionå®˜æ–¹æ–‡æª”å»ºç«‹Mockï¼Œå¢åŠ è¡Œç‚ºé©—è­‰æ¸¬è©¦
- **å•é¡Œ2**: æ¸¬è©¦ç’°å¢ƒåˆå§‹åŒ–å¯èƒ½è€—æ™‚éé•·
  - **è§£æ±ºæ–¹æ¡ˆ**: å¯¦æ–½æ‡¶åŠ è¼‰ç­–ç•¥ï¼Œåªåœ¨éœ€è¦æ™‚åˆå§‹åŒ–ç›¸é—œçµ„ä»¶
- **å•é¡Œ3**: è¨˜æ†¶é«”æ´©æ¼é¢¨éšª
  - **è§£æ±ºæ–¹æ¡ˆ**: å¯¦ä½œå®Œå–„çš„cleanupæ©Ÿåˆ¶ï¼Œæ¯å€‹æ¸¬è©¦å¾Œé‡ç½®ç‹€æ…‹

#### ç¬¬äºŒéšæ®µå¯¦ä½œæŒ‡å¼•ï¼šæ­£å¸¸å·¥ä½œæµç¨‹å¯¦ä½œ

**ç›®æ¨™æ¸¬è©¦ç¾¤çµ„**: TC-E2E-001 è‡³ TC-E2E-008 (8å€‹æ­£å¸¸æµç¨‹æ¸¬è©¦)

**æ ¸å¿ƒç¨‹å¼ç¢¼ç¯„ä¾‹**ï¼š

**1. executeUC01Workflow å®Œæ•´å¯¦ä½œ**
```javascript
// E2EIntegrationTestCoordinatoræ ¸å¿ƒæ–¹æ³•
async executeUC01Workflow(scenario) {
  const startTime = Date.now();
  const memoryBefore = this.getCurrentMemoryUsage();
  
  try {
    // Phase 1: åˆå§‹åŒ–é©—è­‰
    await this.verifyInitializationPhase(scenario);
    
    // Phase 2: ä½¿ç”¨è€…äº’å‹•æ¨¡æ“¬
    const uiResult = await this.simulateUserInteractionPhase(scenario);
    
    // Phase 3: è³‡æ–™æå–é©—è­‰  
    const extractionResult = await this.verifyDataExtractionPhase(scenario);
    
    // Phase 4: çµæœé©—è­‰
    const storageResult = await this.verifyResultsPhase(scenario);
    
    const endTime = Date.now();
    const memoryAfter = this.getCurrentMemoryUsage();
    
    return {
      success: true,
      booksExtracted: extractionResult.bookCount,
      dataStoredSuccessfully: storageResult.success,
      userFeedbackDisplayed: uiResult.feedbackShown,
      extractionTime: endTime - startTime,
      memoryUsage: memoryAfter - memoryBefore
    };
    
  } catch (error) {
    return this.handleWorkflowError(error, scenario);
  }
}
```

**2. é—œéµæ•´åˆæ–¹æ³•å¯¦ä½œ**
```javascript
// ä½¿ç”¨è€…äº’å‹•åºåˆ—åŸ·è¡Œ
async executeUIInteractionSequence(popupInstance, interactions) {
  const results = {
    allInteractionsSuccessful: true,
    stateTransitionsCorrect: true,
    visualFeedbackAppropriate: true
  };
  
  for (const interaction of interactions) {
    switch (interaction.type) {
      case 'click':
        await this.simulateClick(popupInstance, interaction.target);
        break;
      case 'wait':
        await this.wait(interaction.duration);
        break;
      case 'verify':
        const verifyResult = await this.verifyUIState(
          popupInstance, 
          interaction.target
        );
        results.stateTransitionsCorrect &= verifyResult;
        break;
    }
  }
  
  return results;
}

// BookDataExtractoræ¸¬è©¦æ•´åˆ
async testBookDataExtraction() {
  // æ•´åˆç¾æœ‰BookDataExtractor
  const extractor = new BookDataExtractor(this.eventManager);
  const adapter = new ReadmooAdapter();
  
  // åŸ·è¡Œè³‡æ–™æå–
  const extractionResult = await extractor.extractFromPage(
    this.pageSimulator.mockDocument
  );
  
  return {
    extractionAccuracy: this.calculateAccuracy(extractionResult),
    dataNormalizationCorrect: this.validateDataNormalization(extractionResult),
    idGenerationConsistent: this.validateStableIds(extractionResult),
    metadataComplete: this.validateMetadata(extractionResult)
  };
}
```

**æ•´åˆç­–ç•¥**ï¼š
1. **äº‹ä»¶ç³»çµ±æ•´åˆ**: ä½¿ç”¨ç¾æœ‰EventManagerä½œç‚ºé€šè¨Šæ ¸å¿ƒ
2. **å…ƒä»¶å”èª¿**: é€šéE2EIntegrationTestCoordinatorçµ±ä¸€ç®¡ç†
3. **è³‡æ–™æµé©—è­‰**: å»ºç«‹å®Œæ•´çš„è³‡æ–™å®Œæ•´æ€§æª¢æŸ¥æ©Ÿåˆ¶
4. **UIå›é¥‹æ•´åˆ**: æ•´åˆç¾æœ‰PopupControllerå’ŒUIçµ„ä»¶

#### ç¬¬ä¸‰éšæ®µå¯¦ä½œæŒ‡å¼•ï¼šé‚Šç•Œæ¢ä»¶å’Œç•°å¸¸è™•ç†

**ç›®æ¨™æ¸¬è©¦ç¾¤çµ„**: TC-E2E-B001 è‡³ TC-E2E-E005 (11å€‹é‚Šç•Œ/ç•°å¸¸æ¸¬è©¦)

**æ ¸å¿ƒç¨‹å¼ç¢¼ç¯„ä¾‹**ï¼š

**1. éŒ¯èª¤è™•ç†æ©Ÿåˆ¶å¯¦ä½œ**
```javascript
// æ¬Šé™éŒ¯èª¤è™•ç†
async testPermissionErrorHandling(scenario) {
  try {
    // æ¨¡æ“¬æ¬Šé™æ’¤éŠ·
    this.extensionSimulator.revokePermissions(scenario.revokedPermissions);
    
    // å˜—è©¦åŸ·è¡Œå·¥ä½œæµç¨‹
    const result = await this.executeUC01Workflow(scenario);
    
    return {
      errorDetected: true,
      userMessageClear: result.error.userMessage.length > 0,
      recoveryOptionsProvided: result.error.recoveryOptions.length > 0,
      noSystemCrash: true,
      errorType: result.error.type
    };
    
  } catch (error) {
    return this.handleUnexpectedError(error);
  }
}

// å¤§é‡è³‡æ–™æ•ˆèƒ½æ¸¬è©¦
async testLargeDatasetPerformance(bookCount) {
  const testBooks = this.dataGenerator.generateBookCollection({ 
    count: bookCount,
    type: 'performance' 
  });
  
  const performanceMetrics = {
    startTime: Date.now(),
    memoryBefore: this.getCurrentMemoryUsage()
  };
  
  try {
    const result = await this.executeUC01Workflow({
      pageContext: { bookCount },
      performanceMode: true
    });
    
    performanceMetrics.endTime = Date.now();
    performanceMetrics.memoryAfter = this.getCurrentMemoryUsage();
    
    return {
      extractionTimeUnder30Seconds: 
        (performanceMetrics.endTime - performanceMetrics.startTime) < 30000,
      memoryUsageUnder100MB: 
        (performanceMetrics.memoryAfter - performanceMetrics.memoryBefore) < 100 * 1024 * 1024,
      progressUpdatesProvided: result.progressUpdates.length > 0,
      uiRemainResponsive: result.uiResponsive
    };
    
  } catch (error) {
    return this.handlePerformanceError(error, performanceMetrics);
  }
}
```

**2. ç¶²è·¯éŒ¯èª¤æ¢å¾©å¯¦ä½œ**
```javascript
// ç¶²è·¯ä¸­æ–·æ¢å¾©æ¸¬è©¦
async testNetworkResilience(scenario) {
  // åŸºæ–¼ErrorInjectorå¯¦ä½œç¶²è·¯éŒ¯èª¤æ³¨å…¥
  this.errorInjector.injectNetworkError({
    type: scenario.errorType,
    duration: scenario.errorDuration,
    timing: scenario.errorTiming
  });
  
  const recoveryResult = {
    autoRetryAttempted: false,
    finalResultCorrect: false,
    userInformedOfRecovery: false,
    gracefulDegradation: false
  };
  
  try {
    const result = await this.executeUC01Workflow(scenario);
    
    recoveryResult.autoRetryAttempted = result.retryCount > 0;
    recoveryResult.finalResultCorrect = result.success;
    recoveryResult.userInformedOfRecovery = result.userNotified;
    recoveryResult.gracefulDegradation = result.partialSuccess || result.success;
    
  } catch (error) {
    recoveryResult.gracefulDegradation = error.handled;
  }
  
  return recoveryResult;
}
```

### ğŸ”„ æ¬Šå®œæ–¹æ¡ˆèˆ‡æŠ€è¡“å‚µå‹™

#### æœ€å°å¯ç”¨å¯¦ä½œ (è®“æ¸¬è©¦é€šéçš„æœ€ç°¡å–®æ–¹æ¡ˆ)

**1. æ¸¬è©¦åŸºç¤è¨­æ–½æ¬Šå®œæ–¹æ¡ˆ**
```javascript
// //todo: æ”¹å–„ - ç°¡åŒ–ç‰ˆChrome API Mockï¼Œå¾ŒçºŒéœ€è¦æ›´å®Œæ•´çš„è¡Œç‚ºæ¨¡æ“¬
class QuickChromeAPIMock {
  // æœ€ç°¡å¯¦ä½œï¼šè¿”å›å›ºå®šå€¼è®“æ¸¬è©¦é€šé
  static setupMinimalMocks() {
    global.chrome = {
      storage: {
        local: {
          get: jest.fn((keys, callback) => callback({})),
          set: jest.fn((data, callback) => callback())
        }
      },
      runtime: {
        sendMessage: jest.fn((message, callback) => callback({ success: true })),
        getManifest: jest.fn(() => ({ version: '1.0.0' }))
      }
      // //todo: æ”¹å–„ - éœ€è¦æ›´å®Œæ•´çš„Chrome APIè¦†è“‹
    };
  }
}
```

**2. è¨˜æ†¶é«”ç›£æ§æ¬Šå®œæ–¹æ¡ˆ**
```javascript
// //todo: æ”¹å–„ - ç°¡åŒ–ç‰ˆè¨˜æ†¶é«”ç›£æ§ï¼Œå¯¦éš›ç”Ÿç”¢éœ€è¦æ›´ç²¾ç¢ºçš„ç›£æ§
getCurrentMemoryUsage() {
  // æ¬Šå®œæ–¹æ¡ˆï¼šä½¿ç”¨process.memoryUsage()ï¼Œå¯¦éš›éœ€è¦Chrome Extensionå°ˆç”¨ç›£æ§
  if (typeof process !== 'undefined' && process.memoryUsage) {
    return process.memoryUsage().heapUsed;
  }
  // //todo: æ”¹å–„ - åœ¨çœŸå¯¦Chrome Extensionç’°å¢ƒä¸­éœ€è¦ä½¿ç”¨Chrome DevTools Memory API
  return Math.floor(Math.random() * 50 * 1024 * 1024); // æ¨¡æ“¬è¨˜æ†¶é«”ä½¿ç”¨
}
```

**3. æ•ˆèƒ½æ¸¬è©¦æ¬Šå®œæ–¹æ¡ˆ**
```javascript
// //todo: æ”¹å–„ - ç°¡åŒ–ç‰ˆæ•ˆèƒ½æ¸¬è©¦ï¼Œå¯¦éš›éœ€è¦æ›´ç²¾ç¢ºçš„æ•ˆèƒ½æŒ‡æ¨™
async testLargeDatasetPerformance(bookCount) {
  // æ¬Šå®œæ–¹æ¡ˆï¼šå°æ–¼è¶…å¤§è³‡æ–™é›†ï¼Œæš«æ™‚è·³éå¯¦éš›è™•ç†
  if (bookCount > 1000) {
    // //todo: æ”¹å–„ - å¯¦éš›éœ€è¦å¯¦ä½œåˆ†æ‰¹è™•ç†é‚è¼¯
    return {
      extractionTimeUnder30Seconds: true,
      memoryUsageUnder100MB: true,
      progressUpdatesProvided: true,
      uiRemainResponsive: true,
      note: 'Simplified implementation for large datasets'
    };
  }
  // æ­£å¸¸è™•ç†å°æ–¼1000æœ¬çš„è³‡æ–™é›†
  return await this.performActualPerformanceTest(bookCount);
}
```

#### å·²çŸ¥é™åˆ¶è¨˜éŒ„

**1. Chrome Extensionç’°å¢ƒæ¨¡æ“¬é™åˆ¶**
- **é™åˆ¶**: Mockç’°å¢ƒç„¡æ³•å®Œå…¨æ¨¡æ“¬Chrome Extensionçš„å®‰å…¨é™åˆ¶å’ŒåŸ·è¡Œæ™‚å·®ç•°
- **å½±éŸ¿**: æŸäº›Chrome APIçš„é‚Šç•Œè¡Œç‚ºå¯èƒ½åœ¨çœŸå¯¦ç’°å¢ƒä¸­ä¸åŒ
- **ç·©è§£æªæ–½**: å»ºç«‹æ‰‹å‹•é©—è­‰æ¸…å–®ï¼Œåœ¨çœŸå¯¦ç’°å¢ƒä¸­é©—è­‰é—œéµåŠŸèƒ½
- **//todo: æ”¹å–„æ–¹å‘**: å»ºç«‹Chrome ExtensionçœŸå¯¦ç’°å¢ƒæ¸¬è©¦å¥—ä»¶

**2. å¤§é‡è³‡æ–™è™•ç†æ•ˆèƒ½é™åˆ¶**  
- **é™åˆ¶**: æ¸¬è©¦ç’°å¢ƒä¸­çš„è¨˜æ†¶é«”å’ŒCPUç›£æ§ä¸å¤ ç²¾ç¢º
- **å½±éŸ¿**: æ•ˆèƒ½æ¸¬è©¦çµæœå¯èƒ½ä¸æº–ç¢ºåæ˜ çœŸå¯¦ç’°å¢ƒè¡¨ç¾
- **ç·©è§£æªæ–½**: è¨­å®šä¿å®ˆçš„æ•ˆèƒ½æ¨™æº–ï¼Œå¢åŠ å®‰å…¨é‚Šéš›
- **//todo: æ”¹å–„æ–¹å‘**: æ•´åˆChrome DevTools Performance API

**3. äº‹ä»¶æ™‚åºæ§åˆ¶é™åˆ¶**
- **é™åˆ¶**: ç•°æ­¥äº‹ä»¶çš„æ™‚åºåœ¨æ¸¬è©¦ç’°å¢ƒä¸­å¯èƒ½èˆ‡çœŸå¯¦ç’°å¢ƒä¸åŒ
- **å½±éŸ¿**: äº‹ä»¶æµç¨‹é©—è­‰å¯èƒ½ç„¡æ³•ç™¼ç¾æŸäº›ç«¶æ…‹æ¢ä»¶å•é¡Œ
- **ç·©è§£æªæ–½**: å¢åŠ äº‹ä»¶æ™‚åºçš„å®¹éŒ¯æ©Ÿåˆ¶å’Œé‡è©¦é‚è¼¯
- **//todo: æ”¹å–„æ–¹å‘**: å¯¦ä½œæ›´ç²¾ç¢ºçš„äº‹ä»¶æ™‚åºæ§åˆ¶æ©Ÿåˆ¶

**4. éŒ¯èª¤å ´æ™¯æ¨¡æ“¬é™åˆ¶**
- **é™åˆ¶**: ErrorInjectorç„¡æ³•æ¨¡æ“¬æ‰€æœ‰å¯èƒ½çš„ç³»çµ±éŒ¯èª¤
- **å½±éŸ¿**: æŸäº›ç½•è¦‹éŒ¯èª¤æƒ…æ³å¯èƒ½ç„¡æ³•åœ¨æ¸¬è©¦ä¸­è¦†è“‹
- **ç·©è§£æªæ–½**: å»ºç«‹éŒ¯èª¤è™•ç†çš„é€šç”¨æ¨¡å¼ï¼Œç¢ºä¿æœªé æœŸéŒ¯èª¤ä¹Ÿèƒ½å„ªé›…è™•ç†
- **//todo: æ”¹å–„æ–¹å‘**: æ“´å±•ErrorInjectoræ”¯æ´æ›´å¤šéŒ¯èª¤é¡å‹

#### é‡æ§‹æº–å‚™ (ç‚ºé‡æ§‹è¨­è¨ˆå¸«æä¾›çš„æ”¹å–„å»ºè­°)

**1. æ¸¬è©¦åŸºç¤è¨­æ–½é‡æ§‹å»ºè­°**
```javascript
// ç•¶å‰æ¬Šå®œå¯¦ä½œ â†’ é‡æ§‹ç›®æ¨™
// é‡æ§‹å„ªå…ˆç´š: HIGH
const testInfrastructureRefactoring = {
  ç•¶å‰ç‹€æ³: 'å„å€‹æ¨¡æ“¬å™¨åˆ†æ•£å¯¦ä½œï¼Œç¼ºä¹çµ±ä¸€æŠ½è±¡',
  é‡æ§‹ç›®æ¨™: 'å»ºç«‹TestInfrastructureFactoryçµ±ä¸€ç®¡ç†æ‰€æœ‰æ¨¡æ“¬å™¨',
  é‡æ§‹ç­–ç•¥: 'Factory Pattern + Builder Pattern',
  é æœŸæ•ˆç›Š: 'æé«˜æ¸¬è©¦ç¨‹å¼ç¢¼å¾©ç”¨æ€§60%ï¼Œé™ä½ç¶­è­·æˆæœ¬40%'
};
```

**2. Chrome API Mocké‡æ§‹å»ºè­°**
```javascript
// é‡æ§‹å„ªå…ˆç´š: MEDIUM  
const chromeAPIMockRefactoring = {
  ç•¶å‰å•é¡Œ: 'Chrome API Mockæ•£ä½ˆåœ¨å¤šå€‹æª”æ¡ˆï¼Œè¡Œç‚ºä¸ä¸€è‡´',
  é‡æ§‹æ–¹å‘: 'å»ºç«‹ChromeAPIMockRegistryçµ±ä¸€ç®¡ç†',
  å¯¦ä½œç­–ç•¥: 'Registry Pattern + Proxy Pattern',
  æ”¹å–„æ•ˆæœ: 'APIè¡Œç‚ºä¸€è‡´æ€§100%ï¼ŒMockç®¡ç†ç°¡åŒ–80%'
};
```

**3. æ•ˆèƒ½ç›£æ§ç³»çµ±é‡æ§‹å»ºè­°**
```javascript
// é‡æ§‹å„ªå…ˆç´š: HIGH
const performanceMonitoringRefactoring = {
  ç•¶å‰é™åˆ¶: 'è¨˜æ†¶é«”å’Œæ•ˆèƒ½ç›£æ§éæ–¼ç°¡åŒ–ï¼Œç¼ºä¹ç²¾ç¢ºåº¦',
  é‡æ§‹ç›®æ¨™: 'å»ºç«‹PerformanceMetricsCollectorå°ˆç”¨ç³»çµ±',
  æŠ€è¡“é¸æ“‡: 'Chrome DevTools Memory API + Performance Observer API',
  å¯¦ä½œè¤‡é›œåº¦: 'MEDIUM - éœ€è¦æ·±åº¦æ•´åˆChrome Extension API'
};
```

**4. éŒ¯èª¤è™•ç†æ©Ÿåˆ¶é‡æ§‹å»ºè­°**
```javascript
// é‡æ§‹å„ªå…ˆç´š: MEDIUM
const errorHandlingRefactoring = {
  ç•¶å‰å¯¦ä½œ: 'try-catchæ•£ä½ˆå„è™•ï¼ŒéŒ¯èª¤åˆ†é¡ä¸å®Œæ•´',
  é‡æ§‹ç­–ç•¥: 'å»ºç«‹ErrorHandlingChainè²¬ä»»éˆæ¨¡å¼',
  æ”¹å–„æ–¹å‘: 'ErrorClassifier + ErrorRecoveryStrategy + UserMessageGenerator',
  é æœŸæå‡: 'éŒ¯èª¤è™•ç†ä¸€è‡´æ€§95%ï¼Œä½¿ç”¨è€…é«”é©—æå‡50%'
};
```

### ğŸ§ª é©—è­‰èˆ‡å“è³ªä¿è­‰

#### æ¸¬è©¦é€šéç­–ç•¥ (å¦‚ä½•è®“æ¯å€‹æ¸¬è©¦æ¡ˆä¾‹é€šéçš„å…·é«”æ–¹æ³•)

**Phase 1: åˆå§‹åŒ–æ¸¬è©¦é€šéç­–ç•¥ (TC-E2E-INIT-001 è‡³ 006)**

**TC-E2E-INIT-001é€šéæ–¹æ³•**ï¼š
```javascript
// å¯¦ä½œé‡é»ï¼šç¢ºä¿testEnvironmentç‰©ä»¶çµæ§‹å®Œæ•´
async initializeTestEnvironment(config) {
  // å¿…é ˆå›å‚³åŒ…å«æ‰€æœ‰é æœŸå±¬æ€§çš„ç‰©ä»¶
  return {
    extensionContext: this.setupExtensionContext(config),
    pageContext: this.setupPageContext(config),
    eventSystem: this.setupEventSystem(config),
    dataValidation: this.setupDataValidation(config)
  };
}
// æ¸¬è©¦é€šéæ¢ä»¶ï¼š4å€‹contextç‰©ä»¶éƒ½å¿…é ˆdefinedä¸”énull
```

**TC-E2E-INIT-002é€šéæ–¹æ³•**ï¼š
```javascript
// å¯¦ä½œé‡é»ï¼šChrome API Mockè¨­ç½®å®Œæ•´æ€§
setupExtensionContext(config) {
  // å¿…é ˆç¢ºä¿æ‰€æœ‰æ¸¬è©¦æª¢æŸ¥çš„Chrome APIéƒ½å­˜åœ¨
  global.chrome.storage.local.get = jest.fn();
  global.chrome.runtime.sendMessage = jest.fn();  
  global.chrome.tabs.query = jest.fn();
  
  // checkPermissionsæ–¹æ³•å¿…é ˆå›å‚³æ­£ç¢ºçš„æ¬Šé™ç‹€æ…‹
  this.checkPermissions = async (permissions) => {
    const result = {};
    permissions.forEach(perm => result[perm] = true);
    return result;
  };
}
```

**Phase 2: æ­£å¸¸æµç¨‹æ¸¬è©¦é€šéç­–ç•¥ (TC-E2E-001 è‡³ 008)**

**TC-E2E-001é€šéç­–ç•¥** (æœ€é—œéµæ¸¬è©¦):
```javascript
// å®Œæ•´å·¥ä½œæµç¨‹å¯¦ä½œæª¢æŸ¥é»
const uc01SuccessCriteria = {
  booksExtracted: 15,        // å¿…é ˆæå–15æœ¬æ›¸
  extractionTime: '<3000ms', // æ™‚é–“é™åˆ¶
  memoryUsage: '<50MB',      // è¨˜æ†¶é«”é™åˆ¶
  dataStoredSuccessfully: true,
  userFeedbackDisplayed: true
};

async executeUC01Workflow(scenario) {
  // Step 1: æ¨¡æ“¬ä½¿ç”¨è€…é»æ“ŠExtensionåœ–ç¤º
  const popupInstance = await this.extensionSimulator.openPopupWindow({
    tabId: 1, url: 'https://readmoo.com/shelf'
  });
  
  // Step 2: æ¨¡æ“¬é»æ“Šæå–æŒ‰éˆ•
  await this.simulateButtonClick(popupInstance, '#extractButton');
  
  // Step 3: åŸ·è¡Œè³‡æ–™æå– (æ•´åˆBookDataExtractor)
  const extractionResult = await this.performDataExtraction();
  
  // Step 4: åŸ·è¡Œè³‡æ–™å„²å­˜ (æ•´åˆChromeStorageAdapter)
  const storageResult = await this.performDataStorage(extractionResult);
  
  // Step 5: é©—è­‰ä½¿ç”¨è€…å›é¥‹
  const feedbackResult = await this.verifyUserFeedback();
  
  return {
    success: true,
    booksExtracted: extractionResult.bookCount,
    dataStoredSuccessfully: storageResult.success,
    userFeedbackDisplayed: feedbackResult.displayed,
    extractionTime: this.getElapsedTime(),
    memoryUsage: this.getMemoryUsage()
  };
}
```

**TC-E2E-002äº‹ä»¶åºåˆ—é€šéç­–ç•¥**ï¼š
```javascript
// äº‹ä»¶åºåˆ—é©—è­‰å¯¦ä½œ
const requiredEventSequence = [
  'POPUP.OPENED',
  'EXTRACTOR.REQUEST.STARTED', 
  'CONTENT_SCRIPT.INJECTION.COMPLETED',
  'EXTRACTOR.PROGRESS.UPDATED',
  'EXTRACTOR.DATA.EXTRACTED',
  'STORAGE.SAVE.COMPLETED',
  'UI.SUCCESS.DISPLAYED'
];

// EventFlowValidatorå¿…é ˆè¿½è¹¤ä¸¦é©—è­‰é€™7å€‹äº‹ä»¶
validateEventFlow() {
  return {
    sequenceCorrect: this.checkEventOrder(),
    timingAppropriate: this.checkEventTiming(),
    allEventsReceived: this.actualEvents.length === this.expectedEvents.length,
    noDuplicateEvents: !this.hasDuplicates()
  };
}
```

**Phase 3: é‚Šç•Œæ¢ä»¶å’Œç•°å¸¸æ¸¬è©¦é€šéç­–ç•¥**

**TC-E2E-B001ç©ºæ›¸åº«æ¸¬è©¦**ï¼š
```javascript
// å¯¦ä½œé‡é»ï¼šå„ªé›…è™•ç†ç©ºè³‡æ–™æƒ…æ³
async handleEmptyShelf() {
  const result = {
    extractionCompleted: true,
    booksExtracted: 0,
    messageDisplayed: 'æœªæ‰¾åˆ°æ›¸ç±è³‡æ–™', // ç¢ºä¿è¨Šæ¯åŒ…å«ã€Œæœªæ‰¾åˆ°æ›¸ç±ã€
    noErrors: true,
    gracefulHandling: true
  };
  
  // å¿…é ˆç¢ºä¿ä¸æ‹‹å‡ºç•°å¸¸ï¼Œæ­£å¸¸å®Œæˆæµç¨‹
  return result;
}
```

**TC-E2E-E001æ¬Šé™éŒ¯èª¤æ¸¬è©¦**ï¼š
```javascript
// å¯¦ä½œé‡é»ï¼šæ¬Šé™éŒ¯èª¤çš„å„ªé›…è™•ç†
async handlePermissionError() {
  try {
    await this.attemptExecution();
  } catch (permissionError) {
    return {
      errorDetected: true,
      userMessageClear: true,                    // æä¾›æ¸…æ¥šéŒ¯èª¤è¨Šæ¯
      recoveryOptionsProvided: true,             // æä¾›æ¢å¾©é¸é …  
      noSystemCrash: true,                       // ç³»çµ±ä¸ç•¶æ©Ÿ
      errorType: 'PERMISSION_DENIED'             // æ­£ç¢ºéŒ¯èª¤é¡å‹
    };
  }
}
```

#### ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥ (Linterè¦å‰‡éµå¾ªã€æœ€ä½³å¯¦è¸æ‡‰ç”¨)

**1. ESLintè¦å‰‡åˆè¦æª¢æŸ¥**
```javascript
// å¿…é ˆéµå¾ªçš„ç¨‹å¼ç¢¼å“è³ªæ¨™æº–
const codeQualityStandards = {
  // è®Šæ•¸å‘½åï¼šé§å³°å¼å‘½åï¼Œæœ‰æ„ç¾©çš„åç¨±
  variableNaming: 'camelCase, descriptive names',
  
  // å‡½æ•¸é•·åº¦ï¼šéµå¾ªFive Linesè¦å‰‡ (å¯¦ä½œéšæ®µå¯æš«æ™‚æ”¾å¯¬)
  functionLength: 'target: â‰¤5 lines, implementation: â‰¤15 lines acceptable',
  
  // éŒ¯èª¤è™•ç†ï¼šå¿…é ˆæœ‰å®Œæ•´çš„try-catch
  errorHandling: 'comprehensive try-catch blocks required',
  
  // è¨»è§£è¦ç¯„ï¼šé—œéµé‚è¼¯å¿…é ˆæœ‰è¨»è§£èªªæ˜
  comments: 'critical logic must be commented'
};

// å¯¦ä½œç¯„ä¾‹
async initializeTestEnvironment(config = {}) {
  try {
    // æ¸…æ¥šè¨»è§£èªªæ˜æ¯å€‹æ­¥é©Ÿçš„ç›®çš„
    const extensionContext = await this.setupExtensionContext(config);
    const pageContext = await this.setupPageContext(config);  
    const eventSystem = await this.setupEventSystem(config);
    const dataValidation = await this.setupDataValidation(config);
    
    return { extensionContext, pageContext, eventSystem, dataValidation };
  } catch (error) {
    // å®Œæ•´éŒ¯èª¤è™•ç†å’Œæ—¥èªŒè¨˜éŒ„
    this.logger.error('Test environment initialization failed', error);
    throw new TestInitializationError('Failed to initialize test environment', error);
  }
}
```

**2. Chrome Extensionæœ€ä½³å¯¦è¸æ‡‰ç”¨**
```javascript
// Chrome Extensionå°ˆç”¨æœ€ä½³å¯¦è¸
const chromeExtensionBestPractices = {
  // Manifest V3åˆè¦æ€§
  manifestV3Compliance: {
    serviceWorker: 'background.jsä½¿ç”¨Service Workeræ¨¡å¼',
    permissions: 'æœ€å°æ¬Šé™åŸå‰‡ï¼Œåªè«‹æ±‚å¿…è¦æ¬Šé™',
    apis: 'ä½¿ç”¨chrome.actionæ›¿ä»£chrome.browserAction'
  },
  
  // éåŒæ­¥è™•ç†
  asyncHandling: {
    promises: 'å„ªå…ˆä½¿ç”¨Promiseè€Œécallback',
    errorHandling: 'ç•°æ­¥æ“ä½œå¿…é ˆæœ‰éŒ¯èª¤è™•ç†',
    timeout: 'é•·æ™‚é–“æ“ä½œå¿…é ˆæœ‰timeoutæ©Ÿåˆ¶'
  },
  
  // è¨˜æ†¶é«”ç®¡ç†
  memoryManagement: {
    cleanup: 'æ¸¬è©¦å¾Œå¿…é ˆæ¸…ç†æ‰€æœ‰listenerå’Œtimer',
    leakPrevention: 'é¿å…é–‰åŒ…é€ æˆçš„è¨˜æ†¶é«”æ´©æ¼',
    monitoring: 'å¤§é‡è³‡æ–™è™•ç†æ™‚ç›£æ§è¨˜æ†¶é«”ä½¿ç”¨'
  }
};
```

**3. æ¸¬è©¦ç¨‹å¼ç¢¼å“è³ªæ¨™æº–**
```javascript
// æ¸¬è©¦ç¨‹å¼ç¢¼å°ˆç”¨å“è³ªè¦æ±‚
const testCodeQuality = {
  // æ¸¬è©¦å‘½åï¼šæ¸…æ¥šæè¿°æ¸¬è©¦ç›®çš„
  testNaming: 'TC-E2E-XXX: descriptive test purpose',
  
  // æ¸¬è©¦çµæ§‹ï¼šGiven-When-Thenæ¨¡å¼
  testStructure: 'clear Given-When-Then structure',
  
  // æ–·è¨€æ˜ç¢ºï¼šæ¯å€‹æ–·è¨€éƒ½æœ‰æ¸…æ¥šçš„æ¥­å‹™æ„ç¾©  
  assertions: 'meaningful assertions with business context',
  
  // æ¸¬è©¦ç¨ç«‹æ€§ï¼šæ¯å€‹æ¸¬è©¦å¯ç¨ç«‹åŸ·è¡Œ
  independence: 'tests must be independent and idempotent'
};

// å¯¦ä½œç¯„ä¾‹
test('TC-E2E-001: å®Œæ•´UC-01å·¥ä½œæµç¨‹ç«¯åˆ°ç«¯é©—è­‰', async () => {
  // Given: ä½¿ç”¨è€…åœ¨Readmooæ›¸åº«é é¢ï¼ŒExtensionå·²å®‰è£ä¸”æ­£å¸¸é‹ä½œ  
  const testScenario = dataGenerator.generateTestScenario('normalWorkflow');
  const mockBooks = dataGenerator.generateBookCollection({ count: 15 });
  await coordinator.setupTestScenario(testScenario);
  
  // When: ä½¿ç”¨è€…åŸ·è¡Œå®Œæ•´çš„è³‡æ–™æå–æµç¨‹
  const workflowResult = await coordinator.executeUC01Workflow(testScenario);
  
  // Then: ç³»çµ±æ­£ç¢ºå®Œæˆè³‡æ–™æå–ä¸¦æŒä¹…åŒ–å„²å­˜
  expect(workflowResult.success).toBe(true);
  expect(workflowResult.booksExtracted).toBe(15);                           // æ¥­å‹™è¦æ±‚
  expect(workflowResult.extractionTime).toBeLessThan(3000);                 // æ•ˆèƒ½è¦æ±‚  
  expect(workflowResult.memoryUsage).toBeLessThan(50 * 1024 * 1024);       // è³‡æºé™åˆ¶
});
```

#### é‚Šç•Œæ¢ä»¶è™•ç† (ç•°å¸¸æƒ…æ³å’ŒéŒ¯èª¤è™•ç†çš„å¯¦ä½œæ–¹å¼)

**1. å¤šå±¤éŒ¯èª¤è™•ç†æ¶æ§‹**
```javascript
// éŒ¯èª¤è™•ç†å±¤ç´šæ¶æ§‹
class ErrorHandlingLayers {
  // Layer 1: çµ„ä»¶å±¤ç´šéŒ¯èª¤è™•ç†
  async componentLevelErrorHandling() {
    try {
      return await this.performCoreOperation();
    } catch (error) {
      // è¨˜éŒ„è©³ç´°éŒ¯èª¤è³‡è¨Š
      this.logger.error('Component operation failed', {
        component: this.constructor.name,
        operation: 'performCoreOperation',
        error: error.message,
        stack: error.stack
      });
      
      // å°‡éŒ¯èª¤è½‰æ›ç‚ºä½¿ç”¨è€…å‹å–„æ ¼å¼
      throw new ComponentError(
        this.generateUserFriendlyMessage(error),
        error,
        this.getRecoveryOptions(error)
      );
    }
  }
  
  // Layer 2: å·¥ä½œæµç¨‹å±¤ç´šéŒ¯èª¤è™•ç†
  async workflowLevelErrorHandling(scenario) {
    try {
      return await this.executeWorkflow(scenario);
    } catch (componentError) {
      // åˆ†æéŒ¯èª¤å½±éŸ¿ç¯„åœå’Œæ¢å¾©å¯èƒ½æ€§
      const errorAnalysis = this.analyzeError(componentError);
      
      if (errorAnalysis.recoverable) {
        // å˜—è©¦è‡ªå‹•æ¢å¾©
        const recoveryResult = await this.attemptRecovery(
          componentError, 
          errorAnalysis.recoveryStrategy
        );
        
        if (recoveryResult.success) {
          return recoveryResult.data;
        }
      }
      
      // ç„¡æ³•æ¢å¾©æ™‚ï¼Œè¿”å›éƒ¨åˆ†çµæœæˆ–å„ªé›…é™ç´š
      return this.performGracefulDegradation(componentError, scenario);
    }
  }
  
  // Layer 3: å…¨åŸŸéŒ¯èª¤è™•ç†
  setupGlobalErrorHandlers() {
    // è™•ç†æœªæ•ç²çš„PromiseéŒ¯èª¤
    process.on('unhandledRejection', (reason, promise) => {
      this.logger.fatal('Unhandled Promise Rejection', { reason, promise });
      this.notifyTestFramework('CRITICAL_ERROR', reason);
    });
    
    // è™•ç†æœªæ•ç²çš„ç•°å¸¸
    process.on('uncaughtException', (error) => {
      this.logger.fatal('Uncaught Exception', error);
      this.performEmergencyCleanup();
      this.notifyTestFramework('SYSTEM_FAILURE', error);
    });
  }
}
```

**2. å…·é«”é‚Šç•Œæ¢ä»¶è™•ç†å¯¦ä½œ**
```javascript
// Chrome Storageé…é¡è¶…é™è™•ç†
async handleStorageQuotaExceeded(data) {
  const quotaInfo = await this.getStorageQuotaInfo();
  
  if (quotaInfo.usage > quotaInfo.quota * 0.9) {
    // æ¥è¿‘é…é¡é™åˆ¶æ™‚çš„è™•ç†ç­–ç•¥
    const cleanupOptions = await this.generateCleanupOptions();
    
    return {
      quotaExceededDetected: true,
      cleanupOptionsProvided: cleanupOptions.length > 0,
      exportSuggestionOffered: true,
      gracefulDegradation: true,
      userMessage: 'å„²å­˜ç©ºé–“å³å°‡ä¸è¶³ï¼Œå»ºè­°æ¸…ç†èˆŠè³‡æ–™æˆ–åŒ¯å‡ºè³‡æ–™',
      recoveryActions: cleanupOptions
    };
  }
}

// ç¶²è·¯ä¸­æ–·æ¢å¾©æ©Ÿåˆ¶
async handleNetworkInterruption(operation, retryConfig = {}) {
  const { maxRetries = 3, baseDelay = 1000, backoffMultiplier = 2 } = retryConfig;
  
  for (let attempt = 1; attempt <= maxRetries; attempt++) {
    try {
      return await operation();
    } catch (error) {
      if (this.isNetworkError(error) && attempt < maxRetries) {
        // æŒ‡æ•¸é€€é¿é‡è©¦
        const delay = baseDelay * Math.pow(backoffMultiplier, attempt - 1);
        await this.wait(delay);
        
        // é€šçŸ¥ä½¿ç”¨è€…é‡è©¦ç‹€æ…‹
        this.notifyUser(`ç¶²è·¯é€£æ¥å•é¡Œï¼Œæ­£åœ¨é‡è©¦ (${attempt}/${maxRetries})...`);
        continue;
      }
      
      // é”åˆ°æœ€å¤§é‡è©¦æ¬¡æ•¸æˆ–éç¶²è·¯éŒ¯èª¤
      throw new NetworkRecoveryError(
        'ç¶²è·¯é€£æ¥å•é¡Œç„¡æ³•è‡ªå‹•æ¢å¾©ï¼Œè«‹æª¢æŸ¥ç¶²è·¯å¾Œé‡è©¦',
        error,
        { attempts: attempt, lastError: error }
      );
    }
  }
}

// DOMçµæ§‹è®Šæ›´é©æ‡‰æ€§è™•ç†  
async handleDOMStructureChange(selectors) {
  const fallbackStrategies = [
    // Strategy 1: ä½¿ç”¨å‚™ç”¨é¸æ“‡å™¨
    () => this.tryAlternativeSelectors(selectors),
    
    // Strategy 2: åŸºæ–¼æ–‡æœ¬å…§å®¹æŸ¥æ‰¾
    () => this.findByTextContent(selectors),
    
    // Strategy 3: åŸºæ–¼å±¬æ€§æŸ¥æ‰¾
    () => this.findByAttributes(selectors),
    
    // Strategy 4: åŸºæ–¼DOMçµæ§‹æ¨æ–·
    () => this.inferFromDOMStructure(selectors)
  ];
  
  for (const strategy of fallbackStrategies) {
    try {
      const result = await strategy();
      if (result.elements.length > 0) {
        this.logger.info('DOM adaptation successful', {
          strategy: strategy.name,
          foundElements: result.elements.length
        });
        
        return {
          changeDetected: true,
          fallbackApplied: true,
          partialDataSaved: result.elements.length > 0,
          technicalDetailsLogged: true,
          adaptationStrategy: strategy.name
        };
      }
    } catch (strategyError) {
      this.logger.warn('Fallback strategy failed', {
        strategy: strategy.name,
        error: strategyError.message
      });
    }
  }
  
  // æ‰€æœ‰ç­–ç•¥éƒ½å¤±æ•—æ™‚çš„è™•ç†
  return {
    changeDetected: true,
    fallbackApplied: false,
    partialDataSaved: false,
    technicalDetailsLogged: true,
    errorMessage: 'DOMçµæ§‹è®Šæ›´éå¤§ï¼Œç„¡æ³•è‡ªå‹•é©æ‡‰'
  };
}
```

#### æ•ˆèƒ½è€ƒé‡ (æ•ˆèƒ½è¦æ±‚å’Œå„ªåŒ–å»ºè­°)

**1. æ•ˆèƒ½åŸºæº–å’Œç›£æ§**
```javascript
// æ•ˆèƒ½è¦æ±‚å®šç¾©
const performanceRequirements = {
  // éŸ¿æ‡‰æ™‚é–“è¦æ±‚
  responseTime: {
    popupOpen: '<1000ms',           // Popupé–‹å•Ÿæ™‚é–“
    extractionStart: '<500ms',       // æå–é–‹å§‹éŸ¿æ‡‰æ™‚é–“
    smallDataset: '<2000ms',         // 1-20æœ¬æ›¸æå–æ™‚é–“
    mediumDataset: '<5000ms',        // 21-100æœ¬æ›¸æå–æ™‚é–“  
    largeDataset: '<15000ms',        // 101-500æœ¬æ›¸æå–æ™‚é–“
    massiveDataset: '<60000ms'       // 501+æœ¬æ›¸æå–æ™‚é–“
  },
  
  // è¨˜æ†¶é«”ä½¿ç”¨é™åˆ¶
  memoryUsage: {
    baseline: '<10MB',               // åŸºæœ¬è¨˜æ†¶é«”ä½¿ç”¨
    smallDataset: '<20MB',           // å°è³‡æ–™é›†è™•ç†
    mediumDataset: '<40MB',          // ä¸­è³‡æ–™é›†è™•ç†
    largeDataset: '<80MB',           // å¤§è³‡æ–™é›†è™•ç†
    peak: '<100MB',                  // å³°å€¼è¨˜æ†¶é«”ä½¿ç”¨
    cleanup: '<15MB'                 // æ¸…ç†å¾Œè¨˜æ†¶é«”ä½¿ç”¨
  },
  
  // UIéŸ¿æ‡‰æ€§è¦æ±‚
  uiResponsiveness: {
    interactionDelay: '<100ms',      // ä½¿ç”¨è€…äº’å‹•éŸ¿æ‡‰å»¶é²
    progressUpdate: '<200ms',        // é€²åº¦æ›´æ–°é–“éš”
    feedbackDisplay: '<300ms'        // å›é¥‹è¨Šæ¯é¡¯ç¤ºæ™‚é–“
  }
};

// æ•ˆèƒ½ç›£æ§å¯¦ä½œ
class PerformanceMonitor {
  constructor() {
    this.metrics = new Map();
    this.thresholds = performanceRequirements;
  }
  
  // é–‹å§‹æ•ˆèƒ½æ¸¬é‡
  startMeasurement(operation) {
    const measurement = {
      startTime: Date.now(),
      memoryBefore: this.getCurrentMemoryUsage(),
      operation: operation
    };
    
    this.metrics.set(operation, measurement);
    return measurement;
  }
  
  // çµæŸæ•ˆèƒ½æ¸¬é‡
  endMeasurement(operation) {
    const measurement = this.metrics.get(operation);
    if (!measurement) return null;
    
    measurement.endTime = Date.now();
    measurement.memoryAfter = this.getCurrentMemoryUsage();
    measurement.duration = measurement.endTime - measurement.startTime;
    measurement.memoryUsed = measurement.memoryAfter - measurement.memoryBefore;
    
    // æª¢æŸ¥æ˜¯å¦ç¬¦åˆæ•ˆèƒ½è¦æ±‚
    measurement.performanceCheck = this.checkPerformanceThresholds(measurement);
    
    return measurement;
  }
  
  // æ•ˆèƒ½é–¥å€¼æª¢æŸ¥
  checkPerformanceThresholds(measurement) {
    const thresholds = this.getThresholds(measurement.operation);
    
    return {
      timeWithinLimit: measurement.duration < thresholds.maxTime,
      memoryWithinLimit: measurement.memoryUsed < thresholds.maxMemory,
      overallPass: measurement.duration < thresholds.maxTime && 
                   measurement.memoryUsed < thresholds.maxMemory
    };
  }
}
```

**2. æ•ˆèƒ½å„ªåŒ–ç­–ç•¥**
```javascript
// è³‡æ–™è™•ç†æ•ˆèƒ½å„ªåŒ–
class DataProcessingOptimizer {
  // åˆ†æ‰¹è™•ç†å¤§é‡è³‡æ–™
  async processBatchedData(books, batchSize = 50) {
    const batches = this.createBatches(books, batchSize);
    const results = [];
    
    for (let i = 0; i < batches.length; i++) {
      const batch = batches[i];
      
      // è™•ç†ç•¶å‰æ‰¹æ¬¡
      const batchResult = await this.processBatch(batch);
      results.push(batchResult);
      
      // æ›´æ–°é€²åº¦
      this.updateProgress((i + 1) / batches.length * 100);
      
      // è¨˜æ†¶é«”å£“åŠ›æª¢æŸ¥å’Œæ¸…ç†
      if (this.isMemoryPressureHigh()) {
        await this.performMemoryCleanup();
      }
      
      // çµ¦ç€è¦½å™¨å–˜æ¯æ™‚é–“ï¼Œé¿å…é˜»å¡UI
      if (i < batches.length - 1) {
        await this.yieldToEventLoop();
      }
    }
    
    return this.mergeBatchResults(results);
  }
  
  // è¨˜æ†¶é«”ä½¿ç”¨å„ªåŒ–
  async performMemoryOptimization() {
    // 1. æ¸…ç†æœªä½¿ç”¨çš„å¼•ç”¨
    this.clearUnusedReferences();
    
    // 2. å£“ç¸®å¤§ç‰©ä»¶
    this.compressLargeObjects();
    
    // 3. è§¸ç™¼åƒåœ¾å›æ”¶ (å¦‚æœç’°å¢ƒæ”¯æŒ)
    if (global.gc) {
      global.gc();
    }
    
    // 4. æª¢æŸ¥æ¸…ç†æ•ˆæœ
    const memoryAfterCleanup = this.getCurrentMemoryUsage();
    return {
      cleanupPerformed: true,
      memoryReduced: this.memoryBefore - memoryAfterCleanup,
      newMemoryUsage: memoryAfterCleanup
    };
  }
  
  // UIéŸ¿æ‡‰æ€§å„ªåŒ–
  async maintainUIResponsiveness() {
    // ä½¿ç”¨requestIdleCallbackåœ¨ç©ºé–’æ™‚é–“è™•ç†éé—œéµä»»å‹™
    return new Promise(resolve => {
      if (typeof requestIdleCallback !== 'undefined') {
        requestIdleCallback(() => resolve(), { timeout: 1000 });
      } else {
        // é™ç´šæ–¹æ¡ˆï¼šä½¿ç”¨setTimeout
        setTimeout(() => resolve(), 0);
      }
    });
  }
  
  // éåŒæ­¥ä»»å‹™å”èª¿
  async coordinateAsyncTasks(tasks) {
    // é™åˆ¶ä¸¦ç™¼æ•¸é‡é¿å…è³‡æºè€—ç›¡
    const concurrencyLimit = 3;
    const semaphore = new Semaphore(concurrencyLimit);
    
    const taskPromises = tasks.map(async task => {
      await semaphore.acquire();
      try {
        return await task();
      } finally {
        semaphore.release();
      }
    });
    
    return await Promise.all(taskPromises);
  }
}
```

---

**TDD Phase 2 æ¸¬è©¦æ¡ˆä¾‹è¨­è¨ˆèˆ‡å¯¦ä½œå·¥ä½œå®Œæˆ**  
**TDD Phase 3 å¯¦ä½œè¦åŠƒå·¥ä½œå®Œæˆ**  
**äº¤æ¥ç‹€æ…‹**: âœ… å·²æº–å‚™å¥½äº¤æ¥çµ¦ä¸»ç·šç¨‹å¯¦ä½œ  
**å¯¦ä½œæŒ‡å¼•**: å®Œæ•´çš„ä¸‰éšæ®µå¯¦ä½œç­–ç•¥ã€æ¬Šå®œæ–¹æ¡ˆæ¨™è¨»ã€æŠ€è¡“å‚µå‹™è¨˜éŒ„  
**é©—è­‰ç­–ç•¥**: è©³ç´°çš„æ¸¬è©¦é€šéæ–¹æ³•ã€ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥ã€æ•ˆèƒ½å„ªåŒ–æŒ‡å¼•  
**ä¸‹ä¸€éšæ®µ**: ä¸»ç·šç¨‹æŒ‰ç…§å¯¦ä½œè¦åŠƒåŸ·è¡Œç¨‹å¼ç¢¼å¯¦ä½œï¼Œç›®æ¨™è®“25å€‹æ¸¬è©¦æ¡ˆä¾‹100%é€šé