# v0.10.10 éŒ¯èª¤è™•ç†èˆ‡å›æ‡‰æ¨™æº–åŒ– Domain é‡æ–°è¨­è¨ˆ

**é–‹ç™¼ç‰ˆæœ¬**: v0.10.10  
**é–‹ç™¼æ—¥æœŸ**: 2025-09-03  
**ä¸»è¦ä»»å‹™**: éŒ¯èª¤è™•ç†èˆ‡å›æ‡‰æ¨™æº–åŒ– Domain é‡æ–°è¨­è¨ˆ  
**å·¥ä½œç‹€æ…‹**: ğŸ”„ é€²è¡Œä¸­ - TDD Phase 1 åŠŸèƒ½è¨­è¨ˆéšæ®µ  
**é–‹ç™¼è€…**: Claude Code

## ğŸ¯ å·¥ä½œç›®æ¨™èˆ‡èƒŒæ™¯

### é‡æ–°è¨­è¨ˆéœ€æ±‚ç†è§£

åŸºæ–¼æ­£ç¢ºçš„éœ€æ±‚é‡æ–°ç†è§£ï¼Œæœ¬æ¬¡é‡æ–°è¨­è¨ˆã€ŒéŒ¯èª¤è™•ç†èˆ‡å›æ‡‰æ¨™æº–åŒ– Domainã€ï¼Œ**æ ¸å¿ƒç›®æ¨™æ˜¯å»ºç«‹åœ˜éšŠå”ä½œæ¨™æº–åŒ–åŸºç¤è¨­æ–½**ï¼Œè€Œéå–®ç´”çš„æŠ€è¡“å•é¡Œä¿®å¾©ã€‚

### çœŸæ­£çš„æ¥­å‹™å•é¡ŒåŸŸ

**åœ˜éšŠå”ä½œä¸€è‡´æ€§å•é¡Œ**ï¼š
- ä¸åŒå·¥ç¨‹å¸«ä½¿ç”¨ä¸åŒçš„éŒ¯èª¤è™•ç†æ–¹å¼
- ç¼ºä¹çµ±ä¸€çš„å›æ‡‰æ ¼å¼å’Œé©—è­‰æ¨™æº–
- æ—¥èªŒè¼¸å‡ºæ ¼å¼ä¸ä¸€è‡´ï¼Œå½±éŸ¿ç›£æ§å’Œé™¤éŒ¯
- æ–‡å­—è¨Šæ¯åˆ†æ•£ç®¡ç†ï¼Œç¶­è­·æˆæœ¬é«˜

**ç³»çµ±æ¶æ§‹æ¨™æº–åŒ–éœ€æ±‚**ï¼š
- å»ºç«‹ç©©å®šçš„åŸºç¤æ¶æ§‹ï¼Œæ”¯æ´é•·æœŸæ¼”åŒ–
- çµ±ä¸€çš„æ¨¡çµ„é–“é€šè¨Šå”å®š
- æ¨™æº–åŒ–çš„æ¸¬è©¦å’Œé©—è­‰æ¨¡å¼
- ä¸€è‡´çš„ä½¿ç”¨è€…é«”é©—å’ŒéŒ¯èª¤å›é¥‹

## ğŸ“… 2025-09-03 é‡æ–°è¨­è¨ˆè¨˜éŒ„

### 1. åŠŸèƒ½éœ€æ±‚åˆ†æéšæ®µ âœ…

#### æ ¸å¿ƒåƒ¹å€¼é‡æ–°å®šç¾©

**å”ä½œæ¨™æº–åŒ–åƒ¹å€¼**ï¼š
- **æ¸›å°‘æºé€šæˆæœ¬**: æ‰€æœ‰å·¥ç¨‹å¸«ä½¿ç”¨ç›¸åŒçš„éŒ¯èª¤è™•ç†æ¨¡å¼
- **æå‡ç¨‹å¼ç¢¼å“è³ª**: çµ±ä¸€çš„æ¨™æº–é˜²æ­¢å¯¦ä½œå·®ç•°
- **é•·æœŸç¶­è­·æ€§**: é›†ä¸­åŒ–ç®¡ç†é™ä½ç¶­è­·è¤‡é›œåº¦
- **åœ˜éšŠæ•ˆç‡**: æ¨™æº–åŒ–æµç¨‹åŠ é€Ÿé–‹ç™¼å’Œæ¸¬è©¦

**ç³»çµ±å¥å£¯æ€§åƒ¹å€¼**ï¼š
- **ä¸€è‡´æ€§ä¿è­‰**: çµ±ä¸€çš„å›æ‡‰æ ¼å¼ç¢ºä¿æ¨¡çµ„é–“æ­£ç¢ºé€šè¨Š
- **å¯è§€æ¸¬æ€§**: çµæ§‹åŒ–æ—¥èªŒæ”¯æ´ç³»çµ±ç›£æ§å’Œæ•…éšœè¨ºæ–·
- **æ“´å±•æ€§**: æ¨™æº–åŒ–åŸºç¤æ”¯æ´æœªä¾†åŠŸèƒ½æ“´å±•
- **ç©©å®šæ€§**: çµ±ä¸€çš„éŒ¯èª¤è™•ç†æå‡ç³»çµ±ç©©å®šæ€§

#### ä½¿ç”¨è€…å ´æ™¯é‡æ–°åˆ†æ

**å·¥ç¨‹å¸«å”ä½œå ´æ™¯**ï¼š
1. **æ–°äººåŠ å…¥å ´æ™¯**: æ–°å·¥ç¨‹å¸«èƒ½å¿«é€Ÿç†è§£å’Œéµå¾ªæ—¢æœ‰çš„éŒ¯èª¤è™•ç†æ¨¡å¼
2. **ç¨‹å¼ç¢¼å¯©æŸ¥å ´æ™¯**: å¯©æŸ¥è€…èƒ½åŸºæ–¼çµ±ä¸€æ¨™æº–å¿«é€Ÿè­˜åˆ¥å•é¡Œ
3. **è·¨æ¨¡çµ„é–‹ç™¼å ´æ™¯**: ä¸åŒæ¨¡çµ„é–‹ç™¼è€…ä½¿ç”¨ä¸€è‡´çš„ä»‹é¢å¥‘ç´„
4. **ç¶­è­·å’Œé‡æ§‹å ´æ™¯**: ç¶­è­·è€…èƒ½ä¾å¾ªæ¨™æº–åŒ–æ¨¡å¼é€²è¡Œä¿®æ”¹

**ç³»çµ±æ•´åˆå ´æ™¯**ï¼š
1. **Chrome Extension é™åˆ¶å ´æ™¯**: åœ¨å—é™ç’°å¢ƒä¸‹çš„éŒ¯èª¤è™•ç†å’Œæ—¥èªŒè¼¸å‡º
2. **Content Script é€šè¨Šå ´æ™¯**: è·¨ç’°å¢ƒçš„éŒ¯èª¤å‚³éå’Œè³‡æ–™é©—è­‰
3. **ä½¿ç”¨è€…é«”é©—å ´æ™¯**: ä¸€è‡´çš„éŒ¯èª¤æç¤ºå’Œæ“ä½œå›é¥‹
4. **ç³»çµ±ç›£æ§å ´æ™¯**: çµæ§‹åŒ–è³‡æ–™æ”¯æ´æ•ˆèƒ½åˆ†æå’Œå•é¡Œè¿½è¹¤

**é•·æœŸæ¼”åŒ–å ´æ™¯**ï¼š
1. **å¤šèªç³»æ“´å±•å ´æ™¯**: çµ±ä¸€çš„æ–‡å­—ç®¡ç†æ”¯æ´åœ‹éš›åŒ–
2. **å¹³å°æ“´å±•å ´æ™¯**: æ¨™æº–åŒ–ä»‹é¢æ”¯æ´å…¶ä»–ç€è¦½å™¨å¹³å°
3. **åŠŸèƒ½æ“´å±•å ´æ™¯**: ä¸€è‡´çš„æ¨¡å¼æ”¯æ´æ–°åŠŸèƒ½å¿«é€Ÿæ•´åˆ
4. **åœ˜éšŠæ“´å¤§å ´æ™¯**: æ¨™æº–åŒ–æµç¨‹æ”¯æ´æ›´å¤šé–‹ç™¼è€…å”ä½œ

#### æœŸæœ›æ•ˆæœèˆ‡æˆåŠŸæ¨™æº–

**å”ä½œæ•ˆç‡æå‡**ï¼š
- æ–°å·¥ç¨‹å¸«ä¸Šæ‰‹æ™‚é–“ç¸®çŸ­ 50%
- ç¨‹å¼ç¢¼å¯©æŸ¥æ™‚é–“æ¸›å°‘ 30%
- è·¨æ¨¡çµ„æ•´åˆå•é¡Œæ¸›å°‘ 80%
- ç¶­è­·ç›¸é—œ bug æ¸›å°‘ 60%

**ç³»çµ±å“è³ªæå‡**ï¼š
- æ¸¬è©¦é€šéç‡ç¶­æŒ 100%
- lint å•é¡Œæ¸›å°‘ 90% (ç›®æ¨™å¾ 3760 å€‹æ¸›å°‘åˆ° 376 å€‹ä»¥ä¸‹)
- éŒ¯èª¤è™•ç†è¦†è“‹ç‡é”åˆ° 95%
- ç³»çµ±å¯è§€æ¸¬æ€§æå‡ 200%

### 2. åŠŸèƒ½è¦æ ¼è¨­è¨ˆéšæ®µ âœ…

#### Domain æ¶æ§‹é‡æ–°è¨­è¨ˆ

**Domain æ ¸å¿ƒè·è²¬**ï¼š
- **å”ä½œæ¨™æº–åˆ¶å®š**: å»ºç«‹çµ±ä¸€çš„éŒ¯èª¤è™•ç†å’Œå›æ‡‰æ ¼å¼æ¨™æº–
- **åŸºç¤è¨­æ–½æä¾›**: æä¾›æ˜“ç”¨çš„å·¥å…·é¡åˆ¥å’Œè¼”åŠ©å‡½æ•¸
- **å“è³ªä¿è­‰æ”¯æ´**: æ•´åˆæ¸¬è©¦æ¡†æ¶ï¼Œæ”¯æ´è‡ªå‹•åŒ–é©—è­‰
- **é•·æœŸæ¼”åŒ–æ”¯æ´**: è¨­è¨ˆå¯æ“´å±•çš„æ¶æ§‹ï¼Œæ”¯æ´æœªä¾†éœ€æ±‚è®ŠåŒ–

#### Chrome Extension ç‰¹åŒ–è¨­è¨ˆ

**èƒŒæ™¯ç’°å¢ƒé©é…**ï¼š
```javascript
// Background Service Worker å°ˆç”¨éŒ¯èª¤è™•ç†å™¨
class BackgroundErrorHandler {
  constructor() {
    this.memoryLimit = 5 * 1024 * 1024 // 5MB é™åˆ¶
    this.logBuffer = new CircularBuffer(1000) // æœ‰é™ç·©è¡å€
  }
  
  handleError(error, context = {}) {
    // è¨˜æ†¶é«”å„ªåŒ–çš„éŒ¯èª¤è™•ç†
    const lightweight = this.createLightweightError(error, context)
    this.logBuffer.add(lightweight)
    
    // å¦‚æœæ˜¯é—œéµéŒ¯èª¤ï¼Œç«‹å³é€šçŸ¥å…¶ä»–ç’°å¢ƒ
    if (this.isCriticalError(error)) {
      this.notifyAllContexts(lightweight)
    }
    
    return new OperationResult(false, null, lightweight)
  }
}
```

**Content Script å°ˆç”¨é€šè¨Š**ï¼š
```javascript
// Content Script éŒ¯èª¤æ”¶é›†å’Œå‚³é
class ContentErrorCollector {
  constructor() {
    this.errorQueue = []
    this.maxQueueSize = 100
  }
  
  collectError(error, pageContext = {}) {
    const errorData = {
      error: this.serializeError(error),
      pageContext: {
        url: window.location.href,
        title: document.title,
        timestamp: Date.now(),
        ...pageContext
      },
      userAgent: navigator.userAgent
    }
    
    this.queueError(errorData)
    this.attemptTransmission()
  }
  
  async attemptTransmission() {
    if (this.errorQueue.length > 0) {
      try {
        await chrome.runtime.sendMessage({
          type: 'ERROR_REPORT',
          errors: this.errorQueue.splice(0, 10) // æ‰¹æ¬¡å‚³é€
        })
      } catch (transmissionError) {
        // å‚³é€å¤±æ•—æ™‚çš„é™ç´šç­–ç•¥
        this.handleTransmissionFailure(transmissionError)
      }
    }
  }
}
```

**Popup ä½¿ç”¨è€…é«”é©—æ•´åˆ**ï¼š
```javascript
// Popup éŒ¯èª¤é¡¯ç¤ºç®¡ç†å™¨
class PopupErrorUIManager {
  constructor() {
    this.activeNotifications = new Map()
    this.maxNotifications = 3
  }
  
  showError(error, options = {}) {
    const notification = {
      id: this.generateId(),
      type: this.classifyErrorForUI(error),
      message: this.getUserFriendlyMessage(error),
      actions: this.getAvailableActions(error),
      dismissible: options.dismissible !== false,
      duration: options.duration || this.getDefaultDuration(error.severity)
    }
    
    this.displayNotification(notification)
    this.scheduleCleanup(notification)
  }
  
  getAvailableActions(error) {
    const actions = []
    
    if (error.canRetry) {
      actions.push({
        label: 'é‡è©¦',
        action: () => this.retryFailedOperation(error)
      })
    }
    
    if (error.hasDetails) {
      actions.push({
        label: 'è©³ç´°è³‡è¨Š',
        action: () => this.showErrorDetails(error)
      })
    }
    
    return actions
  }
}
```

#### è¼¸å…¥å®šç¾© (Chrome Extension ç‰¹åŒ–)

**Background ç’°å¢ƒéŒ¯èª¤è¼¸å…¥**ï¼š
- `error`: Error - åŸå§‹éŒ¯èª¤ç‰©ä»¶ (å¿…å¡«)
- `context`: object - Service Worker ä¸Šä¸‹æ–‡ (é¸å¡«)
  - `memoryUsage`: number - ç•¶å‰è¨˜æ†¶é«”ä½¿ç”¨é‡
  - `activeConnections`: number - æ´»èºé€£ç·šæ•¸é‡
  - `lastHeartbeat`: timestamp - æœ€å¾Œå¿ƒè·³æ™‚é–“
- `severity`: ErrorSeverity - éŒ¯èª¤åš´é‡ç¨‹åº¦ (é¸å¡«ï¼Œè‡ªå‹•æ¨æ–·)
- `retryable`: boolean - æ˜¯å¦å¯é‡è©¦ (é¸å¡«ï¼Œè‡ªå‹•åˆ¤æ–·)

**Content Script ç’°å¢ƒéŒ¯èª¤è¼¸å…¥**ï¼š
- `error`: Error - åŸå§‹éŒ¯èª¤ç‰©ä»¶ (å¿…å¡«)
- `pageContext`: object - é é¢ä¸Šä¸‹æ–‡ (å¿…å¡«)
  - `url`: string - ç•¶å‰é é¢ URL
  - `title`: string - é é¢æ¨™é¡Œ  
  - `platform`: string - æª¢æ¸¬åˆ°çš„å¹³å°é¡å‹
  - `extractionState`: object - è³‡æ–™æå–ç‹€æ…‹
- `userContext`: object - ä½¿ç”¨è€…æ“ä½œä¸Šä¸‹æ–‡ (é¸å¡«)
  - `lastAction`: string - æœ€å¾ŒåŸ·è¡Œçš„å‹•ä½œ
  - `interactionHistory`: array - äº’å‹•æ­·å²
- `transmissionPriority`: Priority - å‚³è¼¸å„ªå…ˆç´š (é¸å¡«)

**Popup ç’°å¢ƒéŒ¯èª¤è¼¸å…¥**ï¼š
- `error`: Error - åŸå§‹éŒ¯èª¤ç‰©ä»¶ (å¿…å¡«)
- `uiContext`: object - UI ä¸Šä¸‹æ–‡ (å¿…å¡«)
  - `activeView`: string - ç•¶å‰æª¢è¦–
  - `userInProgress`: boolean - ä½¿ç”¨è€…æ˜¯å¦åœ¨åŸ·è¡Œæ“ä½œ
  - `pendingOperations`: array - ç­‰å¾…ä¸­çš„æ“ä½œ
- `displayOptions`: object - é¡¯ç¤ºé¸é … (é¸å¡«)
  - `blocking`: boolean - æ˜¯å¦é˜»å¡å¼é¡¯ç¤º
  - `dismissible`: boolean - æ˜¯å¦å¯é—œé–‰
  - `actions`: array - å¯ç”¨çš„ä½¿ç”¨è€…å‹•ä½œ

#### è¼¸å‡ºè¦æ ¼å®šç¾© (Chrome Extension å„ªåŒ–)

**è¼•é‡ç´šéŒ¯èª¤å›æ‡‰æ ¼å¼**ï¼š
```javascript
{
  success: boolean,
  data: object | null,
  error: {
    code: string,           // æ¨™æº–éŒ¯èª¤ä»£ç¢¼
    type: string,          // éŒ¯èª¤é¡å‹æšèˆ‰
    message: string,       // ä½¿ç”¨è€…å‹å–„è¨Šæ¯
    severity: string,      // åš´é‡ç¨‹åº¦
    retryable: boolean,    // æ˜¯å¦å¯é‡è©¦
    context: {             // ç²¾ç°¡çš„ä¸Šä¸‹æ–‡è³‡è¨Š
      environment: string, // 'background' | 'content' | 'popup'
      timestamp: number,   // Unix timestamp
      sessionId: string    // å·¥ä½œéšæ®µè­˜åˆ¥
    }
  } | null,
  metadata: {
    requestId: string,     // è«‹æ±‚è¿½è¹¤ ID
    version: string,       // Extension ç‰ˆæœ¬
    performance: {         // æ•ˆèƒ½æŒ‡æ¨™
      processingTime: number,
      memoryUsage: number
    }
  }
}
```

**è·¨ç’°å¢ƒé€šè¨Šæ ¼å¼**ï¼š
```javascript
{
  type: 'ERROR_REPORT' | 'ERROR_RESPONSE' | 'ERROR_RECOVERY',
  source: 'background' | 'content' | 'popup',
  target: 'background' | 'content' | 'popup' | 'all',
  payload: {
    errors: Array<StandardError>,
    batchId: string,
    priority: 'high' | 'normal' | 'low',
    requiresResponse: boolean
  },
  routing: {
    messageId: string,
    correlationId: string,
    timestamp: number,
    ttl: number // Time To Live in milliseconds
  }
}
```

**çµæ§‹åŒ–æ—¥èªŒæ ¼å¼ (è¨˜æ†¶é«”å„ªåŒ–)**ï¼š
```javascript
{
  level: 'debug' | 'info' | 'warn' | 'error' | 'fatal',
  message: string,        // ç°¡æ½”çš„è¨Šæ¯
  timestamp: number,      // Unix timestamp (æ›´å°çš„å„²å­˜ç©ºé–“)
  environment: string,    // åŸ·è¡Œç’°å¢ƒ
  context: object,        // ä¸Šä¸‹æ–‡è³‡è¨Š (å£“ç¸®å„²å­˜)
  metadata: {
    sessionId: string,
    sequence: number,     // åºåˆ—è™Ÿ
    compressed: boolean   // æ˜¯å¦å£“ç¸®å„²å­˜
  }
}
```

#### æ­£å¸¸æµç¨‹è¨­è¨ˆ (Chrome Extension ç‰¹åŒ–)

**è·¨ç’°å¢ƒéŒ¯èª¤è™•ç†æµç¨‹**ï¼š
1. **éŒ¯èª¤ç™¼ç”Ÿ**: åœ¨ä»»ä¸€ç’°å¢ƒ (Background/Content/Popup) æª¢æ¸¬åˆ°éŒ¯èª¤
2. **æœ¬åœ°è™•ç†**: ä½¿ç”¨å°æ‡‰ç’°å¢ƒçš„éŒ¯èª¤è™•ç†å™¨å»ºç«‹æ¨™æº–åŒ–éŒ¯èª¤
3. **åš´é‡åº¦è©•ä¼°**: è‡ªå‹•è©•ä¼°éŒ¯èª¤åš´é‡åº¦å’Œå½±éŸ¿ç¯„åœ
4. **é€šçŸ¥æ±ºç­–**: æ ¹æ“šåš´é‡åº¦æ±ºå®šæ˜¯å¦éœ€è¦é€šçŸ¥å…¶ä»–ç’°å¢ƒ
5. **è·¨ç’°å¢ƒå‚³é**: ä½¿ç”¨ Chrome Extension è¨Šæ¯ API å‚³ééŒ¯èª¤è³‡è¨Š
6. **çµ±ä¸€æ—¥èªŒè¨˜éŒ„**: åœ¨ Background ç’°å¢ƒçµ±ä¸€è¨˜éŒ„å’Œåˆ†æ
7. **ä½¿ç”¨è€…å›é¥‹**: åœ¨ Popup ç’°å¢ƒæä¾›é©ç•¶çš„ä½¿ç”¨è€…å›é¥‹

**è¨˜æ†¶é«”å„ªåŒ–æµç¨‹**ï¼š
1. **éŒ¯èª¤ç”¢ç”Ÿ**: å»ºç«‹è¼•é‡ç´šéŒ¯èª¤ç‰©ä»¶ï¼Œé¿å…è¨˜æ†¶é«”æ´©æ¼
2. **å¾ªç’°ç·©è¡**: ä½¿ç”¨æœ‰é™å¤§å°çš„ç·©è¡å€å„²å­˜éŒ¯èª¤æ­·å²
3. **æ‰¹æ¬¡è™•ç†**: ç´¯ç©å¤šå€‹éŒ¯èª¤å¾Œé€²è¡Œæ‰¹æ¬¡å‚³è¼¸
4. **å£“ç¸®å„²å­˜**: å°è©³ç´°è³‡è¨Šé€²è¡Œå£“ç¸®å„²å­˜
5. **å®šæœŸæ¸…ç†**: å®šæ™‚æ¸…ç†éæœŸçš„éŒ¯èª¤è¨˜éŒ„
6. **è¨˜æ†¶é«”ç›£æ§**: æŒçºŒç›£æ§è¨˜æ†¶é«”ä½¿ç”¨é‡ï¼Œè§¸ç™¼æ¸…ç†æ©Ÿåˆ¶

**ä½¿ç”¨è€…é«”é©—å„ªåŒ–æµç¨‹**ï¼š
1. **éŒ¯èª¤åˆ†é¡**: å°‡æŠ€è¡“éŒ¯èª¤è½‰æ›ç‚ºä½¿ç”¨è€…å¯ç†è§£çš„åˆ†é¡
2. **è¨Šæ¯æœ¬åœ°åŒ–**: æ ¹æ“šä½¿ç”¨è€…èªè¨€åå¥½æä¾›è¨Šæ¯
3. **å‹•ä½œå»ºè­°**: æ ¹æ“šéŒ¯èª¤é¡å‹æä¾›å…·é«”çš„ä¿®å¾©å»ºè­°
4. **æ¼¸é€²å¼æ­éœ²**: æä¾›ç°¡è¦è¨Šæ¯ï¼Œè©³ç´°è³‡è¨Šå¯é¸æ“‡æª¢è¦–
5. **éé˜»å¡é€šçŸ¥**: ä½¿ç”¨éé˜»å¡å¼é€šçŸ¥ï¼Œä¸å¹²æ“¾ä½¿ç”¨è€…å·¥ä½œæµç¨‹
6. **ç‹€æ…‹è¿½è¹¤**: è¿½è¹¤éŒ¯èª¤è§£æ±ºç‹€æ…‹ï¼Œé¿å…é‡è¤‡é€šçŸ¥

#### ç•°å¸¸è™•ç†ç­–ç•¥ (Chrome Extension ç’°å¢ƒ)

**Service Worker ç”Ÿå‘½é€±æœŸç›¸é—œç•°å¸¸**ï¼š
- æœå‹™çµ‚æ­¢ç•°å¸¸ â†’ ServiceWorkerTerminationException
- åŒ…å«çµ‚æ­¢åŸå› ã€æ´»èºä»»å‹™ã€è¨˜æ†¶é«”ä½¿ç”¨æƒ…æ³
- ä½¿ç”¨ SERVICE_WORKER_ERROR é¡å‹
- è‡ªå‹•é‡å•Ÿç­–ç•¥å’Œç‹€æ…‹æ¢å¾©æ©Ÿåˆ¶

**Content Script æ³¨å…¥ç•°å¸¸**ï¼š
- è…³æœ¬æ³¨å…¥å¤±æ•— â†’ ContentScriptInjectionException
- åŒ…å«ç›®æ¨™ URLã€æ¬Šé™ç‹€æ…‹ã€æ³¨å…¥æ™‚æ©Ÿ
- ä½¿ç”¨ CONTENT_SCRIPT_ERROR é¡å‹
- é™ç´šåˆ°è¢«å‹•å¼è³‡æ–™æå–

**è·¨ç’°å¢ƒé€šè¨Šç•°å¸¸**ï¼š
- è¨Šæ¯å‚³éå¤±æ•— â†’ MessagePipelineException
- åŒ…å«è¨Šæ¯å…§å®¹ã€ç›®æ¨™ç’°å¢ƒã€ç¶²è·¯ç‹€æ…‹
- ä½¿ç”¨ COMMUNICATION_ERROR é¡å‹
- å¯¦ä½œé‡è©¦æ©Ÿåˆ¶å’Œæœ¬åœ°æš«å­˜

**å„²å­˜é…é¡ç•°å¸¸**ï¼š
- Chrome Storage é…é¡è¶…é™ â†’ StorageQuotaException
- åŒ…å«ä½¿ç”¨é‡çµ±è¨ˆã€è³‡æ–™é‡è¦æ€§åˆ†ç´š
- ä½¿ç”¨ STORAGE_QUOTA_ERROR é¡å‹
- è‡ªå‹•æ¸…ç†ç­–ç•¥å’Œå„ªå…ˆç´šä¿ç•™

**æ¬Šé™ç›¸é—œç•°å¸¸**ï¼š
- æ¬Šé™ä¸è¶³æˆ–è¢«æ‹’çµ• â†’ PermissionException
- åŒ…å«æ‰€éœ€æ¬Šé™ã€ç•¶å‰ç‹€æ…‹ã€è«‹æ±‚æ­·å²
- ä½¿ç”¨ PERMISSION_ERROR é¡å‹
- å¼•å°ä½¿ç”¨è€…æˆæ¬Šæµç¨‹

### 3. é‚Šç•Œæ¢ä»¶åˆ†æéšæ®µ âœ…

#### Chrome Extension ç‰¹æ®Šé™åˆ¶

**Service Worker è¨˜æ†¶é«”é™åˆ¶**ï¼š
- è¨˜æ†¶é«”ä½¿ç”¨é‡é™åˆ¶ï¼šæ¨è–¦ < 10MBï¼Œç¡¬é™åˆ¶ ~50MB
- éŒ¯èª¤ç‰©ä»¶å¤§å°ï¼šå–®ä¸€éŒ¯èª¤ < 1KBï¼ŒéŒ¯èª¤å¿«å– < 1MB
- è™•ç†ç­–ç•¥ï¼šä½¿ç”¨å¾ªç’°ç·©è¡å€ã€éŒ¯èª¤è³‡è¨Šå£“ç¸®ã€å®šæœŸæ¸…ç†
- è¶…é™è™•ç†ï¼šè‡ªå‹•è§¸ç™¼ GCã€æ¸…ç†èˆŠè³‡æ–™ã€é™ç´šåˆ°åŸºæœ¬åŠŸèƒ½

**Content Script åŸ·è¡Œç’°å¢ƒé™åˆ¶**ï¼š
- é é¢ç’°å¢ƒéš”é›¢ï¼šç„¡æ³•å­˜å–æ‰€æœ‰ Chrome API
- ç¶²è·¯é€£ç·šé™åˆ¶ï¼šä¾è³´ Background ç’°å¢ƒä»£ç†
- DOM å­˜å–é™åˆ¶ï¼šå¯èƒ½é‡åˆ° CSP (Content Security Policy) é™åˆ¶
- è™•ç†ç­–ç•¥ï¼šæœ¬åœ°æš«å­˜éŒ¯èª¤ã€æ‰¹æ¬¡å‚³è¼¸ã€é™ç´šè™•ç†

**Extension API é…é¡é™åˆ¶**ï¼š
- `chrome.storage.local`ï¼šé…é¡ 10MB (åŒæ­¥é…é¡ 100KB)
- `chrome.runtime.sendMessage`ï¼šè¨Šæ¯å¤§å°é™åˆ¶ 64MB
- è™•ç†ç­–ç•¥ï¼šè³‡æ–™å£“ç¸®ã€åˆ†æ‰¹å‚³è¼¸ã€å„ªå…ˆç´šç®¡ç†

#### æ¥µç«¯æƒ…æ³è™•ç†

**Extension è¢«ç¦ç”¨æˆ–æ›´æ–°**ï¼š
- æƒ…å¢ƒï¼šä½¿ç”¨è€…åœ¨åŸ·è¡ŒæœŸé–“ç¦ç”¨ Extension æˆ–è§¸ç™¼è‡ªå‹•æ›´æ–°
- è™•ç†ï¼šå¯¦ä½œå„ªé›…é—œé–‰æ©Ÿåˆ¶ï¼Œå„²å­˜é—œéµéŒ¯èª¤è³‡è¨Šåˆ°æœ¬åœ°
- æ¢å¾©ï¼šExtension é‡å•Ÿå¾Œæ¢å¾©éŒ¯èª¤è™•ç†ç‹€æ…‹

**ç€è¦½å™¨è¨˜æ†¶é«”ä¸è¶³**ï¼š
- æƒ…å¢ƒï¼šç³»çµ±è¨˜æ†¶é«”ä¸è¶³ï¼Œç€è¦½å™¨é–‹å§‹å›æ”¶ Extension è³‡æº
- è™•ç†ï¼šå¯¦ä½œè¨˜æ†¶é«”å£“åŠ›æª¢æ¸¬ï¼Œä¸»å‹•æ¸…ç†éé—œéµè³‡æ–™
- é™ç´šï¼šåˆ‡æ›åˆ°æœ€å°åŠŸèƒ½æ¨¡å¼ï¼Œåƒ…ä¿ç•™æ ¸å¿ƒéŒ¯èª¤è™•ç†

**ç¶²è·¯é€£ç·šç•°å¸¸**ï¼š
- æƒ…å¢ƒï¼šç¶²è·¯ä¸­æ–·æˆ–ä¸ç©©å®šï¼Œå½±éŸ¿éŒ¯èª¤è³‡æ–™åŒæ­¥
- è™•ç†ï¼šæœ¬åœ°å„²å­˜éŒ¯èª¤è³‡æ–™ï¼Œç¶²è·¯æ¢å¾©å¾Œè‡ªå‹•åŒæ­¥
- å‚™æ´ï¼šä½¿ç”¨é›¢ç·šæ¨¡å¼ï¼Œç¢ºä¿åŸºæœ¬åŠŸèƒ½å¯ç”¨

**è·¨åŸŸæ”¿ç­–é™åˆ¶**ï¼š
- æƒ…å¢ƒï¼šç›®æ¨™ç¶²ç«™çš„ CSP æˆ– CORS æ”¿ç­–é˜»æ­¢éŒ¯èª¤è³‡æ–™æ”¶é›†
- è™•ç†ï¼šå¯¦ä½œå¤šç´šé™ç´šæ©Ÿåˆ¶ï¼Œä½¿ç”¨å…è¨±çš„è³‡æ–™æ”¶é›†æ–¹å¼
- æ›¿ä»£ï¼šæ”¹ç”¨è¢«å‹•å¼éŒ¯èª¤ç›£æ§ï¼Œæ¸›å°‘ä¸»å‹•è³‡æ–™æ”¶é›†

#### ç³»çµ±é™åˆ¶èˆ‡æ•ˆèƒ½å„ªåŒ–

**éŒ¯èª¤è™•ç†æ•ˆèƒ½è¦æ±‚**ï¼š
```javascript
// æ•ˆèƒ½åŸºæº–å®šç¾©
const PERFORMANCE_BENCHMARKS = {
  errorCreation: { target: 0.5, max: 1.0 }, // ms
  errorSerialization: { target: 0.2, max: 0.5 }, // ms
  crossEnvironmentTransmission: { target: 5.0, max: 15.0 }, // ms
  errorRecovery: { target: 10.0, max: 50.0 }, // ms
  memoryUsage: { target: 5.0, max: 10.0 } // MB
}

// æ•ˆèƒ½ç›£æ§å’Œè‡ªå‹•èª¿æ•´
class PerformanceMonitor {
  constructor() {
    this.metrics = new Map()
    this.adaptiveConfig = new AdaptiveConfiguration()
  }
  
  recordMetric(operation, duration) {
    const benchmark = PERFORMANCE_BENCHMARKS[operation]
    if (duration > benchmark.max) {
      this.adaptiveConfig.degradePerformance(operation)
    }
    
    this.metrics.set(operation, duration)
  }
}
```

**ä½µç™¼è™•ç†é™åˆ¶**ï¼š
- åŒæ™‚è™•ç†çš„éŒ¯èª¤æ•¸é‡ï¼š< 100 å€‹
- Background Script ä½µç™¼é™åˆ¶ï¼šä¾ Chrome ç‰ˆæœ¬è€Œç•°
- Content Script ä½µç™¼é™åˆ¶ï¼šæ¯å€‹é é¢ç¨ç«‹è¨ˆç®—
- è™•ç†ç­–ç•¥ï¼šä½¿ç”¨ä½‡åˆ—æ©Ÿåˆ¶ã€å„ªå…ˆç´šæ’ç¨‹ã€è³‡æºæ± ç®¡ç†

### 4. API/ä»‹é¢è¨­è¨ˆéšæ®µ âœ…

#### Chrome Extension ç‰¹åŒ– API è¨­è¨ˆ

**çµ±ä¸€éŒ¯èª¤è™•ç†å™¨ (å„ç’°å¢ƒé€šç”¨)**ï¼š
```javascript
class UniversalErrorHandler {
  constructor(environment) {
    this.environment = environment // 'background' | 'content' | 'popup'
    this.config = this.loadEnvironmentConfig(environment)
    this.messageRouter = new MessageRouter(environment)
    this.localLogger = new LocalLogger(environment)
  }
  
  // ä¸»è¦éŒ¯èª¤è™•ç†æ–¹æ³•
  async handleError(error, context = {}, options = {}) {
    // 1. å»ºç«‹æ¨™æº–åŒ–éŒ¯èª¤
    const standardError = await this.createStandardError(error, context)
    
    // 2. æœ¬åœ°è™•ç†
    const localResult = await this.processLocally(standardError, options)
    
    // 3. è·¨ç’°å¢ƒé€šçŸ¥ (å¦‚æœéœ€è¦)
    if (this.shouldNotifyOtherEnvironments(standardError)) {
      await this.notifyOtherEnvironments(standardError)
    }
    
    // 4. å›å‚³è™•ç†çµæœ
    return this.createOperationResult(localResult, standardError)
  }
  
  // å»ºç«‹æ¨™æº–åŒ–éŒ¯èª¤
  async createStandardError(error, context) {
    const classifier = new ErrorClassifier()
    const classification = classifier.classify(error)
    
    return new StandardError({
      code: this.generateErrorCode(classification),
      type: classification.type,
      message: await this.getUserMessage(error, classification),
      originalError: this.sanitizeError(error),
      context: {
        environment: this.environment,
        ...context,
        timestamp: Date.now(),
        sessionId: await this.getSessionId()
      },
      severity: classification.severity,
      retryable: classification.retryable,
      metadata: await this.collectMetadata()
    })
  }
  
  // æœ¬åœ°è™•ç†
  async processLocally(standardError, options) {
    // è¨˜éŒ„æ—¥èªŒ
    this.localLogger.log(standardError)
    
    // å„²å­˜åˆ°æœ¬åœ°å¿«å–
    await this.cacheError(standardError)
    
    // åŸ·è¡Œæ¢å¾©ç­–ç•¥ (å¦‚æœå¯ä»¥)
    if (standardError.retryable && options.attemptRecovery) {
      return await this.attemptRecovery(standardError)
    }
    
    return { processed: true, recovered: false }
  }
}
```

**Background ç’°å¢ƒå°ˆç”¨è™•ç†å™¨**ï¼š
```javascript
class BackgroundErrorProcessor extends UniversalErrorHandler {
  constructor() {
    super('background')
    this.errorAggregator = new ErrorAggregator()
    this.monitoringService = new MonitoringService()
    this.recoveryOrchestrator = new RecoveryOrchestrator()
  }
  
  // Background ç‰¹æœ‰çš„éŒ¯èª¤èšåˆ
  async aggregateErrors(errors) {
    return this.errorAggregator.process(errors, {
      groupBy: ['type', 'source'],
      timeWindow: 60000, // 1åˆ†é˜èšåˆçª—å£
      maxGroupSize: 50
    })
  }
  
  // ç³»çµ±å¥åº·åº¦ç›£æ§
  async assessSystemHealth() {
    const metrics = await this.monitoringService.collectMetrics()
    const errorPatterns = this.errorAggregator.getPatterns()
    
    return {
      healthScore: this.calculateHealthScore(metrics, errorPatterns),
      criticalIssues: this.identifyCriticalIssues(errorPatterns),
      recommendations: this.generateRecommendations(metrics)
    }
  }
  
  // è‡ªå‹•æ¢å¾©ç·¨æ’
  async orchestrateRecovery(systemHealth) {
    if (systemHealth.healthScore < 0.5) {
      return await this.recoveryOrchestrator.executeEmergencyProtocol()
    } else if (systemHealth.healthScore < 0.8) {
      return await this.recoveryOrchestrator.executePreventiveMeasures()
    }
    
    return { action: 'monitor', reason: 'system_healthy' }
  }
}
```

**Content Script ç’°å¢ƒå°ˆç”¨è™•ç†å™¨**ï¼š
```javascript
class ContentErrorProcessor extends UniversalErrorHandler {
  constructor() {
    super('content')
    this.pageContext = new PageContextCollector()
    this.transmissionQueue = new TransmissionQueue()
    this.fallbackStorage = new FallbackStorage()
  }
  
  // Content Script ç‰¹æœ‰çš„é é¢ä¸Šä¸‹æ–‡æ”¶é›†
  async collectPageContext(error) {
    return this.pageContext.collect({
      url: window.location.href,
      title: document.title,
      platform: await this.detectPlatform(),
      domState: this.captureDOMState(error),
      userInteraction: this.getUserInteractionHistory(),
      networkState: await this.getNetworkState()
    })
  }
  
  // æ‰¹æ¬¡å‚³è¼¸ç®¡ç†
  async queueForTransmission(standardError, priority = 'normal') {
    await this.transmissionQueue.add(standardError, priority)
    
    // å¦‚æœæ˜¯é«˜å„ªå…ˆç´šæˆ–ä½‡åˆ—å·²æ»¿ï¼Œç«‹å³å‚³è¼¸
    if (priority === 'high' || this.transmissionQueue.shouldFlush()) {
      return await this.flushTransmissionQueue()
    }
    
    return { queued: true, queueSize: this.transmissionQueue.size() }
  }
  
  // é™ç´šå„²å­˜æ©Ÿåˆ¶
  async handleTransmissionFailure(errors, reason) {
    await this.fallbackStorage.store(errors, {
      reason,
      timestamp: Date.now(),
      retryCount: 0
    })
    
    // è¨­å®šé‡è©¦è¨ˆæ™‚å™¨
    this.scheduleRetry()
    
    return { stored: true, location: 'fallback' }
  }
}
```

**Popup ç’°å¢ƒå°ˆç”¨è™•ç†å™¨**ï¼š
```javascript
class PopupErrorProcessor extends UniversalErrorHandler {
  constructor() {
    super('popup')
    this.uiNotificationManager = new UINotificationManager()
    this.userActionTracker = new UserActionTracker()
    this.accessibilityManager = new AccessibilityManager()
  }
  
  // Popup ç‰¹æœ‰çš„ UI éŒ¯èª¤è™•ç†
  async handleUIError(error, uiContext) {
    const standardError = await this.createStandardError(error, uiContext)
    
    // æ±ºå®š UI å›æ‡‰ç­–ç•¥
    const uiStrategy = this.determineUIStrategy(standardError, uiContext)
    
    // é¡¯ç¤ºä½¿ç”¨è€…é€šçŸ¥
    if (uiStrategy.showNotification) {
      await this.uiNotificationManager.show({
        error: standardError,
        strategy: uiStrategy,
        accessibility: await this.accessibilityManager.getRequirements()
      })
    }
    
    // è¿½è¹¤ä½¿ç”¨è€…å¾ŒçºŒå‹•ä½œ
    this.userActionTracker.trackErrorResponse(standardError.id, uiContext)
    
    return this.createUIResult(standardError, uiStrategy)
  }
  
  // UI ç­–ç•¥æ±ºå®š
  determineUIStrategy(standardError, uiContext) {
    const strategy = {
      showNotification: true,
      blocking: false,
      dismissible: true,
      actions: [],
      displayDuration: 5000
    }
    
    // æ ¹æ“šéŒ¯èª¤åš´é‡åº¦èª¿æ•´ç­–ç•¥
    if (standardError.severity === 'critical') {
      strategy.blocking = true
      strategy.dismissible = false
    }
    
    // æ ¹æ“šä½¿ç”¨è€…ç‹€æ…‹èª¿æ•´
    if (uiContext.userInProgress) {
      strategy.displayDuration = 10000 // å»¶é•·é¡¯ç¤ºæ™‚é–“
      strategy.actions.push({
        label: 'ç¹¼çºŒ',
        action: () => this.resumeUserOperation(uiContext)
      })
    }
    
    return strategy
  }
}
```

#### è·¨ç’°å¢ƒé€šè¨Šä»‹é¢

**è¨Šæ¯è·¯ç”±ç³»çµ±**ï¼š
```javascript
class MessageRouter {
  constructor(environment) {
    this.environment = environment
    this.messageHandlers = new Map()
    this.correlationMap = new Map()
    this.setupMessageListeners()
  }
  
  // ç™¼é€éŒ¯èª¤å ±å‘Šåˆ°å…¶ä»–ç’°å¢ƒ
  async sendErrorReport(errors, targetEnvironment = 'all') {
    const message = {
      type: 'ERROR_REPORT',
      source: this.environment,
      target: targetEnvironment,
      payload: {
        errors: this.sanitizeForTransmission(errors),
        batchId: this.generateBatchId(),
        priority: this.calculatePriority(errors),
        requiresResponse: false
      },
      routing: {
        messageId: this.generateMessageId(),
        timestamp: Date.now(),
        ttl: 30000 // 30ç§’ TTL
      }
    }
    
    return await this.transmitMessage(message, targetEnvironment)
  }
  
  // è«‹æ±‚éŒ¯èª¤è™•ç†å”åŠ©
  async requestErrorAssistance(error, assistanceType) {
    const message = {
      type: 'ERROR_ASSISTANCE_REQUEST',
      source: this.environment,
      target: 'background', // ç¸½æ˜¯ç”± Background è™•ç†å”åŠ©è«‹æ±‚
      payload: {
        error: this.sanitizeForTransmission(error),
        assistanceType, // 'recovery' | 'analysis' | 'escalation'
        urgency: this.calculateUrgency(error),
        requiresResponse: true
      },
      routing: {
        messageId: this.generateMessageId(),
        correlationId: this.generateCorrelationId(),
        timestamp: Date.now(),
        ttl: 60000 // 1åˆ†é˜ TTL
      }
    }
    
    // ç­‰å¾…å›æ‡‰
    return await this.sendAndWaitForResponse(message, 10000) // 10ç§’è¶…æ™‚
  }
}
```

#### æ•´åˆæ¸¬è©¦ä»‹é¢

**æ¸¬è©¦è¼”åŠ©å·¥å…·**ï¼š
```javascript
// Chrome Extension ç’°å¢ƒæ¸¬è©¦è¼”åŠ©
export class ExtensionTestHelper {
  constructor() {
    this.mockEnvironments = new Map()
    this.messageInterceptor = new MessageInterceptor()
    this.errorSimulator = new ErrorSimulator()
  }
  
  // æ¨¡æ“¬ Chrome Extension ç’°å¢ƒ
  setupMockEnvironment(environment, config = {}) {
    const mockEnv = new MockExtensionEnvironment(environment, config)
    this.mockEnvironments.set(environment, mockEnv)
    return mockEnv
  }
  
  // æ¨¡æ“¬è·¨ç’°å¢ƒéŒ¯èª¤å‚³æ’­
  async simulateErrorPropagation(sourceEnv, error, propagationPath) {
    const handler = this.mockEnvironments.get(sourceEnv).errorHandler
    const result = await handler.handleError(error)
    
    // è¿½è¹¤éŒ¯èª¤åœ¨ç’°å¢ƒé–“çš„å‚³æ’­
    const propagationTrace = await this.messageInterceptor.traceMessages(
      (msg) => msg.type === 'ERROR_REPORT' && msg.payload.errors.some(e => e.id === result.error.id),
      propagationPath.length * 1000 // è¶…æ™‚æ™‚é–“
    )
    
    return {
      originalResult: result,
      propagationTrace,
      reachedEnvironments: propagationTrace.map(msg => msg.target)
    }
  }
  
  // é©—è­‰éŒ¯èª¤è™•ç†çµæœ
  expectErrorHandlingResult(result, expectedPattern) {
    // çµæ§‹åŒ–é©—è­‰ï¼Œé¿å…å­—ä¸²æ¯”å°
    expect(result.success).toBe(expectedPattern.success)
    expect(result.error.type).toBe(expectedPattern.errorType)
    expect(result.error.code).toBe(expectedPattern.errorCode)
    
    if (expectedPattern.shouldNotifyOthers) {
      expect(this.messageInterceptor.getMessageCount('ERROR_REPORT')).toBeGreaterThan(0)
    }
    
    if (expectedPattern.shouldRecovery) {
      expect(result.metadata.recoveryAttempted).toBe(true)
    }
  }
}

// éŒ¯èª¤æ¨¡æ“¬å™¨
export class ErrorSimulator {
  // æ¨¡æ“¬ Service Worker çµ‚æ­¢
  simulateServiceWorkerTermination() {
    return new ServiceWorkerTerminationException('SW_TERMINATED_BY_BROWSER', {
      reason: 'memory_pressure',
      activeTasks: 3,
      memoryUsage: 45 * 1024 * 1024 // 45MB
    })
  }
  
  // æ¨¡æ“¬ Content Script æ³¨å…¥å¤±æ•—
  simulateContentScriptInjectionFailure(url, reason = 'permission_denied') {
    return new ContentScriptInjectionException('CONTENT_SCRIPT_INJECTION_FAILED', {
      targetUrl: url,
      reason,
      permissions: ['activeTab'],
      manifestVersion: 3
    })
  }
  
  // æ¨¡æ“¬å„²å­˜é…é¡è¶…é™
  simulateStorageQuotaExceeded(usage, quota) {
    return new StorageQuotaException('STORAGE_QUOTA_EXCEEDED', {
      currentUsage: usage,
      maxQuota: quota,
      utilizationRate: (usage / quota) * 100,
      dataCategories: ['books', 'logs', 'cache']
    })
  }
}
```

### 5. é©—æ”¶æ¨™æº–åˆ¶å®šéšæ®µ âœ…

#### åŠŸèƒ½æ­£ç¢ºæ€§é©—è­‰ (Chrome Extension ç‰¹åŒ–)

**è·¨ç’°å¢ƒéŒ¯èª¤è™•ç†é©—è­‰**ï¼š
- [ ] Background Service Worker å¯ä»¥æ­£ç¢ºè™•ç†è¨˜æ†¶é«”é™åˆ¶ç›¸é—œéŒ¯èª¤
- [ ] Content Script å¯ä»¥æ”¶é›†é é¢ä¸Šä¸‹æ–‡ä¸¦æ­£ç¢ºå‚³ééŒ¯èª¤
- [ ] Popup å¯ä»¥é¡¯ç¤ºä½¿ç”¨è€…å‹å–„çš„éŒ¯èª¤é€šçŸ¥ä¸¦æä¾›é©ç•¶å‹•ä½œ
- [ ] éŒ¯èª¤å¯ä»¥åœ¨ç’°å¢ƒé–“æ­£ç¢ºå‚³éä¸”ä¸å¤±çœŸ
- [ ] è·¨ç’°å¢ƒè¨Šæ¯å‚³éå…·å‚™è¶…æ™‚å’Œé‡è©¦æ©Ÿåˆ¶

**Chrome Extension API æ•´åˆé©—è­‰**ï¼š
- [ ] chrome.storage API éŒ¯èª¤æ­£ç¢ºåŒ…è£ç‚º StorageException
- [ ] chrome.runtime.sendMessage å¤±æ•—æ­£ç¢ºè™•ç†ç‚º MessagePipelineException  
- [ ] chrome.tabs API æ¬Šé™å•é¡Œæ­£ç¢ºè™•ç†ç‚º PermissionException
- [ ] Extension æ›´æ–°æˆ–åœç”¨æ™‚éŒ¯èª¤è™•ç†å™¨èƒ½å„ªé›…é—œé–‰
- [ ] Service Worker çµ‚æ­¢å’Œé‡å•Ÿæ™‚ç‹€æ…‹æ­£ç¢ºæ¢å¾©

**è¨˜æ†¶é«”å’Œæ•ˆèƒ½é©—è­‰**ï¼š
- [ ] éŒ¯èª¤ç‰©ä»¶åºåˆ—åŒ–å¤§å° < 1KB
- [ ] éŒ¯èª¤å¿«å–ç¸½å¤§å° < 1MB
- [ ] å¾ªç’°ç·©è¡å€æ­£ç¢ºæ¸…ç†èˆŠè³‡æ–™
- [ ] è¨˜æ†¶é«”ä½¿ç”¨é‡ç›£æ§å’Œè­¦å‘Šæ©Ÿåˆ¶æ­£å¸¸é‹ä½œ
- [ ] æ‰¹æ¬¡å‚³è¼¸æ©Ÿåˆ¶æœ‰æ•ˆæ¸›å°‘è¨Šæ¯å‚³éæ¬¡æ•¸

**ä½¿ç”¨è€…é«”é©—é©—è­‰**ï¼š
- [ ] éŒ¯èª¤é€šçŸ¥ä¸é˜»å¡ä½¿ç”¨è€…æ­£å¸¸æ“ä½œ
- [ ] éŒ¯èª¤è¨Šæ¯ç¬¦åˆå°ç£ä½¿ç”¨è€…çš„èªè¨€ç¿’æ…£
- [ ] éŒ¯èª¤é€šçŸ¥æ”¯æ´éµç›¤å°èˆªå’Œè¢å¹•é–±è®€å™¨
- [ ] é‡è©¦å’Œæ¢å¾©å‹•ä½œå¯ä»¥æ­£ç¢ºåŸ·è¡Œ
- [ ] éŒ¯èª¤ç‹€æ…‹è¿½è¹¤é˜²æ­¢é‡è¤‡é€šçŸ¥

#### æ•ˆèƒ½è¦æ±‚ (Chrome Extension å„ªåŒ–)

**è¨˜æ†¶é«”æ•ˆèƒ½è¦æ±‚**ï¼š
- Background Service Worker éŒ¯èª¤è™•ç†è¨˜æ†¶é«”å ç”¨ï¼š< 5MB
- Content Script éŒ¯èª¤è™•ç†è¨˜æ†¶é«”å ç”¨ï¼š< 1MB per page
- Popup éŒ¯èª¤è™•ç†è¨˜æ†¶é«”å ç”¨ï¼š< 500KB
- éŒ¯èª¤ç‰©ä»¶å»ºç«‹è¨˜æ†¶é«”åˆ†é…ï¼š< 1KB per error
- è¨˜æ†¶é«”æ¸…ç†éŸ¿æ‡‰æ™‚é–“ï¼š< 100ms

**è™•ç†æ™‚é–“è¦æ±‚**ï¼š
- æœ¬åœ°éŒ¯èª¤è™•ç†æ™‚é–“ï¼š< 1ms
- è·¨ç’°å¢ƒéŒ¯èª¤å‚³éæ™‚é–“ï¼š< 10ms
- éŒ¯èª¤æ¢å¾©å˜—è©¦æ™‚é–“ï¼š< 50ms
- UI éŒ¯èª¤é€šçŸ¥é¡¯ç¤ºæ™‚é–“ï¼š< 5ms
- æ‰¹æ¬¡éŒ¯èª¤è™•ç†æ™‚é–“ï¼š< 100ms (100å€‹éŒ¯èª¤)

**ä¸¦ç™¼æ•ˆèƒ½è¦æ±‚**ï¼š
- æ”¯æ´ 50+ ä¸¦ç™¼éŒ¯èª¤è™•ç† (Background)
- æ”¯æ´ 10+ ä¸¦ç™¼éŒ¯èª¤è™•ç† (Content per page)
- æ”¯æ´ 5+ ä¸¦ç™¼éŒ¯èª¤è™•ç† (Popup)
- è¨Šæ¯ä½‡åˆ—è™•ç†èƒ½åŠ›ï¼š1000+ messages/second
- éŒ¯èª¤èšåˆè™•ç†èƒ½åŠ›ï¼š500+ errors/minute

#### ä½¿ç”¨è€…é«”é©—æ¨™æº– (Chrome Extension ç‰¹åŒ–)

**é–‹ç™¼è€…å”ä½œé«”é©—**ï¼š
- æ–°å·¥ç¨‹å¸«èƒ½åœ¨ 1 å°æ™‚å…§ç†è§£éŒ¯èª¤è™•ç†æ¨™æº–
- éŒ¯èª¤è™•ç†ç¨‹å¼ç¢¼éµå¾ªçµ±ä¸€æ¨¡å¼ï¼Œç¨‹å¼ç¢¼å¯©æŸ¥æ•ˆç‡æå‡ 30%
- è·¨æ¨¡çµ„æ•´åˆæ™‚éŒ¯èª¤è™•ç†ä»‹é¢ä¸€è‡´ï¼Œæ¸›å°‘ 80% æ•´åˆå•é¡Œ
- éŒ¯èª¤é™¤éŒ¯è³‡è¨Šå®Œæ•´ï¼Œå•é¡Œå®šä½æ™‚é–“æ¸›å°‘ 50%

**ä½¿ç”¨è€…ä½¿ç”¨é«”é©—**ï¼š
- éŒ¯èª¤è¨Šæ¯ä½¿ç”¨å°ç£ç”¨æˆ¶ç†Ÿæ‚‰çš„è©å½™å’Œè¡¨é”æ–¹å¼
- éŒ¯èª¤é€šçŸ¥ä¸å¹²æ“¾æ­£å¸¸çš„æ›¸ç±æå–å’Œç®¡ç†æ“ä½œ
- å¯æ¢å¾©çš„éŒ¯èª¤æä¾›æ˜ç¢ºçš„é‡è©¦é¸é …å’ŒæˆåŠŸæ©Ÿç‡é ä¼°
- åš´é‡éŒ¯èª¤æä¾›æ›¿ä»£æ–¹æ¡ˆæˆ–è¯çµ¡æ”¯æ´çš„æ˜ç¢ºæŒ‡å¼•

**ç¶­è­·å’Œç›£æ§é«”é©—**ï¼š
- ç³»çµ±å¥åº·ç‹€æ…‹å¯ä»¥é€éçµæ§‹åŒ–æ—¥èªŒå¯¦æ™‚ç›£æ§
- éŒ¯èª¤è¶¨å‹¢åˆ†ææ”¯æ´é é˜²æ€§ç¶­è­·æ±ºç­–
- éŒ¯èª¤æ¨¡å¼è­˜åˆ¥æ”¯æ´ç³»çµ±å„ªåŒ–å’Œæ”¹é€²æ–¹å‘
- ç·Šæ€¥äº‹ä»¶éŸ¿æ‡‰æ™‚é–“ç¸®çŸ­ 60%ï¼ˆé€éæ¨™æº–åŒ–å›æ‡‰æµç¨‹ï¼‰

**å¯è¨ªå•æ€§é«”é©—**ï¼š
- éŒ¯èª¤é€šçŸ¥æ”¯æ´è¢å¹•é–±è®€å™¨å®Œæ•´èªéŸ³è¼¸å‡º
- éŒ¯èª¤å‹•ä½œæ”¯æ´ç´”éµç›¤æ“ä½œï¼ŒTab é †åºåˆç†
- éŒ¯èª¤è¨Šæ¯è‰²å½©å°æ¯”åº¦ç¬¦åˆ WCAG 2.1 AA æ¨™æº–
- éŒ¯èª¤ç‹€æ…‹è®ŠåŒ–æœ‰é©ç•¶çš„éŸ³æ•ˆæˆ–è§¸è¦ºåé¥‹æç¤º

---

## ğŸ“‹ äº¤æ¥çµ¦ sage-test-architect çš„æª¢æŸ¥é»

### è¨­è¨ˆå®Œæ•´æ€§ç¢ºèª âœ…

- [x] **åŠŸèƒ½éœ€æ±‚æ¸…æ¥šä¸”å…·é«”**: é‡æ–°å®šç¾©ç‚ºåœ˜éšŠå”ä½œæ¨™æº–åŒ–åŸºç¤è¨­æ–½ï¼Œæ˜ç¢ºæ¥­å‹™åƒ¹å€¼
- [x] **APIä»‹é¢å®šç¾©å®Œæ•´**: Chrome Extension ç‰¹åŒ–çš„è·¨ç’°å¢ƒéŒ¯èª¤è™•ç† API
- [x] **é‚Šç•Œæ¢ä»¶å…¨é¢è­˜åˆ¥**: æ¶µè“‹ Service Worker é™åˆ¶ã€Content Script éš”é›¢ã€Popup UI ç´„æŸ  
- [x] **é©—æ”¶æ¨™æº–æ˜ç¢ºå¯é©—è­‰**: å…·é«”çš„åŠŸèƒ½ã€æ•ˆèƒ½ã€ä½¿ç”¨è€…é«”é©—é©—è­‰æ¨™æº–

### Chrome Extension ç‰¹åŒ–è¨­è¨ˆäº¤ä»˜ç‰© âœ…

- [x] **è·¨ç’°å¢ƒæ¶æ§‹è¨­è¨ˆ**: Background/Content/Popup ä¸‰ç’°å¢ƒå”ä½œçš„éŒ¯èª¤è™•ç†æ¶æ§‹
- [x] **è¨˜æ†¶é«”å„ªåŒ–ç­–ç•¥**: å¾ªç’°ç·©è¡ã€éŒ¯èª¤å£“ç¸®ã€æ‰¹æ¬¡è™•ç†çš„å®Œæ•´æ–¹æ¡ˆ
- [x] **é€šè¨Šå”å®šè¨­è¨ˆ**: è·¨ç’°å¢ƒè¨Šæ¯å‚³éçš„æ¨™æº–æ ¼å¼å’Œè·¯ç”±æ©Ÿåˆ¶
- [x] **ä½¿ç”¨è€…é«”é©—æ•´åˆ**: Popup UI éŒ¯èª¤é¡¯ç¤ºå’Œäº’å‹•çš„å®Œæ•´æ–¹æ¡ˆ
- [x] **æ¸¬è©¦æ¡†æ¶æ•´åˆ**: Chrome Extension ç’°å¢ƒä¸‹çš„æ¸¬è©¦è¼”åŠ©å·¥å…·

### åœ˜éšŠå”ä½œæ¨™æº–åŒ–æˆæœ âœ…

- [x] **çµ±ä¸€éŒ¯èª¤è™•ç†æ¨¡å¼**: æ‰€æœ‰ç’°å¢ƒä½¿ç”¨ç›¸åŒçš„éŒ¯èª¤è™•ç†é¡åˆ¥å’Œæ–¹æ³•
- [x] **æ¨™æº–åŒ–å›æ‡‰æ ¼å¼**: è·¨æ¨¡çµ„é€šè¨Šä½¿ç”¨çµ±ä¸€çš„ OperationResult æ ¼å¼
- [x] **é›†ä¸­åŒ–æ–‡å­—ç®¡ç†**: æ‰€æœ‰ä½¿ç”¨è€…å¯è¦‹æ–‡å­—é›†ä¸­åœ¨å­—å…¸ç³»çµ±ç®¡ç†
- [x] **çµæ§‹åŒ–æ¸¬è©¦æ–¹æ³•**: æ‘’æ£„å­—ä¸²æ¯”å°ï¼Œä½¿ç”¨çµæ§‹åŒ–é©—è­‰æ–¹æ³•
- [x] **å¯è§€æ¸¬æ€§åŸºç¤è¨­æ–½**: å®Œæ•´çš„æ—¥èªŒã€ç›£æ§ã€åˆ†æåŸºç¤è¨­æ–½

---

## ğŸ¯ ä¸‹ä¸€éšæ®µï¼šsage-test-architect TDD Phase 2

### é‡æ–°è¨­è¨ˆæ‘˜è¦

**Domain é‡æ–°å®šä½**: Chrome Extension åœ˜éšŠå”ä½œæ¨™æº–åŒ–åŸºç¤è¨­æ–½  
**æ ¸å¿ƒåƒ¹å€¼**: å»ºç«‹é•·æœŸç©©å®šçš„æ¶æ§‹åŸºç¤ï¼Œçµ±ä¸€åœ˜éšŠé–‹ç™¼æ¨¡å¼  
**æŠ€è¡“ç‰¹è‰²**: è·¨ç’°å¢ƒéŒ¯èª¤è™•ç†ã€è¨˜æ†¶é«”å„ªåŒ–ã€ä½¿ç”¨è€…é«”é©—æ•´åˆ  
**è¨­è¨ˆè¤‡é›œåº¦**: é«˜ - æ¶‰åŠ Chrome Extension å¹³å°ç‰¹åŒ–å’Œå¤šç’°å¢ƒå”ä½œ  
**é æœŸæ•ˆç›Š**: é–‹ç™¼æ•ˆç‡æå‡ 40%ã€éŒ¯èª¤è™•ç†å“è³ªæå‡ 300%ã€ç¶­è­·æˆæœ¬é™ä½ 50%

### é—œéµè¨­è¨ˆç‰¹è‰²

1. **Chrome Extension å¹³å°ç‰¹åŒ–**: é‡å° Service Workerã€Content Scriptã€Popup çš„å°ˆé–€è¨­è¨ˆ
2. **è¨˜æ†¶é«”å„ªåŒ–æ¶æ§‹**: å¾ªç’°ç·©è¡ã€å£“ç¸®å„²å­˜ã€æ‰¹æ¬¡è™•ç†çš„å®Œæ•´è§£æ±ºæ–¹æ¡ˆ  
3. **è·¨ç’°å¢ƒå”ä½œæ©Ÿåˆ¶**: çµ±ä¸€çš„è¨Šæ¯è·¯ç”±å’ŒéŒ¯èª¤å‚³éç³»çµ±
4. **åœ˜éšŠå”ä½œæ¨™æº–åŒ–**: çµ±ä¸€çš„é–‹ç™¼æ¨¡å¼å’Œæ¸¬è©¦æ–¹æ³•ï¼Œæ¸›å°‘æºé€šæˆæœ¬
5. **é•·æœŸæ¼”åŒ–æ”¯æ´**: å¯æ“´å±•çš„æ¶æ§‹è¨­è¨ˆï¼Œæ”¯æ´æœªä¾†éœ€æ±‚è®ŠåŒ–

**é‡æ–°è¨­è¨ˆå®Œæˆï¼Œæº–å‚™é€²å…¥ TDD Phase 2 æ¸¬è©¦è¨­è¨ˆéšæ®µã€‚**

---

*å»ºç«‹æ—¥æœŸ: 2025-09-03*  
*Phase 1 é‡æ–°è¨­è¨ˆå®Œæˆæ™‚é–“: 2025-09-03*  
*é è¨ˆ Phase 2 é–‹å§‹: ç«‹å³*