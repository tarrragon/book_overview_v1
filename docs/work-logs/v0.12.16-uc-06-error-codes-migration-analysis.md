# 工作日誌 v0.12.16 - UC-06 ErrorCodes 系統遷移分析

**功能設計階段** | TDD Phase 1  
**建立日期**: 2025-09-16  
**負責人**: claude-sonnet-4 (TDD Phase 1 功能設計師)  

## 🎯 任務概述

**任務目標**: 評估 UC-06: 書籍資料檢視與管理的驗收文件是否需要按照新的 ErrorCodes 系統 v5.0.0 進行更新遷移。

## 📋 UC-06 現況分析

### 📄 現有驗收文件狀況

**文件路徑**: `docs/acceptance/uc-06/exceptions.md`

**發現的 StandardError 定義**:
1. `SYSTEM_OVERVIEW_RENDERING_FAILURE` - 系統渲染失敗
2. `DATA_SEARCH_INDEX_CORRUPTION` - 搜尋索引損壞
3. `SYSTEM_PAGINATION_OVERFLOW` - 分頁載入超出處理能力
4. `DATA_EDIT_VALIDATION_CONFLICT` - 編輯操作驗證失敗

### 🔍 與新 ErrorCodes 系統對應分析

**新 ErrorCodes v5.0.0 的 15 個核心代碼**:
```javascript
VALIDATION_ERROR, NETWORK_ERROR, STORAGE_ERROR, READMOO_ERROR, 
CHROME_ERROR, BOOK_ERROR, DOM_ERROR, FILE_ERROR, OPERATION_ERROR,
PERMISSION_ERROR, TIMEOUT_ERROR, PARSE_ERROR, CONNECTION_ERROR, 
CONFIG_ERROR, UNKNOWN_ERROR
```

## 🎨 錯誤代碼對應建議

### 1. SYSTEM_OVERVIEW_RENDERING_FAILURE → DOM_ERROR
**理由**: Overview 頁面渲染問題屬於 DOM 操作失敗類別
**新格式**:
```javascript
throw new Error(`${ErrorCodes.DOM_ERROR}: Overview 頁面渲染失敗`)
```

**詳細對應**:
- **原始場景**: 大量書籍資料渲染、記憶體不足、DOM 操作失敗
- **新分類邏輯**: DOM 操作相關的錯誤，包含虛擬滾動初始化失敗
- **觸發條件**: virtual_scrolling_initialization, 記憶體使用 90%+

### 2. DATA_SEARCH_INDEX_CORRUPTION → STORAGE_ERROR
**理由**: 搜尋索引損壞屬於資料儲存問題
**新格式**:
```javascript
throw new Error(`${ErrorCodes.STORAGE_ERROR}: 搜尋索引損壞，影響搜尋功能`)
```

**詳細對應**:
- **原始場景**: 搜尋索引檔案損壞、資料更新不同步、記憶體錯誤
- **新分類邏輯**: 儲存系統相關的索引檔案問題
- **恢復機制**: rebuildRequired: true, estimatedRebuildTime: '30s'

### 3. SYSTEM_PAGINATION_OVERFLOW → OPERATION_ERROR
**理由**: 分頁操作超出處理能力屬於操作執行錯誤
**新格式**:
```javascript
throw new Error(`${ErrorCodes.OPERATION_ERROR}: 分頁載入資料量超出處理能力`)
```

**詳細對應**:
- **原始場景**: 單頁資料量過大、渲染超時、效能瓶頸
- **新分類邏輯**: 系統操作能力限制問題
- **降級策略**: fallbackStrategy: 'reduce_page_size'

### 4. DATA_EDIT_VALIDATION_CONFLICT → VALIDATION_ERROR
**理由**: 編輯操作驗證失敗直接對應驗證錯誤類別
**新格式**:
```javascript
throw new Error(`${ErrorCodes.VALIDATION_ERROR}: 編輯操作驗證失敗`)
```

**詳細對應**:
- **原始場景**: 使用者輸入無效資料、格式不符合規範、邏輯衝突
- **新分類邏輯**: 資料驗證失敗，使用者輸入問題
- **使用者指引**: userInput: 'correctable', 提供修正建議

## 📊 遷移影響評估

### 🔍 測試檔案搜尋結果
- **發現**: 594 個 StandardError 引用分佈在 98 個測試檔案中
- **評估**: UC-06 相關測試可能分散在多個領域模組中

### 📋 需要更新的檔案類別

1. **驗收文件**:
   - `docs/acceptance/uc-06/exceptions.md` ✅ 已識別

2. **可能相關的測試檔案**:
   - UI 相關: `tests/unit/ui/overview-page.test.js`
   - 搜尋相關: `tests/unit/ui/search/` 資料夾下的測試
   - Export 相關: `tests/unit/export/` 相關檔案
   - 錯誤處理: `tests/unit/error-handling/` 相關測試

3. **實作程式碼**:
   - 需要進一步確認是否有對應的實作檔案使用這些錯誤代碼

## 🚀 TDD 遷移策略

### Phase 1: 功能設計階段 (當前)
- ✅ 錯誤代碼對應分析完成
- ✅ 遷移策略制定完成  
- 📝 需要制定驗收標準清單

### Phase 2: 測試設計階段
**交接給**: sage-test-architect
**需要測試的場景**:
1. DOM_ERROR: 渲染失敗恢復機制測試
2. STORAGE_ERROR: 搜尋索引重建功能測試  
3. OPERATION_ERROR: 分頁降級策略測試
4. VALIDATION_ERROR: 編輯驗證錯誤處理測試

### Phase 3: 實作階段
**需要更新的模組**:
- Overview 頁面渲染邏輯
- 搜尋索引管理系統
- 分頁載入控制器
- 資料編輯驗證器

### Phase 4: 整合測試階段
**跨模組整合驗證**:
- UI 與資料層的錯誤傳播
- 使用者體驗一致性確認

## 📈 工作量與優先級評估

### 🔥 高優先級 (Critical)
1. **VALIDATION_ERROR 遷移** - 影響使用者輸入體驗
2. **DOM_ERROR 遷移** - 影響核心渲染功能

### 🟡 中優先級 (High)  
3. **STORAGE_ERROR 遷移** - 影響搜尋功能，有重建機制
4. **OPERATION_ERROR 遷移** - 有降級策略，影響較小

### ⏱ 工作量預估
- **文件更新**: 2-3 小時 (4個錯誤代碼 + 測試案例)
- **測試重構**: 4-6 小時 (跨多個測試檔案)
- **實作更新**: 6-8 小時 (多個模組的錯誤處理邏輯)
- **整合驗證**: 2-4 小時 (跨模組測試)

**總計**: 14-21 小時

## 🎯 驗收標準制定

### 功能正確性驗證
1. **錯誤代碼映射正確性**: 每個舊錯誤代碼都正確對應到新的 ErrorCodes
2. **錯誤訊息保持語意**: 使用者看到的錯誤訊息不會降低可理解性
3. **恢復機制保留**: 原有的錯誤恢復和降級策略功能不變

### 效能要求
1. **錯誤處理效能**: 符合 v5.0.0 設計目標 (0.1-0.5ms 錯誤建立時間)
2. **記憶體使用**: 錯誤物件記憶體占用符合 400-1000 bytes 標準

### 使用者體驗標準  
1. **錯誤訊息一致性**: 所有 UC-06 相關錯誤使用統一的訊息格式
2. **恢復指引完整性**: degradedModeAvailable、rebuildRequired 等指引保持有效
3. **開發者體驗**: 錯誤除錯資訊完整且易於理解

## 📝 今日進度總結

**完成項目**:
- ✅ UC-06 驗收文件現況分析
- ✅ 4個 StandardError 與新 ErrorCodes 對應規劃
- ✅ TDD 階段性遷移策略制定
- ✅ 工作量評估與優先級排序
- ✅ 驗收標準建立

**待處理項目**:
- 🔄 需要 sage-test-architect 設計對應的測試案例
- 🔄 需要確認實際程式碼中的 StandardError 使用情況
- 🔄 需要與其他 UC 的錯誤處理協調一致性

## 🚨 風險與注意事項

1. **測試覆蓋風險**: 594 個 StandardError 引用分佈廣泛，需要系統性測試確保無遺漏
2. **使用者體驗風險**: 錯誤訊息變更可能影響使用者理解，需要仔細驗證
3. **跨模組依賴風險**: UC-06 與其他模組的錯誤處理互動需要整體考量
4. **效能回歸風險**: 確保新的錯誤處理不會影響 UI 渲染和搜尋效能

---

**工作狀態**: 🔄 Phase 1 功能設計完成，待交接 sage-test-architect  
**下一步**: 測試設計階段 (TDD Phase 2)  
**預計完成**: v0.12.29