# 📋 TDD 開發任務清單

## 🎯 開發原則

- 嚴格遵循 **Red-Green-Refactor** 循環
- 每個功能必須先寫測試（紅燈）
- 實現最小可用代碼讓測試通過（綠燈）  
- 重構優化代碼（重構）
- 所有測試必須保持通過狀態

## 📊 進度追蹤圖例

- ⭕ 待開始
- 🔴 紅燈 - 測試失敗
- 🟢 綠燈 - 測試通過
- 🔵 重構 - 代碼優化
- ✅ 完成

## 🏗 開發階段概覽

### 架構優先順序（事件驅動設計）
1. **🎭 階段一：事件系統核心** - 系統通信基礎
2. **📚 階段二：資料提取器** - 基於事件系統的資料提取
3. **🏗 階段三：Chrome Extension 基礎架構** - 整合事件系統
4. **💾 階段四：儲存系統** - 事件驅動的資料儲存
5. **🎨 階段五：UI 組件** - 使用者界面實現

---

## 🔴 優先級：修復失敗的測試（TDD 紅燈狀態）

### 0.1 修復當前失敗的測試

**依照TDD原則，必須先讓現有測試通過，才能繼續新功能開發**

- [x] ✅ **測試失敗**: Chrome Storage 配額錯誤處理
- [x] ✅ **實現**: 在 Chrome Storage 適配器中加入配額檢查
- [x] ✅ **驗證**: 確認測試通過
- [x] ✅ **重構**: 優化錯誤處理邏輯

- [x] ✅ **測試失敗**: localStorage 模擬機制修正
- [x] ✅ **實現**: 修正測試環境中的 localStorage 模擬
- [x] ✅ **驗證**: 確認測試通過
- [x] ✅ **重構**: 優化模擬機制

- [x] ✅ **測試失敗**: 資料格式驗證功能
- [x] ✅ **實現**: 建立書籍資料格式驗證函數
- [x] ✅ **驗證**: 確認測試通過
- [x] ✅ **重構**: 優化驗證邏輯

- [x] ✅ **已完成**: 無效書籍ID處理邏輯（多書城支援）
- [x] ✅ **實現**: 加入無效ID的檢查與處理
- [x] ✅ **驗證**: 確認測試通過
- [x] ✅ **重構**: 優化ID處理邏輯

#### TDD 循環追蹤 - 失敗測試修復

- [x] ✅ **已完成**: 實現儲存配額錯誤處理
- [x] ✅ 確認測試從紅燈變綠燈
- [x] ✅ 重構與優化程式碼
- [x] ✅ **已完成**: localStorage 模擬修正
- [x] ✅ 確認測試通過
- [x] ✅ 重構相關程式碼
- [x] ✅ **已完成**: 資料格式驗證功能
- [x] ✅ 確認測試通過
- [x] ✅ 重構相關程式碼
- [x] ✅ **已完成**: 多書城書籍ID處理邏輯
- [x] ✅ 確認測試通過
- [x] ✅ 重構相關程式碼

### 🎉 階段 0.1 完成：TDD測試框架 (50/50 測試通過)

---

## 🌐 多書城支援目標

### 支援書城

- [x] ✅ Readmoo - 架構已設計
- [ ] ⭕ 博客來、金石堂、Kobo 等 - 待開發

### 架構任務

- [x] ✅ 可配置書城支援系統
- [ ] ⭕ 書城適配器介面
- [ ] ⭕ 統一資料格式轉換器

---

## 🎭 階段一：事件系統核心實現

### 1.1 事件總線 (Event Bus) 核心

- [ ] ⭕ **測試**: EventBus 類別基本功能測試
  - [ ] 🔴 測試事件註冊功能
  - [ ] 🟢 實現事件註冊
  - [ ] 🔵 重構事件註冊邏輯
  - [ ] 🔴 測試事件觸發功能  
  - [ ] 🟢 實現事件觸發
  - [ ] 🔵 重構事件分發邏輯
  - [ ] 🔴 測試事件移除功能
  - [ ] 🟢 實現事件移除
  - [ ] 🔵 重構完整事件總線

#### 核心測試項目

- [ ] ⭕ 事件註冊與移除
- [ ] ⭕ 事件觸發與傳播
- [ ] ⭕ 事件優先級處理
- [ ] ⭕ 錯誤處理與隔離
- [ ] ⭕ 效能與記憶體管理

### 1.2 事件處理器基底類別

- [ ] ⭕ **測試**: EventHandler 抽象類別測試
  - [ ] 🔴 測試處理器介面規範
  - [ ] 🟢 實現 EventHandler 基底類別
  - [ ] 🔵 重構處理器架構
  - [ ] 🔴 測試統計功能
  - [ ] 🟢 實現執行統計
  - [ ] 🔵 重構統計邏輯

### 1.3 Chrome Extension 事件橋接

- [ ] ⭕ **測試**: ChromeEventBridge 跨上下文通訊測試
  - [ ] 🔴 測試 background ↔ content script 通訊
  - [ ] 🟢 實現跨上下文事件傳遞
  - [ ] 🔵 重構通訊機制
  - [ ] 🔴 測試 popup ↔ background 通訊
  - [ ] 🟢 實現彈出視窗通訊
  - [ ] 🔵 重構整體橋接邏輯

---

## 📚 階段二：資料提取器實現

### 2.1 書籍資料提取器 (基於事件系統)

- [ ] ⭕ **測試**: BookDataExtractor 核心功能測試
  - [ ] 🔴 測試 DOM 解析功能
  - [ ] 🟢 實現基本 DOM 解析
  - [ ] 🔵 重構解析邏輯
  - [ ] 🔴 測試書籍 ID 提取 (多書城支援)
  - [ ] 🟢 實現 ID 提取邏輯
  - [ ] 🔵 重構 ID 解析
  - [ ] 🔴 測試書名提取
  - [ ] 🟢 實現書名提取
  - [ ] 🔵 重構書名處理
  - [ ] 🔴 測試封面圖片提取
  - [ ] 🟢 實現封面提取
  - [ ] 🔵 重構圖片處理

#### 提取功能測試項目

- [ ] ⭕ 基本書籍資訊提取（ID、標題、封面）
- [ ] ⭕ 閱讀進度解析
- [ ] ⭕ 書籍類型識別（流式/版式）
- [ ] ⭕ 特殊標記識別（新書/完讀）
- [ ] ⭕ 事件觸發：`EXTRACTOR.DATA.EXTRACTED`
- [ ] ⭕ 錯誤處理與資料驗證
- [ ] ⭕ 批次處理與效能最佳化

### 3.2 進度資料提取器

- [ ] ⭕ **測試**: ProgressExtractor 測試
  - [ ] 🔴 測試進度百分比解析
  - [ ] 🟢 實現進度解析邏輯
  - [ ] 🔵 重構進度計算
  - [ ] 🔴 測試無效資料處理
  - [ ] 🟢 實現錯誤處理
  - [ ] 🔵 重構資料驗證

### 3.3 元資料提取器

- [ ] ⭕ **測試**: MetadataExtractor 測試
  - [ ] 🔴 測試頁面元資料解析
  - [ ] 🟢 實現元資料提取
  - [ ] 🔵 重構元資料處理
  - [ ] 🔴 測試時間戳生成
  - [ ] 🟢 實現時間戳功能
  - [ ] 🔵 重構時間處理邏輯

---

## 🏗 階段三：Chrome Extension 基礎架構

### 3.1 建立 Chrome Extension 基本檔案 (基於事件系統)

- [ ] ⭕ **測試**: 驗證 manifest.json 格式正確性
- [ ] ⭕ **實現**: 建立 manifest.json (Manifest V3)
- [ ] ⭕ **測試**: 驗證 background script 載入
- [ ] ⭕ **實現**: 建立基本 background service worker (事件驅動)
- [ ] ⭕ **測試**: 驗證 content script 注入
- [ ] ⭕ **實現**: 建立基本 content script (事件監聽)
- [ ] ⭕ **重構**: 優化檔案結構和命名

#### TDD 循環追蹤

- [ ] 🔴 寫測試 - manifest.json 驗證
- [ ] 🟢 實現功能 - 建立 manifest.json  
- [ ] 🔵 重構 - 優化配置
- [ ] 🔴 寫測試 - background script (事件系統整合)
- [ ] 🟢 實現功能 - service worker
- [ ] 🔵 重構 - 優化結構

### 3.2 建立專案建置與部署系統

- [ ] ⭕ **測試**: 驗證建置腳本功能
- [ ] ⭕ **實現**: scripts/build.js 建置腳本
- [ ] ⭕ **測試**: 驗證開發環境熱重載
- [ ] ⭕ **實現**: 開發模式配置
- [ ] ⭕ **重構**: 優化建置流程

---

## 💾 階段四：儲存系統實現

### 4.1 Chrome Storage 適配器 (事件驅動)

- [ ] ⭕ **測試**: ChromeStorageAdapter 測試
  - [ ] 🔴 測試資料儲存功能
  - [ ] 🟢 實現 Chrome Storage API 包裝
  - [ ] 🔵 重構儲存邏輯
  - [ ] 🔴 測試資料讀取功能
  - [ ] 🟢 實現資料讀取
  - [ ] 🔵 重構讀取邏輯
  - [ ] 🔴 測試配額管理
  - [ ] 🟢 實現配額檢查
  - [ ] 🔵 重構配額管理
  - [ ] ⭕ 事件觸發：`STORAGE.SAVE.COMPLETED`、`STORAGE.LOAD.COMPLETED`

### 4.2 Local Storage 適配器

- [ ] ⭕ **測試**: LocalStorageAdapter 測試
  - [ ] 🔴 測試 localStorage 操作
  - [ ] 🟢 實現 localStorage 包裝
  - [ ] 🔵 重構本地儲存邏輯
  - [ ] 🔴 測試序列化處理
  - [ ] 🟢 實現 JSON 序列化
  - [ ] 🔵 重構序列化邏輯

### 4.3 IndexedDB 適配器

- [ ] ⭕ **測試**: IndexedDBAdapter 測試
  - [ ] 🔴 測試資料庫連線
  - [ ] 🟢 實現 IndexedDB 初始化
  - [ ] 🔵 重構資料庫邏輯
  - [ ] 🔴 測試大量資料處理
  - [ ] 🟢 實現批次操作
  - [ ] 🔵 重構效能最佳化

### 4.4 儲存管理器

- [ ] ⭕ **測試**: StorageManager 統一介面測試
  - [ ] 🔴 測試適配器切換
  - [ ] 🟢 實現儲存管理器
  - [ ] 🔵 重構管理邏輯
  - [ ] 🔴 測試自動備份
  - [ ] 🟢 實現備份機制
  - [ ] 🔵 重構備份邏輯

---

## 🎨 階段五：UI 組件實現

### 5.1 彈出視窗 (Popup)

- [ ] ⭕ **測試**: Popup UI 元件測試
  - [ ] 🔴 測試狀態顯示元件
  - [ ] 🟢 實現狀態顯示
  - [ ] 🔵 重構狀態邏輯
  - [ ] 🔴 測試操作按鈕元件
  - [ ] 🟢 實現操作按鈕
  - [ ] 🔵 重構按鈕邏輯
  - [ ] 🔴 測試進度條元件
  - [ ] 🟢 實現進度顯示
  - [ ] 🔵 重構進度邏輯

### 5.2 Overview 頁面整合

- [ ] ⭕ **測試**: Overview 頁面元件測試
  - [ ] 🔴 測試書籍網格元件
  - [ ] 🟢 實現書籍展示
  - [ ] 🔵 重構展示邏輯
  - [ ] 🔴 測試搜尋功能
  - [ ] 🟢 實現搜尋邏輯
  - [ ] 🔵 重構搜尋演算法
  - [ ] 🔴 測試篩選功能
  - [ ] 🟢 實現篩選邏輯
  - [ ] 🔵 重構篩選演算法

### 5.3 匯出功能

- [ ] ⭕ **測試**: 資料匯出測試
  - [ ] 🔴 測試 CSV 匯出
  - [ ] 🟢 實現 CSV 匯出器
  - [ ] 🔵 重構匯出邏輯
  - [ ] 🔴 測試 JSON 匯出
  - [ ] 🟢 實現 JSON 匯出器
  - [ ] 🔵 重構檔案處理

---

## 🔧 階段六：錯誤處理與監控

### 6.1 錯誤處理系統

- [ ] ⭕ **測試**: EventErrorHandler 測試
  - [ ] 🔴 測試錯誤捕獲
  - [ ] 🟢 實現錯誤處理器
  - [ ] 🔵 重構錯誤邏輯
  - [ ] 🔴 測試斷路器模式
  - [ ] 🟢 實現斷路器
  - [ ] 🔵 重構恢復機制

### 6.2 效能監控

- [ ] ⭕ **測試**: EventPerformanceMonitor 測試
  - [ ] 🔴 測試效能指標收集
  - [ ] 🟢 實現效能監控
  - [ ] 🔵 重構監控邏輯
  - [ ] 🔴 測試效能警告
  - [ ] 🟢 實現警告機制
  - [ ] 🔵 重構警告邏輯

### 6.3 事件追蹤

- [ ] ⭕ **測試**: EventTracker 測試
  - [ ] 🔴 測試事件記錄
  - [ ] 🟢 實現事件追蹤
  - [ ] 🔵 重構追蹤邏輯
  - [ ] 🔴 測試資料匯出
  - [ ] 🟢 實現追蹤匯出
  - [ ] 🔵 重構匯出格式

---

## 🔗 階段七：整合測試與優化

### 7.1 端對端測試

- [ ] ⭕ **測試**: 完整資料提取流程測試
  - [ ] 🔴 測試使用者操作流程
  - [ ] 🟢 實現端對端測試
  - [ ] 🔵 重構測試腳本
  - [ ] 🔴 測試錯誤恢復流程
  - [ ] 🟢 實現錯誤測試
  - [ ] 🔵 重構錯誤處理

### 7.2 效能優化

- [ ] ⭕ **測試**: 效能基準測試
  - [ ] 🔴 測試大量資料處理
  - [ ] 🟢 實現效能優化
  - [ ] 🔵 重構最佳化邏輯
  - [ ] 🔴 測試記憶體使用
  - [ ] 🟢 實現記憶體最佳化
  - [ ] 🔵 重構資源管理

### 7.3 使用者體驗優化

- [ ] ⭕ **測試**: UX 互動測試
  - [ ] 🔴 測試載入狀態
  - [ ] 🟢 實現載入指示器
  - [ ] 🔵 重構使用者回饋
  - [ ] 🔴 測試錯誤訊息
  - [ ] 🟢 實現友善錯誤訊息
  - [ ] 🔵 重構訊息系統

---

## 📊 總體進度追蹤

### 整體完成度

- [ ] 🏗 階段一：Chrome Extension 基礎架構 (0%)
- [ ] 🎭 階段二：事件系統核心實現 (0%)
- [ ] 📚 階段三：資料提取器實現 (0%)
- [ ] 💾 階段四：儲存系統實現 (0%)
- [ ] 🎨 階段五：UI 組件實現 (0%)
- [ ] 🔧 階段六：錯誤處理與監控 (0%)
- [ ] 🔗 階段七：整合測試與優化 (0%)

### TDD 循環統計

- 🔴 紅燈階段: 0 個測試待實現
- 🟢 綠燈階段: 0 個功能待完成  
- 🔵 重構階段: 0 個項目待重構
- ✅ 已完成: 0 個項目

### 測試覆蓋率目標

- [ ] 單元測試覆蓋率 ≥ 90%
- [ ] 整合測試覆蓋率 ≥ 80%
- [ ] 端對端測試覆蓋率 ≥ 70%

---

## 🎯 當前焦點

**✅ 已完成的基礎工作：**

1. ✅ 建立專案檔案結構整理
2. ✅ 新增 .gitignore 檔案  
3. ✅ 將文件檔案整理到 docs/ 資料夾
4. ✅ 建立 CHANGELOG.md 版本記錄
5. ✅ 建立 .cursorrules 開發規範
6. ✅ 完成 TDD 測試框架建置與驗證
7. ✅ 確認紅燈狀態 - 4個功能測試失敗，等待實現

**🔴 當前紅燈狀態分析：**

- **總計測試**: 49個測試 (4個失敗，45個通過)
- **失敗原因**: 功能尚未實現（符合TDD預期）
- **已完成的功能** ✅:
  1. 儲存配額錯誤處理 (Chrome Storage)
  2. localStorage 模擬修正
  3. 資料格式驗證功能
  4. 無效書籍ID處理邏輯（多書城支援）

**🎉 TDD 基礎階段完成：100% 測試通過 (50/50)**

**🎯 下一階段：Chrome Extension 實現**

**TDD 提醒：**

- ❗ 絕對不能在沒有測試的情況下寫程式碼
- ❗ 每次只實現讓測試通過的最小程式碼
- ❗ 重構時必須保持所有測試通過
- ❗ 定期執行完整測試套件

---

**最後更新：** 2025-07-29
**版本：** v0.0.1
