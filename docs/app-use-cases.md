# APP版書庫管理系統用例文件

## 概述

本文件詳細描述APP版書庫管理系統的各項功能用例，採用**簡潔優先、功能可選**的設計理念。系統提供簡潔模式和管理模式雙介面，讓一般使用者能輕鬆瀏覽書庫，進階使用者可使用完整分類功能。

### 核心設計原則

- **異步優先**：資料立即呈現，詳細資訊背景補充
- **雙模式設計**：簡潔模式（預設）+ 管理模式（進階）
- **可選功能**：分類、標籤、筆記等為選用功能，不強制使用
- **平台整合**：統一管理數位和實體書籍

---

## UC-01: 匯入Chrome Extension書庫資料

### 基本資訊
- **用例ID**: UC-01
- **用例名稱**: 匯入Chrome Extension書庫資料  
- **主要行為者**: 使用者
- **利益關係人**: 使用者（獲得統一書庫管理）
- **前置條件**: 
  - 使用者已安裝APP版書庫管理系統
  - 使用者擁有Chrome Extension匯出的JSON檔案
- **成功保證**: 所有書籍立即可在簡潔模式書庫中瀏覽，詳細資訊背景補充

### 主要成功場景

1. **選擇檔案**
   - 使用者點擊「匯入資料」按鈕
   - 系統開啟檔案選擇器
   - 使用者選擇JSON檔案並確認

2. **檔案驗證與立即匯入**
   - 系統讀取並驗證JSON檔案格式
   - 檢查必要欄位：id, title, cover
   - **立即批量插入資料庫**：設定source_type為`digital`，platform_id為Readmoo
   - 顯示匯入成功訊息：「成功匯入 X 本書籍」

3. **背景資料補充**
   - **異步啟動**：為每本書籍查詢Google Books API
   - 補充作者、出版社、ISBN、描述等詳細資訊
   - 更新封面圖片URL（如果Google Books有更高解析度版本）
   - 使用者在簡潔模式下可看到載入指示器

4. **進入簡潔模式書庫**
   - 自動跳轉到簡潔模式書庫檢視
   - 顯示：封面、書名、Readmoo平台圖標
   - 背景補充資訊時顯示載入動畫
   - 使用者可立即開始瀏覽，無需等待API完成

### 替代流程

**3a. JSON格式錯誤**
- 3a1. 系統偵測到格式不符
- 3a2. 顯示具體錯誤訊息：「檔案格式不正確，請確認為Chrome Extension匯出的JSON檔案」
- 3a3. 返回檔案選擇步驟

**3b. 重複書籍處理**
- 3b1. 系統偵測到重複ID的書籍
- 3b2. 詢問使用者處理策略：「跳過重複」、「覆蓋現有」、「取消匯入」
- 3b3. 根據使用者選擇執行對應動作

**3c. 匯入中斷**
- 3c1. 使用者點擊取消或APP被中斷
- 3c2. 系統回滾已插入的資料
- 3c3. 顯示「匯入已取消」訊息

### 特殊需求
- **效能**: 1000本書籍的匯入時間應少於10秒
- **相容性**: 100%相容Chrome Extension v0.9.x匯出格式
- **錯誤恢復**: 支援匯入失敗自動回滾

---

## UC-02: 匯出書庫資料

### 基本資訊
- **用例ID**: UC-02
- **用例名稱**: 匯出書庫資料為JSON格式
- **主要行為者**: 使用者
- **前置條件**: 書庫中存在至少一本書籍
- **成功保證**: 產生與Chrome Extension相容的JSON檔案

### 主要成功場景

1. **啟動匯出**
   - 使用者進入「資料管理」頁面
   - 點擊「匯出資料」按鈕
   - 選擇匯出範圍：「全部書籍」或「指定來源」

2. **匯出設定**
   - 選擇匯出格式：JSON（預設）
   - 設定檔案名稱：「我的書庫_YYYYMMDD.json」
   - 選擇儲存位置

3. **資料處理**
   - 系統查詢符合條件的書籍
   - 轉換為Chrome Extension相容格式
   - 產生JSON檔案

4. **完成匯出**
   - 顯示匯出成功訊息
   - 提供「分享檔案」和「查看位置」選項
   - 記錄匯出歷史

### 替代流程

**1a. 空書庫**
- 1a1. 系統偵測書庫為空
- 1a2. 顯示提示：「書庫中沒有書籍，無法匯出」
- 1a3. 提供「匯入資料」快速連結

**3a. 儲存空間不足**
- 3a1. 系統檢測到儲存空間不足
- 3a2. 提示使用者清理空間或選擇其他位置
- 3a3. 使用者確認後重新執行匯出

---

## UC-03: ISBN條碼掃描新增書籍

### 基本資訊
- **用例ID**: UC-03
- **用例名稱**: 使用相機掃描ISBN條碼新增實體書籍
- **主要行為者**: 使用者
- **前置條件**: 
  - 裝置具備相機功能
  - 使用者已授權相機權限
- **成功保證**: 實體書籍立即新增到書庫，可在簡潔模式中瀏覽

### 主要成功場景

1. **啟動掃描**
   - 使用者點擊主畫面「掃描新增」按鈕
   - 系統檢查相機權限狀態
   - 開啟相機掃描介面

2. **掃描條碼與立即新增**
   - 畫面顯示相機預覽和掃描框
   - 使用者將ISBN條碼對準掃描框
   - 系統自動識別ISBN號碼並**立即新增書籍**
   - 顯示：「書籍已新增，正在查詢詳細資訊...」

3. **書籍立即可用**
   - 書籍以ISBN號碼作為暫時書名出現在書庫
   - 顯示「實體書」圖標和載入動畫
   - 設定source_type為`physical`
   - 使用者可立即在簡潔模式中看到新增的書籍

4. **背景資料補充**
   - **異步查詢**：系統調用Google Books API查詢詳細資訊
   - **自動更新**：查詢完成後更新書名、作者、封面、描述
   - **後續功能**：查詢失敗時使用Amazon API備用
   - **後續功能**：台灣出版品資料庫查詢

5. **無縫使用體驗**
   - 使用者無需等待API查詢完成
   - 書籍在背景更新時自動刷新顯示
   - 查詢失敗不影響書籍在書庫中的存在
   - 可隨時在管理模式中手動編輯資訊

### 替代流程

**1a. 相機權限未授權**
- 1a1. 系統檢測到權限未授權
- 1a2. 顯示權限請求對話框
- 1a3. 引導使用者到系統設定開啟權限
- 1a4. 使用者授權後返回掃描介面

**2a. 無法識別條碼**
- 2a1. 系統無法識別條碼內容
- 2a2. 顯示提示：「請確保條碼清晰可見」
- 2a3. 提供「手動輸入ISBN」選項
- 2a4. 使用者可輸入13位ISBN號碼

**3a. API查詢失敗**
- 3a1. Google Books API查詢無結果
- 3a2. 顯示：「找不到該ISBN的書籍資訊」
- 3a3. 提供「手動填寫資訊」選項
- 3a4. 使用者可手動輸入書籍基本資訊

**3b. 網路連接問題**
- 3b1. 系統偵測到網路不可用
- 3b2. 顯示：「網路連接異常，請檢查網路設定」
- 3b3. 提供「重試」和「離線新增」選項
- 3b4. 離線新增僅保存ISBN，待網路恢復後補充資訊

**4a. 重複書籍**
- 4a1. 系統檢查到ISBN已存在
- 4a2. 顯示現有書籍資訊
- 4a3. 詢問：「該書籍已存在，是否要更新資訊？」
- 4a4. 使用者選擇更新或取消

### 特殊需求
- **掃描效能**: 條碼識別時間應少於2秒
- **離線支援**: 支援離線記錄ISBN，線上時補充資訊
- **手動輸入**: 提供備用的手動ISBN輸入方式

---

## UC-04: 關鍵字搜尋補充書籍資訊

### 基本資訊
- **用例ID**: UC-04
- **用例名稱**: 使用關鍵字搜尋補充現有書籍詳細資訊
- **主要行為者**: 使用者  
- **前置條件**: 
  - 書庫中存在資訊不完整的書籍
  - 網路連接可用
- **成功保證**: 現有書籍資訊更新完成，原始來源標記保持不變

### 主要成功場景

1. **選擇書籍**
   - 使用者在書庫列表中瀏覽書籍
   - 識別資訊不完整的書籍（缺少作者、出版社等）
   - 點擊書籍右上角的「補充資訊」按鈕

2. **啟動搜尋**
   - 系統以現有書名作為關鍵字
   - 顯示搜尋確認：「將搜尋：《原書名》」
   - 使用者可修改搜尋關鍵字
   - 點擊「開始搜尋」

3. **API查詢處理**
   - 調用Google Books API進行關鍵字搜尋
   - 設定maxResults=10取得候選清單
   - 顯示載入狀態：「正在搜尋相關書籍...」

4. **展示候選清單**
   - 以卡片方式展示搜尋結果：
     - 書名匹配度高的優先顯示
     - 每個候選項顯示：標題、作者、出版社、封面
     - 相似度指標（書名匹配百分比）
   - 提供「這是正確的書」按鈕

5. **確認並更新**
   - 使用者選擇正確的書籍
   - 顯示更新預覽：新舊資訊對比
   - 確認後系統更新資料庫記錄
   - 保持原始source標記不變
   - 更新updated_at時間戳

6. **完成更新**
   - 顯示成功訊息：「書籍資訊已更新」
   - 返回更新後的書籍詳細頁面
   - 高亮顯示新增/修改的資訊欄位

### 替代流程

**2a. 書名過於簡短或模糊**
- 2a1. 系統提醒：「書名過短可能影響搜尋精度」
- 2a2. 建議使用者手動輸入更完整的搜尋關鍵字
- 2a3. 提供作者名字輔助搜尋選項

**4a. 無相關搜尋結果**
- 4a1. Google Books API返回空結果
- 4a2. 顯示：「找不到相關書籍」
- 4a3. 提供「嘗試其他關鍵字」選項
- 4a4. 建議「手動編輯資訊」作為替代方案

**4b. 搜尋結果過多但相關性低**
- 4b1. 系統分析返回結果的相關性
- 4b2. 若前3個結果匹配度都低於30%
- 4b3. 提示：「搜尋結果可能不準確，建議調整關鍵字」
- 4b4. 提供精確搜尋建議（加入作者、出版年等）

**5a. 使用者不確定正確書籍**
- 5a1. 使用者點擊「都不是我要的書」
- 5a2. 系統提供「修改搜尋條件」選項
- 5a3. 或者提供「手動編輯」書籍資訊功能

**5b. 選擇的書籍資訊有衝突**
- 5b1. 新資訊與現有資訊差異很大
- 5b2. 系統顯示衝突警告並列出差異項目
- 5b3. 使用者可選擇性接受部分更新
- 5b4. 或者選擇「保持原始資訊」

### 批次補充場景

**UC-04b: 批次補充多本書籍資訊**

1. **選擇批次模式**
   - 使用者在書庫管理頁面選擇「批次補充」
   - 系統自動篩選資訊不完整的書籍
   - 顯示候選清單供使用者勾選

2. **批次處理**
   - 使用者選擇要處理的書籍（最多20本）
   - 系統逐一進行API搜尋
   - 顯示整體進度：「正在處理：5/12」

3. **逐一確認**
   - 對每本書顯示搜尋結果
   - 使用者可選擇「自動選擇最佳匹配」
   - 或者手動確認每本書的候選選項

4. **批次更新**
   - 完成所有確認後執行批次更新
   - 顯示更新統計：「已更新12本書籍資訊」
   - 提供詳細更新報告

### 特殊需求
- **搜尋精度**: 書名相似度計算算法
- **API限制**: 實作Google Books API請求頻率控制
- **離線準備**: 將搜尋需求加入待辦清單，線上時處理

---

## UC-05: 雙模式書庫展示系統

### 基本資訊
- **用例ID**: UC-05
- **用例名稱**: 簡潔模式與管理模式書庫展示
- **主要行為者**: 使用者
- **前置條件**: 書庫中存在書籍資料
- **成功保證**: 提供適合不同使用者需求的雙模式介面

## 5A. 簡潔模式（預設模式）

### 設計目標
- **快速瀏覽**：專注於書籍發現和基本資訊
- **零學習成本**：直觀的介面，無需學習複雜功能
- **效能優先**：載入速度快，滑動流暢

### 展示內容
1. **書籍卡片**
   - **封面圖片**：Google Books API獲取的高解析度封面
   - **書名**：清晰易讀的字體
   - **來源標示**：平台圖標（Readmoo/Kindle/實體書等）
   - **載入狀態**：背景補充資料時的載入動畫

2. **基本功能**
   - **搜尋**：頂部搜尋框，支援書名搜尋
   - **篩選**：按來源平台快速篩選
   - **排序**：按新增時間或書名排序
   - **模式切換**：右上角「管理模式」按鈕

### 互動行為
- 點擊書籍：顯示基本資訊彈窗（書名、作者、簡介）
- 長按書籍：快速操作選單（刪除、查看詳細資訊）
- 下拉重新整理：同步最新資料
- 無限滾動：流暢的書籍載入

## 5B. 管理模式（進階功能）

### 設計目標
- **完整功能**：提供所有分類和管理功能
- **批次操作**：高效的批量處理能力
- **個人化管理**：支援複雜的分類和標籤系統

### 展示內容
1. **詳細書籍卡片**
   - 完整書籍資訊（作者、出版社、ISBN等）
   - **重要程度顯示**：7級重要性標記
   - **閱讀進度**：狀態和進度條
   - **標籤系統**：彩色標籤顯示
   - **個人筆記**：筆記摘要預覽
   - **借閱資訊**：borrower_name等詳細資訊

2. **進階功能**
   - **多維度篩選**：組合重要程度、閱讀狀態、標籤等
   - **批次選擇**：多選書籍進行批量操作
   - **統計分析**：書庫統計和閱讀分析
   - **匯出功能**：選擇性資料匯出

### 管理操作
- **分類設定**：重要程度、閱讀狀態設定
- **標籤管理**：新增/編輯/刪除標籤
- **筆記編輯**：個人心得和筆記記錄
- **借閱管理**：記錄借書和還書資訊
- **批次操作**：批量修改分類或標籤

## 5C. 模式切換與記憶

### 切換機制
- **入口點**：右上角顯著的模式切換按鈕
- **即時切換**：無需重新載入，即時切換檢視
- **狀態保持**：切換時保持當前篩選和排序狀態

### 使用者偏好
- **預設模式記憶**：記住使用者偏好的預設模式
- **情境化建議**：新使用者推薦簡潔模式，進階使用者自動提供管理模式
- **功能引導**：在簡潔模式中適時提示管理模式功能

### 替代流程

**1a. 空書庫狀態**
- 1a1. 系統偵測到書庫為空
- 1a2. 顯示友善的空狀態插圖
- 1a3. 提供明確的行動指引：「匯入資料」、「掃描新增」
- 1a4. 簡要介紹APP功能特色

**3a. 搜尋無結果**
- 3a1. 使用者搜尋關鍵字無匹配結果
- 3a2. 顯示「沒有找到相關書籍」
- 3a3. 提供搜尋建議：檢查拼寫、嘗試其他關鍵字
- 3a4. 提供「重置篩選條件」選項

**4a. 書籍資訊不完整**
- 4a1. 某些欄位為空（如作者、出版社）
- 4a2. 顯示「資訊待補充」提示
- 4a3. 提供「補充資訊」快速連結
- 4a4. 指向UC-04搜尋補充功能

### 特殊需求
- **效能**: 1000本書籍列表載入時間<3秒
- **記憶體**: 圖片懶載入避免記憶體問題
- **無障礙**: 支援螢幕閱讀器和高對比模式

---

## UC-06: 借閱管理系統

### 基本資訊
- **用例ID**: UC-06  
- **用例名稱**: 管理圖書館借書和個人借書記錄
- **主要行為者**: 使用者（管理模式）
- **前置條件**: 
  - 書籍已存在於書庫中
  - 使用者在管理模式
  - 書籍source_type為`borrowed`
- **成功保證**: 借閱記錄完整追蹤，支援到期提醒和歸還管理

## 6A. 圖書館借書管理

### 主要成功場景

1. **新增圖書館借書記錄**
   - 使用者在管理模式中選擇書籍
   - 點擊「設定為借閱書籍」
   - 選擇借閱類型：「從圖書館借閱」
   - 填寫借閱資訊：
     - 圖書館名稱（如：台北市立圖書館總館）
     - 借閱日期（預設今日）
     - 到期日期（必填）
     - 借閱備註（可選）

2. **借閱狀態顯示**
   - 簡潔模式：顯示「圖書館」圖標
   - 管理模式：完整借閱資訊卡片
   - 到期提醒：
     - 綠色：7天以上
     - 黃色：3-7天  
     - 紅色：3天內或已逾期

3. **歸還記錄**
   - 使用者點擊「標記為已歸還」
   - 系統記錄歸還日期
   - 更新書籍狀態為已歸還
   - 借閱記錄保留作為歷史

## 6B. 個人借書管理

### 主要成功場景

1. **記錄借給朋友的書**
   - 選擇書籍並設定為「借給他人」
   - 填寫借閱者姓名
   - 設定預期歸還日期
   - 可新增聯絡方式和備註

2. **借書追蹤**
   - 在管理模式中顯示借出清單
   - 支援按借閱者篩選
   - 提供到期提醒功能
   - 可發送歸還提醒（後續功能）

3. **收回記錄**
   - 朋友歸還後標記為已收回
   - 記錄實際歸還日期
   - 書籍重新回到個人書庫

### 特殊處理

#### 已賣出書籍
- 借閱類型：特殊標記為「已賣出」
- 不設定到期日期，記錄出售日期
- 在管理模式中可查看出售歷史
- 支援出售價格和購買者資訊記錄

---

## UC-07: 跨平台資料同步準備

### 基本資訊
- **用例ID**: UC-07  
- **用例名稱**: 準備跨裝置資料同步機制
- **主要行為者**: 系統（自動）
- **利益關係人**: 使用者（未來獲得多裝置同步）
- **前置條件**: 本地資料庫已建立且包含書籍和借閱資料
- **成功保證**: 資料同步準備就緒，包含借閱記錄同步

### 主要成功場景

1. **資料同步狀態管理**
   - 每本書籍記錄同步狀態：`local`, `synced`, `conflict`
   - 自動維護時間戳：`created_at`, `updated_at`, `last_sync_at`
   - 追蹤本地變更，標記需要同步的記錄

2. **增量變更追蹤**
   - 資料庫觸發器自動更新`updated_at`
   - 識別自上次同步後的變更記錄
   - 生成變更摘要供同步使用

3. **衝突預防機制**
   - 本地優先策略：離線變更優先於雲端
   - 時間戳比較確定數據新舊
   - 為複雜衝突預留手動解決介面

4. **同步準備檢查**
   - 系統定期檢查資料一致性
   - 驗證關鍵欄位完整性
   - 預先標記可能的同步問題

### 設計考量

**資料一致性保證**
- 使用UUID作為跨裝置唯一識別
- 保留原始Chrome Extension的ID映射
- 變更日誌記錄所有修改操作

**網路適應性**
- 支援間歇性網路連接
- 批次同步減少API呼叫
- 智慧重試機制處理網路失敗

**隱私和安全**
- 本地資料加密存儲
- 為未來端到端加密預留架構
- 使用者可控制同步範圍和頻率

### 未來擴展準備

**雲端同步API介面設計**
```
POST /api/sync/books
GET /api/sync/books?since={timestamp}
PUT /api/sync/books/{id}
```

**衝突解決策略**
- Last-Write-Wins（簡單場景）
- User-Choose（複雜場景）
- Field-Level-Merge（進階功能）

---

## 系統整體工作流程

### 典型使用者旅程

1. **首次使用**
   - 下載並安裝APP
   - 匯入Chrome Extension資料（UC-01）
   - 瀏覽書庫確認資料正確（UC-05）

2. **日常使用**
   - 購買實體書後掃描ISBN新增（UC-03）
   - 定期補充書籍詳細資訊（UC-04）
   - 瀏覽和管理個人書庫（UC-05）

3. **資料管理**
   - 定期匯出備份（UC-02）
   - 清理重複或錯誤資料
   - 準備跨裝置同步（UC-06）

### 跨用例交互

- **UC-01 → UC-05**: 匯入完成後自動跳轉書庫頁面
- **UC-03 → UC-04**: 掃描新增後可立即補充詳細資訊
- **UC-05 → UC-04**: 書庫瀏覽時發現並補充不完整資訊
- **UC-05 → UC-02**: 書庫管理中觸發匯出操作

### 錯誤處理和恢復

**網路相關錯誤**
- API呼叫失敗：自動重試3次，指數退避
- 網路中斷：離線模式，恢復後自動同步
- 超時處理：30秒超時，提供手動重試

**資料相關錯誤**
- 格式錯誤：詳細錯誤提示，指導修正
- 重複資料：智慧合併或使用者選擇
- 資料庫錯誤：事務回滾，錯誤報告

**使用者介面錯誤**
- 權限拒絕：清楚說明並指導授權
- 操作失敗：提供明確的下一步建議
- 載入失敗：重試機制和離線提示

---

## 非功能需求

### 效能要求
- 應用程式啟動時間：<3秒
- 書庫列表載入：1000本書<5秒
- ISBN掃描識別：<2秒
- API回應時間：Google Books API<5秒

### 可用性要求
- 離線功能：核心瀏覽功能離線可用
- 多語言：支援繁體中文、英文
- 無障礙：符合WCAG 2.1 AA級標準
- 響應式：適應不同螢幕尺寸

### 安全性要求
- 資料加密：SQLite資料庫加密存儲
- 網路安全：HTTPS通訊，憑證驗證
- 隱私保護：不收集使用者個人資料
- 權限最小化：僅申請必要系統權限

### 相容性要求
- 平台支援：iOS 12+, Android 8+, Windows 10+, macOS 10.15+
- 資料格式：100%相容Chrome Extension JSON格式
- API版本：Google Books API v1穩定支援
- 資料庫：SQLite 3.x跨平台相容性

---

## 總結

本用例文件涵蓋了APP版書庫管理系統的完整功能場景，從基本的資料匯入匯出，到進階的智慧搜尋和跨平台準備。每個用例都經過詳細的場景分析和替代流程設計，確保系統在各種情況下都能提供良好的使用者體驗。

配合需求規格書的TDD開發方法，這些用例將指導具體的測試案例撰寫和功能實現，確保最終產品符合使用者需求並具備高品質的使用者體驗。