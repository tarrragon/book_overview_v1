<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç€è¦½å™¨ç›¸å®¹æ€§æ¸¬è©¦</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Chrome Extension ç€è¦½å™¨ç›¸å®¹æ€§æ¸¬è©¦</h1>
    
    <div id="testResults"></div>

    <!-- è¼‰å…¥æ¸¬è©¦çš„ JavaScript æª”æ¡ˆ -->
    <script src="src/core/event-bus.js"></script>
    <script src="src/core/chrome-event-bridge.js"></script>
    <script src="src/core/event-handler.js"></script>
    <script src="src/overview/overview-page-controller.js"></script>
    
    <script>
        (function() {
            'use strict';
            
            const results = [];
            const resultsContainer = document.getElementById('testResults');
            
            function addResult(test, status, message, error) {
                results.push({ test, status, message, error });
                const div = document.createElement('div');
                div.className = `test-result ${status}`;
                
                let content = `<strong>${test}</strong>: ${message}`;
                if (error) {
                    content += `<pre>${error}</pre>`;
                }
                
                div.innerHTML = content;
                resultsContainer.appendChild(div);
            }
            
            // æ¸¬è©¦ 1: æª¢æŸ¥å…¨åŸŸè®Šæ•¸æ˜¯å¦æ­£ç¢ºå®šç¾©
            try {
                if (typeof window.EventBus === 'function') {
                    addResult('EventBus å…¨åŸŸè®Šæ•¸', 'success', 'âœ… EventBus å·²æ­£ç¢ºå®šç¾©ç‚ºå…¨åŸŸè®Šæ•¸');
                } else {
                    addResult('EventBus å…¨åŸŸè®Šæ•¸', 'error', 'âŒ EventBus æœªå®šç¾©æˆ–ä¸æ˜¯å‡½æ•¸');
                }
            } catch (e) {
                addResult('EventBus å…¨åŸŸè®Šæ•¸', 'error', 'âŒ æª¢æŸ¥ EventBus æ™‚ç™¼ç”ŸéŒ¯èª¤', e.message);
            }
            
            // æ¸¬è©¦ 2: æª¢æŸ¥ ChromeEventBridge
            try {
                if (typeof window.ChromeEventBridge === 'function') {
                    addResult('ChromeEventBridge å…¨åŸŸè®Šæ•¸', 'success', 'âœ… ChromeEventBridge å·²æ­£ç¢ºå®šç¾©ç‚ºå…¨åŸŸè®Šæ•¸');
                } else {
                    addResult('ChromeEventBridge å…¨åŸŸè®Šæ•¸', 'error', 'âŒ ChromeEventBridge æœªå®šç¾©æˆ–ä¸æ˜¯å‡½æ•¸');
                }
            } catch (e) {
                addResult('ChromeEventBridge å…¨åŸŸè®Šæ•¸', 'error', 'âŒ æª¢æŸ¥ ChromeEventBridge æ™‚ç™¼ç”ŸéŒ¯èª¤', e.message);
            }
            
            // æ¸¬è©¦ 3: æª¢æŸ¥ EventHandler
            try {
                if (typeof window.EventHandler === 'function') {
                    addResult('EventHandler å…¨åŸŸè®Šæ•¸', 'success', 'âœ… EventHandler å·²æ­£ç¢ºå®šç¾©ç‚ºå…¨åŸŸè®Šæ•¸');
                } else {
                    addResult('EventHandler å…¨åŸŸè®Šæ•¸', 'error', 'âŒ EventHandler æœªå®šç¾©æˆ–ä¸æ˜¯å‡½æ•¸');
                }
            } catch (e) {
                addResult('EventHandler å…¨åŸŸè®Šæ•¸', 'error', 'âŒ æª¢æŸ¥ EventHandler æ™‚ç™¼ç”ŸéŒ¯èª¤', e.message);
            }
            
            // æ¸¬è©¦ 4: æª¢æŸ¥ OverviewPageController
            try {
                if (typeof window.OverviewPageController === 'function') {
                    addResult('OverviewPageController å…¨åŸŸè®Šæ•¸', 'success', 'âœ… OverviewPageController å·²æ­£ç¢ºå®šç¾©ç‚ºå…¨åŸŸè®Šæ•¸');
                } else {
                    addResult('OverviewPageController å…¨åŸŸè®Šæ•¸', 'error', 'âŒ OverviewPageController æœªå®šç¾©æˆ–ä¸æ˜¯å‡½æ•¸');
                }
            } catch (e) {
                addResult('OverviewPageController å…¨åŸŸè®Šæ•¸', 'error', 'âŒ æª¢æŸ¥ OverviewPageController æ™‚ç™¼ç”ŸéŒ¯èª¤', e.message);
            }
            
            // æ¸¬è©¦ 5: å˜—è©¦å¯¦ä¾‹åŒ– EventBus
            try {
                const eventBus = new window.EventBus();
                if (eventBus && typeof eventBus.on === 'function' && typeof eventBus.emit === 'function') {
                    addResult('EventBus å¯¦ä¾‹åŒ–', 'success', 'âœ… EventBus å¯ä»¥æ­£å¸¸å¯¦ä¾‹åŒ–ä¸¦å…·æœ‰å¿…è¦æ–¹æ³•');
                } else {
                    addResult('EventBus å¯¦ä¾‹åŒ–', 'error', 'âŒ EventBus å¯¦ä¾‹åŒ–æˆåŠŸä½†ç¼ºå°‘å¿…è¦æ–¹æ³•');
                }
            } catch (e) {
                addResult('EventBus å¯¦ä¾‹åŒ–', 'error', 'âŒ EventBus å¯¦ä¾‹åŒ–å¤±æ•—', e.message);
            }
            
            // æ¸¬è©¦ 6: å˜—è©¦å¯¦ä¾‹åŒ– OverviewPageController
            try {
                const eventBus = new window.EventBus();
                const controller = new window.OverviewPageController(eventBus, document);
                
                if (controller && typeof controller.getSupportedEvents === 'function') {
                    addResult('OverviewPageController å¯¦ä¾‹åŒ–', 'success', 'âœ… OverviewPageController å¯ä»¥æ­£å¸¸å¯¦ä¾‹åŒ–');
                } else {
                    addResult('OverviewPageController å¯¦ä¾‹åŒ–', 'error', 'âŒ OverviewPageController å¯¦ä¾‹åŒ–æˆåŠŸä½†ç¼ºå°‘å¿…è¦æ–¹æ³•');
                }
            } catch (e) {
                addResult('OverviewPageController å¯¦ä¾‹åŒ–', 'error', 'âŒ OverviewPageController å¯¦ä¾‹åŒ–å¤±æ•—', e.message);
            }
            
            // æ¸¬è©¦ 7: æª¢æŸ¥æ¨¡çµ„ç³»çµ±éŒ¯èª¤
            try {
                if (typeof module !== 'undefined' && typeof require !== 'undefined') {
                    addResult('æ¨¡çµ„ç³»çµ±æª¢æŸ¥', 'warning', 'âš ï¸ æª¢æ¸¬åˆ° Node.js æ¨¡çµ„ç³»çµ±ï¼Œé€™åœ¨æ­£å¸¸ç€è¦½å™¨ç’°å¢ƒä¸­ä¸æ‡‰å­˜åœ¨');
                } else {
                    addResult('æ¨¡çµ„ç³»çµ±æª¢æŸ¥', 'success', 'âœ… æ²’æœ‰æª¢æ¸¬åˆ° Node.js æ¨¡çµ„ç³»çµ±éŒ¯èª¤');
                }
            } catch (e) {
                addResult('æ¨¡çµ„ç³»çµ±æª¢æŸ¥', 'success', 'âœ… æ¨¡çµ„ç³»çµ±æª¢æŸ¥æ­£å¸¸ï¼ˆé æœŸéŒ¯èª¤ï¼‰');
            }
            
            // çµ±è¨ˆçµæœ
            const successCount = results.filter(r => r.status === 'success').length;
            const errorCount = results.filter(r => r.status === 'error').length;
            const warningCount = results.filter(r => r.status === 'warning').length;
            
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'test-result';
            summaryDiv.className += errorCount > 0 ? ' error' : ' success';
            summaryDiv.innerHTML = `
                <h3>ğŸ“Š æ¸¬è©¦ç¸½çµ</h3>
                <p>ç¸½å…±é€²è¡Œ ${results.length} é …æ¸¬è©¦ï¼š</p>
                <ul>
                    <li>âœ… æˆåŠŸï¼š${successCount} é …</li>
                    <li>âŒ å¤±æ•—ï¼š${errorCount} é …</li>
                    <li>âš ï¸ è­¦å‘Šï¼š${warningCount} é …</li>
                </ul>
                ${errorCount === 0 ? '<p><strong>ğŸ‰ æ‰€æœ‰æ¸¬è©¦éƒ½é€šéäº†ï¼ç€è¦½å™¨ç›¸å®¹æ€§ä¿®å¾©æˆåŠŸã€‚</strong></p>' : '<p><strong>ğŸš¨ ä»æœ‰éŒ¯èª¤éœ€è¦ä¿®å¾©ã€‚</strong></p>'}
            `;
            
            resultsContainer.insertBefore(summaryDiv, resultsContainer.firstChild);
            
        })();
    </script>
</body>
</html>