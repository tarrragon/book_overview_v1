---
id: decision-suspend-semantic-path-fix-tests-first
type: decision
title: 決策暫停語意化路徑修正專案優先修復測試
created: 2025-09-07
tags: [decision, path-migration, testing, priority, crisis-management]
---

# 決策暫停語意化路徑修正專案優先修復測試

## 一句話說明

> 基於測試通過率鐵律和架構債務零容忍原則，決定立即暫停語意化路徑修正工作，優先恢復 100% 測試通過率

## 上下文連結

- 基於：[[語意化路徑修正遭遇Jest環境解析失敗危機]]
- 導致：[[測試通過率恢復行動計畫啟動]]
- 相關：[[路徑規範文件存在內部矛盾需要統一]]

## 核心內容

### 🚨 **決策背景**

#### **危機觸發條件**

1. **測試通過率鐵律違反**：
   - 專案核心原則：100% 測試通過率是最低標準
   - 當前狀況：語意化路徑修正導致多個測試失敗
   - 違反程度：Critical - 需立即處理

2. **架構債務累積風險**：
   - 專案原則：架構問題 = 立即停止功能開發
   - 當前問題：Jest 環境路徑解析技術問題
   - 累積風險：技術債務會隨時間指數增長

3. **規範文件可信度危機**：
   - 發現規範文件內部標準矛盾
   - 實施過程出現決策混亂
   - 影響整體開發流程的穩定性

### 🎯 **決策內容**

#### **立即生效的決策**

1. **暫停語意化路徑修正**：
   - **範圍**：所有 JavaScript require 語句路徑修正
   - **時間**：立即生效，直到技術問題解決
   - **例外**：無例外情況

2. **測試通過率恢復優先**：
   - **目標**：恢復並維持 100% 測試通過率
   - **方法**：回退到相對路徑格式
   - **驗證**：每個修正檔案都必須通過測試

3. **技術可行性重新評估**：
   - **重點**：Jest 環境路徑解析機制分析
   - **目標**：找到穩定且一致的路徑策略
   - **標準**：必須同時支援 Jest 和 Node.js 環境

#### **決策理由分析**

**理由A: 遵循專案核心原則**
- 專案 CLAUDE.md 明確規定測試通過率鐵律
- 架構債務零容忍原則不允許妥協
- 品質標準不能因為功能需求而降低

**理由B: 技術現實考量**
- Jest 環境路徑解析問題超出預期
- moduleNameMapper 配置方案未能解決問題
- 需要更深入的技術分析和驗證

**理由C: 風險管控**
- 繼續實施可能導致更多檔案受影響
- 修復成本會隨影響範圍擴大而增長
- 及早停止避免技術債務累積

**理由D: 規範一致性**
- 規範文件存在內部矛盾需要修正
- 實施標準不明確導致執行混亂
- 需要統一和明確的實施指引

### 📋 **執行計畫**

#### **Phase 1: 緊急修復 (24小時內)**

**目標**: 恢復 100% 測試通過率

**行動清單**:
1. **識別受影響檔案**：
   - 掃描所有使用語意化路徑的檔案
   - 建立完整的修復清單

2. **逐一回退修正**：
   - 將 `require('./src/...)` 改回相對路徑
   - 將 `require('src/...')` 改回相對路徑
   - 每個檔案修正後立即執行測試驗證

3. **測試全面驗證**：
   - 執行完整測試套件
   - 確認所有測試通過
   - 記錄修復過程和結果

#### **Phase 2: 技術分析 (3-5天內)**

**目標**: 深度分析技術可行性

**分析重點**:
1. **Jest 配置深度分析**：
   - 研究 Jest 模組解析機制
   - 測試各種 moduleNameMapper 配置
   - 評估自訂 resolver 的可行性

2. **路徑格式比較分析**：
   - `src/` vs `./src/` 的技術差異
   - Node.js 和 Jest 環境相容性
   - 第三方工具支援度評估

3. **替代方案探索**：
   - 考慮 webpack alias 等工具
   - 評估 TypeScript path mapping
   - 研究其他專案的最佳實踐

#### **Phase 3: 規範統一 (1-2天內)**

**目標**: 修正規範文件矛盾

**行動項目**:
1. **規範文件審查**：
   - 檢查所有相關規範文件
   - 識別其他可能的矛盾

2. **標準統一制定**：
   - 基於技術分析結果確定單一標準
   - 更新所有相關規範文件

3. **範例更新**：
   - 修正所有範例和模板
   - 確保一致性和準確性

#### **Phase 4: 重新實施 (時間待定)**

**前提條件**: 
- Phase 1-3 全部完成
- 技術方案經過充分驗證
- 規範標準完全統一

**實施原則**:
- 小批次漸進式修正
- 每批次後完整測試驗證
- 保持 100% 測試通過率

### 🔍 **決策影響評估**

#### **正面影響**

1. **品質標準維護**：
   - 維持專案品質鐵律
   - 避免技術債務累積
   - 保持開發流程穩定

2. **風險有效控制**：
   - 避免影響範圍擴大
   - 降低修復成本
   - 防範後續問題

3. **規範完善契機**：
   - 修正規範文件矛盾
   - 提升文件品質
   - 建立更嚴格的品質控制

#### **負面影響**

1. **進度延遲**：
   - 語意化路徑目標暫時延後
   - 需要額外時間進行技術分析
   - 可能影響其他相關改善項目

2. **工作重複**：
   - 已修正的檔案需要回退
   - 後續可能需要重新修正
   - 增加總體工作量

#### **風險緩解措施**

1. **進度影響緩解**：
   - 並行進行技術分析
   - 優先解決規範問題
   - 制定更有效的實施策略

2. **重複工作最小化**：
   - 詳細記錄修復過程
   - 建立自動化檢查工具
   - 制定批次處理腳本

### 📊 **成功標準**

#### **短期成功標準 (1週內)**

1. **測試通過率**：100% 恢復並維持
2. **規範一致性**：所有規範文件無矛盾
3. **技術方案**：確定可行的路徑策略

#### **中期成功標準 (1個月內)**

1. **語意化路徑**：基於穩定方案重新實施
2. **自動化工具**：建立路徑修正檢查工具
3. **流程完善**：建立規範制定和維護流程

#### **長期成功標準 (3個月內)**

1. **專案品質**：維持更高的程式碼品質標準
2. **開發效率**：語意化路徑帶來的效率提升
3. **流程成熟**：建立完善的品質控制機制

### 🎓 **經驗教訓**

1. **技術驗證的重要性**：
   - 規範制定前必須進行充分的技術驗證
   - 不能僅基於理論制定實施標準

2. **規範一致性的關鍵性**：
   - 規範文件的內部一致性至關重要
   - 需要建立更嚴格的文件品質控制

3. **漸進式改善的智慧**：
   - 大規模變更需要更謹慎的計畫和執行
   - 小批次驗證比一次性修改更安全

4. **品質原則的堅持**：
   - 專案品質原則不能因為功能需求而妥協
   - 及時停止是避免更大損失的智慧決定

## 關鍵文件

- `CLAUDE.md` - 專案核心原則和品質標準
- `memory/語意化路徑修正遭遇Jest環境解析失敗危機.md` - 危機詳細分析
- `docs/claude/format-fix-examples.md` - 已修正的規範文件
- `package.json` - Jest 配置相關