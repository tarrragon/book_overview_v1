# Platform Domain æ¸¬è©¦åŸ·è¡ŒæŒ‡å¼•

**ç‰ˆæœ¬**: v2.0.0  
**å»ºç«‹æ—¥æœŸ**: 2025-08-13  
**ç¶­è­·è€…**: sage-test-architect (TDD æ¸¬è©¦è¨­è¨ˆå°ˆå®¶)

## ğŸ“‹ æ¸¬è©¦æ¦‚è¦½

æœ¬æ–‡ä»¶èªªæ˜ Platform Domain v2.0 çš„å®Œæ•´æ¸¬è©¦è¨­è¨ˆå’ŒåŸ·è¡Œæ–¹å¼ï¼ŒåŒ…å«å–®å…ƒæ¸¬è©¦ã€æ•´åˆæ¸¬è©¦ã€æ•ˆèƒ½åŸºæº–æ¸¬è©¦ç­‰ã€‚

### ğŸ¯ æ¸¬è©¦ç›®æ¨™

- **100% å–®å…ƒæ¸¬è©¦è¦†è“‹** - æ¶µè“‹æ‰€æœ‰å¯æ¸¬è©¦ç¨‹å¼ç¢¼è·¯å¾‘
- **95%+ æ•´åˆæ¸¬è©¦è¦†è“‹** - ç¢ºä¿æœå‹™é–“å”ä½œæ­£ç¢º
- **æ•ˆèƒ½åŸºæº–é”æ¨™** - ç¬¦åˆ Platform Domain v2.0 æ•ˆèƒ½è¦æ±‚
- **å‘å¾Œç›¸å®¹æ€§ä¿è­‰** - ç¢ºä¿ Readmoo å¹³å°ç„¡ç¸«é·ç§»

### ğŸ“Š æ¸¬è©¦è¦†è“‹ç¯„åœ

#### å·²å¯¦ç¾æ¸¬è©¦ âœ…

1. **Platform Detection Service** (å¹³å°æª¢æ¸¬æœå‹™)
   - å–®å…ƒæ¸¬è©¦: 67 å€‹æ¸¬è©¦æ¡ˆä¾‹
   - æ•´åˆæ¸¬è©¦: 24 å€‹æ¸¬è©¦æ¡ˆä¾‹
   - æ•ˆèƒ½æ¸¬è©¦: 12 å€‹åŸºæº–æ¸¬è©¦
   - è¦†è“‹ç‡ç›®æ¨™: 100%

#### å¾…å¯¦ç¾æ¸¬è©¦ ğŸ“

2. **Platform Registry Service** (å¹³å°è¨»å†Šæœå‹™) - å¾…é–‹ç™¼
3. **Adapter Factory Service** (é©é…å™¨å·¥å» æœå‹™) - å¾…é–‹ç™¼
4. **Platform Switcher Service** (å¹³å°åˆ‡æ›æœå‹™) - å¾…é–‹ç™¼
5. **Platform Domain Coordinator** (é ˜åŸŸå”èª¿å™¨) - å¾…é–‹ç™¼

## ğŸš€ å¿«é€Ÿé–‹å§‹

### åŸ·è¡Œæ‰€æœ‰ Platform Domain æ¸¬è©¦

```bash
# åŸ·è¡Œå®Œæ•´æ¸¬è©¦å¥—ä»¶
npm test -- --testPathPattern="platform"

# åƒ…åŸ·è¡Œå–®å…ƒæ¸¬è©¦
npm test -- tests/unit/background/domains/platform/

# åƒ…åŸ·è¡Œæ•´åˆæ¸¬è©¦
npm test -- tests/integration/platform/

# åƒ…åŸ·è¡Œæ•ˆèƒ½æ¸¬è©¦
npm test -- tests/performance/platform-detection-benchmark.test.js
```

### åŸ·è¡Œç‰¹å®šæœå‹™æ¸¬è©¦

```bash
# Platform Detection Service å–®å…ƒæ¸¬è©¦
npm test -- tests/unit/background/domains/platform/services/platform-detection-service.test.js

# Platform Detection Service æ•´åˆæ¸¬è©¦
npm test -- tests/integration/platform/platform-detection-integration.test.js

# Platform Detection Service æ•ˆèƒ½åŸºæº–æ¸¬è©¦
npm test -- tests/performance/platform-detection-benchmark.test.js
```

### æ¸¬è©¦è¦†è“‹ç‡å ±å‘Š

```bash
# ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
npm run test:coverage -- --testPathPattern="platform"

# æª¢è¦– HTML è¦†è“‹ç‡å ±å‘Š
open coverage/index.html
```

## ğŸ“ æ¸¬è©¦æª”æ¡ˆçµæ§‹

```
tests/
â”œâ”€â”€ unit/background/domains/platform/
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ platform-detection-service.test.js      # ä¸»è¦å–®å…ƒæ¸¬è©¦
â”‚   â””â”€â”€ platform-domain.test.suite.js               # æ¸¬è©¦å¥—ä»¶ç´¢å¼•
â”œâ”€â”€ integration/platform/
â”‚   â””â”€â”€ platform-detection-integration.test.js      # æ•´åˆæ¸¬è©¦
â”œâ”€â”€ performance/
â”‚   â””â”€â”€ platform-detection-benchmark.test.js        # æ•ˆèƒ½åŸºæº–æ¸¬è©¦
â”œâ”€â”€ mocks/
â”‚   â””â”€â”€ platform-detection.mock.js                  # æ¨¡æ“¬è³‡æ–™å’Œå·¥å…·
â”œâ”€â”€ helpers/
â”‚   â””â”€â”€ platform-test-helpers.js                    # æ¸¬è©¦è¼”åŠ©å·¥å…·
â””â”€â”€ README-platform-tests.md                        # æœ¬æ–‡ä»¶
```

## ğŸ§ª æ¸¬è©¦è¨­è¨ˆæ¶æ§‹

### å–®å…ƒæ¸¬è©¦è¨­è¨ˆ (Unit Tests)

**æª”æ¡ˆ**: `tests/unit/background/domains/platform/services/platform-detection-service.test.js`

**æ¸¬è©¦ç¯„åœ**:

- åŸºæœ¬åˆå§‹åŒ–å’Œé…ç½® (5 å€‹æ¸¬è©¦)
- URL æ¨¡å¼åŒ¹é…åˆ†æ (18 å€‹æ¸¬è©¦)
- DOM çµæ§‹ç‰¹å¾µæª¢æ¸¬ (12 å€‹æ¸¬è©¦)
- å¹³å°æª¢æ¸¬æ ¸å¿ƒé‚è¼¯ (8 å€‹æ¸¬è©¦)
- æª¢æ¸¬çµæœå¿«å–ç³»çµ± (6 å€‹æ¸¬è©¦)
- ä¿¡å¿ƒåº¦è¨ˆç®—æ¼”ç®—æ³• (8 å€‹æ¸¬è©¦)
- äº‹ä»¶ç™¼é€å’Œç›£è½ (4 å€‹æ¸¬è©¦)
- éŒ¯èª¤è™•ç†å’Œé‚Šç•Œæƒ…æ³ (4 å€‹æ¸¬è©¦)
- å¹³å°é©—è­‰åŠŸèƒ½ (2 å€‹æ¸¬è©¦)

**é—œéµç‰¹è‰²**:

- ä½¿ç”¨åƒæ•¸åŒ–æ¸¬è©¦ (`test.each`) æ¶µè“‹å¤šå¹³å°å ´æ™¯
- è‡ªè¨‚ Jest åŒ¹é…å™¨æä¾›å°ˆæ¥­çš„æ–·è¨€
- å®Œæ•´çš„é‚Šç•Œæƒ…æ³å’ŒéŒ¯èª¤è™•ç†æ¸¬è©¦
- æ¨¡æ“¬çœŸå¯¦ DOM çµæ§‹å’Œ URL æ¨¡å¼

### æ•´åˆæ¸¬è©¦è¨­è¨ˆ (Integration Tests)

**æª”æ¡ˆ**: `tests/integration/platform/platform-detection-integration.test.js`

**æ¸¬è©¦ç¯„åœ**:

- äº‹ä»¶ç³»çµ±æ•´åˆ (3 å€‹æ¸¬è©¦)
- å¿«å–ç³»çµ±æ•´åˆ (3 å€‹æ¸¬è©¦)
- å¤šå¹³å°æª¢æ¸¬å”èª¿ (3 å€‹æ¸¬è©¦)
- éŒ¯èª¤æ¢å¾©å’Œå®¹éŒ¯æ©Ÿåˆ¶ (3 å€‹æ¸¬è©¦)
- æ•ˆèƒ½åŸºæº–é”æ¨™é©—è­‰ (3 å€‹æ¸¬è©¦)
- è¨˜æ†¶é«”ä½¿ç”¨ç›£æ§ (2 å€‹æ¸¬è©¦)
- ä¸¦ç™¼æª¢æ¸¬è™•ç† (3 å€‹æ¸¬è©¦)

**é—œéµç‰¹è‰²**:

- æ¨¡æ“¬çœŸå¯¦æœå‹™é–“å”ä½œ
- é©—è­‰äº‹ä»¶ç³»çµ±é›™å‘é€šè¨Š
- æ¸¬è©¦ä¸¦ç™¼å ´æ™¯å’Œç«¶æ…‹æ¢ä»¶
- è¨˜æ†¶é«”ä½¿ç”¨å’Œæ•ˆèƒ½ç›£æ§

### æ•ˆèƒ½åŸºæº–æ¸¬è©¦ (Performance Tests)

**æª”æ¡ˆ**: `tests/performance/platform-detection-benchmark.test.js`

**æ•ˆèƒ½åŸºæº–**:

- å¹³å‡æª¢æ¸¬æ™‚é–“: â‰¤ 500ms
- æœ€å¤§æª¢æ¸¬æ™‚é–“: â‰¤ 1000ms
- å¿«å–å‘½ä¸­ç‡: â‰¥ 80%
- è¨˜æ†¶é«”ä½¿ç”¨å¢é•·: â‰¤ 20%
- ä¸¦ç™¼æª¢æ¸¬æˆåŠŸç‡: â‰¥ 95%

**æ¸¬è©¦ç¯„åœ**:

- æª¢æ¸¬é€Ÿåº¦æ•ˆèƒ½åŸºæº– (3 å€‹æ¸¬è©¦)
- å¿«å–æ•ˆç‡æ•ˆèƒ½æ¸¬è©¦ (2 å€‹æ¸¬è©¦)
- è¨˜æ†¶é«”ä½¿ç”¨é‡ç›£æ§ (3 å€‹æ¸¬è©¦)
- ä¸¦ç™¼æª¢æ¸¬æ•ˆèƒ½åŸºæº– (2 å€‹æ¸¬è©¦)
- æ•ˆèƒ½å›æ­¸æ¸¬è©¦ (1 å€‹æ¸¬è©¦)

## ğŸ› ï¸ æ¸¬è©¦å·¥å…·å’Œæ¨¡æ“¬ç‰©ä»¶

### æ¨¡æ“¬è³‡æ–™ (`platform-detection.mock.js`)

**åŠŸèƒ½**:

- 5å€‹å¹³å°çš„ URL æ¨¡å¼æ¸¬è©¦è³‡æ–™ (100+ å€‹çœŸå¯¦ URL)
- DOM å…ƒç´ ç‰¹å¾µæ¨¡æ“¬è³‡æ–™ (é¸æ“‡å™¨ã€å±¬æ€§ã€æ–‡å­—å…§å®¹)
- å‹•æ…‹ DOM æ¨¡æ“¬ç‰©ä»¶å»ºç«‹å™¨
- æª¢æ¸¬ä¸Šä¸‹æ–‡å»ºæ§‹å™¨
- æª¢æ¸¬çµæœé©—è­‰å™¨
- æ•ˆèƒ½æ¸¬è©¦è¼”åŠ©å·¥å…·
- æ¸¬è©¦å ´æ™¯å»ºæ§‹å™¨

**é—œéµç‰¹è‰²**:

- åŸºæ–¼çœŸå¯¦å¹³å°ç¶²ç«™çµæ§‹
- æ”¯æ´å‹•æ…‹å ´æ™¯ç”Ÿæˆ
- å…§å»ºæ•ˆèƒ½ç›£æ§å·¥å…·

### æ¸¬è©¦è¼”åŠ©å·¥å…· (`platform-test-helpers.js`)

**åŠŸèƒ½**:

- è‡ªè¨‚ Jest åŒ¹é…å™¨ (4å€‹å°ˆæ¥­åŒ¹é…å™¨)
- å¹³å°æª¢æ¸¬æ–·è¨€å·¥å…·
- æ¸¬è©¦è³‡æ–™ç”Ÿæˆå™¨
- æ•ˆèƒ½æ¸¬è©¦å·¥å…·
- æ¸¬è©¦å ±å‘Šç”Ÿæˆå™¨

**è‡ªè¨‚åŒ¹é…å™¨**:

- `toBeValidDetectionResult()` - é©—è­‰æª¢æ¸¬çµæœçµæ§‹
- `toHaveConfidenceAbove(threshold)` - é©—è­‰ä¿¡å¿ƒåº¦é–¾å€¼
- `toContainFeatures(features)` - é©—è­‰å¹³å°ç‰¹å¾µ
- `toCompleteWithin(time)` - é©—è­‰æ•ˆèƒ½æ™‚é–“

## ğŸ“Š æ¸¬è©¦åŸ·è¡Œå’Œå ±å‘Š

### æ¸¬è©¦åŸ·è¡Œçµ±è¨ˆ

```bash
# æª¢è¦–æ¸¬è©¦çµ±è¨ˆ
npm test -- --verbose tests/unit/background/domains/platform/platform-domain.test.suite.js
```

**é æœŸè¼¸å‡º**:

```
Platform Domain Test Suite
  âœ“ Platform Detection Service (67 tests)
  â—‹ Platform Registry Service (å¾…å¯¦ç¾)
  â—‹ Adapter Factory Service (å¾…å¯¦ç¾)
  â—‹ Platform Switcher Service (å¾…å¯¦ç¾)
  â—‹ Platform Domain Coordinator (å¾…å¯¦ç¾)

Test Summary:
  Total Tests: 67 implemented + 36 pending
  Unit Tests: 67 âœ…
  Integration Tests: 24 âœ…
  Performance Tests: 12 âœ…
```

### æ•ˆèƒ½åŸºæº–å ±å‘Š

æ•ˆèƒ½æ¸¬è©¦æœƒç”Ÿæˆè©³ç´°çš„åŸºæº–å ±å‘Š:

```
Performance Benchmark Report
============================
Status: PASSED âœ“

Metrics:
- Average Time: 245.32ms (Limit: 500ms)
- Maximum Time: 687.45ms (Limit: 1000ms)
- Success Rate: 100.0% (Min: 95.0%)
- Cache Hit Rate: 92.5% (Target: 80.0%)

All benchmarks passed!
```

## ğŸ”§ æ¸¬è©¦ç’°å¢ƒé…ç½®

### Jest é…ç½®èª¿æ•´

é‡å° Platform Domain æ¸¬è©¦ï¼Œå»ºè­°åœ¨ `jest.config.js` ä¸­èª¿æ•´:

```javascript
module.exports = {
  // é‡å° platform domain çš„ç‰¹æ®Šé…ç½®
  testEnvironment: 'jsdom',

  // å¹³å°æ¸¬è©¦å°ˆç”¨çš„è¦†è“‹ç‡é–¾å€¼
  coverageThreshold: {
    './src/background/domains/platform/': {
      branches: 100,
      functions: 100,
      lines: 100,
      statements: 100
    }
  },

  // æ•ˆèƒ½æ¸¬è©¦è¶…æ™‚è¨­å®š
  testTimeout: 30000, // 30ç§’ï¼Œç”¨æ–¼æ•ˆèƒ½åŸºæº–æ¸¬è©¦

  // å¹³å°æ¸¬è©¦å°ˆç”¨çš„è¨­å®šæª”
  setupFilesAfterEnv: ['<rootDir>/tests/helpers/platform-test-helpers.js']
}
```

### æ¸¬è©¦ç’°å¢ƒè®Šæ•¸

```bash
# é–‹å•Ÿæ•ˆèƒ½æ¸¬è©¦è©³ç´°è¼¸å‡º
PLATFORM_PERF_VERBOSE=true npm test

# é–‹å•Ÿè¨˜æ†¶é«”ç›£æ§
NODE_OPTIONS="--expose-gc" npm test

# æ•ˆèƒ½æ¸¬è©¦å°ˆç”¨æ¨¡å¼
NODE_ENV=performance-test npm test
```

## ğŸ“ æ¸¬è©¦ç¶­è­·æŒ‡å¼•

### æ–°å¢æ¸¬è©¦æ¡ˆä¾‹

1. **å–®å…ƒæ¸¬è©¦æ–°å¢**:
   - åœ¨å°æ‡‰çš„ `describe` å€å¡Šä¸­åŠ å…¥æ–°æ¸¬è©¦
   - ä½¿ç”¨ç¾æœ‰çš„æ¨¡æ“¬è³‡æ–™å’Œè¼”åŠ©å·¥å…·
   - ç¢ºä¿æ¸¬è©¦å‘½åæ¸…æ¥šä¸”æè¿°æ€§å¼·

2. **æ•´åˆæ¸¬è©¦æ–°å¢**:
   - è€ƒæ…®è·¨æœå‹™çš„å”ä½œå ´æ™¯
   - ä½¿ç”¨çœŸå¯¦çš„äº‹ä»¶æµç¨‹æ¸¬è©¦
   - é©—è­‰éŒ¯èª¤è™•ç†å’Œæ¢å¾©æ©Ÿåˆ¶

3. **æ•ˆèƒ½æ¸¬è©¦æ–°å¢**:
   - å®šç¾©æ˜ç¢ºçš„æ•ˆèƒ½åŸºæº–
   - ä½¿ç”¨çµ±ä¸€çš„æ¸¬é‡å·¥å…·
   - æä¾›è©³ç´°çš„æ•ˆèƒ½å ±å‘Š

### æ¸¬è©¦è³‡æ–™ç¶­è­·

- **URL æ¨¡å¼æ›´æ–°**: åœ¨ `PLATFORM_URL_PATTERNS` ä¸­æ–°å¢çœŸå¯¦çš„å¹³å° URL
- **DOM ç‰¹å¾µæ›´æ–°**: åœ¨ `DOM_FEATURES` ä¸­æ›´æ–°å¹³å°çš„ DOM çµæ§‹ç‰¹å¾µ
- **æ•ˆèƒ½åŸºæº–èª¿æ•´**: åœ¨ `PERFORMANCE_BENCHMARKS` ä¸­èª¿æ•´åŸºæº–å€¼

### å¤±æ•—æ¸¬è©¦é™¤éŒ¯

1. **æª¢æŸ¥æ¨¡æ“¬è³‡æ–™**: ç¢ºèªæ¨¡æ“¬çš„ DOM çµæ§‹å’Œ URL æ˜¯å¦ç¬¦åˆçœŸå¯¦æƒ…æ³
2. **é©—è­‰äº‹ä»¶ç™¼é€**: ä½¿ç”¨ `mockEventBus.emit.mock.calls` æª¢æŸ¥äº‹ä»¶ç™¼é€
3. **æ•ˆèƒ½å•é¡Œé™¤éŒ¯**: ä½¿ç”¨ `console.log` è¼¸å‡ºè©³ç´°çš„æ•ˆèƒ½æ¸¬é‡è³‡æ–™
4. **è¨˜æ†¶é«”æ´©æ¼æª¢æŸ¥**: é–‹å•Ÿ `--expose-gc` é¸é …ä¸¦æª¢æŸ¥è¨˜æ†¶é«”ä½¿ç”¨

## ğŸš¨ é‡è¦æ³¨æ„äº‹é …

### ä¸å¯æ¸¬è©¦ç¨‹å¼ç¢¼æ¨™è¨»

æ ¹æ“š TDD è¦æ±‚ï¼Œå°æ–¼ç„¡æ³•æ¸¬è©¦çš„ç¨‹å¼ç¢¼éƒ¨åˆ†ï¼ˆå¦‚ç¬¬ä¸‰æ–¹ API èª¿ç”¨é™åˆ¶ï¼‰ï¼Œå·²åœ¨è¨­è¨ˆæ–‡ä»¶ä¸­æ˜ç¢ºæ¨™è¨»ï¼š

```javascript
// ä¾‹å¦‚ï¼šChrome Extension API èª¿ç”¨
// æ¨™è¨»: ç„¡æ³•ç›´æ¥æ¸¬è©¦ï¼Œä½¿ç”¨æ¨¡æ“¬ç‰©ä»¶ä»£æ›¿
// å»ºè­°: é€éä¾è³´æ³¨å…¥æ”¹å–„å¯æ¸¬è©¦æ€§
```

### æ¸¬è©¦è¦†è“‹ç‡è¦æ±‚

- **å–®å…ƒæ¸¬è©¦**: 100% è¦†è“‹æ‰€æœ‰å¯æ¸¬è©¦ç¨‹å¼ç¢¼
- **æ•´åˆæ¸¬è©¦**: 95%+ è¦†è“‹æœå‹™é–“å”ä½œ
- **æ•ˆèƒ½æ¸¬è©¦**: 100% è¦†è“‹é—œéµæ•ˆèƒ½æŒ‡æ¨™
- **é‚Šç•Œæ¸¬è©¦**: 100% è¦†è“‹éŒ¯èª¤è™•ç†è·¯å¾‘

### CI/CD æ•´åˆ

æ¸¬è©¦å¥—ä»¶å·²è¨­è¨ˆç‚ºæ”¯æ´ CI/CD æµç¨‹:

```bash
# CI/CD ç®¡é“ä¸­çš„æ¸¬è©¦å‘½ä»¤
npm run test:coverage -- --testPathPattern="platform" --ci --watchAll=false
```

---

**å»ºç«‹è€…**: sage-test-architect  
**æœ€å¾Œæ›´æ–°**: 2025-08-13  
**ç‰ˆæœ¬**: v2.0.0

æ­¤æ¸¬è©¦è¨­è¨ˆéµå¾ª CLAUDE.md ä¸­çš„ TDD åš´æ ¼è¦æ±‚å’Œæ¶æ§‹å‚µå‹™é›¶å®¹å¿åŸå‰‡ï¼Œç¢ºä¿ Platform Domain å¯¦ç¾çš„æœ€é«˜å“è³ªå’Œå¯ç¶­è­·æ€§ã€‚
